{
  "metadata": {
    "version": "0.1",
    "parent": null
  },
  "conversation": [
    {
      "id": "ab2ce785-3794-429a-b225-353663ab36fc",
      "timestamp": "2025-08-29T18:42:15.814645+00:00",
      "type": "user_message",
      "content": "The following preamble describes some elements of a language called Metaphor.  Please pay\nextremely close attention to the details as they will affect the way you interpret\neverything that follows after \"BEGIN DESCRIPTION IN METAPHOR:\"\n\nMetaphor is a structured natural language prompt creation language.  It is designed to\nlet a user convey their requirements to a large language model AI.\n\nMetaphor has the structure of a document tree with branches and leaves being prefixed\nby new sections containing the keywords \"Role:\", \"Context:\" or \"Action:\".  Each of\nthese indicates the start of a new block of information.  Blocks are introduced using\nMarkdown-style headings (using hash symbols).  The number of hashes gives an indication\nof the nesting depth and the parent/child relationship.\n\nBlock keywords have an optional name that will immediately follow them on the same line.\nIf this is missing then the block name is not defined.\n\nAfter a block heading there may be one or more lines of text that will describe the purpose\nof that block.  A block may also include one or more optional child blocks inside them and\nthat further clarify their parent block.\n\nWithin the text of a block, you may be presented with code or document fragments inside a\nblock delimited by 3 backticks.  Please pay close attention to the indentation level of the\nopening 3 backticks.  The identation of such code or document fragments is relative to this,\nnot relative to the block in which the code or document fragment occurs.\n\nIf \"Role:\" block exists then this contains details about the role you should fulfil.  This\nmay also describe specific skills you have, knowledge you should apply, and the\napproach you take to apply these.\n\n\"Context:\" blocks provide context necessary to understand what you will be asked to do.\n\n\"Action:\" blocks describes the task, or tasks, you should do.\n\nIf you are asked to offer any opinions on the Metaphor prompt then always provide the full\nset of parent headings leading up to any block you want to talk about.  This will allow\nthe user to understand which part of the Metaphor prompt is being discussed.\n\nWhen you process the actions please carefully ensure you do all of them accurately and\ncomplete all the elements requested.  Unless otherwise instructed, do not include any\nplaceholders in your responses.\n\nBEGIN DESCRIPTION IN METAPHOR:\n\n# Role:\n\nYou are a world class python programmer, highly skilled in accurate and performant software development.  You\nare going to assist me in making modifications to my application.\n\n# Context:\n\n## Context: Python implementation rules\n\nAs an engineer working with the application, I want the application to be easy to use and understand,\nso I can maintain and enhance it over time.\n\n### Context: Implement in Python 3\n\nThe application will be written in the latest version of Python 3.  Assume a baseline of Python 3.10.\n\n### Context: Indentation of code\n\nCode must be indented by 4 spaces.\n\n### Context: Use docstrings\n\nDocstrings must be used to describe all modules, classes, and functions.  This should follow PEP 257 guidelines.\n\n### Context: Use type hints\n\nType hints must be used for function arguments and return values.\n\nAs we're using Python 3.10 as a minimum, use union types.  E.g. use `T | None` instead of `Optional[T]`.\n\n`self` parameters do not need to have type hints.\n\n### Context: Use comments\n\nComments must be used to describe any complex logic, or rationale that would not be obvious from\nsimply reading the code.  This ensures that anyone reading the code for the first time will be able\nto understand why the code is the way it is.\n\n### Context: PEP 8 imports\n\nThe import list in any module should follow PEP 8 guidelines, including the ordering of imports.\n\n### Context: Avoid unnecessary `elif` and `else` statements\n\nTo improve readability, do not use `elif` or `else` statements if the preceding `if` branch ends with\na `return`, `continue`, or `break`.\n\nFor example, do this:\n\n```python\nif condition:\n    return\n\nnext_statement()\n```\n\ninstead of this:\n\n```python\nif condition:\n    return\nelse:\n    next_statement()\n```\n\nThe first version avoids the unecessary else statement.\n\n### Context: Handle error and exception paths early\n\nIf it is possible to detect errors and exceptions early then do so.  Always prefer to do this as early\nas possible within the code so we have the fewest possible conditional checks by the time we reach the\nmain purpose of any function or method.\n\nThis is sometimes known as \"flattening the code to the left\" as there is generally less indentation required\nwhen we do this.  This makes the code easier to read.\n\nFor example do this:\n\n```python\nif error_condition:\n    return\n\nif another_error_condition:\n    return\n\nhandle_happy_path()\n```\n\ninstead of this:\n\n```python\nif not error_condition:\n    if not another_error_condition:\n        handle_happy_path()\n```\n\nWhile the latter has slightly fewer lines of code, it is far more difficult to understand when reading.\n\n### Context: Exception handling philosophy\n\n#### Context: Exception documentation\n\nDocument what exceptions each function may raise in its docstring.\n\n#### Context: Handling exceptions\n\nAttempt to handle and mitigate exceptions at the level closest to which they are first\ndetected.  If we cannot handle or mitigate the exception then it should be wrapped in a domain-appropriate\nexception class and this re-raised to the next level up the call stack.\n\nInclude contextual information when wrapping exceptions.\n\nPreserve the exception chain using `raise ... from e` syntax.\n\n#### Context: Avoid bare `except:` or `except Exception:` clauses.\n\nAvoid the use of bare `except:` or `except Exception:` clauses unless a function we are calling\ncan only have exceptions handled this way.\n\nWe should always catch specific exception types that could occur from an operation.\n\n#### Context: Exception logging\n\nAll exceptions should be logged when they occur, before re-raising or wrapping them.\n\nUse appropriate log levels:\n- ERROR for exceptions that indicate failure.\n- WARNING for exceptions that can be handled/recovered from.\n- DEBUG for detailed exception information during development.\n\nWe must include sufficient context in log messages to aid debugging.\n\nLogging must use lazy evaluation of any arguments rather.\n\n#### Context: Exception wrapping example\n\nDo this:\n\n```python\ntry:\n    await self.api_client.fetch_data()\n\nexcept ConnectionError as e:\n    logger.error(\"Failed to retrieve data from API endpoint\", exc_info=True)\n    raise DataFetchError(f\"Failed to retrieve data from API endpoint: {e}\") from e\n\nexcept TimeoutError as e:\n    logger.warning(\"API request timed out, will retry\", exc_info=True)\n```\n\nNot this:\n\n```python\ntry:\n    await self.api_client.fetch_data()\nexcept Exception as e:\n    logger.error(f\"Error: {e}\")  # Insufficient context, no stack trace\n    raise  # No wrapping or additional context\n```\n\n## Context: Dependencies\n\nLeverage standard library tools before custom solutions, unless specifically instructed, or\nunless a depdency is already in use.\n\n## Context: Tool use\n\nYou have a number of tools at your disposal.  Before using any of them, consider whether you need to use them or\nif you already have the information you require and only use them if you don't have it, or are unsure.\n\n## Context: Existing code\n\nThe following files are used in my application - as you have them here you do not need to re-read them:\n\nFile: src/humbug/main_window.py\n\n```python\n\"\"\"Main window implementation for Humbug application.\"\"\"\n\nimport json\nimport logging\nimport os\nfrom pathlib import Path\nfrom typing import cast, Dict, Tuple\n\nfrom PySide6.QtWidgets import (\n    QMainWindow, QWidget, QVBoxLayout, QMenuBar, QFileDialog,\n    QSplitter, QLabel, QApplication, QDialog, QMenu, QStatusBar\n)\nfrom PySide6.QtCore import Qt, QTimer, QEvent\nfrom PySide6.QtGui import QKeyEvent, QAction, QKeySequence, QActionGroup\n\nfrom metaphor import (\n    MetaphorASTBuilder, MetaphorASTBuilderError, MetaphorFormatVisitor, MetaphorASTRootNode,\n    format_errors, format_preamble\n)\n\nfrom ai_tool import AIToolManager\nfrom ai_tool.tools.calculator_ai_tool import CalculatorAITool\nfrom ai_tool.tools.clock_ai_tool import ClockAITool\nfrom ai_tool.tools.filesystem_ai_tool import FileSystemAITool\n\nfrom humbug.about_dialog import AboutDialog\nfrom humbug.color_role import ColorRole\nfrom humbug.delegate_ai_tool import DelegateAITool\nfrom humbug.message_box import MessageBox, MessageBoxType\nfrom humbug.language.language_manager import LanguageManager\nfrom humbug.mindspace.mindspace_error import MindspaceError, MindspaceExistsError\nfrom humbug.mindspace.mindspace_folders_dialog import MindspaceFoldersDialog\nfrom humbug.mindspace.mindspace_log_level import MindspaceLogLevel\nfrom humbug.mindspace.mindspace_manager import MindspaceManager\nfrom humbug.mindspace.mindspace_settings import MindspaceSettings\nfrom humbug.mindspace.mindspace_settings_dialog import MindspaceSettingsDialog\nfrom humbug.mindspace.mindspace_view import MindspaceView\nfrom humbug.mindspace.mindspace_view_type import MindspaceViewType\nfrom humbug.style_manager import StyleManager, ColorMode\nfrom humbug.status_message import StatusMessage\nfrom humbug.system_ai_tool import SystemAITool\nfrom humbug.tabs.column_manager import ColumnManager\nfrom humbug.tabs.conversation.conversation_error import ConversationError\nfrom humbug.tabs.conversation.conversation_tab import ConversationTab\nfrom humbug.tabs.shell.commands.shell_command_clear import ShellCommandClear\nfrom humbug.tabs.shell.commands.shell_command_conversation import ShellCommandConversation\nfrom humbug.tabs.shell.commands.shell_command_edit import ShellCommandEdit\nfrom humbug.tabs.shell.commands.shell_command_help import ShellCommandHelp\nfrom humbug.tabs.shell.commands.shell_command_log import ShellCommandLog\nfrom humbug.tabs.shell.commands.shell_command_m6rc import ShellCommandM6rc\nfrom humbug.tabs.shell.commands.shell_command_terminal import ShellCommandTerminal\nfrom humbug.tabs.shell.commands.shell_command_wiki import ShellCommandWiki\nfrom humbug.tabs.shell.shell_command_registry import ShellCommandRegistry\nfrom humbug.tabs.tab_base import TabBase\nfrom humbug.tabs.wiki.wiki_error import WikiError\nfrom humbug.tabs.wiki.wiki_tab import WikiTab\nfrom humbug.user.user_manager import UserManager, UserError\nfrom humbug.user.user_settings import UserSettings\nfrom humbug.user.user_settings_dialog import UserSettingsDialog\n\n\nclass MainWindow(QMainWindow):\n    \"\"\"Main window for the Humbug application.\"\"\"\n\n    def __init__(self) -> None:\n        \"\"\"Initialize the main window.\"\"\"\n        super().__init__()\n\n        self._logger = logging.getLogger(\"MainWindow\")\n\n        self._language_manager = LanguageManager()\n        self._language_manager.language_changed.connect(self._on_language_changed)\n        strings = self._language_manager.strings()\n\n        # Humbug menu actions\n        self._about_action = QAction(strings.about_humbug, self)\n        self._about_action.setMenuRole(QAction.MenuRole.AboutRole)\n        self._about_action.triggered.connect(self._show_about_dialog)\n\n        self._user_settings_action = QAction(strings.user_settings, self)\n        self._user_settings_action.setMenuRole(QAction.MenuRole.PreferencesRole)\n        self._user_settings_action.setShortcut(QKeySequence(\"Ctrl+,\"))\n        self._user_settings_action.triggered.connect(self._show_user_settings_dialog)\n\n        self._quit_action = QAction(strings.quit_humbug, self)\n        self._quit_action.setMenuRole(QAction.MenuRole.QuitRole)\n        self._quit_action.setShortcut(QKeySequence(\"Ctrl+Q\"))\n        self._quit_action.triggered.connect(self.close)\n\n        # File menu actions\n        self._new_mindspace_action = QAction(strings.new_mindspace, self)\n        self._new_mindspace_action.setShortcut(QKeySequence(\"Ctrl+Alt+N\"))\n        self._new_mindspace_action.triggered.connect(self._new_mindspace)\n\n        self._new_conv_action = QAction(strings.new_conversation, self)\n        self._new_conv_action.setShortcut(QKeySequence(\"Ctrl+Shift+N\"))\n        self._new_conv_action.triggered.connect(self._new_conversation)\n\n        self._new_metaphor_conv_action = QAction(strings.new_metaphor_conversation, self)\n        self._new_metaphor_conv_action.setShortcut(QKeySequence(\"Ctrl+Shift+M\"))\n        self._new_metaphor_conv_action.triggered.connect(self._new_metaphor_conversation)\n\n        self._new_file_action = QAction(strings.new_file, self)\n        self._new_file_action.setShortcut(QKeySequence.StandardKey.New)\n        self._new_file_action.triggered.connect(self._new_file)\n\n        self._new_terminal_action = QAction(strings.new_terminal, self)\n        self._new_terminal_action.setShortcut(QKeySequence(\"Ctrl+Alt+T\"))\n        self._new_terminal_action.triggered.connect(self._new_terminal)\n\n        self._open_mindspace_action = QAction(strings.open_mindspace, self)\n        self._open_mindspace_action.setShortcut(QKeySequence(\"Ctrl+Alt+O\"))\n        self._open_mindspace_action.triggered.connect(self._open_mindspace)\n\n        self._open_wiki_action = QAction(strings.open_wiki, self)\n        self._open_wiki_action.setShortcut(QKeySequence(\"Ctrl+Shift+W\"))\n        self._open_wiki_action.triggered.connect(self._open_wiki)\n\n        self._open_conv_action = QAction(strings.open_conversation, self)\n        self._open_conv_action.setShortcut(QKeySequence(\"Ctrl+Shift+O\"))\n        self._open_conv_action.triggered.connect(self._open_conversation)\n\n        self._open_file_action = QAction(strings.open_file, self)\n        self._open_file_action.setShortcut(QKeySequence.StandardKey.Open)\n        self._open_file_action.triggered.connect(self._open_file)\n\n        self._fork_conv_action = QAction(strings.fork_conversation, self)\n        self._fork_conv_action.setShortcut(QKeySequence(\"Ctrl+Shift+F\"))\n        self._fork_conv_action.triggered.connect(self._fork_conversation)\n\n        self._save_action = QAction(strings.save, self)\n        self._save_action.setShortcut(QKeySequence.StandardKey.Save)\n        self._save_action.triggered.connect(self._save_file)\n\n        self._save_as_action = QAction(strings.save_as, self)\n        self._save_as_action.setShortcut(QKeySequence.StandardKey.SaveAs)\n        self._save_as_action.triggered.connect(self._save_file_as)\n\n        self._close_tab_action = QAction(strings.close_tab, self)\n        self._close_tab_action.setShortcut(QKeySequence(\"Ctrl+W\"))\n        self._close_tab_action.triggered.connect(self._close_tab)\n\n        self._close_mindspace_action = QAction(strings.close_mindspace, self)\n        self._close_mindspace_action.setShortcut(QKeySequence(\"Ctrl+Alt+W\"))\n        self._close_mindspace_action.triggered.connect(self._close_mindspace)\n\n        # Edit menu actions\n        self._submit_message_action = QAction(strings.submit_message, self)\n        self._submit_message_action.setShortcut(QKeySequence(\"Ctrl+J\"))\n        self._submit_message_action.triggered.connect(self._submit_message)\n\n        self._undo_action = QAction(strings.undo, self)\n        self._undo_action.setShortcut(QKeySequence(\"Ctrl+Z\"))\n        self._undo_action.triggered.connect(self._undo)\n\n        self._redo_action = QAction(strings.redo, self)\n        self._redo_action.setShortcut(QKeySequence(\"Ctrl+Shift+Z\"))\n        self._redo_action.triggered.connect(self._redo)\n\n        self._cut_action = QAction(strings.cut, self)\n        self._cut_action.setShortcut(QKeySequence(\"Ctrl+X\"))\n        self._cut_action.triggered.connect(self._cut)\n\n        self._copy_action = QAction(strings.copy, self)\n        self._copy_action.setShortcut(QKeySequence(\"Ctrl+C\"))\n        self._copy_action.triggered.connect(self._copy)\n\n        self._paste_action = QAction(strings.paste, self)\n        self._paste_action.setShortcut(QKeySequence(\"Ctrl+V\"))\n        self._paste_action.triggered.connect(self._paste)\n\n        self._find_action = QAction(strings.find, self)\n        self._find_action.setShortcut(QKeySequence.StandardKey.Find)\n        self._find_action.triggered.connect(self._find)\n\n        self._mindspace_settings_action = QAction(strings.mindspace_settings, self)\n        self._mindspace_settings_action.setShortcut(QKeySequence(\"Ctrl+Alt+,\"))\n        self._mindspace_settings_action.triggered.connect(self._show_mindspace_settings_dialog)\n\n        self._conv_settings_action = QAction(strings.conversation_settings, self)\n        self._conv_settings_action.setShortcut(QKeySequence(\"Ctrl+Shift+,\"))\n        self._conv_settings_action.triggered.connect(self._show_conversation_settings_dialog)\n\n        # View menu actions - Theme menu will be created in _on_language_changed\n        self._theme_menu: QMenu | None = None\n        self._theme_actions: Dict[ColorMode, QAction] = {}\n\n        self._zoom_in_action = QAction(strings.zoom_in, self)\n        self._zoom_in_action.setShortcut(QKeySequence(\"Ctrl+=\"))\n        self._zoom_in_action.triggered.connect(lambda: self._handle_zoom(1.0800597))\n\n        self._zoom_out_action = QAction(strings.zoom_out, self)\n        self._zoom_out_action.setShortcut(QKeySequence(\"Ctrl+-\"))\n        self._zoom_out_action.triggered.connect(lambda: self._handle_zoom(1/1.0800597))\n\n        self._reset_zoom_action = QAction(strings.reset_zoom, self)\n        self._reset_zoom_action.setShortcut(QKeySequence(\"Ctrl+0\"))\n        self._reset_zoom_action.triggered.connect(lambda: self._set_zoom(1.0))\n\n        self._show_system_log_action = QAction(strings.show_system_log, self)\n        self._show_system_log_action.setShortcut(QKeySequence(\"Ctrl+Shift+L\"))\n        self._show_system_log_action.triggered.connect(self._show_system_log)\n\n        self._show_system_shell_action = QAction(strings.show_system_shell, self)\n        self._show_system_shell_action.setShortcut(QKeySequence(\"Ctrl+Shift+Y\"))\n        self._show_system_shell_action.triggered.connect(self._show_system_shell)\n\n        self._show_all_columns_action = QAction(strings.show_all_columns, self)\n        self._show_all_columns_action.setShortcut(QKeySequence(\"Ctrl+\\\\\"))\n        self._show_all_columns_action.triggered.connect(self._show_all_columns)\n\n        self._split_column_left_action = QAction(strings.split_column_left, self)\n        self._split_column_left_action.setShortcut(QKeySequence(\"Ctrl+Shift+[\"))\n\n        self._split_column_right_action = QAction(strings.split_column_right, self)\n        self._split_column_right_action.setShortcut(QKeySequence(\"Ctrl+Shift+]\"))\n\n        self._merge_column_left_action = QAction(strings.merge_column_left, self)\n        self._merge_column_left_action.setShortcut(QKeySequence(\"Ctrl+[\"))\n\n        self._merge_column_right_action = QAction(strings.merge_column_right, self)\n        self._merge_column_right_action.setShortcut(QKeySequence(\"Ctrl+]\"))\n\n        self._swap_column_left_action = QAction(strings.swap_column_left, self)\n        self._swap_column_left_action.setShortcut(QKeySequence(\"Ctrl+Alt+[\"))\n\n        self._swap_column_right_action = QAction(strings.swap_column_right, self)\n        self._swap_column_right_action.setShortcut(QKeySequence(\"Ctrl+Alt+]\"))\n\n        self._next_message_action = QAction(strings.next_message, self)\n        self._next_message_action.setShortcut(QKeySequence(\"Alt+Down\"))\n        self._next_message_action.triggered.connect(self._navigate_next_message)\n\n        self._previous_message_action = QAction(strings.previous_message, self)\n        self._previous_message_action.setShortcut(QKeySequence(\"Alt+Up\"))\n        self._previous_message_action.triggered.connect(self._navigate_previous_message)\n\n        self._toggle_bookmark_action = QAction(strings.bookmark_section, self)\n        self._toggle_bookmark_action.setCheckable(True)\n        self._toggle_bookmark_action.setShortcut(QKeySequence(\"Ctrl+B\"))\n        self._toggle_bookmark_action.triggered.connect(self._toggle_bookmark)\n\n        self._next_bookmark_action = QAction(strings.next_bookmark, self)\n        self._next_bookmark_action.setShortcut(QKeySequence(\"Ctrl+Shift+N\"))\n        self._next_bookmark_action.triggered.connect(self._navigate_next_bookmark)\n\n        self._previous_bookmark_action = QAction(strings.previous_bookmark, self)\n        self._previous_bookmark_action.setShortcut(QKeySequence(\"Ctrl+Shift+P\"))\n        self._previous_bookmark_action.triggered.connect(self._navigate_previous_bookmark)\n\n        self._menu_bar = QMenuBar(self)\n        self.setMenuBar(self._menu_bar)\n\n        # Humbug menu\n        self._humbug_menu = self._menu_bar.addMenu(strings.humbug_menu)\n        self._humbug_menu.addAction(self._about_action)\n        self._humbug_menu.addSeparator()\n        self._humbug_menu.addAction(self._user_settings_action)\n        self._humbug_menu.addSeparator()\n        self._humbug_menu.addAction(self._quit_action)\n\n        # File menu\n        self._file_menu = self._menu_bar.addMenu(strings.file_menu)\n        self._file_menu.addAction(self._new_mindspace_action)\n        self._file_menu.addAction(self._new_conv_action)\n        self._file_menu.addAction(self._new_metaphor_conv_action)\n        self._file_menu.addAction(self._new_file_action)\n        self._file_menu.addAction(self._new_terminal_action)\n        self._file_menu.addSeparator()\n        self._file_menu.addAction(self._open_mindspace_action)\n        self._file_menu.addAction(self._open_wiki_action)\n        self._file_menu.addAction(self._open_conv_action)\n        self._file_menu.addAction(self._open_file_action)\n        self._file_menu.addSeparator()\n        self._file_menu.addAction(self._fork_conv_action)\n        self._file_menu.addSeparator()\n        self._file_menu.addAction(self._save_action)\n        self._file_menu.addAction(self._save_as_action)\n        self._file_menu.addSeparator()\n        self._file_menu.addAction(self._close_mindspace_action)\n        self._file_menu.addAction(self._close_tab_action)\n\n        # Edit menu\n        self._edit_menu = self._menu_bar.addMenu(strings.edit_menu)\n        self._edit_menu.addAction(self._submit_message_action)\n        self._edit_menu.addSeparator()\n        self._edit_menu.addAction(self._undo_action)\n        self._edit_menu.addAction(self._redo_action)\n        self._edit_menu.addSeparator()\n        self._edit_menu.addAction(self._cut_action)\n        self._edit_menu.addAction(self._copy_action)\n        self._edit_menu.addAction(self._paste_action)\n        self._edit_menu.addSeparator()\n        self._edit_menu.addAction(self._find_action)\n        self._edit_menu.addSeparator()\n        self._edit_menu.addAction(self._mindspace_settings_action)\n        self._edit_menu.addAction(self._conv_settings_action)\n\n        # View menu\n        self._view_menu = self._menu_bar.addMenu(strings.view_menu)\n\n        # Theme menu will be added when language changes\n        self._view_menu.addSeparator()\n        self._view_menu.addAction(self._zoom_in_action)\n        self._view_menu.addAction(self._zoom_out_action)\n        self._view_menu.addAction(self._reset_zoom_action)\n        self._view_menu.addSeparator()\n        self._view_menu.addAction(self._show_system_log_action)\n        self._view_menu.addAction(self._show_system_shell_action)\n        self._view_menu.addSeparator()\n        self._view_menu.addAction(self._show_all_columns_action)\n        self._view_menu.addAction(self._split_column_left_action)\n        self._view_menu.addAction(self._split_column_right_action)\n        self._view_menu.addAction(self._merge_column_left_action)\n        self._view_menu.addAction(self._merge_column_right_action)\n        self._view_menu.addAction(self._swap_column_left_action)\n        self._view_menu.addAction(self._swap_column_right_action)\n        self._view_menu.addSeparator()\n        self._view_menu.addAction(self._next_message_action)\n        self._view_menu.addAction(self._previous_message_action)\n        self._view_menu.addSeparator()\n        self._view_menu.addAction(self._toggle_bookmark_action)\n        self._view_menu.addAction(self._next_bookmark_action)\n        self._view_menu.addAction(self._previous_bookmark_action)\n\n        self.setWindowTitle(\"Humbug\")\n        self.setMinimumSize(1280, 800)\n\n        # Main widget and layout\n        main_widget = QWidget()\n        self.setCentralWidget(main_widget)\n        layout = QVBoxLayout(main_widget)\n        layout.setSpacing(0)\n        layout.setContentsMargins(0, 0, 0, 0)\n\n        # Create splitter\n        self._splitter = QSplitter(Qt.Orientation.Horizontal)\n        layout.addWidget(self._splitter)\n\n        # Create and add mindspace view\n        self._mindspace_view = MindspaceView(self)\n        self._mindspace_view.file_clicked.connect(self._on_mindspace_view_file_clicked)\n        self._mindspace_view.file_deleted.connect(self._on_mindspace_view_file_deleted)\n        self._mindspace_view.file_renamed.connect(self._on_mindspace_view_file_renamed)\n        self._mindspace_view.file_edited.connect(self._on_mindspace_view_file_edited)\n        self._mindspace_view.file_opened_in_wiki.connect(self._on_mindspace_view_file_opened_in_wiki)\n        self._splitter.addWidget(self._mindspace_view)\n\n        # Create tab manager in splitter\n        self._column_manager = ColumnManager(self)\n        self._column_manager.tab_changed.connect(self._on_column_manager_tab_changed)\n        self._column_manager.fork_requested.connect(self._on_column_manager_fork_requested)\n        self._column_manager.fork_from_index_requested.connect(self._on_column_manager_fork_from_index_requested)\n        self._column_manager.open_wiki_link_requested.connect(self._on_column_manager_open_wiki_link_requested)\n        self._column_manager.edit_file_requested.connect(self._on_column_manager_edit_file_requested)\n        self._splitter.addWidget(self._column_manager)\n\n        # Set initial mindspace view width\n        self._splitter.setSizes([300, self.width() - 300])\n\n        # Set the stretch factors: 0 for mindspace view (no stretch) and 1 for column manager (stretch to fill)\n        self._splitter.setStretchFactor(0, 0)\n        self._splitter.setStretchFactor(1, 1)\n\n        self._style_manager = StyleManager()\n        self._style_manager.style_changed.connect(self._on_style_changed)\n\n        # Create a timer that fires every 50ms to keep our menu states correct\n        self._menu_timer = QTimer()\n        self._menu_timer.setInterval(50)\n        self._menu_timer.timeout.connect(self._update_menu_state)\n        self._menu_timer.start()\n\n        # Create status bar\n        self._status_bar = QStatusBar()\n        self._status_message_label = QLabel()\n        self._status_bar.addPermanentWidget(self._status_message_label)\n\n        self.setStatusBar(self._status_bar)\n        self._column_manager.status_message.connect(self._on_column_manager_status_message)\n\n        self._on_language_changed()\n\n        self._user_manager = UserManager()\n        user_settings = self._user_manager.settings()\n        self._style_manager.set_user_font_size(user_settings.font_size)\n        self._language_manager.set_language(user_settings.language)\n\n        # Set theme from user settings\n        self._style_manager.set_color_mode(user_settings.theme)\n        self._update_theme_menu()\n\n        self._mindspace_manager = MindspaceManager()\n\n        # Initialize command registry and register commands\n        self._command_registry = ShellCommandRegistry()\n        self._command_registry.register_command(ShellCommandClear(self._column_manager))\n        self._command_registry.register_command(ShellCommandConversation(self._column_manager))\n        self._command_registry.register_command(ShellCommandEdit(self._column_manager))\n        self._command_registry.register_command(ShellCommandLog(self._column_manager))\n        self._command_registry.register_command(ShellCommandM6rc(self._column_manager))\n        self._command_registry.register_command(ShellCommandTerminal(self._column_manager))\n        self._command_registry.register_command(ShellCommandWiki(self._column_manager))\n\n        # Register help command last so it can see all other commands\n        self._command_registry.register_command(ShellCommandHelp(self._command_registry))\n\n        self._ai_tool_manager = AIToolManager()\n        self._ai_tool_manager.register_tool(\n            CalculatorAITool(), \"Calculator: performs arithmetic, trigonometry, logarithms, and other calculations\"\n        )\n        self._ai_tool_manager.register_tool(ClockAITool(), \"Clock: gets the current time and date\")\n        self._ai_tool_manager.register_tool(\n            DelegateAITool(self._column_manager), \"Delegate: delegates tasks to specialized AI instances\"\n        )\n        self._ai_tool_manager.register_tool(\n            FileSystemAITool(self._resolve_mindspace_path), \"FileSystem: handles file operations in the current mindspace\"\n        )\n        self._ai_tool_manager.register_tool(SystemAITool(self._column_manager), \"System: implements UI automations within Humbug\")\n\n        QTimer.singleShot(0, self._restore_last_mindspace)\n\n    def changeEvent(self, event: QEvent) -> None:\n        \"\"\"Handle change events.\"\"\"\n        # If our window state changes then update the column manager's style\n        if event.type() == QEvent.Type.WindowStateChange:\n            self._column_manager.apply_style()\n\n        return super().changeEvent(event)\n\n    def _update_menu_state(self) -> None:\n        \"\"\"Update enabled/disabled state of menu items.\"\"\"\n        # Update mindspace-specific actions\n        has_mindspace = self._mindspace_manager.has_mindspace()\n        self._close_mindspace_action.setEnabled(has_mindspace)\n        self._new_conv_action.setEnabled(has_mindspace)\n        self._new_metaphor_conv_action.setEnabled(has_mindspace)\n        self._new_file_action.setEnabled(has_mindspace)\n        self._open_wiki_action.setEnabled(has_mindspace)\n        self._open_conv_action.setEnabled(has_mindspace)\n        self._open_file_action.setEnabled(has_mindspace)\n        self._new_terminal_action.setEnabled(has_mindspace)\n        self._mindspace_settings_action.setEnabled(has_mindspace)\n\n        # Update tab-specific actions\n        column_manager = self._column_manager\n        self._fork_conv_action.setEnabled(column_manager.can_fork_conversation())\n        self._save_action.setEnabled(column_manager.can_save_file())\n        self._save_as_action.setEnabled(column_manager.can_save_file_as())\n        self._close_tab_action.setEnabled(column_manager.can_close_tab())\n        self._undo_action.setEnabled(column_manager.can_undo())\n        self._redo_action.setEnabled(column_manager.can_redo())\n        self._cut_action.setEnabled(column_manager.can_cut())\n        self._copy_action.setEnabled(column_manager.can_copy())\n        self._paste_action.setEnabled(column_manager.can_paste())\n        self._find_action.setEnabled(column_manager.can_show_find())\n        self._submit_message_action.setEnabled(column_manager.can_submit_message())\n        self._conv_settings_action.setEnabled(column_manager.can_show_conversation_settings_dialog())\n\n        # Update view actions\n        current_zoom = self._style_manager.zoom_factor()\n        left_to_right = self._language_manager.left_to_right()\n        self._zoom_in_action.setEnabled(current_zoom < 2.0)\n        self._zoom_out_action.setEnabled(current_zoom > 0.5)\n        self._show_system_log_action.setEnabled(has_mindspace)\n        self._show_system_shell_action.setEnabled(has_mindspace)\n        self._show_all_columns_action.setEnabled(column_manager.can_show_all_columns())\n        self._split_column_left_action.setEnabled(column_manager.can_split_column())\n        self._split_column_right_action.setEnabled(column_manager.can_split_column())\n        self._merge_column_left_action.setEnabled(column_manager.can_merge_column(left_to_right))\n        self._merge_column_right_action.setEnabled(column_manager.can_merge_column(not left_to_right))\n        self._swap_column_left_action.setEnabled(column_manager.can_swap_column(left_to_right))\n        self._swap_column_right_action.setEnabled(column_manager.can_swap_column(not left_to_right))\n        self._next_message_action.setEnabled(column_manager.can_navigate_next_message())\n        self._previous_message_action.setEnabled(column_manager.can_navigate_previous_message())\n        self._toggle_bookmark_action.setEnabled(column_manager.can_toggle_bookmark())\n        self._next_bookmark_action.setEnabled(column_manager.can_navigate_next_bookmark())\n        self._previous_bookmark_action.setEnabled(column_manager.can_navigate_previous_bookmark())\n\n    def _on_language_changed(self) -> None:\n        \"\"\"Update UI text when language changes.\"\"\"\n        app = cast(QApplication, QApplication.instance())\n        left_to_right = self._language_manager.left_to_right()\n        if left_to_right:\n            app.setLayoutDirection(Qt.LayoutDirection.LeftToRight)\n\n        else:\n            app.setLayoutDirection(Qt.LayoutDirection.RightToLeft)\n\n        strings = self._language_manager.strings()\n\n        # Update menu titles\n        self._humbug_menu.setTitle(strings.humbug_menu)\n        self._edit_menu.setTitle(strings.edit_menu)\n        self._file_menu.setTitle(strings.file_menu)\n        self._view_menu.setTitle(strings.view_menu)\n\n        # Update action texts\n        self._about_action.setText(strings.about_humbug)\n        self._user_settings_action.setText(strings.user_settings)\n        self._quit_action.setText(strings.quit_humbug)\n        self._new_mindspace_action.setText(strings.new_mindspace)\n        self._new_conv_action.setText(strings.new_conversation)\n        self._new_metaphor_conv_action.setText(strings.new_metaphor_conversation)\n        self._new_file_action.setText(strings.new_file)\n        self._open_mindspace_action.setText(strings.open_mindspace)\n        self._open_wiki_action.setText(strings.open_wiki)\n        self._open_conv_action.setText(strings.open_conversation)\n        self._open_file_action.setText(strings.open_file)\n        self._fork_conv_action.setText(strings.fork_conversation)\n        self._save_action.setText(strings.save)\n        self._save_as_action.setText(strings.save_as)\n        self._close_tab_action.setText(strings.close_tab)\n        self._close_mindspace_action.setText(strings.close_mindspace)\n        self._submit_message_action.setText(strings.submit_message)\n        self._undo_action.setText(strings.undo)\n        self._redo_action.setText(strings.redo)\n        self._cut_action.setText(strings.cut)\n        self._copy_action.setText(strings.copy)\n        self._paste_action.setText(strings.paste)\n        self._find_action.setText(strings.find)\n        self._mindspace_settings_action.setText(strings.mindspace_settings)\n        self._conv_settings_action.setText(strings.conversation_settings)\n\n        # Recreate the theme menu with updated language strings\n        if self._theme_menu is not None:\n            self._view_menu.removeAction(self._theme_menu.menuAction())\n\n        self._theme_menu = self._create_theme_menu()\n        self._view_menu.insertMenu(self._zoom_in_action, self._theme_menu)\n\n        self._zoom_in_action.setText(strings.zoom_in)\n        self._zoom_out_action.setText(strings.zoom_out)\n        self._reset_zoom_action.setText(strings.reset_zoom)\n        self._show_system_shell_action.setText(strings.show_system_shell)\n        self._show_all_columns_action.setText(strings.show_all_columns)\n        self._split_column_left_action.setText(strings.split_column_left)\n        self._split_column_right_action.setText(strings.split_column_right)\n        self._merge_column_left_action.setText(strings.merge_column_left)\n        self._merge_column_right_action.setText(strings.merge_column_right)\n        self._swap_column_left_action.setText(strings.swap_column_left)\n        self._swap_column_right_action.setText(strings.swap_column_right)\n        self._next_message_action.setText(strings.next_message)\n        self._previous_message_action.setText(strings.previous_message)\n        self._toggle_bookmark_action.setText(strings.bookmark_section)\n        self._next_bookmark_action.setText(strings.next_bookmark)\n        self._previous_bookmark_action.setText(strings.previous_bookmark)\n\n        # Our logic for left and right reverses for right-to-left languages\n        left_to_right = self._language_manager.left_to_right()\n        self._split_column_left_action.triggered.disconnect()\n        self._split_column_left_action.triggered.connect(lambda: self._split_column(left_to_right))\n        self._split_column_right_action.triggered.disconnect()\n        self._split_column_right_action.triggered.connect(lambda: self._split_column(not left_to_right))\n        self._merge_column_left_action.triggered.disconnect()\n        self._merge_column_left_action.triggered.connect(lambda: self._merge_column(left_to_right))\n        self._merge_column_right_action.triggered.disconnect()\n        self._merge_column_right_action.triggered.connect(lambda: self._merge_column(not left_to_right))\n        self._swap_column_left_action.triggered.disconnect()\n        self._swap_column_left_action.triggered.connect(lambda: self._swap_column(left_to_right))\n        self._swap_column_right_action.triggered.disconnect()\n        self._swap_column_right_action.triggered.connect(lambda: self._swap_column(not left_to_right))\n\n        self._on_style_changed()\n\n    def _create_theme_menu(self) -> QMenu:\n        \"\"\"\n        Create a display theme submenu with available themes.\n\n        Returns:\n            QMenu: The theme submenu\n        \"\"\"\n        strings = self._language_manager.strings()\n\n        # Create the theme menu\n        theme_menu = QMenu(strings.display_theme, self)\n\n        # Create an action group so only one theme can be selected at a time\n        theme_action_group = QActionGroup(self)\n        theme_action_group.setExclusive(True)\n\n        # Create the theme actions dictionary to store references\n        self._theme_actions = {}\n\n        # Add Light theme action\n        light_action = QAction(strings.theme_light, self)\n        light_action.setCheckable(True)\n        light_action.setChecked(self._style_manager.color_mode() == ColorMode.LIGHT)\n        light_action.triggered.connect(lambda: self._set_color_mode(ColorMode.LIGHT))\n        theme_action_group.addAction(light_action)\n        theme_menu.addAction(light_action)\n        self._theme_actions[ColorMode.LIGHT] = light_action\n\n        # Add Dark theme action\n        dark_action = QAction(strings.theme_dark, self)\n        dark_action.setCheckable(True)\n        dark_action.setChecked(self._style_manager.color_mode() == ColorMode.DARK)\n        dark_action.triggered.connect(lambda: self._set_color_mode(ColorMode.DARK))\n        theme_action_group.addAction(dark_action)\n        theme_menu.addAction(dark_action)\n        self._theme_actions[ColorMode.DARK] = dark_action\n\n        return theme_menu\n\n    def _update_theme_menu(self) -> None:\n        \"\"\"Update the theme menu to reflect the current selected theme.\"\"\"\n        # Set the checked state for the appropriate theme action\n        for theme, action in self._theme_actions.items():\n            action.setChecked(theme == self._style_manager.color_mode())\n\n    def _set_color_mode(self, theme: ColorMode) -> None:\n        \"\"\"\n        Set the color mode (theme) for the application.\n\n        Args:\n            theme: The new theme to apply\n        \"\"\"\n        self._style_manager.set_color_mode(theme)\n\n    def _map_tab_to_mindspace_view(self, tab: TabBase) -> MindspaceViewType:\n        \"\"\"Map a tab to its corresponding mindspace view type.\"\"\"\n        if isinstance(tab, ConversationTab):\n            return MindspaceViewType.CONVERSATIONS\n\n        if isinstance(tab, WikiTab):\n            return MindspaceViewType.WIKI\n\n        return MindspaceViewType.FILES\n\n    def _on_column_manager_tab_changed(self) -> None:\n        \"\"\"Handle tab change events.\"\"\"\n        current_tab = self._column_manager.get_current_tab()\n        if current_tab is None:\n            return\n\n        path = current_tab.path()\n        if path is None:\n            return\n\n        view_type = self._map_tab_to_mindspace_view(current_tab)\n        self._mindspace_view.reveal_and_select_file(view_type, path)\n\n    def _on_column_manager_status_message(self, message: StatusMessage) -> None:\n        \"\"\"Update status bar with new message.\"\"\"\n        self._status_message_label.setText(message.text)\n        if message.timeout:\n            QTimer.singleShot(message.timeout, self._status_message_label.clear)\n\n    def _restore_last_mindspace(self) -> None:\n        \"\"\"Restore last mindspace on startup if available.\"\"\"\n        try:\n            with open(os.path.expanduser(\"~/.humbug/mindspace.json\"), encoding='utf-8') as f:\n                data = json.load(f)\n                mindspace_path = data.get(\"lastMindspace\")\n                if mindspace_path and os.path.exists(mindspace_path):\n                    try:\n                        self._mindspace_manager.open_mindspace(mindspace_path)\n                        self._mindspace_view.set_mindspace(mindspace_path)\n                        self._restore_mindspace_state()\n\n                    except MindspaceError as e:\n                        self._logger.error(\"Failed to restore mindspace: %s\", str(e))\n                        # Don't show error dialog on startup, just log it\n\n        except (FileNotFoundError, json.JSONDecodeError):\n            pass\n\n    def _new_mindspace(self) -> None:\n        \"\"\"Show folder selection dialog and create new mindspace.\"\"\"\n        self._menu_timer.stop()\n        strings = self._language_manager.strings()\n        dir_path = QFileDialog.getExistingDirectory(\n            self, strings.file_dialog_new_mindspace\n        )\n        self._menu_timer.start()\n        if not dir_path:\n            return\n\n        if self._mindspace_manager.is_already_mindspace(dir_path):\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.mindspace_exists_error\n            )\n            return\n\n        # Show folder configuration dialog\n        dialog = MindspaceFoldersDialog(dir_path, self)\n        if dialog.exec() != QDialog.DialogCode.Accepted:\n            return\n\n        try:\n            # Create mindspace with selected folders\n            self._mindspace_manager.create_mindspace(dir_path, dialog.get_selected_folders())\n\n        except MindspaceExistsError:\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.mindspace_exists_error\n            )\n            return\n\n        except MindspaceError as e:\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.error_creating_mindspace.format(str(e))\n            )\n            return\n\n        self._open_mindspace_path(dir_path)\n\n    def _open_mindspace(self) -> None:\n        \"\"\"Open a new mindspace.\"\"\"\n        self._menu_timer.stop()\n        strings = self._language_manager.strings()\n        dir_path = QFileDialog.getExistingDirectory(self, strings.file_dialog_open_mindspace)\n        self._menu_timer.start()\n        if not dir_path:\n            return\n\n        self._open_mindspace_path(dir_path)\n\n    def _open_mindspace_path(self, path: str) -> None:\n        # Before we do anything, check if the new location is a mindspace\n        if not self._mindspace_manager.check_mindspace(path):\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.error_opening_mindspace.format(path)\n            )\n            return\n\n        # If we're switching mindspaces, save the current one first\n        if self._mindspace_manager.has_mindspace():\n            self._save_mindspace_state()\n            if not self._close_all_tabs():\n                return\n\n            self._mindspace_manager.close_mindspace()\n\n        # Open the new mindspace\n        try:\n            self._mindspace_manager.open_mindspace(path)\n            self._mindspace_view.set_mindspace(path)\n\n        except MindspaceError as e:\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.error_opening_mindspace.format(str(e))\n            )\n            return\n\n        # Restore the state of the newly opened mindspace\n        self._restore_mindspace_state()\n\n    def _close_mindspace(self) -> None:\n        if not self._mindspace_manager.has_mindspace():\n            self._logger.error(\"No mindspace active, cannot close\")\n            return\n\n        self._save_mindspace_state()\n        if not self._close_all_tabs():\n            return\n\n        self._mindspace_view.set_mindspace(\"\")\n        self._mindspace_manager.close_mindspace()\n\n    def _save_mindspace_state(self) -> None:\n        \"\"\"Save current mindspace state.\"\"\"\n        if not self._mindspace_manager.has_mindspace():\n            self._logger.error(\"No mindspace active, cannot save\")\n            return\n\n        try:\n            mindspace_state = self._column_manager.save_state()\n            self._mindspace_manager.save_mindspace_state(mindspace_state)\n\n        except MindspaceError as e:\n            self._logger.error(\"Failed to save mindspace state: %s\", str(e))\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.error_saving_mindspace.format(str(e))\n            )\n\n    def _restore_mindspace_state(self) -> None:\n        \"\"\"Restore previously open tabs from mindspace state.\"\"\"\n        saved_state = self._mindspace_manager.load_mindspace_state()\n        if not saved_state:\n            self._logger.debug(\"No saved states found\")\n            return\n\n        try:\n            self._column_manager.restore_state(saved_state)\n\n        except MindspaceError as e:\n            self._logger.error(\"Failed to restore mindspace state: %s\", str(e))\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.error_restoring_mindspace.format(str(e))\n            )\n\n    def _close_all_tabs(self) -> bool:\n        return self._column_manager.close_all_tabs()\n\n    def _undo(self) -> None:\n        self._column_manager.undo()\n\n    def _redo(self) -> None:\n        self._column_manager.redo()\n\n    def _cut(self) -> None:\n        self._column_manager.cut()\n\n    def _copy(self) -> None:\n        self._column_manager.copy()\n\n    def _paste(self) -> None:\n        self._column_manager.paste()\n\n    def _find(self) -> None:\n        self._column_manager.show_find()\n\n    def _show_about_dialog(self) -> None:\n        \"\"\"Show the About dialog.\"\"\"\n        dialog = AboutDialog(self)\n        dialog.exec()\n\n    def _new_terminal(self) -> None:\n        \"\"\"Create a new terminal tab.\"\"\"\n        if not self._mindspace_manager.has_mindspace():\n            return\n\n        self._column_manager.new_terminal()\n\n    def _new_file(self) -> None:\n        \"\"\"Create a new empty editor tab.\"\"\"\n        if not self._mindspace_manager.has_mindspace():\n            return\n\n        self._column_manager.new_file()\n\n    def _on_mindspace_view_file_opened_in_wiki(self, path: str, ephemeral: bool) -> None:\n        \"\"\"Handle click of a wiki link from the mindspace view.\"\"\"\n        wiki_tab = self._column_manager.open_wiki_page(path, ephemeral)\n        if wiki_tab is None:\n            return\n\n        self._mindspace_manager.add_interaction(\n            MindspaceLogLevel.INFO,\n            f\"User opened wiki: '{path}'\\ntab ID: {wiki_tab.tab_id()}\"\n        )\n\n    def _on_mindspace_view_file_clicked(self, source: MindspaceViewType, path: str, ephemeral: bool) -> None:\n        \"\"\"Handle click of a file from the mindspace view.\"\"\"\n        self._column_manager.open_file_by_mindspace_view_type(source, path, ephemeral)\n\n    def _on_mindspace_view_file_deleted(self, path: str) -> None:\n        \"\"\"Handle deletion of a file by closing any open tab.\n\n        Args:\n            path: Path of file being deleted\n        \"\"\"\n        self._column_manager.close_deleted_file(path)\n\n    def _on_mindspace_view_file_renamed(self, old_path: str, new_path: str) -> None:\n        \"\"\"Handle renaming of files.\n\n        Args:\n            old_path: Original path of renamed file\n            new_path: New path after renaming\n        \"\"\"\n        self._column_manager.handle_file_rename(old_path, new_path)\n\n    def _on_mindspace_view_file_edited(self, path: str, ephemeral: bool) -> None:\n        \"\"\"Handle file edited event from the mindspace view.\"\"\"\n        self._open_file_path(path, ephemeral)\n\n    def _open_file(self) -> None:\n        \"\"\"Show open file dialog and create editor tab.\"\"\"\n        self._menu_timer.stop()\n        strings = self._language_manager.strings()\n        file_path, _ = QFileDialog.getOpenFileName(\n            self,\n            strings.file_dialog_open_file,\n            self._mindspace_manager.file_dialog_directory()\n        )\n        self._menu_timer.start()\n\n        if not file_path:\n            return\n\n        self._mindspace_manager.update_file_dialog_directory(file_path)\n        self._open_file_path(file_path, False)\n\n    def _open_file_path(self, path: str, ephemeral: bool) -> None:\n        \"\"\"Open file in editor tab.\"\"\"\n        try:\n            editor_tab = self._column_manager.open_file(path, ephemeral)\n\n            self._mindspace_manager.add_interaction(\n                MindspaceLogLevel.INFO,\n                f\"User opened editor for file: '{path}'\\nTab ID: {editor_tab.tab_id()}\"\n            )\n\n        except OSError as e:\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.error_opening_file_title,\n                strings.could_not_open.format(path, str(e))\n            )\n\n    def _save_file(self) -> None:\n        \"\"\"Save the current file.\"\"\"\n        path = self._column_manager.save_file()\n        self._mindspace_view.reveal_and_select_file(MindspaceViewType.FILES, path)\n\n    def _save_file_as(self) -> None:\n        \"\"\"Save the current file with a new name.\"\"\"\n        path = self._column_manager.save_file_as()\n        self._mindspace_view.reveal_and_select_file(MindspaceViewType.FILES, path)\n\n    def _open_wiki(self) -> None:\n        \"\"\"Open the wiki page in a new tab.\"\"\"\n        self._column_manager.open_wiki_page(self._mindspace_manager.get_absolute_path(\".\"), False)\n\n    def _show_system_log(self) -> None:\n        \"\"\"Show the log tab.\"\"\"\n        self._column_manager.show_system_log()\n\n    def _show_system_shell(self) -> None:\n        \"\"\"Show the shell tab.\"\"\"\n        self._column_manager.show_system_shell()\n\n    def _show_all_columns(self) -> None:\n        \"\"\"Show all columns equally.\"\"\"\n        self._column_manager.show_all_columns()\n\n    def _split_column(self, split_left: bool) -> None:\n        \"\"\"Split the current column.\"\"\"\n        self._column_manager.split_column(split_left)\n\n    def _merge_column(self, merge_left: bool) -> None:\n        \"\"\"Merge the current column.\"\"\"\n        self._column_manager.merge_column(merge_left)\n\n    def _swap_column(self, swap_left: bool) -> None:\n        \"\"\"Swap the current column.\"\"\"\n        self._column_manager.swap_column(swap_left)\n\n    def _on_style_changed(self) -> None:\n        style_manager = self._style_manager\n        zoom_factor = style_manager.zoom_factor()\n        base_font_size = style_manager.base_font_size()\n\n        self.setStyleSheet(f\"\"\"\n            QMainWindow {{\n                background-color: {style_manager.get_color_str(ColorRole.BACKGROUND_PRIMARY)};\n                color: {style_manager.get_color_str(ColorRole.TEXT_PRIMARY)};\n            }}\n\n            QMenuBar {{\n                background-color: {style_manager.get_color_str(ColorRole.MENU_BACKGROUND)};\n                padding: 4px;\n                font-size: {base_font_size}pt;\n            }}\n            QMenuBar::item {{\n                background-color: transparent;\n                color: {style_manager.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border-radius: 4px;\n                padding: 4px 8px 4px 8px;\n            }}\n            QMenuBar::item:selected {{\n                background-color: {style_manager.get_color_str(ColorRole.MENU_HOVER)};\n            }}\n\n            QMenu {{\n                background-color: {style_manager.get_color_str(ColorRole.MENU_BACKGROUND)};\n                color: {style_manager.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border-color: {style_manager.get_color_str(ColorRole.MENU_BORDER)};\n                border-width: 1px;\n                border-style: solid;\n                border-radius: 8px;\n                margin: 0px;\n            }}\n            QMenu::item {{\n                margin: 2px;\n                padding: 4px 8px 4px 8px;\n                border-radius: 4px;\n            }}\n            QMenu::item:disabled {{\n                color: {style_manager.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n            QMenu::item:selected {{\n                background-color: {style_manager.get_color_str(ColorRole.MENU_HOVER)}\n            }}\n\n            QStatusBar {{\n                background-color: {self._style_manager.get_color_str(ColorRole.STATUS_BAR_BACKGROUND)};\n                color: {self._style_manager.get_color_str(ColorRole.TEXT_PRIMARY)};\n                padding: {2 * zoom_factor}px;\n                border-top: 1px solid {self._style_manager.get_color_str(ColorRole.SPLITTER)};\n            }}\n            QStatusBar::item {{\n                border: 0;\n                padding: 0;\n            }}\n\n            QStatusBar QLabel {{\n                color: {self._style_manager.get_color_str(ColorRole.TEXT_PRIMARY)};\n                padding: 0;\n            }}\n\n            QSplitter::handle {{\n                background-color: {style_manager.get_color_str(ColorRole.SPLITTER)};\n                margin: 0;\n                width: 1px;\n            }}\n        \"\"\")\n\n        # Update status bar font\n        status_font = self.font()\n        status_font.setPointSizeF(base_font_size * zoom_factor)\n        self._status_bar.setFont(status_font)\n        self._status_message_label.setFont(status_font)\n\n        # Apply styles to the mindspace view and column manager\n        self._mindspace_view.apply_style()\n        self._column_manager.apply_style()\n\n    def _new_conversation(self) -> ConversationTab | None:\n        \"\"\"Create new conversation tab.\"\"\"\n        if not self._mindspace_manager.has_mindspace():\n            return None\n\n        try:\n            self._mindspace_manager.ensure_mindspace_dir(\"conversations\")\n            conversation_tab = self._column_manager.new_conversation()\n\n        except MindspaceError as e:\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.error_opening_conversation.format(str(e))\n            )\n            self._mindspace_manager.add_interaction(\n                MindspaceLogLevel.ERROR,\n                f\"User failed to create new conversation: {str(e)}\"\n            )\n            return None\n\n        self._mindspace_manager.add_interaction(\n            MindspaceLogLevel.INFO,\n            f\"User created new conversation\\ntab ID: {conversation_tab.tab_id()}\"\n        )\n        return conversation_tab\n\n    def _get_canonical_mindspace_path(self, path: str) -> str | None:\n        \"\"\"Get the canonical path of the current mindspace.\"\"\"\n        if not self._mindspace_manager.has_mindspace():\n            return None\n\n        # Get the absolute path of the current mindspace\n        return self._mindspace_manager.get_relative_path(path)\n\n    def _resolve_mindspace_path(self, path: str) -> Tuple[Path, str]:\n        # Check if our path starts with a separator.  If it does we'll assume it's for the root of the mindspace.\n        if path.startswith(os.sep):\n            path = path[1:]\n\n        # Convert to absolute path via mindspace manager\n        abs_path = self._mindspace_manager.get_absolute_path(path)\n        resolved_path = Path(abs_path).resolve()\n\n        # Verify the resolved path is still within mindspace\n        relative_path = self._mindspace_manager.get_mindspace_relative_path(str(resolved_path))\n        if relative_path is None:\n            raise ValueError(f\"Path is outside mindspace boundaries: {path}\")\n\n        return resolved_path, relative_path\n\n    def _new_metaphor_conversation(self) -> None:\n        \"\"\"Create new conversation from Metaphor file.\"\"\"\n        # Show file dialog\n        self._menu_timer.stop()\n        strings = self._language_manager.strings()\n        file_path, _ = QFileDialog.getOpenFileName(\n            self,\n            strings.file_dialog_open_metaphor,\n            self._mindspace_manager.file_dialog_directory(),\n            f\"{strings.file_filter_metaphor};;{strings.file_filter_all}\"\n        )\n        self._menu_timer.start()\n\n        if not file_path:\n            return\n\n        self._mindspace_manager.update_file_dialog_directory(file_path)\n        search_path = self._mindspace_manager.mindspace_path()\n\n        metaphor_ast_builder = MetaphorASTBuilder(self._get_canonical_mindspace_path)\n        try:\n            syntax_tree = MetaphorASTRootNode()\n            metaphor_ast_builder.build_ast_from_file(syntax_tree, file_path, [search_path], search_path, [file_path])\n            formatter = MetaphorFormatVisitor()\n            prompt = format_preamble() + formatter.format(syntax_tree)\n\n        except MetaphorASTBuilderError as e:\n            self._column_manager.show_system_shell()\n            error = f\"Metaphor compiler error prevented new Metaphor conversation:\\n\\n{format_errors(e.errors)}\"\n            self._mindspace_manager.add_interaction(MindspaceLogLevel.WARN, error)\n            self._column_manager.show_system_log()\n            return\n\n        conversation_tab = self._new_conversation()\n        if conversation_tab is None:\n            return\n\n        # Set input text\n        conversation_tab.set_input_text(prompt)\n\n    def _open_conversation(self) -> None:\n        \"\"\"Show open conversation dialog and create conversation tab.\"\"\"\n        self._menu_timer.stop()\n        strings = self._language_manager.strings()\n        file_path, _ = QFileDialog.getOpenFileName(\n            self,\n            strings.file_dialog_open_conversation,\n            self._mindspace_manager.conversations_directory(),\n            f\"{strings.file_filter_conversation};;{strings.file_filter_all}\"\n        )\n        self._menu_timer.start()\n\n        if not file_path:\n            return\n\n        self._mindspace_manager.update_conversations_directory(file_path)\n        self._open_conversation_path(file_path, False)\n\n    def _open_conversation_path(self, path: str, ephemeral: bool) -> ConversationTab | None:\n        \"\"\"Open an existing conversation file.\"\"\"\n        try:\n            tab = self._column_manager.open_conversation(path, ephemeral)\n            return tab\n\n        except ConversationError as e:\n            self._logger.error(\"Error opening conversation: %s: %s\", path, str(e))\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.conversation_error_title,\n                strings.error_opening_conversation.format(path, str(e))\n            )\n            return None\n\n    def _fork_conversation(self) -> None:\n        \"\"\"Create a new conversation tab with the history of the current conversation.\"\"\"\n        # Create task to fork conversation\n        try:\n            self._column_manager.fork_conversation_from_index(None)\n\n        except ConversationError as e:\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.conversation_error_title,\n                strings.error_forking_conversation.format(str(e))\n            )\n\n    def _on_column_manager_fork_requested(self) -> None:\n        \"\"\"Handle fork conversation requests.\"\"\"\n        self._fork_conversation()\n\n    def _on_column_manager_fork_from_index_requested(self, index: int) -> None:\n        \"\"\"Handle fork conversation requests from a specific index.\"\"\"\n        try:\n            self._column_manager.fork_conversation_from_index(index)\n\n        except ConversationError as e:\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.conversation_error_title,\n                strings.error_forking_conversation.format(str(e))\n            )\n\n    def _on_column_manager_open_wiki_link_requested(self, path: str) -> None:\n        \"\"\"Handle requests to open a wiki page.\"\"\"\n        try:\n            self._column_manager.open_wiki_page(path, True)\n\n        except WikiError as e:\n            self._logger.info(\"Error opening wiki page: %s: %s\", path, str(e))\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.wiki_error_title,\n                strings.could_not_open.format(path, str(e))\n            )\n\n    def _on_column_manager_edit_file_requested(self, path: str) -> None:\n        \"\"\"Handle requests to open a file in the editor.\"\"\"\n        self._open_file_path(path, False)\n\n    def _close_tab(self) -> None:\n        \"\"\"Close the current tab.\"\"\"\n        tab = self._column_manager.get_current_tab()\n        if tab is None:\n            self._logger.error(\"No current tab to close\")\n            return\n\n        self._column_manager.close_tab()\n        self._mindspace_manager.add_interaction(\n            MindspaceLogLevel.INFO,\n            f\"User closed tab\\nTab ID: {tab.tab_id()}\"\n        )\n\n    def _submit_message(self) -> None:\n        \"\"\"Handle message submission.\"\"\"\n        self._column_manager.submit_message()\n\n    def _navigate_next_message(self) -> None:\n        \"\"\"Navigate to the next message in conversation.\"\"\"\n        self._column_manager.navigate_next_message()\n\n    def _navigate_previous_message(self) -> None:\n        \"\"\"Navigate to the previous message in conversation.\"\"\"\n        self._column_manager.navigate_previous_message()\n\n    def _toggle_bookmark(self) -> None:\n        \"\"\"Handle toggling a bookmark.\"\"\"\n        self._column_manager.toggle_bookmark()\n\n    def _navigate_next_bookmark(self) -> None:\n        \"\"\"Move to the next bookmark.\"\"\"\n        self._column_manager.navigate_next_bookmark()\n\n    def _navigate_previous_bookmark(self) -> None:\n        \"\"\"Move to the previous bookmark.\"\"\"\n        self._column_manager.navigate_previous_bookmark()\n\n    def _show_user_settings_dialog(self) -> None:\n        \"\"\"Show the user settings dialog.\"\"\"\n        dialog = UserSettingsDialog(self)\n        dialog.set_settings(self._user_manager.settings())\n\n        def _on_settings_changed(new_settings: UserSettings) -> None:\n            try:\n                self._user_manager.update_settings(new_settings)\n                self._style_manager.set_user_font_size(new_settings.font_size)\n                self._language_manager.set_language(new_settings.language)\n\n                # Update theme from settings if it changed\n                new_theme = new_settings.theme\n                if new_theme != self._style_manager.color_mode():\n                    self._style_manager.set_color_mode(new_theme)\n                    self._update_theme_menu()\n\n                self._logger.info(\"User settings saved successfully\")\n\n            except UserError as e:\n                self._logger.error(\"Failed to save user settings: %s\", str(e))\n                strings = self._language_manager.strings()\n                MessageBox.show_message(\n                    self,\n                    MessageBoxType.CRITICAL,\n                    strings.settings_error_title,\n                    strings.error_saving_user_settings.format(str(e))\n                )\n\n        dialog.settings_changed.connect(_on_settings_changed)\n        dialog.exec()\n\n    def _show_mindspace_settings_dialog(self) -> None:\n        \"\"\"Show the mindspace settings dialog.\"\"\"\n        if not self._mindspace_manager.has_mindspace():\n            return\n\n        settings = cast(MindspaceSettings, self._mindspace_manager.settings())\n        dialog = MindspaceSettingsDialog(self)\n        dialog.set_settings(settings)\n\n        def _on_settings_changed(new_settings: MindspaceSettings) -> None:\n            try:\n                self._mindspace_manager.update_settings(new_settings)\n\n            except OSError as e:\n                self._logger.error(\"Failed to save mindspace settings: %s\", str(e))\n                strings = self._language_manager.strings()\n                MessageBox.show_message(\n                    self,\n                    MessageBoxType.CRITICAL,\n                    strings.settings_error_title,\n                    strings.error_saving_mindspace_settings.format(str(e))\n                )\n\n        dialog.settings_changed.connect(_on_settings_changed)\n        dialog.exec()\n\n    def _show_conversation_settings_dialog(self) -> None:\n        \"\"\"Show the conversation settings dialog.\"\"\"\n        self._column_manager.show_conversation_settings_dialog()\n\n    def keyPressEvent(self, event: QKeyEvent) -> None:\n        \"\"\"Handle global key events.\"\"\"\n        if event.key() == Qt.Key.Key_Escape:\n            if self._column_manager.handle_esc_key():\n                return\n\n        super().keyPressEvent(event)\n\n    def _handle_zoom(self, factor: float) -> None:\n        \"\"\"Handle zoom in/out requests.\"\"\"\n        new_zoom = self._style_manager.zoom_factor() * factor\n        self._set_zoom(new_zoom)\n\n    def _set_zoom(self, zoom_level: float) -> None:\n        \"\"\"Set zoom level for the application.\"\"\"\n        self._style_manager.set_zoom(zoom_level)\n\n    def closeEvent(self, event: QEvent) -> None:\n        \"\"\"Handle application close request.\"\"\"\n        self._save_mindspace_state()\n        if not self._close_all_tabs():\n            event.ignore()\n            return\n\n        event.accept()\n```\n\nFile: src/humbug/__main__.py\n\n```python\n\"\"\"Main entry point for the Humbug application.\"\"\"\n\nimport asyncio\nfrom datetime import datetime, timezone\nimport glob\nimport logging\nfrom logging.handlers import RotatingFileHandler\nimport os\nimport sys\nimport time\nfrom types import TracebackType\nfrom typing import List\n\nfrom PySide6.QtCore import QObject, QEvent\nfrom qasync import QEventLoop, QApplication  # type: ignore[import-untyped]\n\n# pylint: disable=unused-import\nimport syntax.parser_imports\n# pylint: enable=unused-import\n\nfrom humbug.main_window import MainWindow\n\n\ndef setup_logging() -> None:\n    \"\"\"Configure application logging with timestamped files and rotation.\"\"\"\n    # Create logs directory in user's home .humbug directory\n    log_dir = os.path.expanduser(\"~/.humbug/logs\")\n    os.makedirs(log_dir, exist_ok=True)\n\n    # Generate timestamp for log filename\n    timestamp = datetime.now(timezone.utc).strftime(\"%Y-%m-%d-%H-%M-%S-%f\")[:23]\n    log_file = os.path.join(log_dir, f\"{timestamp}.log\")\n\n    # Configure rotating file handler\n    # Keep up to 50 log files, max 1MB each\n    handler = RotatingFileHandler(\n        log_file,\n        maxBytes=1024*1024,  # 1MB\n        backupCount=49,  # Keep 50 files total (current + 49 backups)\n        encoding='utf-8'\n    )\n\n    # Configure logging\n    logging.basicConfig(\n        level=logging.DEBUG,\n        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',\n        handlers=[handler]\n    )\n\n    # Clean up old logs if we have too many\n    cleanup_old_logs(log_dir, max_logs=50)\n\n\ndef cleanup_old_logs(log_dir: str, max_logs: int) -> None:\n    \"\"\"Remove oldest log files if we exceed maximum count.\"\"\"\n    log_files = glob.glob(os.path.join(log_dir, \"*.log*\"))\n    log_files.sort(key=os.path.getctime)  # Sort by creation time\n\n    # Remove oldest files if we have too many\n    while len(log_files) > max_logs:\n        try:\n            os.remove(log_files.pop(0))  # Remove oldest file\n\n        except OSError:\n            pass  # Ignore errors removing old logs\n\n\ndef install_global_exception_handler() -> None:\n    \"\"\"Install a global exception handler for uncaught exceptions.\"\"\"\n    logger = logging.getLogger('GlobalExceptionHandler')\n\n    def handle_exception(exc_type: type[BaseException], exc_value: BaseException, exc_traceback: TracebackType | None) -> None:\n        \"\"\"Handle uncaught exceptions and log them.\"\"\"\n        if issubclass(exc_type, KeyboardInterrupt):\n            # Don't log keyboard interrupt\n            sys.__excepthook__(exc_type, exc_value, exc_traceback)\n            return\n\n        logger.critical(\n            \"Uncaught exception\",\n            exc_info=(exc_type, exc_value, exc_traceback),\n            stack_info=True\n        )\n\n    sys.excepthook = handle_exception\n\n\nclass HumbugApplication(QApplication):\n    \"\"\"Class for the application. Specialized to do event time reporting.\"\"\"\n    def __init__(self, argv: List[str]) -> None:\n        super().__init__(argv)\n        self._start_time = time.monotonic()\n\n    def notify(self, arg__1: QObject, arg__2: QEvent) -> bool:\n        event_type = arg__2.type()\n        receiver_name = arg__1.objectName()\n        start = time.monotonic()\n        ret = super().notify(arg__1, arg__2)\n        end = time.monotonic()\n        elapsed_time = (end - start) * 1000\n        if elapsed_time > 20:\n            rel_end = end - self._start_time\n            print(f\"{rel_end:.3f}: event {arg__2}, type {event_type}, object {receiver_name}, took {elapsed_time:.3f} msec\")\n\n        return ret\n\n\ndef main() -> int:\n    \"\"\"Main function to run the application.\"\"\"\n    setup_logging()\n    install_global_exception_handler()\n\n    # Create application\n    app = HumbugApplication(sys.argv)\n\n    # Create and set event loop\n    loop = QEventLoop(app)\n    asyncio.set_event_loop(loop)\n\n    window = MainWindow()\n    window.show()\n\n    # Run the main function\n    try:\n        with loop:\n            loop.run_forever()\n\n    except KeyboardInterrupt:\n        return 0\n\n    return 0\n\nif __name__ == \"__main__\":\n    sys.exit(main())\n```\n\n# Action:\n\nMy application features a global exception handler to catch any otherwise uncaught exceptions.  When\nthese occur, we log the exception, but the problem may not be visible to the user.\n\nI would like to add some sort of \"canary\" marker when this occurs.  One obvious approach is to make\nthe background colour of the main status bar turn red if we see such an exception.\n\nI don't want you to code anything yet - I want to understand ways we can do this and to ask questions.",
      "completed": true,
      "model": "claude-sonnet-4-20250514",
      "reasoning_capability": 1,
      "temperature": 0.7
    },
    {
      "id": "da875263-f950-4c9e-9a10-30f945f8af5a",
      "timestamp": "2025-08-29T18:42:18.316087+00:00",
      "type": "ai_response",
      "content": "Looking at your code, I can see you have a global exception handler in `__main__.py` that logs uncaught exceptions, and a status bar in `MainWindow` that currently shows status messages. Here are several approaches we could take to implement a \"canary\" marker for uncaught exceptions:\n\n## Approach 1: Status Bar Background Color Change\nThis is your suggested approach - change the status bar background to red when an uncaught exception occurs.\n\n**Pros:**\n- Simple and immediately visible\n- Uses existing UI infrastructure\n- Non-intrusive (doesn't block user workflow)\n\n**Cons:**\n- Requires communication mechanism from global handler to MainWindow\n- Status bar might not always be visible depending on window state\n- Color alone might not be accessible for colorblind users\n\n## Approach 2: Status Bar Message + Color\nCombine a red background with an explicit error message in the status bar.\n\n**Pros:**\n- More informative than color alone\n- Better accessibility\n- Uses existing status message infrastructure\n\n**Cons:**\n- Might interfere with normal status messages\n- Still requires communication mechanism\n\n## Approach 3: System Tray/Notification\nShow a system tray notification or desktop notification when exceptions occur.\n\n**Pros:**\n- Visible even when application is minimized\n- Doesn't interfere with main UI\n\n**Cons:**\n- Requires additional Qt modules (QSystemTrayIcon)\n- Platform-dependent behavior\n- Might be missed by users\n\n## Approach 4: Modal Error Dialog\nShow a dialog when uncaught exceptions occur.\n\n**Pros:**\n- Impossible to miss\n- Can provide detailed error information\n\n**Cons:**\n- Intrusive - blocks user workflow\n- Could cause cascading issues if exception handling itself has problems\n\n## Questions to Consider:\n\n1. **Communication Mechanism**: How should the global exception handler communicate with the MainWindow? Options include:\n   - Qt signals/slots (requires the handler to have access to MainWindow instance)\n   - Global state/flags that MainWindow polls\n   - Qt's event system (custom events)\n   - Application-level signals\n\n2. **Persistence**: Should the canary marker:\n   - Persist until user acknowledges it?\n   - Clear after a timeout?\n   - Clear when a new status message arrives?\n   - Accumulate multiple exceptions?\n\n3. **User Interaction**: Should users be able to:\n   - Click to see exception details?\n   - Dismiss the marker?\n   - Access a log of recent exceptions?\n\n4. **Exception Filtering**: Should all uncaught exceptions trigger the canary, or only certain types? (You already filter out KeyboardInterrupt)\n\n5. **Accessibility**: How do we ensure the marker is accessible to users with visual impairments?\n\n## My Recommendation:\n\nI'd suggest **Approach 2** (Status Bar Message + Color) with these specifics:\n- Change status bar background to red\n- Show a persistent message like \"\u26a0 System Error Detected - Check Logs\"\n- Allow clicking the status bar to open the system log tab\n- Clear the marker when user opens the log tab or after viewing the error\n\nThis approach:\n- Leverages your existing status bar and log infrastructure\n- Is visible but non-blocking\n- Provides a path for users to investigate further\n- Is accessible (text + color)\n\nWould you like me to elaborate on any of these approaches or discuss the implementation details for the recommended solution?",
      "completed": true,
      "usage": {
        "prompt_tokens": 22909,
        "completion_tokens": 778,
        "total_tokens": 23687
      },
      "model": "claude-sonnet-4-20250514",
      "reasoning_capability": 1,
      "temperature": 0.7
    },
    {
      "id": "b12d97e3-5bb4-4400-a8ef-d5d30b56c45d",
      "timestamp": "2025-08-29T18:51:39.392800+00:00",
      "type": "user_message",
      "content": "I prefer option 1 - the status persists indefinitely once it occurs (it's a canary)",
      "completed": true,
      "model": "claude-sonnet-4-20250514",
      "reasoning_capability": 1,
      "temperature": 0.7
    },
    {
      "id": "5688db9b-260f-45fb-b8c7-bb4ea487f0ed",
      "timestamp": "2025-08-29T18:51:41.724400+00:00",
      "type": "ai_response",
      "content": "Perfect! Option 1 with persistent status makes sense as a true \"canary\" - once it turns red, it stays red to indicate that *something went wrong* during this session, even if the application continues to function.\n\nHere are the key implementation considerations for this approach:\n\n## Communication Mechanism Options:\n\n1. **Qt Signal/Slot System**: \n   - Create a singleton \"ExceptionNotifier\" QObject that the global handler can emit signals to\n   - MainWindow connects to this signal to update the status bar\n   - Clean, Qt-native approach\n\n2. **Application-Level Custom Event**:\n   - Post a custom QEvent from the global handler\n   - MainWindow overrides `customEvent()` to handle it\n   - More decoupled, doesn't require direct object references\n\n3. **Global Flag with Timer Polling**:\n   - Global handler sets a flag/variable\n   - MainWindow's existing `_menu_timer` (or separate timer) polls this flag\n   - Simple but less elegant\n\n## Implementation Questions:\n\n1. **Scope of Status Bar Styling**: Should we:\n   - Only change the background color of the status bar itself?\n   - Also change the text color for contrast?\n   - Apply the red background to the entire status bar or just a portion?\n\n2. **Integration with Existing Status Messages**: \n   - Should normal status messages still appear over the red background?\n   - Or should the red background replace all normal status functionality?\n\n3. **Visual Design**: \n   - What shade of red? (considering your existing dark/light theme support)\n   - Should it be a solid color or have some visual indicator (border, icon, etc.)?\n\n4. **Exception Handler Access**: \n   - The global handler in `__main__.py` needs a way to communicate with MainWindow\n   - Should we pass the MainWindow instance to the handler setup?\n   - Or use a more decoupled approach?\n\nMy preference would be the **Qt Signal/Slot approach** with a singleton ExceptionNotifier, as it's clean, type-safe, and follows Qt patterns your application already uses extensively.\n\nWould you like me to proceed with implementing this approach, or do you have preferences on any of these design decisions?",
      "completed": true,
      "usage": {
        "prompt_tokens": 23713,
        "completion_tokens": 499,
        "total_tokens": 24212
      },
      "model": "claude-sonnet-4-20250514",
      "reasoning_capability": 1,
      "temperature": 0.7
    },
    {
      "id": "071521bd-19af-47d7-a3cd-c6ae5beb5744",
      "timestamp": "2025-08-29T18:54:00.527006+00:00",
      "type": "user_message",
      "content": "Use signal/slot\n\nquestions:\n\n1. just the background colour\n2. yes - keep existing messages\n3. a red that will maintain text contrast. Add one to the style manager.",
      "completed": true,
      "model": "claude-sonnet-4-20250514",
      "reasoning_capability": 1,
      "temperature": 0.7
    },
    {
      "id": "2bb32395-6892-4c25-8319-b84c99c8b588",
      "timestamp": "2025-08-29T18:54:02.283762+00:00",
      "type": "ai_response",
      "content": "Perfect! I'll implement the signal/slot approach with those specifications.\n\nBefore I code this, I need to understand a few more details:\n\n## Questions:\n\n1. **Color Role Name**: What would you like to call the new color role in the StyleManager? Something like `STATUS_BAR_ERROR_BACKGROUND` or `CANARY_BACKGROUND`?\n\n2. **ExceptionNotifier Singleton Location**: Where should I place the ExceptionNotifier class? Options:\n   - New file like `src/humbug/exception_notifier.py`\n   - Add it to an existing module (maybe `src/humbug/main_window.py` or create a utilities module)\n\n3. **Color Values**: Should I choose appropriate red values for both light and dark themes, or do you have specific colors in mind? I'm thinking:\n   - Light theme: A darker red that maintains contrast with black text\n   - Dark theme: A darker red that maintains contrast with white text\n\n4. **Integration Point**: The global exception handler in `__main__.py` will need to access the ExceptionNotifier singleton. Should I:\n   - Import and use it directly in the `handle_exception` function?\n   - Pass the notifier instance to the exception handler setup?\n\n5. **Thread Safety**: Since exceptions can occur on any thread, should the ExceptionNotifier emit signals in a thread-safe way (using `QMetaObject.invokeMethod` with `Qt.QueuedConnection`)?\n\nThese details will help me implement exactly what you're looking for. What are your preferences?",
      "completed": true,
      "usage": {
        "prompt_tokens": 24255,
        "completion_tokens": 353,
        "total_tokens": 24608
      },
      "model": "claude-sonnet-4-20250514",
      "reasoning_capability": 1,
      "temperature": 0.7
    },
    {
      "id": "1edb1471-e892-41c9-8aca-201e7ce8b977",
      "timestamp": "2025-08-29T18:55:25.802270+00:00",
      "type": "user_message",
      "content": "1. CANARY_BACKGROUND\n2. new file\n3. yes\n4. import it\n5. yes",
      "completed": true,
      "model": "claude-sonnet-4-20250514",
      "reasoning_capability": 1,
      "temperature": 0.7
    },
    {
      "id": "dcd63daf-b511-48db-92a4-b8f9512fa0fc",
      "timestamp": "2025-08-29T18:55:34.602707+00:00",
      "type": "ai_response",
      "content": "",
      "completed": true,
      "model": "claude-sonnet-4-20250514",
      "reasoning_capability": 1,
      "temperature": 0.7,
      "tool_calls": [
        {
          "id": "toolu_01PvEURabKGEBkwd1NTPm29J",
          "name": "filesystem",
          "arguments": {
            "operation": "write_file",
            "path": "src/humbug/exception_notifier.py",
            "content": "\"\"\"Exception notifier singleton for communicating uncaught exceptions to the UI.\"\"\"\n\nimport logging\nfrom typing import ClassVar\n\nfrom PySide6.QtCore import QObject, Signal, QMetaObject, Qt\n\n\nclass ExceptionNotifier(QObject):\n    \"\"\"Singleton class for notifying the UI of uncaught exceptions.\"\"\"\n    \n    _instance: ClassVar['ExceptionNotifier | None'] = None\n    \n    # Signal emitted when an uncaught exception occurs\n    exception_occurred = Signal()\n    \n    def __new__(cls) -> 'ExceptionNotifier':\n        \"\"\"Ensure only one instance exists.\"\"\"\n        if cls._instance is None:\n            cls._instance = super().__new__(cls)\n        return cls._instance\n    \n    def __init__(self) -> None:\n        \"\"\"Initialize the exception notifier.\"\"\"\n        # Only initialize once\n        if hasattr(self, '_initialized'):\n            return\n            \n        super().__init__()\n        self._logger = logging.getLogger(\"ExceptionNotifier\")\n        self._initialized = True\n    \n    def notify_exception(self) -> None:\n        \"\"\"\n        Notify the UI that an uncaught exception has occurred.\n        \n        This method is thread-safe and can be called from any thread.\n        \"\"\"\n        self._logger.debug(\"Notifying UI of uncaught exception\")\n        \n        # Use queued connection to ensure thread safety\n        QMetaObject.invokeMethod(\n            self,\n            \"_emit_exception_signal\",\n            Qt.ConnectionType.QueuedConnection\n        )\n    \n    def _emit_exception_signal(self) -> None:\n        \"\"\"Emit the exception signal on the main thread.\"\"\"\n        self.exception_occurred.emit()\n\n\ndef get_exception_notifier() -> ExceptionNotifier:\n    \"\"\"\n    Get the global exception notifier instance.\n    \n    Returns:\n        ExceptionNotifier: The singleton instance\n    \"\"\"\n    return ExceptionNotifier()"
          }
        }
      ]
    },
    {
      "id": "722499b8-3166-44fd-aee1-a0cb5aeba344",
      "timestamp": "2025-08-29T18:55:34.608792+00:00",
      "type": "tool_call",
      "content": "```json\n{\n    \"id\": \"toolu_01PvEURabKGEBkwd1NTPm29J\",\n    \"name\": \"filesystem\",\n    \"arguments\": {\n        \"operation\": \"write_file\",\n        \"path\": \"src/humbug/exception_notifier.py\",\n        \"content\": \"\\\"\\\"\\\"Exception notifier singleton for communicating uncaught exceptions to the UI.\\\"\\\"\\\"\\n\\nimport logging\\nfrom typing import ClassVar\\n\\nfrom PySide6.QtCore import QObject, Signal, QMetaObject, Qt\\n\\n\\nclass ExceptionNotifier(QObject):\\n    \\\"\\\"\\\"Singleton class for notifying the UI of uncaught exceptions.\\\"\\\"\\\"\\n    \\n    _instance: ClassVar['ExceptionNotifier | None'] = None\\n    \\n    # Signal emitted when an uncaught exception occurs\\n    exception_occurred = Signal()\\n    \\n    def __new__(cls) -> 'ExceptionNotifier':\\n        \\\"\\\"\\\"Ensure only one instance exists.\\\"\\\"\\\"\\n        if cls._instance is None:\\n            cls._instance = super().__new__(cls)\\n        return cls._instance\\n    \\n    def __init__(self) -> None:\\n        \\\"\\\"\\\"Initialize the exception notifier.\\\"\\\"\\\"\\n        # Only initialize once\\n        if hasattr(self, '_initialized'):\\n            return\\n            \\n        super().__init__()\\n        self._logger = logging.getLogger(\\\"ExceptionNotifier\\\")\\n        self._initialized = True\\n    \\n    def notify_exception(self) -> None:\\n        \\\"\\\"\\\"\\n        Notify the UI that an uncaught exception has occurred.\\n        \\n        This method is thread-safe and can be called from any thread.\\n        \\\"\\\"\\\"\\n        self._logger.debug(\\\"Notifying UI of uncaught exception\\\")\\n        \\n        # Use queued connection to ensure thread safety\\n        QMetaObject.invokeMethod(\\n            self,\\n            \\\"_emit_exception_signal\\\",\\n            Qt.ConnectionType.QueuedConnection\\n        )\\n    \\n    def _emit_exception_signal(self) -> None:\\n        \\\"\\\"\\\"Emit the exception signal on the main thread.\\\"\\\"\\\"\\n        self.exception_occurred.emit()\\n\\n\\ndef get_exception_notifier() -> ExceptionNotifier:\\n    \\\"\\\"\\\"\\n    Get the global exception notifier instance.\\n    \\n    Returns:\\n        ExceptionNotifier: The singleton instance\\n    \\\"\\\"\\\"\\n    return ExceptionNotifier()\"\n    }\n}\n```",
      "completed": true,
      "tool_calls": [
        {
          "id": "toolu_01PvEURabKGEBkwd1NTPm29J",
          "name": "filesystem",
          "arguments": {
            "operation": "write_file",
            "path": "src/humbug/exception_notifier.py",
            "content": "\"\"\"Exception notifier singleton for communicating uncaught exceptions to the UI.\"\"\"\n\nimport logging\nfrom typing import ClassVar\n\nfrom PySide6.QtCore import QObject, Signal, QMetaObject, Qt\n\n\nclass ExceptionNotifier(QObject):\n    \"\"\"Singleton class for notifying the UI of uncaught exceptions.\"\"\"\n    \n    _instance: ClassVar['ExceptionNotifier | None'] = None\n    \n    # Signal emitted when an uncaught exception occurs\n    exception_occurred = Signal()\n    \n    def __new__(cls) -> 'ExceptionNotifier':\n        \"\"\"Ensure only one instance exists.\"\"\"\n        if cls._instance is None:\n            cls._instance = super().__new__(cls)\n        return cls._instance\n    \n    def __init__(self) -> None:\n        \"\"\"Initialize the exception notifier.\"\"\"\n        # Only initialize once\n        if hasattr(self, '_initialized'):\n            return\n            \n        super().__init__()\n        self._logger = logging.getLogger(\"ExceptionNotifier\")\n        self._initialized = True\n    \n    def notify_exception(self) -> None:\n        \"\"\"\n        Notify the UI that an uncaught exception has occurred.\n        \n        This method is thread-safe and can be called from any thread.\n        \"\"\"\n        self._logger.debug(\"Notifying UI of uncaught exception\")\n        \n        # Use queued connection to ensure thread safety\n        QMetaObject.invokeMethod(\n            self,\n            \"_emit_exception_signal\",\n            Qt.ConnectionType.QueuedConnection\n        )\n    \n    def _emit_exception_signal(self) -> None:\n        \"\"\"Emit the exception signal on the main thread.\"\"\"\n        self.exception_occurred.emit()\n\n\ndef get_exception_notifier() -> ExceptionNotifier:\n    \"\"\"\n    Get the global exception notifier instance.\n    \n    Returns:\n        ExceptionNotifier: The singleton instance\n    \"\"\"\n    return ExceptionNotifier()"
          }
        }
      ]
    },
    {
      "id": "0e65182f-fc89-4f8b-baf6-e10e29d3ffb9",
      "timestamp": "2025-08-29T18:55:37.314822+00:00",
      "type": "tool_result",
      "content": "```json\n{\n    \"id\": \"toolu_01PvEURabKGEBkwd1NTPm29J\",\n    \"name\": \"filesystem\",\n    \"content\": \"File written successfully: src/humbug/exception_notifier.py (1,829 bytes)\",\n    \"error\": null\n}\n```",
      "completed": true,
      "tool_results": [
        {
          "id": "toolu_01PvEURabKGEBkwd1NTPm29J",
          "name": "filesystem",
          "content": "File written successfully: src/humbug/exception_notifier.py (1,829 bytes)",
          "error": null
        }
      ]
    },
    {
      "id": "e8eb0db1-8b4c-4f41-a427-7529b25861f2",
      "timestamp": "2025-08-29T18:55:37.322053+00:00",
      "type": "user_message",
      "content": "",
      "completed": true,
      "tool_results": [
        {
          "id": "toolu_01PvEURabKGEBkwd1NTPm29J",
          "name": "filesystem",
          "content": "File written successfully: src/humbug/exception_notifier.py (1,829 bytes)",
          "error": null
        }
      ]
    },
    {
      "id": "f5333df1-0f7e-4040-a76d-6d5b6ade4b25",
      "timestamp": "2025-08-29T18:55:39.254516+00:00",
      "type": "ai_response",
      "content": "Now I'll add the CANARY_BACKGROUND color role to the ColorRole enum:",
      "completed": true,
      "usage": {
        "prompt_tokens": 25234,
        "completion_tokens": 100,
        "total_tokens": 25334
      },
      "model": "claude-sonnet-4-20250514",
      "reasoning_capability": 1,
      "temperature": 0.7,
      "tool_calls": [
        {
          "id": "toolu_01877uqKeefFGKxvJy5ZJ1AT",
          "name": "filesystem",
          "arguments": {
            "operation": "read_file",
            "path": "src/humbug/color_role.py"
          }
        }
      ]
    },
    {
      "id": "6e9dd988-be20-4c55-af46-41d18585193c",
      "timestamp": "2025-08-29T18:55:40.646064+00:00",
      "type": "tool_call",
      "content": "```json\n{\n    \"id\": \"toolu_01877uqKeefFGKxvJy5ZJ1AT\",\n    \"name\": \"filesystem\",\n    \"arguments\": {\n        \"operation\": \"read_file\",\n        \"path\": \"src/humbug/color_role.py\"\n    }\n}\n```",
      "completed": true,
      "tool_calls": [
        {
          "id": "toolu_01877uqKeefFGKxvJy5ZJ1AT",
          "name": "filesystem",
          "arguments": {
            "operation": "read_file",
            "path": "src/humbug/color_role.py"
          }
        }
      ]
    },
    {
      "id": "44161a18-405c-4e25-a36c-9fa44fac3ae7",
      "timestamp": "2025-08-29T18:55:40.661359+00:00",
      "type": "tool_result",
      "content": "```json\n{\n    \"id\": \"toolu_01877uqKeefFGKxvJy5ZJ1AT\",\n    \"name\": \"filesystem\",\n    \"content\": \"File: src/humbug/color_role.py\\nSize: 7,101 bytes\\nEncoding: utf-8\\n\\n\\\"\\\"\\\"Handle application styling\\\"\\\"\\\"\\n\\nfrom enum import Enum, auto\\n\\n\\nclass ColorRole(Enum):\\n    \\\"\\\"\\\"Enumeration of color roles in the application.\\\"\\\"\\\"\\n    # Background colours\\n    BACKGROUND_PRIMARY = auto()         # Main window background\\n    BACKGROUND_SECONDARY = auto()       # Secondary elements background\\n    BACKGROUND_TERTIARY = auto()        # Tertiary elements background\\n    BACKGROUND_DIALOG = auto()          # Dialog box background\\n\\n    # Text colours\\n    TEXT_PRIMARY = auto()               # Primary text color\\n    TEXT_BRIGHT = auto()                # Bright text color\\n    TEXT_HEADING = auto()               # Heading text color\\n    TEXT_HEADING_BRIGHT = auto()        # Bright heading text color\\n    TEXT_DISABLED = auto()              # Disabled text color\\n    TEXT_SELECTED = auto()              # Selected text background\\n    TEXT_FOUND = auto()                 # Found text background\\n    TEXT_FOUND_DIM = auto()             # Dimmed found text background\\n    TEXT_RECOMMENDED = auto()           # Recommended text color\\n    TEXT_LINK = auto()                  # Link text color\\n    TEXT_INACTIVE = auto()              # Inactive text colour\\n    TEXT_EPHEMERAL = auto()             # Ephemeral text color\\n    TEXT_EPHEMERAL_INACTIVE = auto()    # Inactive ephemeral text color\\n    TEXT_ERROR = auto()                 # Error text color\\n    TEXT_ERROR_INACTIVE = auto()        # Inactive error text color\\n\\n    # Edit box colours\\n    EDIT_BOX_BORDER = auto()            # Edit box border\\n    EDIT_BOX_BACKGROUND = auto()        # Edit box background\\n    EDIT_BOX_ERROR = auto()             # Edit box error\\n\\n    # Tab colours\\n    TAB_BAR_BACKGROUND = auto()         # Tab bar background\\n    TAB_BACKGROUND_ACTIVE = auto()      # Active tab background\\n    TAB_BACKGROUND_INACTIVE = auto()    # Inactive tab background\\n    TAB_BACKGROUND_HOVER = auto()       # Tab hover background\\n    TAB_BACKGROUND_UPDATED = auto()     # Tab background when content updated\\n    TAB_BORDER_ACTIVE = auto()          # Active tab border\\n\\n    # Button colours\\n    BUTTON_BACKGROUND = auto()          # Push button background\\n    BUTTON_BACKGROUND_PRESSED = auto()  # Pressed push button background\\n    BUTTON_BACKGROUND_HOVER = auto()    # Hover state push button background\\n    BUTTON_SECONDARY_BACKGROUND = auto()\\n                                        # Push button background\\n    BUTTON_SECONDARY_BACKGROUND_PRESSED = auto()\\n                                        # Pressed push button background\\n    BUTTON_SECONDARY_BACKGROUND_HOVER = auto()\\n                                        # Hover state push button background\\n    BUTTON_BACKGROUND_RECOMMENDED = auto()\\n                                        # Recommended primary action button\\n    BUTTON_BACKGROUND_RECOMMENDED_PRESSED = auto()\\n                                        # Recommended primary action button pressed\\n    BUTTON_BACKGROUND_RECOMMENDED_HOVER = auto()\\n                                        # Recommended primary action button hover\\n    BUTTON_BACKGROUND_DESTRUCTIVE = auto()\\n                                        # Destructive primary action button\\n    BUTTON_BACKGROUND_DESTRUCTIVE_PRESSED = auto()\\n                                        # Destructive primary action button pressed\\n    BUTTON_BACKGROUND_DESTRUCTIVE_HOVER = auto()\\n                                        # Destructive primary action button hover\\n    BUTTON_BACKGROUND_DISABLED = auto()\\n                                        # Disabled push button background\\n\\n    # Menu elements\\n    MENU_BACKGROUND = auto()            # Menu background\\n    MENU_HOVER = auto()                 # Menu item hover\\n    MENU_BORDER = auto()                # Menu border\\n\\n    # Splitter bars\\n    SPLITTER = auto()                   # Splitter bar\\n\\n    # Scroll bar elements\\n    SCROLLBAR_BACKGROUND = auto()       # Scrollbar background\\n    SCROLLBAR_HANDLE = auto()           # Scrollbar handle\\n\\n    # Table elements\\n    TABLE_BORDER = auto()               # Table border\\n    TABLE_HEADER_BACKGROUND = auto()    # Table header background\\n\\n    # Message colours\\n    MESSAGE_BACKGROUND = auto()         # Message background\\n    MESSAGE_USER_BACKGROUND = auto()    # Message background for user messages\\n    MESSAGE_FOCUSED = auto()            # For highlighting the focused message\\n    MESSAGE_USER = auto()               # User message\\n    MESSAGE_AI = auto()                 # AI response\\n    MESSAGE_REASONING = auto()          # AI reasoning\\n    MESSAGE_TOOL_CALL = auto()          # AI tool call\\n    MESSAGE_TOOL_RESULT = auto()        # AI tool result\\n    MESSAGE_SYSTEM_ERROR = auto()       # System error message\\n    MESSAGE_SYSTEM_SUCCESS = auto()     # System success message\\n    MESSAGE_LANGUAGE = auto()           # Language heading\\n    MESSAGE_BOOKMARK = auto()           # Bookmark highlight\\n    MESSAGE_STREAMING = auto()          # Message streaming\\n    MESSAGE_TRACE = auto()              # Trace message\\n    MESSAGE_INFORMATION = auto()        # Information message\\n    MESSAGE_WARNING = auto()            # Warning message\\n    MESSAGE_ERROR = auto()              # Error message\\n\\n    # Status bar elements\\n    STATUS_BAR_BACKGROUND = auto()      # Status bar background\\n\\n    # Close button states\\n    CLOSE_BUTTON_BACKGROUND_HOVER = auto()\\n                                        # Hover state close button background\\n\\n    # Editor line numbers\\n    LINE_NUMBER = auto()                # Line number\\n\\n    # Syntax highlighting\\n    SYNTAX_ERROR = auto()               # Red\\n    SYNTAX_01 = auto()                  # Cyan\\n    SYNTAX_02 = auto()                  #\\u00a0White\\n    SYNTAX_03 = auto()                  # Light green\\n    SYNTAX_04 = auto()                  # Light pink\\n    SYNTAX_05 = auto()                  # Mid grey\\n    SYNTAX_06 = auto()                  # Light blue\\n    SYNTAX_07 = auto()                  # Light yellow\\n    SYNTAX_08 = auto()                  # Lilac\\n    SYNTAX_09 = auto()                  # Light cyan\\n    SYNTAX_10 = auto()                  # Mid purple\\n    SYNTAX_11 = auto()                  # Mid blue\\n    SYNTAX_12 = auto()                  # Light red\\n    SYNTAX_13 = auto()                  # Light purple\\n    SYNTAX_14 = auto()                  # Gold\\n    SYNTAX_15 = auto()                  # Teal\\n    SYNTAX_16 = auto()                  # Lime green\\n    SYNTAX_17 = auto()                  # Light grey\\n    SYNTAX_18 = auto()                  # Mid grey/green\\n    SYNTAX_19 = auto()                  # Mid orange\\n    SYNTAX_20 = auto()                  # Dark orange\\n    SYNTAX_21 = auto()                  # Green\\n\\n    # Terminal basic colors\\n    TERM_BLACK = auto()\\n    TERM_RED = auto()\\n    TERM_GREEN = auto()\\n    TERM_YELLOW = auto()\\n    TERM_BLUE = auto()\\n    TERM_MAGENTA = auto()\\n    TERM_CYAN = auto()\\n    TERM_WHITE = auto()\\n\\n    # Terminal bright colors\\n    TERM_BRIGHT_BLACK = auto()\\n    TERM_BRIGHT_RED = auto()\\n    TERM_BRIGHT_GREEN = auto()\\n    TERM_BRIGHT_YELLOW = auto()\\n    TERM_BRIGHT_BLUE = auto()\\n    TERM_BRIGHT_MAGENTA = auto()\\n    TERM_BRIGHT_CYAN = auto()\\n    TERM_BRIGHT_WHITE = auto()\\n\",\n    \"error\": null\n}\n```",
      "completed": true,
      "tool_results": [
        {
          "id": "toolu_01877uqKeefFGKxvJy5ZJ1AT",
          "name": "filesystem",
          "content": "File: src/humbug/color_role.py\nSize: 7,101 bytes\nEncoding: utf-8\n\n\"\"\"Handle application styling\"\"\"\n\nfrom enum import Enum, auto\n\n\nclass ColorRole(Enum):\n    \"\"\"Enumeration of color roles in the application.\"\"\"\n    # Background colours\n    BACKGROUND_PRIMARY = auto()         # Main window background\n    BACKGROUND_SECONDARY = auto()       # Secondary elements background\n    BACKGROUND_TERTIARY = auto()        # Tertiary elements background\n    BACKGROUND_DIALOG = auto()          # Dialog box background\n\n    # Text colours\n    TEXT_PRIMARY = auto()               # Primary text color\n    TEXT_BRIGHT = auto()                # Bright text color\n    TEXT_HEADING = auto()               # Heading text color\n    TEXT_HEADING_BRIGHT = auto()        # Bright heading text color\n    TEXT_DISABLED = auto()              # Disabled text color\n    TEXT_SELECTED = auto()              # Selected text background\n    TEXT_FOUND = auto()                 # Found text background\n    TEXT_FOUND_DIM = auto()             # Dimmed found text background\n    TEXT_RECOMMENDED = auto()           # Recommended text color\n    TEXT_LINK = auto()                  # Link text color\n    TEXT_INACTIVE = auto()              # Inactive text colour\n    TEXT_EPHEMERAL = auto()             # Ephemeral text color\n    TEXT_EPHEMERAL_INACTIVE = auto()    # Inactive ephemeral text color\n    TEXT_ERROR = auto()                 # Error text color\n    TEXT_ERROR_INACTIVE = auto()        # Inactive error text color\n\n    # Edit box colours\n    EDIT_BOX_BORDER = auto()            # Edit box border\n    EDIT_BOX_BACKGROUND = auto()        # Edit box background\n    EDIT_BOX_ERROR = auto()             # Edit box error\n\n    # Tab colours\n    TAB_BAR_BACKGROUND = auto()         # Tab bar background\n    TAB_BACKGROUND_ACTIVE = auto()      # Active tab background\n    TAB_BACKGROUND_INACTIVE = auto()    # Inactive tab background\n    TAB_BACKGROUND_HOVER = auto()       # Tab hover background\n    TAB_BACKGROUND_UPDATED = auto()     # Tab background when content updated\n    TAB_BORDER_ACTIVE = auto()          # Active tab border\n\n    # Button colours\n    BUTTON_BACKGROUND = auto()          # Push button background\n    BUTTON_BACKGROUND_PRESSED = auto()  # Pressed push button background\n    BUTTON_BACKGROUND_HOVER = auto()    # Hover state push button background\n    BUTTON_SECONDARY_BACKGROUND = auto()\n                                        # Push button background\n    BUTTON_SECONDARY_BACKGROUND_PRESSED = auto()\n                                        # Pressed push button background\n    BUTTON_SECONDARY_BACKGROUND_HOVER = auto()\n                                        # Hover state push button background\n    BUTTON_BACKGROUND_RECOMMENDED = auto()\n                                        # Recommended primary action button\n    BUTTON_BACKGROUND_RECOMMENDED_PRESSED = auto()\n                                        # Recommended primary action button pressed\n    BUTTON_BACKGROUND_RECOMMENDED_HOVER = auto()\n                                        # Recommended primary action button hover\n    BUTTON_BACKGROUND_DESTRUCTIVE = auto()\n                                        # Destructive primary action button\n    BUTTON_BACKGROUND_DESTRUCTIVE_PRESSED = auto()\n                                        # Destructive primary action button pressed\n    BUTTON_BACKGROUND_DESTRUCTIVE_HOVER = auto()\n                                        # Destructive primary action button hover\n    BUTTON_BACKGROUND_DISABLED = auto()\n                                        # Disabled push button background\n\n    # Menu elements\n    MENU_BACKGROUND = auto()            # Menu background\n    MENU_HOVER = auto()                 # Menu item hover\n    MENU_BORDER = auto()                # Menu border\n\n    # Splitter bars\n    SPLITTER = auto()                   # Splitter bar\n\n    # Scroll bar elements\n    SCROLLBAR_BACKGROUND = auto()       # Scrollbar background\n    SCROLLBAR_HANDLE = auto()           # Scrollbar handle\n\n    # Table elements\n    TABLE_BORDER = auto()               # Table border\n    TABLE_HEADER_BACKGROUND = auto()    # Table header background\n\n    # Message colours\n    MESSAGE_BACKGROUND = auto()         # Message background\n    MESSAGE_USER_BACKGROUND = auto()    # Message background for user messages\n    MESSAGE_FOCUSED = auto()            # For highlighting the focused message\n    MESSAGE_USER = auto()               # User message\n    MESSAGE_AI = auto()                 # AI response\n    MESSAGE_REASONING = auto()          # AI reasoning\n    MESSAGE_TOOL_CALL = auto()          # AI tool call\n    MESSAGE_TOOL_RESULT = auto()        # AI tool result\n    MESSAGE_SYSTEM_ERROR = auto()       # System error message\n    MESSAGE_SYSTEM_SUCCESS = auto()     # System success message\n    MESSAGE_LANGUAGE = auto()           # Language heading\n    MESSAGE_BOOKMARK = auto()           # Bookmark highlight\n    MESSAGE_STREAMING = auto()          # Message streaming\n    MESSAGE_TRACE = auto()              # Trace message\n    MESSAGE_INFORMATION = auto()        # Information message\n    MESSAGE_WARNING = auto()            # Warning message\n    MESSAGE_ERROR = auto()              # Error message\n\n    # Status bar elements\n    STATUS_BAR_BACKGROUND = auto()      # Status bar background\n\n    # Close button states\n    CLOSE_BUTTON_BACKGROUND_HOVER = auto()\n                                        # Hover state close button background\n\n    # Editor line numbers\n    LINE_NUMBER = auto()                # Line number\n\n    # Syntax highlighting\n    SYNTAX_ERROR = auto()               # Red\n    SYNTAX_01 = auto()                  # Cyan\n    SYNTAX_02 = auto()                  #\u00a0White\n    SYNTAX_03 = auto()                  # Light green\n    SYNTAX_04 = auto()                  # Light pink\n    SYNTAX_05 = auto()                  # Mid grey\n    SYNTAX_06 = auto()                  # Light blue\n    SYNTAX_07 = auto()                  # Light yellow\n    SYNTAX_08 = auto()                  # Lilac\n    SYNTAX_09 = auto()                  # Light cyan\n    SYNTAX_10 = auto()                  # Mid purple\n    SYNTAX_11 = auto()                  # Mid blue\n    SYNTAX_12 = auto()                  # Light red\n    SYNTAX_13 = auto()                  # Light purple\n    SYNTAX_14 = auto()                  # Gold\n    SYNTAX_15 = auto()                  # Teal\n    SYNTAX_16 = auto()                  # Lime green\n    SYNTAX_17 = auto()                  # Light grey\n    SYNTAX_18 = auto()                  # Mid grey/green\n    SYNTAX_19 = auto()                  # Mid orange\n    SYNTAX_20 = auto()                  # Dark orange\n    SYNTAX_21 = auto()                  # Green\n\n    # Terminal basic colors\n    TERM_BLACK = auto()\n    TERM_RED = auto()\n    TERM_GREEN = auto()\n    TERM_YELLOW = auto()\n    TERM_BLUE = auto()\n    TERM_MAGENTA = auto()\n    TERM_CYAN = auto()\n    TERM_WHITE = auto()\n\n    # Terminal bright colors\n    TERM_BRIGHT_BLACK = auto()\n    TERM_BRIGHT_RED = auto()\n    TERM_BRIGHT_GREEN = auto()\n    TERM_BRIGHT_YELLOW = auto()\n    TERM_BRIGHT_BLUE = auto()\n    TERM_BRIGHT_MAGENTA = auto()\n    TERM_BRIGHT_CYAN = auto()\n    TERM_BRIGHT_WHITE = auto()\n",
          "error": null
        }
      ]
    },
    {
      "id": "1948a470-954f-4c72-9c31-3295a471ddc2",
      "timestamp": "2025-08-29T18:55:40.670252+00:00",
      "type": "user_message",
      "content": "",
      "completed": true,
      "tool_results": [
        {
          "id": "toolu_01877uqKeefFGKxvJy5ZJ1AT",
          "name": "filesystem",
          "content": "File: src/humbug/color_role.py\nSize: 7,101 bytes\nEncoding: utf-8\n\n\"\"\"Handle application styling\"\"\"\n\nfrom enum import Enum, auto\n\n\nclass ColorRole(Enum):\n    \"\"\"Enumeration of color roles in the application.\"\"\"\n    # Background colours\n    BACKGROUND_PRIMARY = auto()         # Main window background\n    BACKGROUND_SECONDARY = auto()       # Secondary elements background\n    BACKGROUND_TERTIARY = auto()        # Tertiary elements background\n    BACKGROUND_DIALOG = auto()          # Dialog box background\n\n    # Text colours\n    TEXT_PRIMARY = auto()               # Primary text color\n    TEXT_BRIGHT = auto()                # Bright text color\n    TEXT_HEADING = auto()               # Heading text color\n    TEXT_HEADING_BRIGHT = auto()        # Bright heading text color\n    TEXT_DISABLED = auto()              # Disabled text color\n    TEXT_SELECTED = auto()              # Selected text background\n    TEXT_FOUND = auto()                 # Found text background\n    TEXT_FOUND_DIM = auto()             # Dimmed found text background\n    TEXT_RECOMMENDED = auto()           # Recommended text color\n    TEXT_LINK = auto()                  # Link text color\n    TEXT_INACTIVE = auto()              # Inactive text colour\n    TEXT_EPHEMERAL = auto()             # Ephemeral text color\n    TEXT_EPHEMERAL_INACTIVE = auto()    # Inactive ephemeral text color\n    TEXT_ERROR = auto()                 # Error text color\n    TEXT_ERROR_INACTIVE = auto()        # Inactive error text color\n\n    # Edit box colours\n    EDIT_BOX_BORDER = auto()            # Edit box border\n    EDIT_BOX_BACKGROUND = auto()        # Edit box background\n    EDIT_BOX_ERROR = auto()             # Edit box error\n\n    # Tab colours\n    TAB_BAR_BACKGROUND = auto()         # Tab bar background\n    TAB_BACKGROUND_ACTIVE = auto()      # Active tab background\n    TAB_BACKGROUND_INACTIVE = auto()    # Inactive tab background\n    TAB_BACKGROUND_HOVER = auto()       # Tab hover background\n    TAB_BACKGROUND_UPDATED = auto()     # Tab background when content updated\n    TAB_BORDER_ACTIVE = auto()          # Active tab border\n\n    # Button colours\n    BUTTON_BACKGROUND = auto()          # Push button background\n    BUTTON_BACKGROUND_PRESSED = auto()  # Pressed push button background\n    BUTTON_BACKGROUND_HOVER = auto()    # Hover state push button background\n    BUTTON_SECONDARY_BACKGROUND = auto()\n                                        # Push button background\n    BUTTON_SECONDARY_BACKGROUND_PRESSED = auto()\n                                        # Pressed push button background\n    BUTTON_SECONDARY_BACKGROUND_HOVER = auto()\n                                        # Hover state push button background\n    BUTTON_BACKGROUND_RECOMMENDED = auto()\n                                        # Recommended primary action button\n    BUTTON_BACKGROUND_RECOMMENDED_PRESSED = auto()\n                                        # Recommended primary action button pressed\n    BUTTON_BACKGROUND_RECOMMENDED_HOVER = auto()\n                                        # Recommended primary action button hover\n    BUTTON_BACKGROUND_DESTRUCTIVE = auto()\n                                        # Destructive primary action button\n    BUTTON_BACKGROUND_DESTRUCTIVE_PRESSED = auto()\n                                        # Destructive primary action button pressed\n    BUTTON_BACKGROUND_DESTRUCTIVE_HOVER = auto()\n                                        # Destructive primary action button hover\n    BUTTON_BACKGROUND_DISABLED = auto()\n                                        # Disabled push button background\n\n    # Menu elements\n    MENU_BACKGROUND = auto()            # Menu background\n    MENU_HOVER = auto()                 # Menu item hover\n    MENU_BORDER = auto()                # Menu border\n\n    # Splitter bars\n    SPLITTER = auto()                   # Splitter bar\n\n    # Scroll bar elements\n    SCROLLBAR_BACKGROUND = auto()       # Scrollbar background\n    SCROLLBAR_HANDLE = auto()           # Scrollbar handle\n\n    # Table elements\n    TABLE_BORDER = auto()               # Table border\n    TABLE_HEADER_BACKGROUND = auto()    # Table header background\n\n    # Message colours\n    MESSAGE_BACKGROUND = auto()         # Message background\n    MESSAGE_USER_BACKGROUND = auto()    # Message background for user messages\n    MESSAGE_FOCUSED = auto()            # For highlighting the focused message\n    MESSAGE_USER = auto()               # User message\n    MESSAGE_AI = auto()                 # AI response\n    MESSAGE_REASONING = auto()          # AI reasoning\n    MESSAGE_TOOL_CALL = auto()          # AI tool call\n    MESSAGE_TOOL_RESULT = auto()        # AI tool result\n    MESSAGE_SYSTEM_ERROR = auto()       # System error message\n    MESSAGE_SYSTEM_SUCCESS = auto()     # System success message\n    MESSAGE_LANGUAGE = auto()           # Language heading\n    MESSAGE_BOOKMARK = auto()           # Bookmark highlight\n    MESSAGE_STREAMING = auto()          # Message streaming\n    MESSAGE_TRACE = auto()              # Trace message\n    MESSAGE_INFORMATION = auto()        # Information message\n    MESSAGE_WARNING = auto()            # Warning message\n    MESSAGE_ERROR = auto()              # Error message\n\n    # Status bar elements\n    STATUS_BAR_BACKGROUND = auto()      # Status bar background\n\n    # Close button states\n    CLOSE_BUTTON_BACKGROUND_HOVER = auto()\n                                        # Hover state close button background\n\n    # Editor line numbers\n    LINE_NUMBER = auto()                # Line number\n\n    # Syntax highlighting\n    SYNTAX_ERROR = auto()               # Red\n    SYNTAX_01 = auto()                  # Cyan\n    SYNTAX_02 = auto()                  #\u00a0White\n    SYNTAX_03 = auto()                  # Light green\n    SYNTAX_04 = auto()                  # Light pink\n    SYNTAX_05 = auto()                  # Mid grey\n    SYNTAX_06 = auto()                  # Light blue\n    SYNTAX_07 = auto()                  # Light yellow\n    SYNTAX_08 = auto()                  # Lilac\n    SYNTAX_09 = auto()                  # Light cyan\n    SYNTAX_10 = auto()                  # Mid purple\n    SYNTAX_11 = auto()                  # Mid blue\n    SYNTAX_12 = auto()                  # Light red\n    SYNTAX_13 = auto()                  # Light purple\n    SYNTAX_14 = auto()                  # Gold\n    SYNTAX_15 = auto()                  # Teal\n    SYNTAX_16 = auto()                  # Lime green\n    SYNTAX_17 = auto()                  # Light grey\n    SYNTAX_18 = auto()                  # Mid grey/green\n    SYNTAX_19 = auto()                  # Mid orange\n    SYNTAX_20 = auto()                  # Dark orange\n    SYNTAX_21 = auto()                  # Green\n\n    # Terminal basic colors\n    TERM_BLACK = auto()\n    TERM_RED = auto()\n    TERM_GREEN = auto()\n    TERM_YELLOW = auto()\n    TERM_BLUE = auto()\n    TERM_MAGENTA = auto()\n    TERM_CYAN = auto()\n    TERM_WHITE = auto()\n\n    # Terminal bright colors\n    TERM_BRIGHT_BLACK = auto()\n    TERM_BRIGHT_RED = auto()\n    TERM_BRIGHT_GREEN = auto()\n    TERM_BRIGHT_YELLOW = auto()\n    TERM_BRIGHT_BLUE = auto()\n    TERM_BRIGHT_MAGENTA = auto()\n    TERM_BRIGHT_CYAN = auto()\n    TERM_BRIGHT_WHITE = auto()\n",
          "error": null
        }
      ]
    },
    {
      "id": "9e12d6ac-9c28-4c19-a603-55a30cb33e6c",
      "timestamp": "2025-08-29T18:55:57.778556+00:00",
      "type": "ai_response",
      "content": "",
      "completed": true,
      "model": "claude-sonnet-4-20250514",
      "reasoning_capability": 1,
      "temperature": 0.7,
      "tool_calls": [
        {
          "id": "toolu_012f43GtHi65r5XT1Nnpet5p",
          "name": "filesystem",
          "arguments": {
            "operation": "write_file",
            "path": "src/humbug/color_role.py",
            "content": "\"\"\"Handle application styling\"\"\"\n\nfrom enum import Enum, auto\n\n\nclass ColorRole(Enum):\n    \"\"\"Enumeration of color roles in the application.\"\"\"\n    # Background colours\n    BACKGROUND_PRIMARY = auto()         # Main window background\n    BACKGROUND_SECONDARY = auto()       # Secondary elements background\n    BACKGROUND_TERTIARY = auto()        # Tertiary elements background\n    BACKGROUND_DIALOG = auto()          # Dialog box background\n\n    # Text colours\n    TEXT_PRIMARY = auto()               # Primary text color\n    TEXT_BRIGHT = auto()                # Bright text color\n    TEXT_HEADING = auto()               # Heading text color\n    TEXT_HEADING_BRIGHT = auto()        # Bright heading text color\n    TEXT_DISABLED = auto()              # Disabled text color\n    TEXT_SELECTED = auto()              # Selected text background\n    TEXT_FOUND = auto()                 # Found text background\n    TEXT_FOUND_DIM = auto()             # Dimmed found text background\n    TEXT_RECOMMENDED = auto()           # Recommended text color\n    TEXT_LINK = auto()                  # Link text color\n    TEXT_INACTIVE = auto()              # Inactive text colour\n    TEXT_EPHEMERAL = auto()             # Ephemeral text color\n    TEXT_EPHEMERAL_INACTIVE = auto()    # Inactive ephemeral text color\n    TEXT_ERROR = auto()                 # Error text color\n    TEXT_ERROR_INACTIVE = auto()        # Inactive error text color\n\n    # Edit box colours\n    EDIT_BOX_BORDER = auto()            # Edit box border\n    EDIT_BOX_BACKGROUND = auto()        # Edit box background\n    EDIT_BOX_ERROR = auto()             # Edit box error\n\n    # Tab colours\n    TAB_BAR_BACKGROUND = auto()         # Tab bar background\n    TAB_BACKGROUND_ACTIVE = auto()      # Active tab background\n    TAB_BACKGROUND_INACTIVE = auto()    # Inactive tab background\n    TAB_BACKGROUND_HOVER = auto()       # Tab hover background\n    TAB_BACKGROUND_UPDATED = auto()     # Tab background when content updated\n    TAB_BORDER_ACTIVE = auto()          # Active tab border\n\n    # Button colours\n    BUTTON_BACKGROUND = auto()          # Push button background\n    BUTTON_BACKGROUND_PRESSED = auto()  # Pressed push button background\n    BUTTON_BACKGROUND_HOVER = auto()    # Hover state push button background\n    BUTTON_SECONDARY_BACKGROUND = auto()\n                                        # Push button background\n    BUTTON_SECONDARY_BACKGROUND_PRESSED = auto()\n                                        # Pressed push button background\n    BUTTON_SECONDARY_BACKGROUND_HOVER = auto()\n                                        # Hover state push button background\n    BUTTON_BACKGROUND_RECOMMENDED = auto()\n                                        # Recommended primary action button\n    BUTTON_BACKGROUND_RECOMMENDED_PRESSED = auto()\n                                        # Recommended primary action button pressed\n    BUTTON_BACKGROUND_RECOMMENDED_HOVER = auto()\n                                        # Recommended primary action button hover\n    BUTTON_BACKGROUND_DESTRUCTIVE = auto()\n                                        # Destructive primary action button\n    BUTTON_BACKGROUND_DESTRUCTIVE_PRESSED = auto()\n                                        # Destructive primary action button pressed\n    BUTTON_BACKGROUND_DESTRUCTIVE_HOVER = auto()\n                                        # Destructive primary action button hover\n    BUTTON_BACKGROUND_DISABLED = auto()\n                                        # Disabled push button background\n\n    # Menu elements\n    MENU_BACKGROUND = auto()            # Menu background\n    MENU_HOVER = auto()                 # Menu item hover\n    MENU_BORDER = auto()                # Menu border\n\n    # Splitter bars\n    SPLITTER = auto()                   # Splitter bar\n\n    # Scroll bar elements\n    SCROLLBAR_BACKGROUND = auto()       # Scrollbar background\n    SCROLLBAR_HANDLE = auto()           # Scrollbar handle\n\n    # Table elements\n    TABLE_BORDER = auto()               # Table border\n    TABLE_HEADER_BACKGROUND = auto()    # Table header background\n\n    # Message colours\n    MESSAGE_BACKGROUND = auto()         # Message background\n    MESSAGE_USER_BACKGROUND = auto()    # Message background for user messages\n    MESSAGE_FOCUSED = auto()            # For highlighting the focused message\n    MESSAGE_USER = auto()               # User message\n    MESSAGE_AI = auto()                 # AI response\n    MESSAGE_REASONING = auto()          # AI reasoning\n    MESSAGE_TOOL_CALL = auto()          # AI tool call\n    MESSAGE_TOOL_RESULT = auto()        # AI tool result\n    MESSAGE_SYSTEM_ERROR = auto()       # System error message\n    MESSAGE_SYSTEM_SUCCESS = auto()     # System success message\n    MESSAGE_LANGUAGE = auto()           # Language heading\n    MESSAGE_BOOKMARK = auto()           # Bookmark highlight\n    MESSAGE_STREAMING = auto()          # Message streaming\n    MESSAGE_TRACE = auto()              # Trace message\n    MESSAGE_INFORMATION = auto()        # Information message\n    MESSAGE_WARNING = auto()            # Warning message\n    MESSAGE_ERROR = auto()              # Error message\n\n    # Status bar elements\n    STATUS_BAR_BACKGROUND = auto()      # Status bar background\n    CANARY_BACKGROUND = auto()          # Canary indicator background for uncaught exceptions\n\n    # Close button states\n    CLOSE_BUTTON_BACKGROUND_HOVER = auto()\n                                        # Hover state close button background\n\n    # Editor line numbers\n    LINE_NUMBER = auto()                # Line number\n\n    # Syntax highlighting\n    SYNTAX_ERROR = auto()               # Red\n    SYNTAX_01 = auto()                  # Cyan\n    SYNTAX_02 = auto()                  # White\n    SYNTAX_03 = auto()                  # Light green\n    SYNTAX_04 = auto()                  # Light pink\n    SYNTAX_05 = auto()                  # Mid grey\n    SYNTAX_06 = auto()                  # Light blue\n    SYNTAX_07 = auto()                  # Light yellow\n    SYNTAX_08 = auto()                  # Lilac\n    SYNTAX_09 = auto()                  # Light cyan\n    SYNTAX_10 = auto()                  # Mid purple\n    SYNTAX_11 = auto()                  # Mid blue\n    SYNTAX_12 = auto()                  # Light red\n    SYNTAX_13 = auto()                  # Light purple\n    SYNTAX_14 = auto()                  # Gold\n    SYNTAX_15 = auto()                  # Teal\n    SYNTAX_16 = auto()                  # Lime green\n    SYNTAX_17 = auto()                  # Light grey\n    SYNTAX_18 = auto()                  # Mid grey/green\n    SYNTAX_19 = auto()                  # Mid orange\n    SYNTAX_20 = auto()                  # Dark orange\n    SYNTAX_21 = auto()                  # Green\n\n    # Terminal basic colors\n    TERM_BLACK = auto()\n    TERM_RED = auto()\n    TERM_GREEN = auto()\n    TERM_YELLOW = auto()\n    TERM_BLUE = auto()\n    TERM_MAGENTA = auto()\n    TERM_CYAN = auto()\n    TERM_WHITE = auto()\n\n    # Terminal bright colors\n    TERM_BRIGHT_BLACK = auto()\n    TERM_BRIGHT_RED = auto()\n    TERM_BRIGHT_GREEN = auto()\n    TERM_BRIGHT_YELLOW = auto()\n    TERM_BRIGHT_BLUE = auto()\n    TERM_BRIGHT_MAGENTA = auto()\n    TERM_BRIGHT_CYAN = auto()\n    TERM_BRIGHT_WHITE = auto()"
          }
        }
      ]
    },
    {
      "id": "61bd9c42-2e95-4714-be12-4a6141556a06",
      "timestamp": "2025-08-29T18:55:57.784875+00:00",
      "type": "tool_call",
      "content": "```json\n{\n    \"id\": \"toolu_012f43GtHi65r5XT1Nnpet5p\",\n    \"name\": \"filesystem\",\n    \"arguments\": {\n        \"operation\": \"write_file\",\n        \"path\": \"src/humbug/color_role.py\",\n        \"content\": \"\\\"\\\"\\\"Handle application styling\\\"\\\"\\\"\\n\\nfrom enum import Enum, auto\\n\\n\\nclass ColorRole(Enum):\\n    \\\"\\\"\\\"Enumeration of color roles in the application.\\\"\\\"\\\"\\n    # Background colours\\n    BACKGROUND_PRIMARY = auto()         # Main window background\\n    BACKGROUND_SECONDARY = auto()       # Secondary elements background\\n    BACKGROUND_TERTIARY = auto()        # Tertiary elements background\\n    BACKGROUND_DIALOG = auto()          # Dialog box background\\n\\n    # Text colours\\n    TEXT_PRIMARY = auto()               # Primary text color\\n    TEXT_BRIGHT = auto()                # Bright text color\\n    TEXT_HEADING = auto()               # Heading text color\\n    TEXT_HEADING_BRIGHT = auto()        # Bright heading text color\\n    TEXT_DISABLED = auto()              # Disabled text color\\n    TEXT_SELECTED = auto()              # Selected text background\\n    TEXT_FOUND = auto()                 # Found text background\\n    TEXT_FOUND_DIM = auto()             # Dimmed found text background\\n    TEXT_RECOMMENDED = auto()           # Recommended text color\\n    TEXT_LINK = auto()                  # Link text color\\n    TEXT_INACTIVE = auto()              # Inactive text colour\\n    TEXT_EPHEMERAL = auto()             # Ephemeral text color\\n    TEXT_EPHEMERAL_INACTIVE = auto()    # Inactive ephemeral text color\\n    TEXT_ERROR = auto()                 # Error text color\\n    TEXT_ERROR_INACTIVE = auto()        # Inactive error text color\\n\\n    # Edit box colours\\n    EDIT_BOX_BORDER = auto()            # Edit box border\\n    EDIT_BOX_BACKGROUND = auto()        # Edit box background\\n    EDIT_BOX_ERROR = auto()             # Edit box error\\n\\n    # Tab colours\\n    TAB_BAR_BACKGROUND = auto()         # Tab bar background\\n    TAB_BACKGROUND_ACTIVE = auto()      # Active tab background\\n    TAB_BACKGROUND_INACTIVE = auto()    # Inactive tab background\\n    TAB_BACKGROUND_HOVER = auto()       # Tab hover background\\n    TAB_BACKGROUND_UPDATED = auto()     # Tab background when content updated\\n    TAB_BORDER_ACTIVE = auto()          # Active tab border\\n\\n    # Button colours\\n    BUTTON_BACKGROUND = auto()          # Push button background\\n    BUTTON_BACKGROUND_PRESSED = auto()  # Pressed push button background\\n    BUTTON_BACKGROUND_HOVER = auto()    # Hover state push button background\\n    BUTTON_SECONDARY_BACKGROUND = auto()\\n                                        # Push button background\\n    BUTTON_SECONDARY_BACKGROUND_PRESSED = auto()\\n                                        # Pressed push button background\\n    BUTTON_SECONDARY_BACKGROUND_HOVER = auto()\\n                                        # Hover state push button background\\n    BUTTON_BACKGROUND_RECOMMENDED = auto()\\n                                        # Recommended primary action button\\n    BUTTON_BACKGROUND_RECOMMENDED_PRESSED = auto()\\n                                        # Recommended primary action button pressed\\n    BUTTON_BACKGROUND_RECOMMENDED_HOVER = auto()\\n                                        # Recommended primary action button hover\\n    BUTTON_BACKGROUND_DESTRUCTIVE = auto()\\n                                        # Destructive primary action button\\n    BUTTON_BACKGROUND_DESTRUCTIVE_PRESSED = auto()\\n                                        # Destructive primary action button pressed\\n    BUTTON_BACKGROUND_DESTRUCTIVE_HOVER = auto()\\n                                        # Destructive primary action button hover\\n    BUTTON_BACKGROUND_DISABLED = auto()\\n                                        # Disabled push button background\\n\\n    # Menu elements\\n    MENU_BACKGROUND = auto()            # Menu background\\n    MENU_HOVER = auto()                 # Menu item hover\\n    MENU_BORDER = auto()                # Menu border\\n\\n    # Splitter bars\\n    SPLITTER = auto()                   # Splitter bar\\n\\n    # Scroll bar elements\\n    SCROLLBAR_BACKGROUND = auto()       # Scrollbar background\\n    SCROLLBAR_HANDLE = auto()           # Scrollbar handle\\n\\n    # Table elements\\n    TABLE_BORDER = auto()               # Table border\\n    TABLE_HEADER_BACKGROUND = auto()    # Table header background\\n\\n    # Message colours\\n    MESSAGE_BACKGROUND = auto()         # Message background\\n    MESSAGE_USER_BACKGROUND = auto()    # Message background for user messages\\n    MESSAGE_FOCUSED = auto()            # For highlighting the focused message\\n    MESSAGE_USER = auto()               # User message\\n    MESSAGE_AI = auto()                 # AI response\\n    MESSAGE_REASONING = auto()          # AI reasoning\\n    MESSAGE_TOOL_CALL = auto()          # AI tool call\\n    MESSAGE_TOOL_RESULT = auto()        # AI tool result\\n    MESSAGE_SYSTEM_ERROR = auto()       # System error message\\n    MESSAGE_SYSTEM_SUCCESS = auto()     # System success message\\n    MESSAGE_LANGUAGE = auto()           # Language heading\\n    MESSAGE_BOOKMARK = auto()           # Bookmark highlight\\n    MESSAGE_STREAMING = auto()          # Message streaming\\n    MESSAGE_TRACE = auto()              # Trace message\\n    MESSAGE_INFORMATION = auto()        # Information message\\n    MESSAGE_WARNING = auto()            # Warning message\\n    MESSAGE_ERROR = auto()              # Error message\\n\\n    # Status bar elements\\n    STATUS_BAR_BACKGROUND = auto()      # Status bar background\\n    CANARY_BACKGROUND = auto()          # Canary indicator background for uncaught exceptions\\n\\n    # Close button states\\n    CLOSE_BUTTON_BACKGROUND_HOVER = auto()\\n                                        # Hover state close button background\\n\\n    # Editor line numbers\\n    LINE_NUMBER = auto()                # Line number\\n\\n    # Syntax highlighting\\n    SYNTAX_ERROR = auto()               # Red\\n    SYNTAX_01 = auto()                  # Cyan\\n    SYNTAX_02 = auto()                  # White\\n    SYNTAX_03 = auto()                  # Light green\\n    SYNTAX_04 = auto()                  # Light pink\\n    SYNTAX_05 = auto()                  # Mid grey\\n    SYNTAX_06 = auto()                  # Light blue\\n    SYNTAX_07 = auto()                  # Light yellow\\n    SYNTAX_08 = auto()                  # Lilac\\n    SYNTAX_09 = auto()                  # Light cyan\\n    SYNTAX_10 = auto()                  # Mid purple\\n    SYNTAX_11 = auto()                  # Mid blue\\n    SYNTAX_12 = auto()                  # Light red\\n    SYNTAX_13 = auto()                  # Light purple\\n    SYNTAX_14 = auto()                  # Gold\\n    SYNTAX_15 = auto()                  # Teal\\n    SYNTAX_16 = auto()                  # Lime green\\n    SYNTAX_17 = auto()                  # Light grey\\n    SYNTAX_18 = auto()                  # Mid grey/green\\n    SYNTAX_19 = auto()                  # Mid orange\\n    SYNTAX_20 = auto()                  # Dark orange\\n    SYNTAX_21 = auto()                  # Green\\n\\n    # Terminal basic colors\\n    TERM_BLACK = auto()\\n    TERM_RED = auto()\\n    TERM_GREEN = auto()\\n    TERM_YELLOW = auto()\\n    TERM_BLUE = auto()\\n    TERM_MAGENTA = auto()\\n    TERM_CYAN = auto()\\n    TERM_WHITE = auto()\\n\\n    # Terminal bright colors\\n    TERM_BRIGHT_BLACK = auto()\\n    TERM_BRIGHT_RED = auto()\\n    TERM_BRIGHT_GREEN = auto()\\n    TERM_BRIGHT_YELLOW = auto()\\n    TERM_BRIGHT_BLUE = auto()\\n    TERM_BRIGHT_MAGENTA = auto()\\n    TERM_BRIGHT_CYAN = auto()\\n    TERM_BRIGHT_WHITE = auto()\"\n    }\n}\n```",
      "completed": true,
      "tool_calls": [
        {
          "id": "toolu_012f43GtHi65r5XT1Nnpet5p",
          "name": "filesystem",
          "arguments": {
            "operation": "write_file",
            "path": "src/humbug/color_role.py",
            "content": "\"\"\"Handle application styling\"\"\"\n\nfrom enum import Enum, auto\n\n\nclass ColorRole(Enum):\n    \"\"\"Enumeration of color roles in the application.\"\"\"\n    # Background colours\n    BACKGROUND_PRIMARY = auto()         # Main window background\n    BACKGROUND_SECONDARY = auto()       # Secondary elements background\n    BACKGROUND_TERTIARY = auto()        # Tertiary elements background\n    BACKGROUND_DIALOG = auto()          # Dialog box background\n\n    # Text colours\n    TEXT_PRIMARY = auto()               # Primary text color\n    TEXT_BRIGHT = auto()                # Bright text color\n    TEXT_HEADING = auto()               # Heading text color\n    TEXT_HEADING_BRIGHT = auto()        # Bright heading text color\n    TEXT_DISABLED = auto()              # Disabled text color\n    TEXT_SELECTED = auto()              # Selected text background\n    TEXT_FOUND = auto()                 # Found text background\n    TEXT_FOUND_DIM = auto()             # Dimmed found text background\n    TEXT_RECOMMENDED = auto()           # Recommended text color\n    TEXT_LINK = auto()                  # Link text color\n    TEXT_INACTIVE = auto()              # Inactive text colour\n    TEXT_EPHEMERAL = auto()             # Ephemeral text color\n    TEXT_EPHEMERAL_INACTIVE = auto()    # Inactive ephemeral text color\n    TEXT_ERROR = auto()                 # Error text color\n    TEXT_ERROR_INACTIVE = auto()        # Inactive error text color\n\n    # Edit box colours\n    EDIT_BOX_BORDER = auto()            # Edit box border\n    EDIT_BOX_BACKGROUND = auto()        # Edit box background\n    EDIT_BOX_ERROR = auto()             # Edit box error\n\n    # Tab colours\n    TAB_BAR_BACKGROUND = auto()         # Tab bar background\n    TAB_BACKGROUND_ACTIVE = auto()      # Active tab background\n    TAB_BACKGROUND_INACTIVE = auto()    # Inactive tab background\n    TAB_BACKGROUND_HOVER = auto()       # Tab hover background\n    TAB_BACKGROUND_UPDATED = auto()     # Tab background when content updated\n    TAB_BORDER_ACTIVE = auto()          # Active tab border\n\n    # Button colours\n    BUTTON_BACKGROUND = auto()          # Push button background\n    BUTTON_BACKGROUND_PRESSED = auto()  # Pressed push button background\n    BUTTON_BACKGROUND_HOVER = auto()    # Hover state push button background\n    BUTTON_SECONDARY_BACKGROUND = auto()\n                                        # Push button background\n    BUTTON_SECONDARY_BACKGROUND_PRESSED = auto()\n                                        # Pressed push button background\n    BUTTON_SECONDARY_BACKGROUND_HOVER = auto()\n                                        # Hover state push button background\n    BUTTON_BACKGROUND_RECOMMENDED = auto()\n                                        # Recommended primary action button\n    BUTTON_BACKGROUND_RECOMMENDED_PRESSED = auto()\n                                        # Recommended primary action button pressed\n    BUTTON_BACKGROUND_RECOMMENDED_HOVER = auto()\n                                        # Recommended primary action button hover\n    BUTTON_BACKGROUND_DESTRUCTIVE = auto()\n                                        # Destructive primary action button\n    BUTTON_BACKGROUND_DESTRUCTIVE_PRESSED = auto()\n                                        # Destructive primary action button pressed\n    BUTTON_BACKGROUND_DESTRUCTIVE_HOVER = auto()\n                                        # Destructive primary action button hover\n    BUTTON_BACKGROUND_DISABLED = auto()\n                                        # Disabled push button background\n\n    # Menu elements\n    MENU_BACKGROUND = auto()            # Menu background\n    MENU_HOVER = auto()                 # Menu item hover\n    MENU_BORDER = auto()                # Menu border\n\n    # Splitter bars\n    SPLITTER = auto()                   # Splitter bar\n\n    # Scroll bar elements\n    SCROLLBAR_BACKGROUND = auto()       # Scrollbar background\n    SCROLLBAR_HANDLE = auto()           # Scrollbar handle\n\n    # Table elements\n    TABLE_BORDER = auto()               # Table border\n    TABLE_HEADER_BACKGROUND = auto()    # Table header background\n\n    # Message colours\n    MESSAGE_BACKGROUND = auto()         # Message background\n    MESSAGE_USER_BACKGROUND = auto()    # Message background for user messages\n    MESSAGE_FOCUSED = auto()            # For highlighting the focused message\n    MESSAGE_USER = auto()               # User message\n    MESSAGE_AI = auto()                 # AI response\n    MESSAGE_REASONING = auto()          # AI reasoning\n    MESSAGE_TOOL_CALL = auto()          # AI tool call\n    MESSAGE_TOOL_RESULT = auto()        # AI tool result\n    MESSAGE_SYSTEM_ERROR = auto()       # System error message\n    MESSAGE_SYSTEM_SUCCESS = auto()     # System success message\n    MESSAGE_LANGUAGE = auto()           # Language heading\n    MESSAGE_BOOKMARK = auto()           # Bookmark highlight\n    MESSAGE_STREAMING = auto()          # Message streaming\n    MESSAGE_TRACE = auto()              # Trace message\n    MESSAGE_INFORMATION = auto()        # Information message\n    MESSAGE_WARNING = auto()            # Warning message\n    MESSAGE_ERROR = auto()              # Error message\n\n    # Status bar elements\n    STATUS_BAR_BACKGROUND = auto()      # Status bar background\n    CANARY_BACKGROUND = auto()          # Canary indicator background for uncaught exceptions\n\n    # Close button states\n    CLOSE_BUTTON_BACKGROUND_HOVER = auto()\n                                        # Hover state close button background\n\n    # Editor line numbers\n    LINE_NUMBER = auto()                # Line number\n\n    # Syntax highlighting\n    SYNTAX_ERROR = auto()               # Red\n    SYNTAX_01 = auto()                  # Cyan\n    SYNTAX_02 = auto()                  # White\n    SYNTAX_03 = auto()                  # Light green\n    SYNTAX_04 = auto()                  # Light pink\n    SYNTAX_05 = auto()                  # Mid grey\n    SYNTAX_06 = auto()                  # Light blue\n    SYNTAX_07 = auto()                  # Light yellow\n    SYNTAX_08 = auto()                  # Lilac\n    SYNTAX_09 = auto()                  # Light cyan\n    SYNTAX_10 = auto()                  # Mid purple\n    SYNTAX_11 = auto()                  # Mid blue\n    SYNTAX_12 = auto()                  # Light red\n    SYNTAX_13 = auto()                  # Light purple\n    SYNTAX_14 = auto()                  # Gold\n    SYNTAX_15 = auto()                  # Teal\n    SYNTAX_16 = auto()                  # Lime green\n    SYNTAX_17 = auto()                  # Light grey\n    SYNTAX_18 = auto()                  # Mid grey/green\n    SYNTAX_19 = auto()                  # Mid orange\n    SYNTAX_20 = auto()                  # Dark orange\n    SYNTAX_21 = auto()                  # Green\n\n    # Terminal basic colors\n    TERM_BLACK = auto()\n    TERM_RED = auto()\n    TERM_GREEN = auto()\n    TERM_YELLOW = auto()\n    TERM_BLUE = auto()\n    TERM_MAGENTA = auto()\n    TERM_CYAN = auto()\n    TERM_WHITE = auto()\n\n    # Terminal bright colors\n    TERM_BRIGHT_BLACK = auto()\n    TERM_BRIGHT_RED = auto()\n    TERM_BRIGHT_GREEN = auto()\n    TERM_BRIGHT_YELLOW = auto()\n    TERM_BRIGHT_BLUE = auto()\n    TERM_BRIGHT_MAGENTA = auto()\n    TERM_BRIGHT_CYAN = auto()\n    TERM_BRIGHT_WHITE = auto()"
          }
        }
      ]
    },
    {
      "id": "e71ddc19-4076-4ec2-97f3-c838f2d41dd6",
      "timestamp": "2025-08-29T19:53:01.686297+00:00",
      "type": "tool_result",
      "content": "```json\n{\n    \"id\": \"toolu_012f43GtHi65r5XT1Nnpet5p\",\n    \"name\": \"filesystem\",\n    \"content\": \"File written successfully: src/humbug/color_role.py (7,193 bytes)\",\n    \"error\": null\n}\n```",
      "completed": true,
      "tool_results": [
        {
          "id": "toolu_012f43GtHi65r5XT1Nnpet5p",
          "name": "filesystem",
          "content": "File written successfully: src/humbug/color_role.py (7,193 bytes)",
          "error": null
        }
      ]
    },
    {
      "id": "d8da9c65-caf2-421e-ab9e-af367035468f",
      "timestamp": "2025-08-29T19:53:01.702601+00:00",
      "type": "user_message",
      "content": "",
      "completed": true,
      "tool_results": [
        {
          "id": "toolu_012f43GtHi65r5XT1Nnpet5p",
          "name": "filesystem",
          "content": "File written successfully: src/humbug/color_role.py (7,193 bytes)",
          "error": null
        }
      ]
    },
    {
      "id": "b1ee1a8d-5000-437d-8344-a45738a889b8",
      "timestamp": "2025-08-29T19:53:04.115849+00:00",
      "type": "ai_response",
      "content": "Now I need to check the StyleManager to add the color values for the CANARY_BACKGROUND:",
      "completed": true,
      "usage": {
        "prompt_tokens": 29205,
        "completion_tokens": 103,
        "total_tokens": 29308
      },
      "model": "claude-sonnet-4-20250514",
      "reasoning_capability": 1,
      "temperature": 0.7,
      "tool_calls": [
        {
          "id": "toolu_01D6Jyee7AR5oiio3H8VX1Nv",
          "name": "filesystem",
          "arguments": {
            "operation": "read_file",
            "path": "src/humbug/style_manager.py"
          }
        }
      ]
    },
    {
      "id": "3e7b63d8-2d8c-402a-8c85-1d2b06aa3ae6",
      "timestamp": "2025-08-29T19:53:05.806920+00:00",
      "type": "tool_call",
      "content": "```json\n{\n    \"id\": \"toolu_01D6Jyee7AR5oiio3H8VX1Nv\",\n    \"name\": \"filesystem\",\n    \"arguments\": {\n        \"operation\": \"read_file\",\n        \"path\": \"src/humbug/style_manager.py\"\n    }\n}\n```",
      "completed": true,
      "tool_calls": [
        {
          "id": "toolu_01D6Jyee7AR5oiio3H8VX1Nv",
          "name": "filesystem",
          "arguments": {
            "operation": "read_file",
            "path": "src/humbug/style_manager.py"
          }
        }
      ]
    },
    {
      "id": "252e1b7a-423a-4b4d-bdd4-ff6d4a247c88",
      "timestamp": "2025-08-29T19:53:05.818870+00:00",
      "type": "tool_result",
      "content": "```json\n{\n    \"id\": \"toolu_01D6Jyee7AR5oiio3H8VX1Nv\",\n    \"name\": \"filesystem\",\n    \"content\": \"File: src/humbug/style_manager.py\\nSize: 63,529 bytes\\nEncoding: utf-8\\n\\n\\\"\\\"\\\"Style manager for handling application-wide style and zoom settings.\\n\\nImplements a singleton pattern to maintain consistent styling across components.\\nProvides signals for style changes and utilities for scaled size calculations.\\n\\\"\\\"\\\"\\n\\nfrom enum import Enum, auto\\nimport os\\nfrom pathlib import Path\\nfrom typing import Dict, List\\n\\nfrom PySide6.QtCore import QObject, Signal, QOperatingSystemVersion, Qt\\nfrom PySide6.QtGui import QTextCharFormat, QFontDatabase, QColor, QFontMetricsF, QFont, QPixmap\\n\\nfrom syntax import TokenType\\n\\nfrom humbug.color_role import ColorRole\\n\\n\\nclass ColorMode(Enum):\\n    \\\"\\\"\\\"Enumeration for color theme modes.\\\"\\\"\\\"\\n    LIGHT = auto()\\n    DARK = auto()\\n\\n\\nclass StyleManager(QObject):\\n    \\\"\\\"\\\"\\n    Singleton manager for application-wide style settings.\\n\\n    Handles zoom factor management and style updates across the application.\\n    Emits signals when zoom level changes to notify dependent components.\\n\\n    Attributes:\\n        style_changed (Signal): Emitted when style changes, passing new zoom factor\\n        _instance (StyleManager): Singleton instance\\n        _zoom_factor (float): Current zoom scaling factor\\n        _initialized (bool): Tracks initialization state of QObject base\\n    \\\"\\\"\\\"\\n\\n    style_changed = Signal()\\n    _instance = None\\n\\n    def __new__(cls) -> 'StyleManager':\\n        \\\"\\\"\\\"Create or return singleton instance.\\\"\\\"\\\"\\n        if cls._instance is None:\\n            cls._instance = super(StyleManager, cls).__new__(cls)\\n\\n        return cls._instance\\n\\n    def __init__(self) -> None:\\n        \\\"\\\"\\\"Initialize QObject base class if not already done.\\\"\\\"\\\"\\n        if not hasattr(self, '_initialized'):\\n            super().__init__()\\n            self._zoom_factor = 1.0\\n            self._base_font_size = self._determine_base_font_size()\\n            self._user_font_size: float | None = None\\n            self._initialized = True\\n            self._color_mode = ColorMode.DARK  # Default to dark mode\\n            self._colors: Dict[ColorRole, Dict[ColorMode, str]] = self._initialize_colors()\\n            self._highlights: Dict[TokenType, QTextCharFormat] = {}\\n            self._proportional_highlights: Dict[TokenType, QTextCharFormat] = {}\\n\\n            self._code_font_families = [\\\"Menlo\\\", \\\"Consolas\\\", \\\"Monaco\\\", \\\"monospace\\\"]\\n            self._initialize_highlights()\\n            self._initialize_proportional_highlights()\\n            self._create_theme_icons()\\n\\n    def _initialize_colors(self) -> Dict[ColorRole, Dict[ColorMode, str]]:\\n        \\\"\\\"\\\"Initialize the application colours for both light and dark modes.\\\"\\\"\\\"\\n        return {\\n            # Background colours\\n            ColorRole.BACKGROUND_PRIMARY: {\\n                ColorMode.DARK: \\\"#080808\\\",\\n                ColorMode.LIGHT: \\\"#e0e0e0\\\"\\n            },\\n            ColorRole.BACKGROUND_SECONDARY: {\\n                ColorMode.DARK: \\\"#141414\\\",\\n                ColorMode.LIGHT: \\\"#ececec\\\"\\n            },\\n            ColorRole.BACKGROUND_TERTIARY: {\\n                ColorMode.DARK: \\\"#242424\\\",\\n                ColorMode.LIGHT: \\\"#fcfcfc\\\"\\n            },\\n            ColorRole.BACKGROUND_DIALOG: {\\n                ColorMode.DARK: \\\"#282828\\\",\\n                ColorMode.LIGHT: \\\"#d0d0d0\\\"\\n            },\\n\\n            # Text colours\\n            ColorRole.TEXT_PRIMARY: {\\n                ColorMode.DARK: \\\"#d8d8d8\\\",\\n                ColorMode.LIGHT: \\\"#202020\\\"\\n            },\\n            ColorRole.TEXT_BRIGHT: {\\n                ColorMode.DARK: \\\"#ffffff\\\",\\n                ColorMode.LIGHT: \\\"#000000\\\"\\n            },\\n            ColorRole.TEXT_HEADING: {\\n                ColorMode.DARK: \\\"#ffe0a0\\\",\\n                ColorMode.LIGHT: \\\"#204080\\\"\\n            },\\n            ColorRole.TEXT_HEADING_BRIGHT: {\\n                ColorMode.DARK: \\\"#ffe8a0\\\",\\n                ColorMode.LIGHT: \\\"#203880\\\"\\n            },\\n            ColorRole.TEXT_DISABLED: {\\n                ColorMode.DARK: \\\"#707070\\\",\\n                ColorMode.LIGHT: \\\"#909090\\\"\\n            },\\n            ColorRole.TEXT_SELECTED: {\\n                ColorMode.DARK: \\\"#404058\\\",\\n                ColorMode.LIGHT: \\\"#c8c8dc\\\"\\n            },\\n            ColorRole.TEXT_FOUND: {\\n                ColorMode.DARK: \\\"#885050\\\",\\n                ColorMode.LIGHT: \\\"#e0b4b4\\\"\\n            },\\n            ColorRole.TEXT_FOUND_DIM: {\\n                ColorMode.DARK: \\\"#583838\\\",\\n                ColorMode.LIGHT: \\\"#f4d8d8\\\"\\n            },\\n            ColorRole.TEXT_RECOMMENDED: {\\n                ColorMode.DARK: \\\"#ffffff\\\",\\n                ColorMode.LIGHT: \\\"#ffffff\\\"\\n            },\\n            ColorRole.TEXT_LINK: {\\n                ColorMode.DARK: \\\"#80a0ff\\\",\\n                ColorMode.LIGHT: \\\"#0000ff\\\"\\n            },\\n            ColorRole.TEXT_INACTIVE: {\\n                ColorMode.DARK: \\\"#909090\\\",\\n                ColorMode.LIGHT: \\\"#707070\\\"\\n            },\\n            ColorRole.TEXT_EPHEMERAL: {\\n                ColorMode.DARK: \\\"#e0a080\\\",\\n                ColorMode.LIGHT: \\\"#a0785c\\\"\\n            },\\n            ColorRole.TEXT_EPHEMERAL_INACTIVE: {\\n                ColorMode.DARK: \\\"#a06040\\\",\\n                ColorMode.LIGHT: \\\"#c09070\\\"\\n            },\\n            ColorRole.TEXT_ERROR: {\\n                ColorMode.DARK: \\\"#e03020\\\",\\n                ColorMode.LIGHT: \\\"#f04030\\\"\\n            },\\n            ColorRole.TEXT_ERROR_INACTIVE: {\\n                ColorMode.DARK: \\\"#e06050\\\",\\n                ColorMode.LIGHT: \\\"#f07060\\\"\\n            },\\n\\n            # Edit box colours\\n            ColorRole.EDIT_BOX_BORDER: {\\n                ColorMode.DARK: \\\"#6060c0\\\",\\n                ColorMode.LIGHT: \\\"#404080\\\"\\n            },\\n            ColorRole.EDIT_BOX_BACKGROUND: {\\n                ColorMode.DARK: \\\"#242454\\\",\\n                ColorMode.LIGHT: \\\"#b8b8f8\\\"\\n            },\\n            ColorRole.EDIT_BOX_ERROR: {\\n                ColorMode.DARK: \\\"#c03020\\\",\\n                ColorMode.LIGHT: \\\"#d04030\\\"\\n            },\\n\\n            # Tab colours\\n            ColorRole.TAB_BAR_BACKGROUND: {\\n                ColorMode.DARK: \\\"#000000\\\",\\n                ColorMode.LIGHT: \\\"#d8d8d8\\\"\\n            },\\n            ColorRole.TAB_BACKGROUND_ACTIVE: {\\n                ColorMode.DARK: \\\"#1e1e1e\\\",\\n                ColorMode.LIGHT: \\\"#ffffff\\\"\\n            },\\n            ColorRole.TAB_BACKGROUND_INACTIVE: {\\n                ColorMode.DARK: \\\"#141414\\\",\\n                ColorMode.LIGHT: \\\"#f0f0f0\\\"\\n            },\\n            ColorRole.TAB_BACKGROUND_HOVER: {\\n                ColorMode.DARK: \\\"#242454\\\",\\n                ColorMode.LIGHT: \\\"#b8b8f8\\\"\\n            },\\n            ColorRole.TAB_BACKGROUND_UPDATED: {\\n                ColorMode.DARK: \\\"#3c2054\\\",\\n                ColorMode.LIGHT: \\\"#f0d0f8\\\"\\n            },\\n            ColorRole.TAB_BORDER_ACTIVE: {\\n                ColorMode.DARK: \\\"#8080ff\\\",\\n                ColorMode.LIGHT: \\\"#3030ff\\\"\\n            },\\n\\n            # Button colours\\n            ColorRole.BUTTON_BACKGROUND: {\\n                ColorMode.DARK: \\\"#0c0c0c\\\",\\n                ColorMode.LIGHT: \\\"#e8e8e8\\\"\\n            },\\n            ColorRole.BUTTON_BACKGROUND_PRESSED: {\\n                ColorMode.DARK: \\\"#505050\\\",\\n                ColorMode.LIGHT: \\\"#b0b0b0\\\"\\n            },\\n            ColorRole.BUTTON_BACKGROUND_HOVER: {\\n                ColorMode.DARK: \\\"#404040\\\",\\n                ColorMode.LIGHT: \\\"#c0c0c0\\\"\\n            },\\n            ColorRole.BUTTON_SECONDARY_BACKGROUND: {\\n                ColorMode.DARK: \\\"#2c2c2c\\\",\\n                ColorMode.LIGHT: \\\"#d8d8d8\\\"\\n            },\\n            ColorRole.BUTTON_SECONDARY_BACKGROUND_PRESSED: {\\n                ColorMode.DARK: \\\"#505050\\\",\\n                ColorMode.LIGHT: \\\"#b0b0b0\\\"\\n            },\\n            ColorRole.BUTTON_SECONDARY_BACKGROUND_HOVER: {\\n                ColorMode.DARK: \\\"#404040\\\",\\n                ColorMode.LIGHT: \\\"#c0c0c0\\\"\\n            },\\n            ColorRole.BUTTON_BACKGROUND_RECOMMENDED: {\\n                ColorMode.DARK: \\\"#2050c0\\\",\\n                ColorMode.LIGHT: \\\"#3060d0\\\"\\n            },\\n            ColorRole.BUTTON_BACKGROUND_RECOMMENDED_PRESSED: {\\n                ColorMode.DARK: \\\"#4070e0\\\",\\n                ColorMode.LIGHT: \\\"#1040b0\\\"\\n            },\\n            ColorRole.BUTTON_BACKGROUND_RECOMMENDED_HOVER: {\\n                ColorMode.DARK: \\\"#3060d0\\\",\\n                ColorMode.LIGHT: \\\"#2050c0\\\"\\n            },\\n            ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE: {\\n                ColorMode.DARK: \\\"#c03020\\\",\\n                ColorMode.LIGHT: \\\"#d04030\\\"\\n            },\\n            ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_PRESSED: {\\n                ColorMode.DARK: \\\"#e05040\\\",\\n                ColorMode.LIGHT: \\\"#b02010\\\"\\n            },\\n            ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_HOVER: {\\n                ColorMode.DARK: \\\"#d04030\\\",\\n                ColorMode.LIGHT: \\\"#c03020\\\"\\n            },\\n            ColorRole.BUTTON_BACKGROUND_DISABLED: {\\n                ColorMode.DARK: \\\"#202020\\\",\\n                ColorMode.LIGHT: \\\"#d8d8d8\\\"\\n            },\\n\\n            # Menu elements\\n            ColorRole.MENU_BACKGROUND: {\\n                ColorMode.DARK: \\\"#2d2d2d\\\",\\n                ColorMode.LIGHT: \\\"#f0f0f0\\\"\\n            },\\n            ColorRole.MENU_HOVER: {\\n                ColorMode.DARK: \\\"#3060d0\\\",\\n                ColorMode.LIGHT: \\\"#2050c0\\\"\\n            },\\n            ColorRole.MENU_BORDER: {\\n                ColorMode.DARK: \\\"#606060\\\",\\n                ColorMode.LIGHT: \\\"#b0b0b0\\\"\\n            },\\n\\n            # Splitter bars\\n            ColorRole.SPLITTER: {\\n                ColorMode.DARK: \\\"#606060\\\",\\n                ColorMode.LIGHT: \\\"#b0b0b0\\\"\\n            },\\n\\n            # Scroll bar elements\\n            ColorRole.SCROLLBAR_BACKGROUND: {\\n                ColorMode.DARK: \\\"#2d2d2d\\\",\\n                ColorMode.LIGHT: \\\"#f0f0f0\\\"\\n            },\\n            ColorRole.SCROLLBAR_HANDLE: {\\n                ColorMode.DARK: \\\"#404040\\\",\\n                ColorMode.LIGHT: \\\"#c0c0c0\\\"\\n            },\\n\\n            # Table elements\\n            ColorRole.TABLE_BORDER: {\\n                ColorMode.DARK: \\\"#808080\\\",\\n                ColorMode.LIGHT: \\\"#a0a0a0\\\"\\n            },\\n            ColorRole.TABLE_HEADER_BACKGROUND: {\\n                ColorMode.DARK: \\\"#484838\\\",\\n                ColorMode.LIGHT: \\\"#d0d0e0\\\"\\n            },\\n\\n            # Message colours\\n            ColorRole.MESSAGE_BACKGROUND: {\\n                ColorMode.DARK: \\\"#020202\\\",\\n                ColorMode.LIGHT: \\\"#f2f2f2\\\"\\n            },\\n            ColorRole.MESSAGE_USER_BACKGROUND: {\\n                ColorMode.DARK: \\\"#121212\\\",\\n                ColorMode.LIGHT: \\\"#e4e4e4\\\"\\n            },\\n            ColorRole.MESSAGE_FOCUSED: {\\n                ColorMode.DARK: \\\"#3a4654\\\",\\n                ColorMode.LIGHT: \\\"#aab6c4\\\"\\n            },\\n            ColorRole.MESSAGE_USER: {\\n                ColorMode.DARK: \\\"#8080c0\\\",\\n                ColorMode.LIGHT: \\\"#6060a0\\\"\\n            },\\n            ColorRole.MESSAGE_AI: {\\n                ColorMode.DARK: \\\"#80c080\\\",\\n                ColorMode.LIGHT: \\\"#40a040\\\"\\n            },\\n            ColorRole.MESSAGE_REASONING: {\\n                ColorMode.DARK: \\\"#808080\\\",\\n                ColorMode.LIGHT: \\\"#808080\\\"\\n            },\\n            ColorRole.MESSAGE_TOOL_CALL: {\\n                ColorMode.DARK: \\\"#808080\\\",\\n                ColorMode.LIGHT: \\\"#808080\\\"\\n            },\\n            ColorRole.MESSAGE_TOOL_RESULT: {\\n                ColorMode.DARK: \\\"#808080\\\",\\n                ColorMode.LIGHT: \\\"#808080\\\"\\n            },\\n            ColorRole.MESSAGE_SYSTEM_ERROR: {\\n                ColorMode.DARK: \\\"#c08080\\\",\\n                ColorMode.LIGHT: \\\"#a04040\\\"\\n            },\\n            ColorRole.MESSAGE_SYSTEM_SUCCESS: {\\n                ColorMode.DARK: \\\"#80c080\\\",\\n                ColorMode.LIGHT: \\\"#40a040\\\"\\n            },\\n            ColorRole.MESSAGE_LANGUAGE: {\\n                ColorMode.DARK: \\\"#a07850\\\",\\n                ColorMode.LIGHT: \\\"#806040\\\"\\n            },\\n            ColorRole.MESSAGE_BOOKMARK: {\\n                ColorMode.DARK: \\\"#ffdf00\\\",\\n                ColorMode.LIGHT: \\\"#806000\\\"\\n            },\\n            ColorRole.MESSAGE_STREAMING: {\\n                ColorMode.DARK: \\\"#c0a080\\\",\\n                ColorMode.LIGHT: \\\"#a07050\\\"\\n            },\\n            ColorRole.MESSAGE_TRACE: {\\n                ColorMode.DARK: \\\"#a0a0a0\\\",\\n                ColorMode.LIGHT: \\\"#606060\\\"\\n            },\\n            ColorRole.MESSAGE_INFORMATION: {\\n                ColorMode.DARK: \\\"#80b0f0\\\",\\n                ColorMode.LIGHT: \\\"#0060c0\\\"\\n            },\\n            ColorRole.MESSAGE_WARNING: {\\n                ColorMode.DARK: \\\"#f0c040\\\",\\n                ColorMode.LIGHT: \\\"#c0a020\\\"\\n            },\\n            ColorRole.MESSAGE_ERROR: {\\n                ColorMode.DARK: \\\"#ff6060\\\",\\n                ColorMode.LIGHT: \\\"#c03030\\\"\\n            },\\n\\n            # Status bar elements\\n            ColorRole.STATUS_BAR_BACKGROUND: {\\n                ColorMode.DARK: \\\"#121212\\\",\\n                ColorMode.LIGHT: \\\"#e8e8e8\\\"\\n            },\\n\\n            # Close button states\\n            ColorRole.CLOSE_BUTTON_BACKGROUND_HOVER: {\\n                ColorMode.DARK: \\\"#d04030\\\",\\n                ColorMode.LIGHT: \\\"#c03020\\\"\\n            },\\n\\n            # Line numbers\\n            ColorRole.LINE_NUMBER: {\\n                ColorMode.DARK: \\\"#606060\\\",\\n                ColorMode.LIGHT: \\\"#c0c0c0\\\"\\n            },\\n\\n            # Syntax highlighting\\n            ColorRole.SYNTAX_ERROR: {\\n                ColorMode.DARK: \\\"#ff0000\\\",\\n                ColorMode.LIGHT: \\\"#ff0000\\\"\\n            },\\n            ColorRole.SYNTAX_01: {\\n                ColorMode.DARK: \\\"#80e0d0\\\",\\n                ColorMode.LIGHT: \\\"#007070\\\"\\n            },\\n            ColorRole.SYNTAX_02: {\\n                ColorMode.DARK: \\\"#f0f0f0\\\",\\n                ColorMode.LIGHT: \\\"#202020\\\"\\n            },\\n            ColorRole.SYNTAX_03: {\\n                ColorMode.DARK: \\\"#68b068\\\",\\n                ColorMode.LIGHT: \\\"#407040\\\"\\n            },\\n            ColorRole.SYNTAX_04: {\\n                ColorMode.DARK: \\\"#ffa0eb\\\",\\n                ColorMode.LIGHT: \\\"#c000a0\\\"\\n            },\\n            ColorRole.SYNTAX_05: {\\n                ColorMode.DARK: \\\"#808080\\\",\\n                ColorMode.LIGHT: \\\"#606060\\\"\\n            },\\n            ColorRole.SYNTAX_06: {\\n                ColorMode.DARK: \\\"#90e0e8\\\",\\n                ColorMode.LIGHT: \\\"#0080a0\\\"\\n            },\\n            ColorRole.SYNTAX_07: {\\n                ColorMode.DARK: \\\"#e0e080\\\",\\n                ColorMode.LIGHT: \\\"#a0a000\\\"\\n            },\\n            ColorRole.SYNTAX_08: {\\n                ColorMode.DARK: \\\"#b090f0\\\",\\n                ColorMode.LIGHT: \\\"#5040c0\\\"\\n            },\\n            ColorRole.SYNTAX_09: {\\n                ColorMode.DARK: \\\"#90e0e8\\\",\\n                ColorMode.LIGHT: \\\"#0080a0\\\"\\n            },\\n            ColorRole.SYNTAX_10: {\\n                ColorMode.DARK: \\\"#d070d0\\\",\\n                ColorMode.LIGHT: \\\"#a000a0\\\"\\n            },\\n            ColorRole.SYNTAX_11: {\\n                ColorMode.DARK: \\\"#80b0f0\\\",\\n                ColorMode.LIGHT: \\\"#0060c0\\\"\\n            },\\n            ColorRole.SYNTAX_12: {\\n                ColorMode.DARK: \\\"#f08080\\\",\\n                ColorMode.LIGHT: \\\"#c03030\\\"\\n            },\\n            ColorRole.SYNTAX_13: {\\n                ColorMode.DARK: \\\"#ffc0eb\\\",\\n                ColorMode.LIGHT: \\\"#c080a0\\\"\\n            },\\n            ColorRole.SYNTAX_14: {\\n                ColorMode.DARK: \\\"#f0e060\\\",\\n                ColorMode.LIGHT: \\\"#a09040\\\"\\n            },\\n            ColorRole.SYNTAX_15: {\\n                ColorMode.DARK: \\\"#70e0e8\\\",\\n                ColorMode.LIGHT: \\\"#2090a0\\\"\\n            },\\n            ColorRole.SYNTAX_16: {\\n                ColorMode.DARK: \\\"#88d048\\\",\\n                ColorMode.LIGHT: \\\"#508020\\\"\\n            },\\n            ColorRole.SYNTAX_17: {\\n                ColorMode.DARK: \\\"#c0c0c0\\\",\\n                ColorMode.LIGHT: \\\"#404040\\\"\\n            },\\n            ColorRole.SYNTAX_18: {\\n                ColorMode.DARK: \\\"#80b080\\\",\\n                ColorMode.LIGHT: \\\"#609060\\\"\\n            },\\n            ColorRole.SYNTAX_19: {\\n                ColorMode.DARK: \\\"#c87050\\\",\\n                ColorMode.LIGHT: \\\"#a04020\\\"\\n            },\\n            ColorRole.SYNTAX_20: {\\n                ColorMode.DARK: \\\"#c05040\\\",\\n                ColorMode.LIGHT: \\\"#803828\\\"\\n             },\\n            ColorRole.SYNTAX_21: {\\n                ColorMode.DARK: \\\"#30c090\\\",\\n                ColorMode.LIGHT: \\\"#24906c\\\"\\n            },\\n\\n            # Terminal basic colors\\n            ColorRole.TERM_BLACK: {\\n                ColorMode.DARK: \\\"#000000\\\",\\n                ColorMode.LIGHT: \\\"#000000\\\"\\n            },\\n            ColorRole.TERM_RED: {\\n                ColorMode.DARK: \\\"#cd0000\\\",\\n                ColorMode.LIGHT: \\\"#cd0000\\\"\\n            },\\n            ColorRole.TERM_GREEN: {\\n                ColorMode.DARK: \\\"#00cd00\\\",\\n                ColorMode.LIGHT: \\\"#00cd00\\\"\\n            },\\n            ColorRole.TERM_YELLOW: {\\n                ColorMode.DARK: \\\"#cdcd00\\\",\\n                ColorMode.LIGHT: \\\"#cdcd00\\\"\\n            },\\n            ColorRole.TERM_BLUE: {\\n                ColorMode.DARK: \\\"#0000ee\\\",\\n                ColorMode.LIGHT: \\\"#0000ee\\\"\\n            },\\n            ColorRole.TERM_MAGENTA: {\\n                ColorMode.DARK: \\\"#cd00cd\\\",\\n                ColorMode.LIGHT: \\\"#cd00cd\\\"\\n            },\\n            ColorRole.TERM_CYAN: {\\n                ColorMode.DARK: \\\"#00cdcd\\\",\\n                ColorMode.LIGHT: \\\"#00cdcd\\\"\\n            },\\n            ColorRole.TERM_WHITE: {\\n                ColorMode.DARK: \\\"#e5e5e5\\\",\\n                ColorMode.LIGHT: \\\"#e5e5e5\\\"\\n            },\\n\\n            # Terminal bright colors\\n            ColorRole.TERM_BRIGHT_BLACK: {\\n                ColorMode.DARK: \\\"#7f7f7f\\\",\\n                ColorMode.LIGHT: \\\"#7f7f7f\\\"\\n            },\\n            ColorRole.TERM_BRIGHT_RED: {\\n                ColorMode.DARK: \\\"#ff0000\\\",\\n                ColorMode.LIGHT: \\\"#ff0000\\\"\\n            },\\n            ColorRole.TERM_BRIGHT_GREEN: {\\n                ColorMode.DARK: \\\"#00ff00\\\",\\n                ColorMode.LIGHT: \\\"#00ff00\\\"\\n            },\\n            ColorRole.TERM_BRIGHT_YELLOW: {\\n                ColorMode.DARK: \\\"#ffff00\\\",\\n                ColorMode.LIGHT: \\\"#ffff00\\\"\\n            },\\n            ColorRole.TERM_BRIGHT_BLUE: {\\n                ColorMode.DARK: \\\"#5c5cff\\\",\\n                ColorMode.LIGHT: \\\"#5c5cff\\\"\\n            },\\n            ColorRole.TERM_BRIGHT_MAGENTA: {\\n                ColorMode.DARK: \\\"#ff00ff\\\",\\n                ColorMode.LIGHT: \\\"#ff00ff\\\"\\n            },\\n            ColorRole.TERM_BRIGHT_CYAN: {\\n                ColorMode.DARK: \\\"#00ffff\\\",\\n                ColorMode.LIGHT: \\\"#00ffff\\\"\\n            },\\n            ColorRole.TERM_BRIGHT_WHITE: {\\n                ColorMode.DARK: \\\"#ffffff\\\",\\n                ColorMode.LIGHT: \\\"#ffffff\\\"\\n            }\\n        }\\n\\n    def _initialize_highlights(self) -> None:\\n        # Mapping from token type to colour\\n        colour_mapping = {\\n            TokenType.ADDRESS: ColorRole.SYNTAX_01,\\n            TokenType.ANNOTATION: ColorRole.SYNTAX_08,\\n            TokenType.ARGUMENT: ColorRole.SYNTAX_11,\\n            TokenType.ATTRIBUTE: ColorRole.SYNTAX_08,\\n            TokenType.BACKTICK: ColorRole.SYNTAX_12,\\n            TokenType.BOOLEAN: ColorRole.SYNTAX_16,\\n            TokenType.BOLD: ColorRole.SYNTAX_21,\\n            TokenType.BOLD_END: ColorRole.SYNTAX_07,\\n            TokenType.BOLD_START: ColorRole.SYNTAX_07,\\n            TokenType.BLOCKQUOTE: ColorRole.SYNTAX_13,\\n            TokenType.CHARACTER: ColorRole.SYNTAX_20,\\n            TokenType.CODE: ColorRole. SYNTAX_02,\\n            TokenType.COMMAND: ColorRole.SYNTAX_07,\\n            TokenType.COMMENT: ColorRole.SYNTAX_03,\\n            TokenType.CSS_AT_RULE: ColorRole.SYNTAX_04,\\n            TokenType.DIMENSION: ColorRole.SYNTAX_16,\\n            TokenType.DOC_COMMENT: ColorRole.SYNTAX_03,\\n            TokenType.DOCTYPE: ColorRole.SYNTAX_05,\\n            TokenType.DIRECTIVE: ColorRole.SYNTAX_18,\\n            TokenType.ELEMENT: ColorRole.SYNTAX_06,\\n            TokenType.ERROR: ColorRole.SYNTAX_ERROR,\\n            TokenType.FENCE: ColorRole.SYNTAX_14,\\n            TokenType.FENCE_END: ColorRole.SYNTAX_14,\\n            TokenType.FENCE_START: ColorRole.SYNTAX_14,\\n            TokenType.FUNCTION_OR_METHOD: ColorRole.SYNTAX_07,\\n            TokenType.GENERIC_END: ColorRole.SYNTAX_17,\\n            TokenType.GENERIC_START: ColorRole.SYNTAX_17,\\n            TokenType.GENERIC_TYPE: ColorRole.SYNTAX_21,\\n            TokenType.HASH: ColorRole.SYNTAX_11,\\n            TokenType.HEADING: ColorRole.SYNTAX_08,\\n            TokenType.HEX: ColorRole.SYNTAX_16,\\n            TokenType.HORIZONTAL_RULE: ColorRole.SYNTAX_21,\\n            TokenType.HTML_ATTRIBUTE: ColorRole.SYNTAX_09,\\n            TokenType.HTML_TAG: ColorRole.SYNTAX_10,\\n            TokenType.IDENTIFIER: ColorRole.SYNTAX_11,\\n            TokenType.IMAGE_ALT_END: ColorRole.SYNTAX_07,\\n            TokenType.IMAGE_ALT_TEXT: ColorRole.SYNTAX_16,\\n            TokenType.IMAGE_END: ColorRole.SYNTAX_07,\\n            TokenType.IMAGE_START: ColorRole.SYNTAX_07,\\n            TokenType.IMAGE_URL: ColorRole.SYNTAX_20,\\n            TokenType.INLINE_CODE: ColorRole.SYNTAX_12,\\n            TokenType.INLINE_CODE_END: ColorRole.SYNTAX_07,\\n            TokenType.INLINE_CODE_START: ColorRole.SYNTAX_07,\\n            TokenType.ITALIC: ColorRole.SYNTAX_09,\\n            TokenType.ITALIC_END: ColorRole.SYNTAX_07,\\n            TokenType.ITALIC_START: ColorRole.SYNTAX_07,\\n            TokenType.JSON_KEY: ColorRole.SYNTAX_07,\\n            TokenType.KEYWORD: ColorRole.SYNTAX_13,\\n            TokenType.LANGUAGE: ColorRole.SYNTAX_14,\\n            TokenType.LIFETIME: ColorRole.SYNTAX_17,\\n            TokenType.LINK_END: ColorRole.SYNTAX_07,\\n            TokenType.LINK_START: ColorRole.SYNTAX_07,\\n            TokenType.LINK_TEXT: ColorRole.SYNTAX_16,\\n            TokenType.LINK_TEXT_END: ColorRole.SYNTAX_07,\\n            TokenType.LINK_URL: ColorRole.SYNTAX_20,\\n            TokenType.LIST_MARKER: ColorRole.SYNTAX_15,\\n            TokenType.LPAREN: ColorRole.SYNTAX_17,\\n            TokenType.NUMBER: ColorRole.SYNTAX_16,\\n            TokenType.OPERATOR: ColorRole.SYNTAX_17,\\n            TokenType.OPTION: ColorRole.SYNTAX_10,\\n            TokenType.OPTION_VALUE: ColorRole.SYNTAX_08,\\n            TokenType.PREPROCESSOR: ColorRole.SYNTAX_05,\\n            TokenType.REGEXP: ColorRole.SYNTAX_19,\\n            TokenType.RPAREN: ColorRole.SYNTAX_17,\\n            TokenType.RUNE: ColorRole.SYNTAX_20,\\n            TokenType.STRING: ColorRole.SYNTAX_20,\\n            TokenType.TABLE: ColorRole.SYNTAX_03,\\n            TokenType.TEXT: ColorRole.SYNTAX_17,\\n            TokenType.TYPE: ColorRole.SYNTAX_21,\\n            TokenType.XML_DOC: ColorRole.SYNTAX_03\\n        }\\n\\n        for token_type, role in colour_mapping.items():\\n            text_format = self._create_highlight(role)\\n            self._highlights[token_type] = text_format\\n\\n        self._error_highlight = self._create_highlight(ColorRole.SYNTAX_ERROR)\\n\\n    def _create_highlight(self, role: ColorRole) -> QTextCharFormat:\\n        text_highlight = QTextCharFormat()\\n        text_highlight.setFontFamilies(self._code_font_families)\\n        text_highlight.setFontFixedPitch(True)\\n        text_highlight.setForeground(QColor(self._colors[role][self._color_mode]))\\n\\n        return text_highlight\\n\\n    def _initialize_proportional_highlights(self) -> None:\\n        # Mapping from token type to colour\\n        colour_mapping = {\\n            TokenType.BOLD: ColorRole.SYNTAX_21,\\n            TokenType.BOLD_END: ColorRole.SYNTAX_07,\\n            TokenType.BOLD_START: ColorRole.SYNTAX_07,\\n            TokenType.BLOCKQUOTE: ColorRole.SYNTAX_13,\\n            TokenType.FENCE: ColorRole.SYNTAX_14,\\n            TokenType.HEADING: ColorRole.SYNTAX_08,\\n            TokenType.IMAGE_ALT_END: ColorRole.SYNTAX_07,\\n            TokenType.IMAGE_ALT_TEXT: ColorRole.SYNTAX_16,\\n            TokenType.IMAGE_END: ColorRole.SYNTAX_07,\\n            TokenType.IMAGE_START: ColorRole.SYNTAX_07,\\n            TokenType.IMAGE_URL: ColorRole.SYNTAX_20,\\n            TokenType.INLINE_CODE_END: ColorRole.SYNTAX_07,\\n            TokenType.INLINE_CODE_START: ColorRole.SYNTAX_07,\\n            TokenType.ITALIC: ColorRole.SYNTAX_09,\\n            TokenType.ITALIC_END: ColorRole.SYNTAX_07,\\n            TokenType.ITALIC_START: ColorRole.SYNTAX_07,\\n            TokenType.LINK_END: ColorRole.SYNTAX_07,\\n            TokenType.LINK_START: ColorRole.SYNTAX_07,\\n            TokenType.LINK_TEXT: ColorRole.SYNTAX_16,\\n            TokenType.LINK_TEXT_END: ColorRole.SYNTAX_07,\\n            TokenType.LINK_URL: ColorRole.SYNTAX_20,\\n            TokenType.LIST_MARKER: ColorRole.SYNTAX_15,\\n            TokenType.TABLE: ColorRole.SYNTAX_03,\\n            TokenType.TEXT: ColorRole.SYNTAX_17\\n        }\\n\\n        for token_type, role in colour_mapping.items():\\n            text_format = self._create_proportional_highlight(role)\\n            self._proportional_highlights[token_type] = text_format\\n\\n        self._proportional_highlights[TokenType.INLINE_CODE] = self._create_highlight(ColorRole.SYNTAX_12)\\n        self._error_proportional_highlight = self._create_proportional_highlight(ColorRole.SYNTAX_ERROR)\\n\\n    def _create_proportional_highlight(self, role: ColorRole) -> QTextCharFormat:\\n        text_highlight = QTextCharFormat()\\n        text_highlight.setForeground(QColor(self._colors[role][self._color_mode]))\\n\\n        return text_highlight\\n\\n    def _create_app_icon_svg(self, bg_color: str, text_color: str) -> str:\\n        \\\"\\\"\\\"\\n        Create an application icon SVG with specified colors.\\n\\n        Args:\\n            bg_color: Background color in hex format\\n            text_color: Text color in hex format\\n\\n        Returns:\\n            str: SVG markup for the application icon\\n        \\\"\\\"\\\"\\n        return f'''\\n            <svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"128\\\" height=\\\"128\\\" viewBox=\\\"0 0 384 384\\\">\\n                <rect x=\\\"0\\\" y=\\\"0\\\" width=\\\"384\\\" height=\\\"384\\\" fill=\\\"{bg_color}\\\"/>\\n                <g fill=\\\"{text_color}\\\">\\n                    <g transform=\\\"translate(38.400004, 250.960113)\\\">\\n                        <path d=\\\"M 97.234375 0\\n                            L 92.125 -64.078125\\n                            L 91.46875 -64.078125\\n                            L 69.328125-0.65625\\n                            L 54.640625 -0.65625\\n                            L 32.5 -64.078125\\n                            L 31.84375 -64.078125\\n                            L 26.734375 0\\n                            L 2.09375 0\\n                            L 11.796875 -108.109375\\n                            L 38 -108.109375\\n                            L 61.984375 -45.734375\\n                            L 85.96875 -108.109375\\n                            L 112.171875 -108.109375\\n                            L 121.875 0\\n                            Z\\\"/>\\n                    </g>\\n                    <g transform=\\\"translate(162.225522, 250.960113)\\\">\\n                        <path d=\\\"M 76 -108.109375\\n                            L 44.15625 -71.03125\\n                            C 46 -72.070312 48.578125 -72.59375 51.890625 -72.59375\\n                            C 55.734375 -72.59375 59.617188 -71.785156 63.546875 -70.171875\\n                            C 67.484375 -68.554688 71.175781 -66.238281 74.625 -63.21875\\n                            C 78.082031 -60.207031 80.898438 -56.210938 83.078125 -51.234375\\n                            C 85.265625 -46.253906 86.359375 -40.753906 86.359375 -34.734375\\n                            C 86.359375 -28.609375 85.203125 -23.125 82.890625 -18.28125\\n                            C 80.578125 -13.4375 77.472656 -9.59375 73.578125 -6.75\\n                            C 69.691406 -3.90625 65.429688 -1.738281 60.796875 -0.25\\n                            C 56.171875 1.226562 51.328125 1.96875 46.265625 1.96875\\n                            C 34.117188 1.96875 23.894531 -1.566406 15.59375 -8.640625\\n                            C 7.289062 -15.722656 3.140625 -24.421875 3.140625 -34.734375\\n                            C 3.140625 -43.460938 4.363281 -50.644531 6.8125 -56.28125\\n                            C 9.257812 -61.914062 13.71875 -69.101562 20.1875 -77.84375\\n                            L 45.609375 -108.109375\\n                            Z\\n                            M 28.703125 -34.734375\\n                            C 28.703125 -30.015625 30.226562 -26.101562 33.28125 -23\\n                            C 36.34375 -19.894531 40.273438 -18.34375 45.078125 -18.34375\\n                            C 49.878906 -18.34375 53.851562 -19.894531 57 -23\\n                            C 60.144531 -26.101562 61.71875 -30.015625 61.71875 -34.734375\\n                            C 61.71875 -39.535156 60.125 -43.53125 56.9375 -46.71875\\n                            C 53.75 -49.90625 49.796875 -51.5 45.078125 -51.5\\n                            C 40.535156 -51.5 36.671875 -49.90625 33.484375 -46.71875\\n                            C 30.296875 -43.53125 28.703125 -39.535156 28.703125 -34.734375\\n                            Z\\\"/>\\n                    </g>\\n                    <g transform=\\\"translate(249.066902, 250.960113)\\\">\\n                        <path d=\\\"M 7.859375 -108.109375\\n                            L 46.515625 -108.109375\\n                            C 56.910156 -108.109375 65.382812 -105.332031 71.9375 -99.78125\\n                            C 78.488281 -94.238281 81.765625 -86.3125 81.765625 -76\\n                            C 81.765625 -68.050781 79.773438 -61.390625 75.796875 -56.015625\\n                            C 71.828125 -50.648438 66.4375 -46.875 59.625 -44.6875\\n                            L 96.84375 0\\n                            L 65.515625 0\\n                            L 32.5 -42.71875\\n                            L 32.5 0\\n                            L 7.859375 0\\n                            Z\\n                            M 32.5 -60.15625\\n                            L 35.375 -60.15625\\n                            C 37.65625 -60.15625 39.578125 -60.195312 41.140625 -60.28125\\n                            C 42.710938 -60.363281 44.503906 -60.664062 46.515625 -61.1875\\n                            C 48.523438 -61.71875 50.140625 -62.460938 51.359375 -63.421875\\n                            C 52.585938 -64.390625 53.640625 -65.789062 54.515625 -67.625\\n                            C 55.390625 -69.457031 55.828125 -71.679688 55.828125 -74.296875\\n                            C 55.828125 -76.921875 55.390625 -79.148438 54.515625 -80.984375\\n                            C 53.640625 -82.816406 52.585938 -84.210938 51.359375 -85.171875\\n                            C 50.140625 -86.140625 48.523438 -86.882812 46.515625 -87.40625\\n                            C 44.503906 -87.925781 42.710938 -88.226562 41.140625 -88.3125\\n                            C 39.578125 -88.40625 37.65625 -88.453125 35.375 -88.453125\\n                            L 32.5 -88.453125\\n                            Z\\\"/>\\n                    </g>\\n                </g>\\n            </svg>\\n        '''\\n\\n    def _write_icon(self, name: str, svg_data: str) -> None:\\n        icon_dir = os.path.expanduser(\\\"~/.humbug/icons\\\")\\n        with open(os.path.join(icon_dir, name), 'w', encoding='utf-8') as f:\\n            f.write(svg_data)\\n\\n    def _create_active_inactive_theme_icons(self, active: bool, suffix: str, color: str) -> None:\\n        prefix = \\\"\\\" if active else \\\"inactive-\\\"\\n\\n        # Close button - visible version\\n        self._write_icon(f'{prefix}close-{suffix}.svg', f'''\\n            <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                    d=\\\"M16,16 L48,48 M48,16 L16,48\\\"/>\\n            </svg>\\n        ''')\\n\\n        # Conversation tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\\n        self._write_icon(f'{prefix}conversation-{suffix}.svg', f'''\\n            <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                <path d=\\\"M8 10H8.01\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M12 10H12.01\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M16 10H16.01\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M21 13V7C21 5.11438 21 4.17157 20.4142 3.58579C19.8284 3 18.8856 3 17 3H7C5.11438 3\\n                    4.17157 3 3.58579 3.58579C3 4.17157 3 5.11438 3 7V13C3 14.8856 3 15.8284 3.58579 16.4142C4.17157\\n                    17 5.11438 17 7 17H7.5C7.77614 17 8 17.2239 8 17.5V20V20.1499C8 20.5037 8.40137 20.7081\\n                    8.6875 20.5L13.0956 17.2941C13.3584 17.103 13.675 17 14 17H17C18.8856 17 19.8284 17 20.4142\\n                    16.4142C21 15.8284 21 14.8856 21 13Z\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linejoin=\\\"round\\\"/>\\n            </svg>\\n        ''')\\n\\n        # Editor tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\\n        self._write_icon(f'{prefix}editor-{suffix}.svg', f'''\\n            <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                <path d=\\\"M13 21H21\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M20.0651 7.39423L7.09967 20.4114C6.72438 20.7882 6.21446 21 5.68265 21H4.00383C3.44943\\n                    21 3 20.5466 3 19.9922V18.2987C3 17.7696 3.20962 17.2621 3.58297 16.8873L16.5517 3.86681C19.5632\\n                    1.34721 22.5747 4.87462 20.0651 7.39423Z\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\"\\n                    stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M15.3097 5.30981L18.7274 8.72755\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\"\\n                    stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n            </svg>\\n        ''')\\n\\n        # Log tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\\n        self._write_icon(f'{prefix}log-{suffix}.svg', f'''\\n            <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                <path d=\\\"M5 12H7.75044C7.89947 12 8.03179 11.9046 8.07892 11.7632V11.7632L9.875 6.375V6.375C9.91626\\n                    6.25122 10.0918 6.25238 10.1364 6.375V6.375L13.875 16.6562L13.885 16.6837C13.9253 16.7946 14.0812\\n                    16.797 14.125 16.6875V16.6875L15.8841 12.2898V12.2898C15.9541 12.1148 16.1236 12 16.3122 12H19\\\"\\n                    stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n            </svg>\\n        ''')\\n\\n        # Shell tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\\n        self._write_icon(f'{prefix}shell-{suffix}.svg', f'''\\n            <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                <path d=\\\"M3 7C3 5.11438 3 4.17157 3.58579 3.58579C4.17157 3 5.11438 3 7 3H12H17C18.8856 3 19.8284\\n                    3 20.4142 3.58579C21 4.17157 21 5.11438 21 7V10V13C21 14.8856 21 15.8284 20.4142 16.4142C19.8284\\n                    17 18.8856 17 17 17H12H7C5.11438 17 4.17157 17 3.58579 16.4142C3 15.8284 3 14.8856 3 13V10V7Z\\\"\\n                    stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M7 21H17\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M12 17V21\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\"/>\\n            </svg>\\n        ''')\\n\\n        # Terminal tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\\n        self._write_icon(f'{prefix}terminal-{suffix}.svg', f'''\\n            <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                <path d=\\\"M13 15H16\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\"/>\\n                <path d=\\\"M8 15L10.5 12.5V12.5C10.7761 12.2239 10.7761 11.7761 10.5 11.5V11.5L8 9\\\"\\n                    stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M3 8C3 6.11438 3 5.17157 3.58579 4.58579C4.17157 4 5.11438 4 7 4H12H17C18.8856 4\\n                    19.8284 4 20.4142 4.58579C21 5.17157 21 6.11438 21 8V12V16C21 17.8856 21 18.8284 20.4142\\n                    19.4142C19.8284 20 18.8856 20 17 20H12H7C5.11438 20 4.17157 20 3.58579 19.4142C3 18.8284\\n                    3 17.8856 3 16V12V8Z\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linejoin=\\\"round\\\"/>\\n            </svg>\\n        ''')\\n\\n        # Wiki tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\\n        self._write_icon(f'{prefix}wiki-{suffix}.svg', f'''\\n            <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                <path d=\\\"M17.8284 6.82843C18.4065 7.40649 18.6955 7.69552 18.8478 8.06306C19 8.4306 19 8.83935\\n                    19 9.65685L19 17C19 18.8856 19 19.8284 18.4142 20.4142C17.8284 21 16.8856 21 15 21H9C7.11438\\n                    21 6.17157 21 5.58579 20.4142C5 19.8284 5 18.8856 5 17L5 7C5 5.11438 5 4.17157 5.58579\\n                    3.58579C6.17157 3 7.11438 3 9 3H12.3431C13.1606 3 13.5694 3 13.9369 3.15224C14.3045 3.30448\\n                    14.5935 3.59351 15.1716 4.17157L17.8284 6.82843Z\\\" stroke=\\\"{color}\\\"\\n                    stroke-width=\\\"2\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M9 6L11 6\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M10 9L12 9\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M9 12L11 12\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M10 15L12 15\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n            </svg>\\n        ''')\\n\\n    def _create_theme_icons(self) -> None:\\n        \\\"\\\"\\\"Create theme-specific icons in the user's .humbug directory.\\\"\\\"\\\"\\n        icon_dir = os.path.expanduser(\\\"~/.humbug/icons\\\")\\n        os.makedirs(icon_dir, exist_ok=True)\\n\\n        # Create collapsed and expanded arrows for both themes\\n        for mode in ColorMode:\\n            color = self._colors[ColorRole.TEXT_PRIMARY][mode]\\n            inactive_color = self._colors[ColorRole.TEXT_INACTIVE][mode]\\n            suffix = mode.name.lower()\\n\\n            # Right-pointing arrow\\n            self._write_icon(f'arrow-right-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\" d=\\\"M24,16 L40,32 L24,48\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Left-pointing arrow\\n            self._write_icon(f'arrow-left-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\" d=\\\"M40,16 L24,32 L40,48\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Up-pointing arrow\\n            self._write_icon(f'arrow-up-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\" d=\\\"M16,40 L32,24 L48,40\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Down-pointing arrow\\n            self._write_icon(f'arrow-down-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\" d=\\\"M16,24 L32,40 L48,24\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Close button - visible version\\n            self._write_icon(f'close-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                        d=\\\"M16,16 L48,48 M48,16 L16,48\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Checkbox check mark\\n            self._write_icon(f'check-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                        d=\\\"M16,32 L28,44 L48,20\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Right-pointing expand\\n            self._write_icon(f'expand-right-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\" d=\\\"M20,8 L44,32 L20,56\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Left-pointing expand\\n            self._write_icon(f'expand-left-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\" d=\\\"M44,8 L20,32 L44,56\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Down-pointing expand\\n            self._write_icon(f'expand-down-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\" d=\\\"M8,20 L32,44 L56,20\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Bulb on icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\\n            self._write_icon(f'info-{suffix}.svg', f'''\\n                <svg width=\\\"800px\\\" height=\\\"800px\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path d=\\\"M12 7C9.23858 7 7 9.23858 7 12C7 13.3613 7.54402 14.5955 8.42651 15.4972C8.77025 15.8484 9.05281 16.2663\\n                        9.14923 16.7482L9.67833 19.3924C9.86537 20.3272 10.6862 21 11.6395 21H12.3605C13.3138 21 14.1346 20.3272\\n                        14.3217 19.3924L14.8508 16.7482C14.9472 16.2663 15.2297 15.8484 15.5735 15.4972C16.456 14.5955 17\\n                        13.3613 17 12C17 9.23858 14.7614 7 12 7Z\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\"/>\\n                    <path d=\\\"M12 4V3\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                    <path d=\\\"M18 6L19 5\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                    <path d=\\\"M20 12H21\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                    <path d=\\\"M4 12H3\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                    <path d=\\\"M5 5L6 6\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                    <path d=\\\"M10 17H14\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Alert triangle icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\\n            self._write_icon(f'warning-{suffix}.svg', f'''\\n                <svg width=\\\"800px\\\" height=\\\"800px\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path d=\\\"M12 10V13\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\"/>\\n                    <path d=\\\"M12 16V15.9888\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\"/>\\n                    <path d=\\\"M10.2518 5.147L3.6508 17.0287C2.91021 18.3618 3.87415 20 5.39912 20H18.6011C20.126 20 21.09\\n                        18.3618 20.3494 17.0287L13.7484 5.147C12.9864 3.77538 11.0138 3.77538 10.2518 5.147Z\\\"\\n                        stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Alert hexagon icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\\n            self._write_icon(f'critical-{suffix}.svg', f'''\\n                <svg width=\\\"800px\\\" height=\\\"800px\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path d=\\\"M3 9.22843V14.7716C3 15.302 3.21071 15.8107 3.58579 16.1858L7.81421 20.4142C8.18929 20.7893 8.69799\\n                        21 9.22843 21H14.7716C15.302 21 15.8107 20.7893 16.1858 20.4142L20.4142 16.1858C20.7893 15.8107 21\\n                        15.302 21 14.7716V9.22843C21 8.69799 20.7893 8.18929 20.4142 7.81421L16.1858 3.58579C15.8107 3.21071\\n                        15.302 3 14.7716 3H9.22843C8.69799 3 8.18929 3.21071 7.81421 3.58579L3.58579 7.81421C3.21071 8.18929\\n                        3 8.69799 3 9.22843Z\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                    <path d=\\\"M12 8V13\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\"/>\\n                    <path d=\\\"M12 16V15.9888\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Help circle icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\\n            self._write_icon(f'question-{suffix}.svg', f'''\\n                <svg width=\\\"800px\\\" height=\\\"800px\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path d=\\\"M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12\\n                        3C16.9706 3 21 7.02944 21 12Z\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\"/>\\n                    <path d=\\\"M10.5 8.67709C10.8665 8.26188 11.4027 8 12 8C13.1046 8 14 8.89543 14 10C14 10.9337\\n                        13.3601 11.718 12.4949 11.9383C12.2273 12.0064 12 12.2239 12 12.5V12.5V13\\\"\\n                        stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                    <path d=\\\"M12 16H12.01\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                </svg>\\n            ''')\\n\\n            self._write_icon(f'save-{suffix}.svg', f'''\\n                <svg width=\\\"64\\\" height=\\\"64\\\" viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                        d=\\\"M8,40, L8,56 L56,56 L56,40\\\"/>\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                        d=\\\"M32,8, L32,40\\\"/>\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                        d=\\\"M20,28, L32,40, L44,28\\\"/>\\n                </svg>\\n            ''')\\n\\n            self._write_icon(f'copy-{suffix}.svg', f'''\\n                <svg width=\\\"64\\\" height=\\\"64\\\" viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <rect x=\\\"22\\\" y=\\\"10\\\" width=\\\"32\\\" height=\\\"32\\\" stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"/>\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                        d=\\\"M22,22, L10,22 L10,54 L42,54 L42,42\\\"/>\\n                </svg>\\n            ''')\\n\\n            self._write_icon(f'fork-{suffix}.svg', f'''\\n                <svg width=\\\"64\\\" height=\\\"64\\\" viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                        d=\\\"M32,8 L32,32 M32,32 L8,56 L8,40 M8,56 L24,56 M32,32 L56,56 L56,40 M56,56 L40,56\\\"/>\\n                </svg>\\n            ''')\\n\\n            self._write_icon(f'delete-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                        d=\\\"M12.5,20 L12.5,56 L51.5,56 L51.5,20 M4,20 L60,20 M18,20 L24,8 L40,8 L46,20\\\"/>\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                        d=\\\"M25.5,28 L25.5,46 M38.5,28 L38.5,46\\\"/>\\n                </svg>\\n            ''')\\n\\n            self._write_icon(f'edit-{suffix}.svg', f'''\\n                <svg width=\\\"64\\\" height=\\\"64\\\" viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                        d=\\\"M8,56 L56,56 M40,12 L52,24 L24,52 L8,56 L12,40 L40,12 Z\\\"/>\\n                </svg>\\n            ''')\\n\\n            self._write_icon(f'submit-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\" d=\\\"M8,32 L32,8 L56,32\\\"/>\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\" d=\\\"M32,56 L32,8\\\"/>\\n                </svg>\\n            ''')\\n\\n            self._write_icon(f'stop-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <circle cx=\\\"32\\\" cy=\\\"32\\\" r=\\\"28\\\" fill=\\\"none\\\" stroke=\\\"{color}\\\" stroke-width=\\\"6\\\"/>\\n                    <rect x=\\\"20\\\" y=\\\"20\\\" width=\\\"24\\\" height=\\\"24\\\" fill=\\\"{color}\\\" stroke=\\\"none\\\"/>\\n                </svg>\\n            ''')\\n\\n            self._create_active_inactive_theme_icons(True, suffix, color)\\n            self._create_active_inactive_theme_icons(False, suffix, inactive_color)\\n\\n        # Create the standard application icon for about dialog\\n        self._write_icon('app-icon.svg', self._create_app_icon_svg('#4040c0', '#ffffff'))\\n\\n        # Create light mode disabled version\\n        self._write_icon('app-icon-disabled-light.svg', self._create_app_icon_svg('#c0c0c0', '#e0e0e0'))\\n\\n        # Create dark mode disabled version\\n        self._write_icon('app-icon-disabled-dark.svg', self._create_app_icon_svg('#202020', '#404040'))\\n\\n    def get_icon_path(self, name: str) -> str:\\n        \\\"\\\"\\\"\\n        Get the path to a theme-appropriate icon.\\n\\n        Args:\\n            name: Base name of the icon (without theme suffix or extension)\\n\\n        Returns:\\n            Full path to the icon file\\n        \\\"\\\"\\\"\\n        icon_dir = os.path.expanduser(\\\"~/.humbug/icons\\\")\\n        theme = \\\"dark\\\" if self._color_mode == ColorMode.DARK else \\\"light\\\"\\n        return Path(os.path.join(icon_dir, f\\\"{name}-{theme}.svg\\\")).as_posix()\\n\\n    def scale_icon(self, icon_path: str, target_size: int) -> QPixmap:\\n        \\\"\\\"\\\"\\n        Load and scale an icon to the appropriate size.\\n\\n        Args:\\n            icon_path: Path to the icon file\\n            target_size: Desired size in pixels\\n\\n        Returns:\\n            Scaled QPixmap of the icon\\n        \\\"\\\"\\\"\\n        pixmap = QPixmap(icon_path)\\n        scaled_size = int(target_size * self._zoom_factor)\\n        return pixmap.scaled(\\n            scaled_size,\\n            scaled_size,\\n            Qt.AspectRatioMode.KeepAspectRatio,\\n            Qt.TransformationMode.SmoothTransformation\\n        )\\n\\n    def get_color(self, role: ColorRole) -> QColor:\\n        \\\"\\\"\\\"\\n        Get a color for a specific role.\\n\\n        Args:\\n            role: The ColorRole to look up\\n\\n        Returns:\\n            QColor: The color for the specified role\\n\\n        Raises:\\n            KeyError: If no color is defined for the role\\n        \\\"\\\"\\\"\\n        return QColor(self._colors[role][self._color_mode])\\n\\n    def get_color_str(self, role: ColorRole) -> str:\\n        \\\"\\\"\\\"\\n        Get a color string for a specific role.\\n\\n        Args:\\n            role: The ColorRole to look up\\n\\n        Returns:\\n            str: The color string (hex format) for the specified role\\n\\n        Raises:\\n            KeyError: If no color is defined for the role\\n        \\\"\\\"\\\"\\n        return self._colors[role][self._color_mode]\\n\\n    def get_highlight(self, token_type: TokenType) -> QTextCharFormat:\\n        \\\"\\\"\\\"\\n        Get the highlight format for a specific token type.\\n\\n        Args:\\n            token_type: The TokenType to look up\\n\\n        Returns:\\n            QTextCharFormat: The highlight format for the specified token type\\n        \\\"\\\"\\\"\\n        if token_type not in self._highlights:\\n            print(f\\\"token type {token_type} not mapped\\\")\\n\\n        return self._highlights.get(token_type, self._error_highlight)\\n\\n    def get_proportional_highlight(self, token_type: TokenType) -> QTextCharFormat:\\n        \\\"\\\"\\\"\\n        Get the proportionally-spaced highlight format for a specific token type.\\n\\n        Args:\\n            token_type: The TokenType to look up\\n\\n        Returns:\\n            QTextCharFormat: The highlight format for the specified token type\\n        \\\"\\\"\\\"\\n        if token_type not in self._proportional_highlights:\\n            print(f\\\"token type {token_type} not mapped\\\")\\n\\n        return self._proportional_highlights.get(token_type, self._error_proportional_highlight)\\n\\n    def _determine_base_font_size(self) -> float:\\n        \\\"\\\"\\\"\\n        Determine the default system font size based on the operating system.\\n\\n        Returns:\\n            int: Base font size in points.\\n        \\\"\\\"\\\"\\n        # Get current OS\\n        os_type = QOperatingSystemVersion.current()\\n\\n        # Get system default font\\n        system_font = QFontDatabase.systemFont(QFontDatabase.SystemFont.GeneralFont)\\n        system_size = system_font.pointSizeF()\\n\\n        # Apply OS-specific adjustments if system detection fails\\n        if system_size > 0:\\n            return system_size\\n\\n        if os_type.type() == QOperatingSystemVersion.OSType.MacOS:  # type: ignore\\n            # macOS typically uses 13pt as default\\n            return 13\\n\\n        if os_type.type() == QOperatingSystemVersion.OSType.Windows:  # type: ignore\\n            # Windows typically uses 9pt as default\\n            return 9\\n\\n        # Linux typically uses 10pt as default\\n        return 10\\n\\n    def base_font_size(self) -> float:\\n        \\\"\\\"\\\"Get the base font size for the current system.\\\"\\\"\\\"\\n        return self._user_font_size or self._base_font_size\\n\\n    def set_user_font_size(self, size: float | None) -> None:\\n        \\\"\\\"\\\"Set user-specific font size override.\\\"\\\"\\\"\\n        if size != self._user_font_size:\\n            self._user_font_size = size\\n\\n            if size:\\n                self.style_changed.emit()\\n\\n    def color_mode(self) -> ColorMode:\\n        \\\"\\\"\\\"Get the current color mode.\\\"\\\"\\\"\\n        return self._color_mode\\n\\n    def set_color_mode(self, mode: ColorMode) -> None:\\n        \\\"\\\"\\\"\\n        Set the color mode and update application styles.\\n\\n        Args:\\n            mode: The ColorMode to switch to\\n        \\\"\\\"\\\"\\n        if mode != self._color_mode:\\n            self._color_mode = mode\\n            self._initialize_highlights()\\n            self._initialize_proportional_highlights()\\n            self.style_changed.emit()\\n\\n    def zoom_factor(self) -> float:\\n        \\\"\\\"\\\"Current zoom scaling factor.\\\"\\\"\\\"\\n        return self._zoom_factor\\n\\n    def set_zoom(self, factor: float) -> None:\\n        \\\"\\\"\\\"\\n        Set new zoom factor and update application styles.\\n\\n        Args:\\n            factor: New zoom factor to apply (clamped between 0.5 and 2.0)\\n        \\\"\\\"\\\"\\n        new_factor = max(0.5, min(2.0, factor))\\n        if new_factor != self._zoom_factor:\\n            self._zoom_factor = new_factor\\n            self.style_changed.emit()\\n\\n    def get_space_width(self) -> float:\\n        \\\"\\\"\\\"Get the width of a space character\\\"\\\"\\\"\\n        font = QFont(self._code_font_families)\\n        font.setPointSizeF(self.base_font_size() * self._zoom_factor)\\n        font_metrics = QFontMetricsF(font)\\n        space_width = font_metrics.horizontalAdvance('        ') / 8\\n        return space_width\\n\\n    def monospace_font_families(self) -> List[str]:\\n        \\\"\\\"\\\"Get the standard monospace font family fallback sequence.\\\"\\\"\\\"\\n        return self._code_font_families\\n\\n    def message_bubble_spacing(self) -> float:\\n        \\\"\\\"\\\"Get the number of pixels to use in message bubble spacing.\\\"\\\"\\\"\\n        return 8.0\\n\\n    def get_dialog_stylesheet(self) -> str:\\n        \\\"\\\"\\\"\\n        Get a complete stylesheet for dialog windows.\\n\\n        Returns:\\n            A stylesheet string with styling for all common dialog components\\n        \\\"\\\"\\\"\\n        zoom_factor = self.zoom_factor()\\n        base_font_size = self.base_font_size()\\n\\n        return f\\\"\\\"\\\"\\n            QDialog {{\\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\\n                font-size: {base_font_size * zoom_factor}pt;\\n            }}\\n\\n            QScrollArea {{\\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\\n                border: none;\\n            }}\\n\\n            QScrollArea > QWidget > QWidget {{\\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\\n                border: none;\\n            }}\\n\\n            /* Labels */\\n            QLabel {{\\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\\n                border: none;\\n                border-radius: 4px;\\n                padding: 0px;\\n                margin: 0px;\\n                font-size: {base_font_size * zoom_factor}pt;\\n            }}\\n\\n            /* Text inputs */\\n            QLineEdit {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\\n                border: none;\\n                border-radius: 4px;\\n                padding: 4px;\\n                font-size: {int(base_font_size * zoom_factor)}pt;\\n            }}\\n            QLineEdit:disabled {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\\n            }}\\n\\n            /* Checkboxes */\\n            QCheckBox {{\\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\\n                border: none;\\n                border-radius: 4px;\\n                padding: 0px;\\n                margin: 0px;\\n            }}\\n            QCheckBox::indicator {{\\n                width: {int(18 * zoom_factor)}px;\\n                height: {int(18 * zoom_factor)}px;\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\\n            }}\\n            QCheckBox::indicator:disabled {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\\n            }}\\n            QCheckBox::indicator:checked {{\\n                image: url({self.get_icon_path('check')});\\n            }}\\n            QCheckBox:disabled {{\\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\\n            }}\\n\\n            /* Combo boxes */\\n            QComboBox {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\\n                border: none;\\n                border-radius: 4px;\\n                padding: 6px;\\n                margin: 0px;\\n                font-size: {int(base_font_size * zoom_factor)}pt;\\n            }}\\n            QComboBox:disabled {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\\n            }}\\n            QComboBox::drop-down {{\\n                border: none;\\n                width: 20px;\\n            }}\\n            QComboBox::down-arrow {{\\n                image: url({self.get_icon_path(\\\"arrow-down\\\")});\\n                width: 12px;\\n                height: 12px;\\n            }}\\n            QComboBox::down-arrow:on {{\\n                image: url({self.get_icon_path('arrow-up')});\\n                width: 12px;\\n                height: 12px;\\n            }}\\n            QComboBox::down-arrow:disabled {{\\n                image: none;\\n            }}\\n            QComboBox QAbstractItemView::item:selected {{\\n                border: none;\\n                background-color: {self.get_color_str(ColorRole.TEXT_SELECTED)};\\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\\n            }}\\n            QComboBox QListView {{\\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_SECONDARY)};\\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\\n            }}\\n\\n            /* Spin boxes */\\n            QSpinBox, QDoubleSpinBox {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\\n                border: none;\\n                border-radius: 4px;\\n                padding: 4px;\\n                font-size: {base_font_size * zoom_factor}pt;\\n            }}\\n            QSpinBox:disabled, QDoubleSpinBox:disabled {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\\n            }}\\n            QSpinBox::up-button, QSpinBox::down-button,\\n            QDoubleSpinBox::up-button, QDoubleSpinBox::down-button {{\\n                border: none;\\n                width: 20px;\\n            }}\\n            QSpinBox::up-arrow, QDoubleSpinBox::up-arrow {{\\n                image: url({self.get_icon_path('arrow-up')});\\n                width: 12px;\\n                height: 12px;\\n            }}\\n            QSpinBox::up-arrow:disabled, QSpinBox::up-arrow:off,\\n            QDoubleSpinBox::up-arrow:disabled, QDoubleSpinBox::up-arrow:off {{\\n                image: none;\\n            }}\\n            QSpinBox::down-arrow, QDoubleSpinBox::down-arrow {{\\n                image: url({self.get_icon_path('arrow-down')});\\n                width: 12px;\\n                height: 12px;\\n            }}\\n            QSpinBox::down-arrow:disabled, QSpinBox::down-arrow:off,\\n            QDoubleSpinBox::down-arrow:disabled, QDoubleSpinBox::down-arrow:off {{\\n                image: none;\\n            }}\\n\\n            /* Buttons */\\n            QPushButton {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\\n                border: none;\\n                border-radius: 4px;\\n                padding: 4px;\\n                font-size: {base_font_size * zoom_factor}pt;\\n            }}\\n            QPushButton:hover {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_HOVER)};\\n            }}\\n            QPushButton:pressed {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_PRESSED)};\\n            }}\\n            QPushButton:disabled {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\\n            }}\\n\\n            /* Recommended (primary) buttons */\\n            QPushButton[recommended=\\\"true\\\"] {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_RECOMMENDED)};\\n                color: {self.get_color_str(ColorRole.TEXT_RECOMMENDED)};\\n            }}\\n            QPushButton[recommended=\\\"true\\\"]:hover {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_RECOMMENDED_HOVER)};\\n            }}\\n            QPushButton[recommended=\\\"true\\\"]:pressed {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_RECOMMENDED_PRESSED)};\\n            }}\\n            QPushButton[recommended=\\\"false\\\"] {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE)};\\n                color: {self.get_color_str(ColorRole.TEXT_RECOMMENDED)};\\n            }}\\n            QPushButton[recommended=\\\"false\\\"]:hover {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_HOVER)};\\n            }}\\n            QPushButton[recommended=\\\"false\\\"]:pressed {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_PRESSED)};\\n            }}\\n\\n            QScrollBar:vertical {{\\n                background-color: {self.get_color_str(ColorRole.SCROLLBAR_BACKGROUND)};\\n                width: 12px;\\n            }}\\n            QScrollBar::handle:vertical {{\\n                background-color: {self.get_color_str(ColorRole.SCROLLBAR_HANDLE)};\\n                min-height: 20px;\\n            }}\\n            QScrollBar::add-page:vertical, QScrollBar::sub-page:vertical {{\\n                background: none;\\n            }}\\n            QScrollBar::add-line:vertical, QScrollBar::sub-line:vertical {{\\n                height: 0px;\\n            }}\\n        \\\"\\\"\\\"\\n\",\n    \"error\": null\n}\n```",
      "completed": true,
      "tool_results": [
        {
          "id": "toolu_01D6Jyee7AR5oiio3H8VX1Nv",
          "name": "filesystem",
          "content": "File: src/humbug/style_manager.py\nSize: 63,529 bytes\nEncoding: utf-8\n\n\"\"\"Style manager for handling application-wide style and zoom settings.\n\nImplements a singleton pattern to maintain consistent styling across components.\nProvides signals for style changes and utilities for scaled size calculations.\n\"\"\"\n\nfrom enum import Enum, auto\nimport os\nfrom pathlib import Path\nfrom typing import Dict, List\n\nfrom PySide6.QtCore import QObject, Signal, QOperatingSystemVersion, Qt\nfrom PySide6.QtGui import QTextCharFormat, QFontDatabase, QColor, QFontMetricsF, QFont, QPixmap\n\nfrom syntax import TokenType\n\nfrom humbug.color_role import ColorRole\n\n\nclass ColorMode(Enum):\n    \"\"\"Enumeration for color theme modes.\"\"\"\n    LIGHT = auto()\n    DARK = auto()\n\n\nclass StyleManager(QObject):\n    \"\"\"\n    Singleton manager for application-wide style settings.\n\n    Handles zoom factor management and style updates across the application.\n    Emits signals when zoom level changes to notify dependent components.\n\n    Attributes:\n        style_changed (Signal): Emitted when style changes, passing new zoom factor\n        _instance (StyleManager): Singleton instance\n        _zoom_factor (float): Current zoom scaling factor\n        _initialized (bool): Tracks initialization state of QObject base\n    \"\"\"\n\n    style_changed = Signal()\n    _instance = None\n\n    def __new__(cls) -> 'StyleManager':\n        \"\"\"Create or return singleton instance.\"\"\"\n        if cls._instance is None:\n            cls._instance = super(StyleManager, cls).__new__(cls)\n\n        return cls._instance\n\n    def __init__(self) -> None:\n        \"\"\"Initialize QObject base class if not already done.\"\"\"\n        if not hasattr(self, '_initialized'):\n            super().__init__()\n            self._zoom_factor = 1.0\n            self._base_font_size = self._determine_base_font_size()\n            self._user_font_size: float | None = None\n            self._initialized = True\n            self._color_mode = ColorMode.DARK  # Default to dark mode\n            self._colors: Dict[ColorRole, Dict[ColorMode, str]] = self._initialize_colors()\n            self._highlights: Dict[TokenType, QTextCharFormat] = {}\n            self._proportional_highlights: Dict[TokenType, QTextCharFormat] = {}\n\n            self._code_font_families = [\"Menlo\", \"Consolas\", \"Monaco\", \"monospace\"]\n            self._initialize_highlights()\n            self._initialize_proportional_highlights()\n            self._create_theme_icons()\n\n    def _initialize_colors(self) -> Dict[ColorRole, Dict[ColorMode, str]]:\n        \"\"\"Initialize the application colours for both light and dark modes.\"\"\"\n        return {\n            # Background colours\n            ColorRole.BACKGROUND_PRIMARY: {\n                ColorMode.DARK: \"#080808\",\n                ColorMode.LIGHT: \"#e0e0e0\"\n            },\n            ColorRole.BACKGROUND_SECONDARY: {\n                ColorMode.DARK: \"#141414\",\n                ColorMode.LIGHT: \"#ececec\"\n            },\n            ColorRole.BACKGROUND_TERTIARY: {\n                ColorMode.DARK: \"#242424\",\n                ColorMode.LIGHT: \"#fcfcfc\"\n            },\n            ColorRole.BACKGROUND_DIALOG: {\n                ColorMode.DARK: \"#282828\",\n                ColorMode.LIGHT: \"#d0d0d0\"\n            },\n\n            # Text colours\n            ColorRole.TEXT_PRIMARY: {\n                ColorMode.DARK: \"#d8d8d8\",\n                ColorMode.LIGHT: \"#202020\"\n            },\n            ColorRole.TEXT_BRIGHT: {\n                ColorMode.DARK: \"#ffffff\",\n                ColorMode.LIGHT: \"#000000\"\n            },\n            ColorRole.TEXT_HEADING: {\n                ColorMode.DARK: \"#ffe0a0\",\n                ColorMode.LIGHT: \"#204080\"\n            },\n            ColorRole.TEXT_HEADING_BRIGHT: {\n                ColorMode.DARK: \"#ffe8a0\",\n                ColorMode.LIGHT: \"#203880\"\n            },\n            ColorRole.TEXT_DISABLED: {\n                ColorMode.DARK: \"#707070\",\n                ColorMode.LIGHT: \"#909090\"\n            },\n            ColorRole.TEXT_SELECTED: {\n                ColorMode.DARK: \"#404058\",\n                ColorMode.LIGHT: \"#c8c8dc\"\n            },\n            ColorRole.TEXT_FOUND: {\n                ColorMode.DARK: \"#885050\",\n                ColorMode.LIGHT: \"#e0b4b4\"\n            },\n            ColorRole.TEXT_FOUND_DIM: {\n                ColorMode.DARK: \"#583838\",\n                ColorMode.LIGHT: \"#f4d8d8\"\n            },\n            ColorRole.TEXT_RECOMMENDED: {\n                ColorMode.DARK: \"#ffffff\",\n                ColorMode.LIGHT: \"#ffffff\"\n            },\n            ColorRole.TEXT_LINK: {\n                ColorMode.DARK: \"#80a0ff\",\n                ColorMode.LIGHT: \"#0000ff\"\n            },\n            ColorRole.TEXT_INACTIVE: {\n                ColorMode.DARK: \"#909090\",\n                ColorMode.LIGHT: \"#707070\"\n            },\n            ColorRole.TEXT_EPHEMERAL: {\n                ColorMode.DARK: \"#e0a080\",\n                ColorMode.LIGHT: \"#a0785c\"\n            },\n            ColorRole.TEXT_EPHEMERAL_INACTIVE: {\n                ColorMode.DARK: \"#a06040\",\n                ColorMode.LIGHT: \"#c09070\"\n            },\n            ColorRole.TEXT_ERROR: {\n                ColorMode.DARK: \"#e03020\",\n                ColorMode.LIGHT: \"#f04030\"\n            },\n            ColorRole.TEXT_ERROR_INACTIVE: {\n                ColorMode.DARK: \"#e06050\",\n                ColorMode.LIGHT: \"#f07060\"\n            },\n\n            # Edit box colours\n            ColorRole.EDIT_BOX_BORDER: {\n                ColorMode.DARK: \"#6060c0\",\n                ColorMode.LIGHT: \"#404080\"\n            },\n            ColorRole.EDIT_BOX_BACKGROUND: {\n                ColorMode.DARK: \"#242454\",\n                ColorMode.LIGHT: \"#b8b8f8\"\n            },\n            ColorRole.EDIT_BOX_ERROR: {\n                ColorMode.DARK: \"#c03020\",\n                ColorMode.LIGHT: \"#d04030\"\n            },\n\n            # Tab colours\n            ColorRole.TAB_BAR_BACKGROUND: {\n                ColorMode.DARK: \"#000000\",\n                ColorMode.LIGHT: \"#d8d8d8\"\n            },\n            ColorRole.TAB_BACKGROUND_ACTIVE: {\n                ColorMode.DARK: \"#1e1e1e\",\n                ColorMode.LIGHT: \"#ffffff\"\n            },\n            ColorRole.TAB_BACKGROUND_INACTIVE: {\n                ColorMode.DARK: \"#141414\",\n                ColorMode.LIGHT: \"#f0f0f0\"\n            },\n            ColorRole.TAB_BACKGROUND_HOVER: {\n                ColorMode.DARK: \"#242454\",\n                ColorMode.LIGHT: \"#b8b8f8\"\n            },\n            ColorRole.TAB_BACKGROUND_UPDATED: {\n                ColorMode.DARK: \"#3c2054\",\n                ColorMode.LIGHT: \"#f0d0f8\"\n            },\n            ColorRole.TAB_BORDER_ACTIVE: {\n                ColorMode.DARK: \"#8080ff\",\n                ColorMode.LIGHT: \"#3030ff\"\n            },\n\n            # Button colours\n            ColorRole.BUTTON_BACKGROUND: {\n                ColorMode.DARK: \"#0c0c0c\",\n                ColorMode.LIGHT: \"#e8e8e8\"\n            },\n            ColorRole.BUTTON_BACKGROUND_PRESSED: {\n                ColorMode.DARK: \"#505050\",\n                ColorMode.LIGHT: \"#b0b0b0\"\n            },\n            ColorRole.BUTTON_BACKGROUND_HOVER: {\n                ColorMode.DARK: \"#404040\",\n                ColorMode.LIGHT: \"#c0c0c0\"\n            },\n            ColorRole.BUTTON_SECONDARY_BACKGROUND: {\n                ColorMode.DARK: \"#2c2c2c\",\n                ColorMode.LIGHT: \"#d8d8d8\"\n            },\n            ColorRole.BUTTON_SECONDARY_BACKGROUND_PRESSED: {\n                ColorMode.DARK: \"#505050\",\n                ColorMode.LIGHT: \"#b0b0b0\"\n            },\n            ColorRole.BUTTON_SECONDARY_BACKGROUND_HOVER: {\n                ColorMode.DARK: \"#404040\",\n                ColorMode.LIGHT: \"#c0c0c0\"\n            },\n            ColorRole.BUTTON_BACKGROUND_RECOMMENDED: {\n                ColorMode.DARK: \"#2050c0\",\n                ColorMode.LIGHT: \"#3060d0\"\n            },\n            ColorRole.BUTTON_BACKGROUND_RECOMMENDED_PRESSED: {\n                ColorMode.DARK: \"#4070e0\",\n                ColorMode.LIGHT: \"#1040b0\"\n            },\n            ColorRole.BUTTON_BACKGROUND_RECOMMENDED_HOVER: {\n                ColorMode.DARK: \"#3060d0\",\n                ColorMode.LIGHT: \"#2050c0\"\n            },\n            ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE: {\n                ColorMode.DARK: \"#c03020\",\n                ColorMode.LIGHT: \"#d04030\"\n            },\n            ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_PRESSED: {\n                ColorMode.DARK: \"#e05040\",\n                ColorMode.LIGHT: \"#b02010\"\n            },\n            ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_HOVER: {\n                ColorMode.DARK: \"#d04030\",\n                ColorMode.LIGHT: \"#c03020\"\n            },\n            ColorRole.BUTTON_BACKGROUND_DISABLED: {\n                ColorMode.DARK: \"#202020\",\n                ColorMode.LIGHT: \"#d8d8d8\"\n            },\n\n            # Menu elements\n            ColorRole.MENU_BACKGROUND: {\n                ColorMode.DARK: \"#2d2d2d\",\n                ColorMode.LIGHT: \"#f0f0f0\"\n            },\n            ColorRole.MENU_HOVER: {\n                ColorMode.DARK: \"#3060d0\",\n                ColorMode.LIGHT: \"#2050c0\"\n            },\n            ColorRole.MENU_BORDER: {\n                ColorMode.DARK: \"#606060\",\n                ColorMode.LIGHT: \"#b0b0b0\"\n            },\n\n            # Splitter bars\n            ColorRole.SPLITTER: {\n                ColorMode.DARK: \"#606060\",\n                ColorMode.LIGHT: \"#b0b0b0\"\n            },\n\n            # Scroll bar elements\n            ColorRole.SCROLLBAR_BACKGROUND: {\n                ColorMode.DARK: \"#2d2d2d\",\n                ColorMode.LIGHT: \"#f0f0f0\"\n            },\n            ColorRole.SCROLLBAR_HANDLE: {\n                ColorMode.DARK: \"#404040\",\n                ColorMode.LIGHT: \"#c0c0c0\"\n            },\n\n            # Table elements\n            ColorRole.TABLE_BORDER: {\n                ColorMode.DARK: \"#808080\",\n                ColorMode.LIGHT: \"#a0a0a0\"\n            },\n            ColorRole.TABLE_HEADER_BACKGROUND: {\n                ColorMode.DARK: \"#484838\",\n                ColorMode.LIGHT: \"#d0d0e0\"\n            },\n\n            # Message colours\n            ColorRole.MESSAGE_BACKGROUND: {\n                ColorMode.DARK: \"#020202\",\n                ColorMode.LIGHT: \"#f2f2f2\"\n            },\n            ColorRole.MESSAGE_USER_BACKGROUND: {\n                ColorMode.DARK: \"#121212\",\n                ColorMode.LIGHT: \"#e4e4e4\"\n            },\n            ColorRole.MESSAGE_FOCUSED: {\n                ColorMode.DARK: \"#3a4654\",\n                ColorMode.LIGHT: \"#aab6c4\"\n            },\n            ColorRole.MESSAGE_USER: {\n                ColorMode.DARK: \"#8080c0\",\n                ColorMode.LIGHT: \"#6060a0\"\n            },\n            ColorRole.MESSAGE_AI: {\n                ColorMode.DARK: \"#80c080\",\n                ColorMode.LIGHT: \"#40a040\"\n            },\n            ColorRole.MESSAGE_REASONING: {\n                ColorMode.DARK: \"#808080\",\n                ColorMode.LIGHT: \"#808080\"\n            },\n            ColorRole.MESSAGE_TOOL_CALL: {\n                ColorMode.DARK: \"#808080\",\n                ColorMode.LIGHT: \"#808080\"\n            },\n            ColorRole.MESSAGE_TOOL_RESULT: {\n                ColorMode.DARK: \"#808080\",\n                ColorMode.LIGHT: \"#808080\"\n            },\n            ColorRole.MESSAGE_SYSTEM_ERROR: {\n                ColorMode.DARK: \"#c08080\",\n                ColorMode.LIGHT: \"#a04040\"\n            },\n            ColorRole.MESSAGE_SYSTEM_SUCCESS: {\n                ColorMode.DARK: \"#80c080\",\n                ColorMode.LIGHT: \"#40a040\"\n            },\n            ColorRole.MESSAGE_LANGUAGE: {\n                ColorMode.DARK: \"#a07850\",\n                ColorMode.LIGHT: \"#806040\"\n            },\n            ColorRole.MESSAGE_BOOKMARK: {\n                ColorMode.DARK: \"#ffdf00\",\n                ColorMode.LIGHT: \"#806000\"\n            },\n            ColorRole.MESSAGE_STREAMING: {\n                ColorMode.DARK: \"#c0a080\",\n                ColorMode.LIGHT: \"#a07050\"\n            },\n            ColorRole.MESSAGE_TRACE: {\n                ColorMode.DARK: \"#a0a0a0\",\n                ColorMode.LIGHT: \"#606060\"\n            },\n            ColorRole.MESSAGE_INFORMATION: {\n                ColorMode.DARK: \"#80b0f0\",\n                ColorMode.LIGHT: \"#0060c0\"\n            },\n            ColorRole.MESSAGE_WARNING: {\n                ColorMode.DARK: \"#f0c040\",\n                ColorMode.LIGHT: \"#c0a020\"\n            },\n            ColorRole.MESSAGE_ERROR: {\n                ColorMode.DARK: \"#ff6060\",\n                ColorMode.LIGHT: \"#c03030\"\n            },\n\n            # Status bar elements\n            ColorRole.STATUS_BAR_BACKGROUND: {\n                ColorMode.DARK: \"#121212\",\n                ColorMode.LIGHT: \"#e8e8e8\"\n            },\n\n            # Close button states\n            ColorRole.CLOSE_BUTTON_BACKGROUND_HOVER: {\n                ColorMode.DARK: \"#d04030\",\n                ColorMode.LIGHT: \"#c03020\"\n            },\n\n            # Line numbers\n            ColorRole.LINE_NUMBER: {\n                ColorMode.DARK: \"#606060\",\n                ColorMode.LIGHT: \"#c0c0c0\"\n            },\n\n            # Syntax highlighting\n            ColorRole.SYNTAX_ERROR: {\n                ColorMode.DARK: \"#ff0000\",\n                ColorMode.LIGHT: \"#ff0000\"\n            },\n            ColorRole.SYNTAX_01: {\n                ColorMode.DARK: \"#80e0d0\",\n                ColorMode.LIGHT: \"#007070\"\n            },\n            ColorRole.SYNTAX_02: {\n                ColorMode.DARK: \"#f0f0f0\",\n                ColorMode.LIGHT: \"#202020\"\n            },\n            ColorRole.SYNTAX_03: {\n                ColorMode.DARK: \"#68b068\",\n                ColorMode.LIGHT: \"#407040\"\n            },\n            ColorRole.SYNTAX_04: {\n                ColorMode.DARK: \"#ffa0eb\",\n                ColorMode.LIGHT: \"#c000a0\"\n            },\n            ColorRole.SYNTAX_05: {\n                ColorMode.DARK: \"#808080\",\n                ColorMode.LIGHT: \"#606060\"\n            },\n            ColorRole.SYNTAX_06: {\n                ColorMode.DARK: \"#90e0e8\",\n                ColorMode.LIGHT: \"#0080a0\"\n            },\n            ColorRole.SYNTAX_07: {\n                ColorMode.DARK: \"#e0e080\",\n                ColorMode.LIGHT: \"#a0a000\"\n            },\n            ColorRole.SYNTAX_08: {\n                ColorMode.DARK: \"#b090f0\",\n                ColorMode.LIGHT: \"#5040c0\"\n            },\n            ColorRole.SYNTAX_09: {\n                ColorMode.DARK: \"#90e0e8\",\n                ColorMode.LIGHT: \"#0080a0\"\n            },\n            ColorRole.SYNTAX_10: {\n                ColorMode.DARK: \"#d070d0\",\n                ColorMode.LIGHT: \"#a000a0\"\n            },\n            ColorRole.SYNTAX_11: {\n                ColorMode.DARK: \"#80b0f0\",\n                ColorMode.LIGHT: \"#0060c0\"\n            },\n            ColorRole.SYNTAX_12: {\n                ColorMode.DARK: \"#f08080\",\n                ColorMode.LIGHT: \"#c03030\"\n            },\n            ColorRole.SYNTAX_13: {\n                ColorMode.DARK: \"#ffc0eb\",\n                ColorMode.LIGHT: \"#c080a0\"\n            },\n            ColorRole.SYNTAX_14: {\n                ColorMode.DARK: \"#f0e060\",\n                ColorMode.LIGHT: \"#a09040\"\n            },\n            ColorRole.SYNTAX_15: {\n                ColorMode.DARK: \"#70e0e8\",\n                ColorMode.LIGHT: \"#2090a0\"\n            },\n            ColorRole.SYNTAX_16: {\n                ColorMode.DARK: \"#88d048\",\n                ColorMode.LIGHT: \"#508020\"\n            },\n            ColorRole.SYNTAX_17: {\n                ColorMode.DARK: \"#c0c0c0\",\n                ColorMode.LIGHT: \"#404040\"\n            },\n            ColorRole.SYNTAX_18: {\n                ColorMode.DARK: \"#80b080\",\n                ColorMode.LIGHT: \"#609060\"\n            },\n            ColorRole.SYNTAX_19: {\n                ColorMode.DARK: \"#c87050\",\n                ColorMode.LIGHT: \"#a04020\"\n            },\n            ColorRole.SYNTAX_20: {\n                ColorMode.DARK: \"#c05040\",\n                ColorMode.LIGHT: \"#803828\"\n             },\n            ColorRole.SYNTAX_21: {\n                ColorMode.DARK: \"#30c090\",\n                ColorMode.LIGHT: \"#24906c\"\n            },\n\n            # Terminal basic colors\n            ColorRole.TERM_BLACK: {\n                ColorMode.DARK: \"#000000\",\n                ColorMode.LIGHT: \"#000000\"\n            },\n            ColorRole.TERM_RED: {\n                ColorMode.DARK: \"#cd0000\",\n                ColorMode.LIGHT: \"#cd0000\"\n            },\n            ColorRole.TERM_GREEN: {\n                ColorMode.DARK: \"#00cd00\",\n                ColorMode.LIGHT: \"#00cd00\"\n            },\n            ColorRole.TERM_YELLOW: {\n                ColorMode.DARK: \"#cdcd00\",\n                ColorMode.LIGHT: \"#cdcd00\"\n            },\n            ColorRole.TERM_BLUE: {\n                ColorMode.DARK: \"#0000ee\",\n                ColorMode.LIGHT: \"#0000ee\"\n            },\n            ColorRole.TERM_MAGENTA: {\n                ColorMode.DARK: \"#cd00cd\",\n                ColorMode.LIGHT: \"#cd00cd\"\n            },\n            ColorRole.TERM_CYAN: {\n                ColorMode.DARK: \"#00cdcd\",\n                ColorMode.LIGHT: \"#00cdcd\"\n            },\n            ColorRole.TERM_WHITE: {\n                ColorMode.DARK: \"#e5e5e5\",\n                ColorMode.LIGHT: \"#e5e5e5\"\n            },\n\n            # Terminal bright colors\n            ColorRole.TERM_BRIGHT_BLACK: {\n                ColorMode.DARK: \"#7f7f7f\",\n                ColorMode.LIGHT: \"#7f7f7f\"\n            },\n            ColorRole.TERM_BRIGHT_RED: {\n                ColorMode.DARK: \"#ff0000\",\n                ColorMode.LIGHT: \"#ff0000\"\n            },\n            ColorRole.TERM_BRIGHT_GREEN: {\n                ColorMode.DARK: \"#00ff00\",\n                ColorMode.LIGHT: \"#00ff00\"\n            },\n            ColorRole.TERM_BRIGHT_YELLOW: {\n                ColorMode.DARK: \"#ffff00\",\n                ColorMode.LIGHT: \"#ffff00\"\n            },\n            ColorRole.TERM_BRIGHT_BLUE: {\n                ColorMode.DARK: \"#5c5cff\",\n                ColorMode.LIGHT: \"#5c5cff\"\n            },\n            ColorRole.TERM_BRIGHT_MAGENTA: {\n                ColorMode.DARK: \"#ff00ff\",\n                ColorMode.LIGHT: \"#ff00ff\"\n            },\n            ColorRole.TERM_BRIGHT_CYAN: {\n                ColorMode.DARK: \"#00ffff\",\n                ColorMode.LIGHT: \"#00ffff\"\n            },\n            ColorRole.TERM_BRIGHT_WHITE: {\n                ColorMode.DARK: \"#ffffff\",\n                ColorMode.LIGHT: \"#ffffff\"\n            }\n        }\n\n    def _initialize_highlights(self) -> None:\n        # Mapping from token type to colour\n        colour_mapping = {\n            TokenType.ADDRESS: ColorRole.SYNTAX_01,\n            TokenType.ANNOTATION: ColorRole.SYNTAX_08,\n            TokenType.ARGUMENT: ColorRole.SYNTAX_11,\n            TokenType.ATTRIBUTE: ColorRole.SYNTAX_08,\n            TokenType.BACKTICK: ColorRole.SYNTAX_12,\n            TokenType.BOOLEAN: ColorRole.SYNTAX_16,\n            TokenType.BOLD: ColorRole.SYNTAX_21,\n            TokenType.BOLD_END: ColorRole.SYNTAX_07,\n            TokenType.BOLD_START: ColorRole.SYNTAX_07,\n            TokenType.BLOCKQUOTE: ColorRole.SYNTAX_13,\n            TokenType.CHARACTER: ColorRole.SYNTAX_20,\n            TokenType.CODE: ColorRole. SYNTAX_02,\n            TokenType.COMMAND: ColorRole.SYNTAX_07,\n            TokenType.COMMENT: ColorRole.SYNTAX_03,\n            TokenType.CSS_AT_RULE: ColorRole.SYNTAX_04,\n            TokenType.DIMENSION: ColorRole.SYNTAX_16,\n            TokenType.DOC_COMMENT: ColorRole.SYNTAX_03,\n            TokenType.DOCTYPE: ColorRole.SYNTAX_05,\n            TokenType.DIRECTIVE: ColorRole.SYNTAX_18,\n            TokenType.ELEMENT: ColorRole.SYNTAX_06,\n            TokenType.ERROR: ColorRole.SYNTAX_ERROR,\n            TokenType.FENCE: ColorRole.SYNTAX_14,\n            TokenType.FENCE_END: ColorRole.SYNTAX_14,\n            TokenType.FENCE_START: ColorRole.SYNTAX_14,\n            TokenType.FUNCTION_OR_METHOD: ColorRole.SYNTAX_07,\n            TokenType.GENERIC_END: ColorRole.SYNTAX_17,\n            TokenType.GENERIC_START: ColorRole.SYNTAX_17,\n            TokenType.GENERIC_TYPE: ColorRole.SYNTAX_21,\n            TokenType.HASH: ColorRole.SYNTAX_11,\n            TokenType.HEADING: ColorRole.SYNTAX_08,\n            TokenType.HEX: ColorRole.SYNTAX_16,\n            TokenType.HORIZONTAL_RULE: ColorRole.SYNTAX_21,\n            TokenType.HTML_ATTRIBUTE: ColorRole.SYNTAX_09,\n            TokenType.HTML_TAG: ColorRole.SYNTAX_10,\n            TokenType.IDENTIFIER: ColorRole.SYNTAX_11,\n            TokenType.IMAGE_ALT_END: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_ALT_TEXT: ColorRole.SYNTAX_16,\n            TokenType.IMAGE_END: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_START: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_URL: ColorRole.SYNTAX_20,\n            TokenType.INLINE_CODE: ColorRole.SYNTAX_12,\n            TokenType.INLINE_CODE_END: ColorRole.SYNTAX_07,\n            TokenType.INLINE_CODE_START: ColorRole.SYNTAX_07,\n            TokenType.ITALIC: ColorRole.SYNTAX_09,\n            TokenType.ITALIC_END: ColorRole.SYNTAX_07,\n            TokenType.ITALIC_START: ColorRole.SYNTAX_07,\n            TokenType.JSON_KEY: ColorRole.SYNTAX_07,\n            TokenType.KEYWORD: ColorRole.SYNTAX_13,\n            TokenType.LANGUAGE: ColorRole.SYNTAX_14,\n            TokenType.LIFETIME: ColorRole.SYNTAX_17,\n            TokenType.LINK_END: ColorRole.SYNTAX_07,\n            TokenType.LINK_START: ColorRole.SYNTAX_07,\n            TokenType.LINK_TEXT: ColorRole.SYNTAX_16,\n            TokenType.LINK_TEXT_END: ColorRole.SYNTAX_07,\n            TokenType.LINK_URL: ColorRole.SYNTAX_20,\n            TokenType.LIST_MARKER: ColorRole.SYNTAX_15,\n            TokenType.LPAREN: ColorRole.SYNTAX_17,\n            TokenType.NUMBER: ColorRole.SYNTAX_16,\n            TokenType.OPERATOR: ColorRole.SYNTAX_17,\n            TokenType.OPTION: ColorRole.SYNTAX_10,\n            TokenType.OPTION_VALUE: ColorRole.SYNTAX_08,\n            TokenType.PREPROCESSOR: ColorRole.SYNTAX_05,\n            TokenType.REGEXP: ColorRole.SYNTAX_19,\n            TokenType.RPAREN: ColorRole.SYNTAX_17,\n            TokenType.RUNE: ColorRole.SYNTAX_20,\n            TokenType.STRING: ColorRole.SYNTAX_20,\n            TokenType.TABLE: ColorRole.SYNTAX_03,\n            TokenType.TEXT: ColorRole.SYNTAX_17,\n            TokenType.TYPE: ColorRole.SYNTAX_21,\n            TokenType.XML_DOC: ColorRole.SYNTAX_03\n        }\n\n        for token_type, role in colour_mapping.items():\n            text_format = self._create_highlight(role)\n            self._highlights[token_type] = text_format\n\n        self._error_highlight = self._create_highlight(ColorRole.SYNTAX_ERROR)\n\n    def _create_highlight(self, role: ColorRole) -> QTextCharFormat:\n        text_highlight = QTextCharFormat()\n        text_highlight.setFontFamilies(self._code_font_families)\n        text_highlight.setFontFixedPitch(True)\n        text_highlight.setForeground(QColor(self._colors[role][self._color_mode]))\n\n        return text_highlight\n\n    def _initialize_proportional_highlights(self) -> None:\n        # Mapping from token type to colour\n        colour_mapping = {\n            TokenType.BOLD: ColorRole.SYNTAX_21,\n            TokenType.BOLD_END: ColorRole.SYNTAX_07,\n            TokenType.BOLD_START: ColorRole.SYNTAX_07,\n            TokenType.BLOCKQUOTE: ColorRole.SYNTAX_13,\n            TokenType.FENCE: ColorRole.SYNTAX_14,\n            TokenType.HEADING: ColorRole.SYNTAX_08,\n            TokenType.IMAGE_ALT_END: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_ALT_TEXT: ColorRole.SYNTAX_16,\n            TokenType.IMAGE_END: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_START: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_URL: ColorRole.SYNTAX_20,\n            TokenType.INLINE_CODE_END: ColorRole.SYNTAX_07,\n            TokenType.INLINE_CODE_START: ColorRole.SYNTAX_07,\n            TokenType.ITALIC: ColorRole.SYNTAX_09,\n            TokenType.ITALIC_END: ColorRole.SYNTAX_07,\n            TokenType.ITALIC_START: ColorRole.SYNTAX_07,\n            TokenType.LINK_END: ColorRole.SYNTAX_07,\n            TokenType.LINK_START: ColorRole.SYNTAX_07,\n            TokenType.LINK_TEXT: ColorRole.SYNTAX_16,\n            TokenType.LINK_TEXT_END: ColorRole.SYNTAX_07,\n            TokenType.LINK_URL: ColorRole.SYNTAX_20,\n            TokenType.LIST_MARKER: ColorRole.SYNTAX_15,\n            TokenType.TABLE: ColorRole.SYNTAX_03,\n            TokenType.TEXT: ColorRole.SYNTAX_17\n        }\n\n        for token_type, role in colour_mapping.items():\n            text_format = self._create_proportional_highlight(role)\n            self._proportional_highlights[token_type] = text_format\n\n        self._proportional_highlights[TokenType.INLINE_CODE] = self._create_highlight(ColorRole.SYNTAX_12)\n        self._error_proportional_highlight = self._create_proportional_highlight(ColorRole.SYNTAX_ERROR)\n\n    def _create_proportional_highlight(self, role: ColorRole) -> QTextCharFormat:\n        text_highlight = QTextCharFormat()\n        text_highlight.setForeground(QColor(self._colors[role][self._color_mode]))\n\n        return text_highlight\n\n    def _create_app_icon_svg(self, bg_color: str, text_color: str) -> str:\n        \"\"\"\n        Create an application icon SVG with specified colors.\n\n        Args:\n            bg_color: Background color in hex format\n            text_color: Text color in hex format\n\n        Returns:\n            str: SVG markup for the application icon\n        \"\"\"\n        return f'''\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"128\" height=\"128\" viewBox=\"0 0 384 384\">\n                <rect x=\"0\" y=\"0\" width=\"384\" height=\"384\" fill=\"{bg_color}\"/>\n                <g fill=\"{text_color}\">\n                    <g transform=\"translate(38.400004, 250.960113)\">\n                        <path d=\"M 97.234375 0\n                            L 92.125 -64.078125\n                            L 91.46875 -64.078125\n                            L 69.328125-0.65625\n                            L 54.640625 -0.65625\n                            L 32.5 -64.078125\n                            L 31.84375 -64.078125\n                            L 26.734375 0\n                            L 2.09375 0\n                            L 11.796875 -108.109375\n                            L 38 -108.109375\n                            L 61.984375 -45.734375\n                            L 85.96875 -108.109375\n                            L 112.171875 -108.109375\n                            L 121.875 0\n                            Z\"/>\n                    </g>\n                    <g transform=\"translate(162.225522, 250.960113)\">\n                        <path d=\"M 76 -108.109375\n                            L 44.15625 -71.03125\n                            C 46 -72.070312 48.578125 -72.59375 51.890625 -72.59375\n                            C 55.734375 -72.59375 59.617188 -71.785156 63.546875 -70.171875\n                            C 67.484375 -68.554688 71.175781 -66.238281 74.625 -63.21875\n                            C 78.082031 -60.207031 80.898438 -56.210938 83.078125 -51.234375\n                            C 85.265625 -46.253906 86.359375 -40.753906 86.359375 -34.734375\n                            C 86.359375 -28.609375 85.203125 -23.125 82.890625 -18.28125\n                            C 80.578125 -13.4375 77.472656 -9.59375 73.578125 -6.75\n                            C 69.691406 -3.90625 65.429688 -1.738281 60.796875 -0.25\n                            C 56.171875 1.226562 51.328125 1.96875 46.265625 1.96875\n                            C 34.117188 1.96875 23.894531 -1.566406 15.59375 -8.640625\n                            C 7.289062 -15.722656 3.140625 -24.421875 3.140625 -34.734375\n                            C 3.140625 -43.460938 4.363281 -50.644531 6.8125 -56.28125\n                            C 9.257812 -61.914062 13.71875 -69.101562 20.1875 -77.84375\n                            L 45.609375 -108.109375\n                            Z\n                            M 28.703125 -34.734375\n                            C 28.703125 -30.015625 30.226562 -26.101562 33.28125 -23\n                            C 36.34375 -19.894531 40.273438 -18.34375 45.078125 -18.34375\n                            C 49.878906 -18.34375 53.851562 -19.894531 57 -23\n                            C 60.144531 -26.101562 61.71875 -30.015625 61.71875 -34.734375\n                            C 61.71875 -39.535156 60.125 -43.53125 56.9375 -46.71875\n                            C 53.75 -49.90625 49.796875 -51.5 45.078125 -51.5\n                            C 40.535156 -51.5 36.671875 -49.90625 33.484375 -46.71875\n                            C 30.296875 -43.53125 28.703125 -39.535156 28.703125 -34.734375\n                            Z\"/>\n                    </g>\n                    <g transform=\"translate(249.066902, 250.960113)\">\n                        <path d=\"M 7.859375 -108.109375\n                            L 46.515625 -108.109375\n                            C 56.910156 -108.109375 65.382812 -105.332031 71.9375 -99.78125\n                            C 78.488281 -94.238281 81.765625 -86.3125 81.765625 -76\n                            C 81.765625 -68.050781 79.773438 -61.390625 75.796875 -56.015625\n                            C 71.828125 -50.648438 66.4375 -46.875 59.625 -44.6875\n                            L 96.84375 0\n                            L 65.515625 0\n                            L 32.5 -42.71875\n                            L 32.5 0\n                            L 7.859375 0\n                            Z\n                            M 32.5 -60.15625\n                            L 35.375 -60.15625\n                            C 37.65625 -60.15625 39.578125 -60.195312 41.140625 -60.28125\n                            C 42.710938 -60.363281 44.503906 -60.664062 46.515625 -61.1875\n                            C 48.523438 -61.71875 50.140625 -62.460938 51.359375 -63.421875\n                            C 52.585938 -64.390625 53.640625 -65.789062 54.515625 -67.625\n                            C 55.390625 -69.457031 55.828125 -71.679688 55.828125 -74.296875\n                            C 55.828125 -76.921875 55.390625 -79.148438 54.515625 -80.984375\n                            C 53.640625 -82.816406 52.585938 -84.210938 51.359375 -85.171875\n                            C 50.140625 -86.140625 48.523438 -86.882812 46.515625 -87.40625\n                            C 44.503906 -87.925781 42.710938 -88.226562 41.140625 -88.3125\n                            C 39.578125 -88.40625 37.65625 -88.453125 35.375 -88.453125\n                            L 32.5 -88.453125\n                            Z\"/>\n                    </g>\n                </g>\n            </svg>\n        '''\n\n    def _write_icon(self, name: str, svg_data: str) -> None:\n        icon_dir = os.path.expanduser(\"~/.humbug/icons\")\n        with open(os.path.join(icon_dir, name), 'w', encoding='utf-8') as f:\n            f.write(svg_data)\n\n    def _create_active_inactive_theme_icons(self, active: bool, suffix: str, color: str) -> None:\n        prefix = \"\" if active else \"inactive-\"\n\n        # Close button - visible version\n        self._write_icon(f'{prefix}close-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                    d=\"M16,16 L48,48 M48,16 L16,48\"/>\n            </svg>\n        ''')\n\n        # Conversation tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}conversation-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M8 10H8.01\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M12 10H12.01\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M16 10H16.01\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M21 13V7C21 5.11438 21 4.17157 20.4142 3.58579C19.8284 3 18.8856 3 17 3H7C5.11438 3\n                    4.17157 3 3.58579 3.58579C3 4.17157 3 5.11438 3 7V13C3 14.8856 3 15.8284 3.58579 16.4142C4.17157\n                    17 5.11438 17 7 17H7.5C7.77614 17 8 17.2239 8 17.5V20V20.1499C8 20.5037 8.40137 20.7081\n                    8.6875 20.5L13.0956 17.2941C13.3584 17.103 13.675 17 14 17H17C18.8856 17 19.8284 17 20.4142\n                    16.4142C21 15.8284 21 14.8856 21 13Z\" stroke=\"{color}\" stroke-width=\"2\" stroke-linejoin=\"round\"/>\n            </svg>\n        ''')\n\n        # Editor tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}editor-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M13 21H21\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M20.0651 7.39423L7.09967 20.4114C6.72438 20.7882 6.21446 21 5.68265 21H4.00383C3.44943\n                    21 3 20.5466 3 19.9922V18.2987C3 17.7696 3.20962 17.2621 3.58297 16.8873L16.5517 3.86681C19.5632\n                    1.34721 22.5747 4.87462 20.0651 7.39423Z\" stroke=\"{color}\" stroke-width=\"2\"\n                    stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M15.3097 5.30981L18.7274 8.72755\" stroke=\"{color}\" stroke-width=\"2\"\n                    stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n            </svg>\n        ''')\n\n        # Log tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}log-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M5 12H7.75044C7.89947 12 8.03179 11.9046 8.07892 11.7632V11.7632L9.875 6.375V6.375C9.91626\n                    6.25122 10.0918 6.25238 10.1364 6.375V6.375L13.875 16.6562L13.885 16.6837C13.9253 16.7946 14.0812\n                    16.797 14.125 16.6875V16.6875L15.8841 12.2898V12.2898C15.9541 12.1148 16.1236 12 16.3122 12H19\"\n                    stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n            </svg>\n        ''')\n\n        # Shell tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}shell-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M3 7C3 5.11438 3 4.17157 3.58579 3.58579C4.17157 3 5.11438 3 7 3H12H17C18.8856 3 19.8284\n                    3 20.4142 3.58579C21 4.17157 21 5.11438 21 7V10V13C21 14.8856 21 15.8284 20.4142 16.4142C19.8284\n                    17 18.8856 17 17 17H12H7C5.11438 17 4.17157 17 3.58579 16.4142C3 15.8284 3 14.8856 3 13V10V7Z\"\n                    stroke=\"{color}\" stroke-width=\"2\" stroke-linejoin=\"round\"/>\n                <path d=\"M7 21H17\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M12 17V21\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n            </svg>\n        ''')\n\n        # Terminal tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}terminal-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M13 15H16\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n                <path d=\"M8 15L10.5 12.5V12.5C10.7761 12.2239 10.7761 11.7761 10.5 11.5V11.5L8 9\"\n                    stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M3 8C3 6.11438 3 5.17157 3.58579 4.58579C4.17157 4 5.11438 4 7 4H12H17C18.8856 4\n                    19.8284 4 20.4142 4.58579C21 5.17157 21 6.11438 21 8V12V16C21 17.8856 21 18.8284 20.4142\n                    19.4142C19.8284 20 18.8856 20 17 20H12H7C5.11438 20 4.17157 20 3.58579 19.4142C3 18.8284\n                    3 17.8856 3 16V12V8Z\" stroke=\"{color}\" stroke-width=\"2\" stroke-linejoin=\"round\"/>\n            </svg>\n        ''')\n\n        # Wiki tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}wiki-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M17.8284 6.82843C18.4065 7.40649 18.6955 7.69552 18.8478 8.06306C19 8.4306 19 8.83935\n                    19 9.65685L19 17C19 18.8856 19 19.8284 18.4142 20.4142C17.8284 21 16.8856 21 15 21H9C7.11438\n                    21 6.17157 21 5.58579 20.4142C5 19.8284 5 18.8856 5 17L5 7C5 5.11438 5 4.17157 5.58579\n                    3.58579C6.17157 3 7.11438 3 9 3H12.3431C13.1606 3 13.5694 3 13.9369 3.15224C14.3045 3.30448\n                    14.5935 3.59351 15.1716 4.17157L17.8284 6.82843Z\" stroke=\"{color}\"\n                    stroke-width=\"2\" stroke-linejoin=\"round\"/>\n                <path d=\"M9 6L11 6\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M10 9L12 9\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M9 12L11 12\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M10 15L12 15\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n            </svg>\n        ''')\n\n    def _create_theme_icons(self) -> None:\n        \"\"\"Create theme-specific icons in the user's .humbug directory.\"\"\"\n        icon_dir = os.path.expanduser(\"~/.humbug/icons\")\n        os.makedirs(icon_dir, exist_ok=True)\n\n        # Create collapsed and expanded arrows for both themes\n        for mode in ColorMode:\n            color = self._colors[ColorRole.TEXT_PRIMARY][mode]\n            inactive_color = self._colors[ColorRole.TEXT_INACTIVE][mode]\n            suffix = mode.name.lower()\n\n            # Right-pointing arrow\n            self._write_icon(f'arrow-right-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M24,16 L40,32 L24,48\"/>\n                </svg>\n            ''')\n\n            # Left-pointing arrow\n            self._write_icon(f'arrow-left-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M40,16 L24,32 L40,48\"/>\n                </svg>\n            ''')\n\n            # Up-pointing arrow\n            self._write_icon(f'arrow-up-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M16,40 L32,24 L48,40\"/>\n                </svg>\n            ''')\n\n            # Down-pointing arrow\n            self._write_icon(f'arrow-down-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M16,24 L32,40 L48,24\"/>\n                </svg>\n            ''')\n\n            # Close button - visible version\n            self._write_icon(f'close-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M16,16 L48,48 M48,16 L16,48\"/>\n                </svg>\n            ''')\n\n            # Checkbox check mark\n            self._write_icon(f'check-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M16,32 L28,44 L48,20\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                </svg>\n            ''')\n\n            # Right-pointing expand\n            self._write_icon(f'expand-right-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M20,8 L44,32 L20,56\"/>\n                </svg>\n            ''')\n\n            # Left-pointing expand\n            self._write_icon(f'expand-left-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M44,8 L20,32 L44,56\"/>\n                </svg>\n            ''')\n\n            # Down-pointing expand\n            self._write_icon(f'expand-down-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M8,20 L32,44 L56,20\"/>\n                </svg>\n            ''')\n\n            # Bulb on icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n            self._write_icon(f'info-{suffix}.svg', f'''\n                <svg width=\"800px\" height=\"800px\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path d=\"M12 7C9.23858 7 7 9.23858 7 12C7 13.3613 7.54402 14.5955 8.42651 15.4972C8.77025 15.8484 9.05281 16.2663\n                        9.14923 16.7482L9.67833 19.3924C9.86537 20.3272 10.6862 21 11.6395 21H12.3605C13.3138 21 14.1346 20.3272\n                        14.3217 19.3924L14.8508 16.7482C14.9472 16.2663 15.2297 15.8484 15.5735 15.4972C16.456 14.5955 17\n                        13.3613 17 12C17 9.23858 14.7614 7 12 7Z\" stroke=\"{color}\" stroke-width=\"2\"/>\n                    <path d=\"M12 4V3\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M18 6L19 5\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M20 12H21\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M4 12H3\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M5 5L6 6\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M10 17H14\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                </svg>\n            ''')\n\n            # Alert triangle icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n            self._write_icon(f'warning-{suffix}.svg', f'''\n                <svg width=\"800px\" height=\"800px\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path d=\"M12 10V13\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n                    <path d=\"M12 16V15.9888\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n                    <path d=\"M10.2518 5.147L3.6508 17.0287C2.91021 18.3618 3.87415 20 5.39912 20H18.6011C20.126 20 21.09\n                        18.3618 20.3494 17.0287L13.7484 5.147C12.9864 3.77538 11.0138 3.77538 10.2518 5.147Z\"\n                        stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                </svg>\n            ''')\n\n            # Alert hexagon icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n            self._write_icon(f'critical-{suffix}.svg', f'''\n                <svg width=\"800px\" height=\"800px\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path d=\"M3 9.22843V14.7716C3 15.302 3.21071 15.8107 3.58579 16.1858L7.81421 20.4142C8.18929 20.7893 8.69799\n                        21 9.22843 21H14.7716C15.302 21 15.8107 20.7893 16.1858 20.4142L20.4142 16.1858C20.7893 15.8107 21\n                        15.302 21 14.7716V9.22843C21 8.69799 20.7893 8.18929 20.4142 7.81421L16.1858 3.58579C15.8107 3.21071\n                        15.302 3 14.7716 3H9.22843C8.69799 3 8.18929 3.21071 7.81421 3.58579L3.58579 7.81421C3.21071 8.18929\n                        3 8.69799 3 9.22843Z\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M12 8V13\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n                    <path d=\"M12 16V15.9888\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n                </svg>\n            ''')\n\n            # Help circle icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n            self._write_icon(f'question-{suffix}.svg', f'''\n                <svg width=\"800px\" height=\"800px\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path d=\"M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12\n                        3C16.9706 3 21 7.02944 21 12Z\" stroke=\"{color}\" stroke-width=\"2\"/>\n                    <path d=\"M10.5 8.67709C10.8665 8.26188 11.4027 8 12 8C13.1046 8 14 8.89543 14 10C14 10.9337\n                        13.3601 11.718 12.4949 11.9383C12.2273 12.0064 12 12.2239 12 12.5V12.5V13\"\n                        stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M12 16H12.01\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'save-{suffix}.svg', f'''\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M8,40, L8,56 L56,56 L56,40\"/>\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M32,8, L32,40\"/>\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M20,28, L32,40, L44,28\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'copy-{suffix}.svg', f'''\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <rect x=\"22\" y=\"10\" width=\"32\" height=\"32\" stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"/>\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M22,22, L10,22 L10,54 L42,54 L42,42\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'fork-{suffix}.svg', f'''\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M32,8 L32,32 M32,32 L8,56 L8,40 M8,56 L24,56 M32,32 L56,56 L56,40 M56,56 L40,56\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'delete-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M12.5,20 L12.5,56 L51.5,56 L51.5,20 M4,20 L60,20 M18,20 L24,8 L40,8 L46,20\"/>\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M25.5,28 L25.5,46 M38.5,28 L38.5,46\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'edit-{suffix}.svg', f'''\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M8,56 L56,56 M40,12 L52,24 L24,52 L8,56 L12,40 L40,12 Z\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'submit-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M8,32 L32,8 L56,32\"/>\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M32,56 L32,8\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'stop-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <circle cx=\"32\" cy=\"32\" r=\"28\" fill=\"none\" stroke=\"{color}\" stroke-width=\"6\"/>\n                    <rect x=\"20\" y=\"20\" width=\"24\" height=\"24\" fill=\"{color}\" stroke=\"none\"/>\n                </svg>\n            ''')\n\n            self._create_active_inactive_theme_icons(True, suffix, color)\n            self._create_active_inactive_theme_icons(False, suffix, inactive_color)\n\n        # Create the standard application icon for about dialog\n        self._write_icon('app-icon.svg', self._create_app_icon_svg('#4040c0', '#ffffff'))\n\n        # Create light mode disabled version\n        self._write_icon('app-icon-disabled-light.svg', self._create_app_icon_svg('#c0c0c0', '#e0e0e0'))\n\n        # Create dark mode disabled version\n        self._write_icon('app-icon-disabled-dark.svg', self._create_app_icon_svg('#202020', '#404040'))\n\n    def get_icon_path(self, name: str) -> str:\n        \"\"\"\n        Get the path to a theme-appropriate icon.\n\n        Args:\n            name: Base name of the icon (without theme suffix or extension)\n\n        Returns:\n            Full path to the icon file\n        \"\"\"\n        icon_dir = os.path.expanduser(\"~/.humbug/icons\")\n        theme = \"dark\" if self._color_mode == ColorMode.DARK else \"light\"\n        return Path(os.path.join(icon_dir, f\"{name}-{theme}.svg\")).as_posix()\n\n    def scale_icon(self, icon_path: str, target_size: int) -> QPixmap:\n        \"\"\"\n        Load and scale an icon to the appropriate size.\n\n        Args:\n            icon_path: Path to the icon file\n            target_size: Desired size in pixels\n\n        Returns:\n            Scaled QPixmap of the icon\n        \"\"\"\n        pixmap = QPixmap(icon_path)\n        scaled_size = int(target_size * self._zoom_factor)\n        return pixmap.scaled(\n            scaled_size,\n            scaled_size,\n            Qt.AspectRatioMode.KeepAspectRatio,\n            Qt.TransformationMode.SmoothTransformation\n        )\n\n    def get_color(self, role: ColorRole) -> QColor:\n        \"\"\"\n        Get a color for a specific role.\n\n        Args:\n            role: The ColorRole to look up\n\n        Returns:\n            QColor: The color for the specified role\n\n        Raises:\n            KeyError: If no color is defined for the role\n        \"\"\"\n        return QColor(self._colors[role][self._color_mode])\n\n    def get_color_str(self, role: ColorRole) -> str:\n        \"\"\"\n        Get a color string for a specific role.\n\n        Args:\n            role: The ColorRole to look up\n\n        Returns:\n            str: The color string (hex format) for the specified role\n\n        Raises:\n            KeyError: If no color is defined for the role\n        \"\"\"\n        return self._colors[role][self._color_mode]\n\n    def get_highlight(self, token_type: TokenType) -> QTextCharFormat:\n        \"\"\"\n        Get the highlight format for a specific token type.\n\n        Args:\n            token_type: The TokenType to look up\n\n        Returns:\n            QTextCharFormat: The highlight format for the specified token type\n        \"\"\"\n        if token_type not in self._highlights:\n            print(f\"token type {token_type} not mapped\")\n\n        return self._highlights.get(token_type, self._error_highlight)\n\n    def get_proportional_highlight(self, token_type: TokenType) -> QTextCharFormat:\n        \"\"\"\n        Get the proportionally-spaced highlight format for a specific token type.\n\n        Args:\n            token_type: The TokenType to look up\n\n        Returns:\n            QTextCharFormat: The highlight format for the specified token type\n        \"\"\"\n        if token_type not in self._proportional_highlights:\n            print(f\"token type {token_type} not mapped\")\n\n        return self._proportional_highlights.get(token_type, self._error_proportional_highlight)\n\n    def _determine_base_font_size(self) -> float:\n        \"\"\"\n        Determine the default system font size based on the operating system.\n\n        Returns:\n            int: Base font size in points.\n        \"\"\"\n        # Get current OS\n        os_type = QOperatingSystemVersion.current()\n\n        # Get system default font\n        system_font = QFontDatabase.systemFont(QFontDatabase.SystemFont.GeneralFont)\n        system_size = system_font.pointSizeF()\n\n        # Apply OS-specific adjustments if system detection fails\n        if system_size > 0:\n            return system_size\n\n        if os_type.type() == QOperatingSystemVersion.OSType.MacOS:  # type: ignore\n            # macOS typically uses 13pt as default\n            return 13\n\n        if os_type.type() == QOperatingSystemVersion.OSType.Windows:  # type: ignore\n            # Windows typically uses 9pt as default\n            return 9\n\n        # Linux typically uses 10pt as default\n        return 10\n\n    def base_font_size(self) -> float:\n        \"\"\"Get the base font size for the current system.\"\"\"\n        return self._user_font_size or self._base_font_size\n\n    def set_user_font_size(self, size: float | None) -> None:\n        \"\"\"Set user-specific font size override.\"\"\"\n        if size != self._user_font_size:\n            self._user_font_size = size\n\n            if size:\n                self.style_changed.emit()\n\n    def color_mode(self) -> ColorMode:\n        \"\"\"Get the current color mode.\"\"\"\n        return self._color_mode\n\n    def set_color_mode(self, mode: ColorMode) -> None:\n        \"\"\"\n        Set the color mode and update application styles.\n\n        Args:\n            mode: The ColorMode to switch to\n        \"\"\"\n        if mode != self._color_mode:\n            self._color_mode = mode\n            self._initialize_highlights()\n            self._initialize_proportional_highlights()\n            self.style_changed.emit()\n\n    def zoom_factor(self) -> float:\n        \"\"\"Current zoom scaling factor.\"\"\"\n        return self._zoom_factor\n\n    def set_zoom(self, factor: float) -> None:\n        \"\"\"\n        Set new zoom factor and update application styles.\n\n        Args:\n            factor: New zoom factor to apply (clamped between 0.5 and 2.0)\n        \"\"\"\n        new_factor = max(0.5, min(2.0, factor))\n        if new_factor != self._zoom_factor:\n            self._zoom_factor = new_factor\n            self.style_changed.emit()\n\n    def get_space_width(self) -> float:\n        \"\"\"Get the width of a space character\"\"\"\n        font = QFont(self._code_font_families)\n        font.setPointSizeF(self.base_font_size() * self._zoom_factor)\n        font_metrics = QFontMetricsF(font)\n        space_width = font_metrics.horizontalAdvance('        ') / 8\n        return space_width\n\n    def monospace_font_families(self) -> List[str]:\n        \"\"\"Get the standard monospace font family fallback sequence.\"\"\"\n        return self._code_font_families\n\n    def message_bubble_spacing(self) -> float:\n        \"\"\"Get the number of pixels to use in message bubble spacing.\"\"\"\n        return 8.0\n\n    def get_dialog_stylesheet(self) -> str:\n        \"\"\"\n        Get a complete stylesheet for dialog windows.\n\n        Returns:\n            A stylesheet string with styling for all common dialog components\n        \"\"\"\n        zoom_factor = self.zoom_factor()\n        base_font_size = self.base_font_size()\n\n        return f\"\"\"\n            QDialog {{\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\n                font-size: {base_font_size * zoom_factor}pt;\n            }}\n\n            QScrollArea {{\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\n                border: none;\n            }}\n\n            QScrollArea > QWidget > QWidget {{\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\n                border: none;\n            }}\n\n            /* Labels */\n            QLabel {{\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\n                border: none;\n                border-radius: 4px;\n                padding: 0px;\n                margin: 0px;\n                font-size: {base_font_size * zoom_factor}pt;\n            }}\n\n            /* Text inputs */\n            QLineEdit {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border: none;\n                border-radius: 4px;\n                padding: 4px;\n                font-size: {int(base_font_size * zoom_factor)}pt;\n            }}\n            QLineEdit:disabled {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n\n            /* Checkboxes */\n            QCheckBox {{\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border: none;\n                border-radius: 4px;\n                padding: 0px;\n                margin: 0px;\n            }}\n            QCheckBox::indicator {{\n                width: {int(18 * zoom_factor)}px;\n                height: {int(18 * zoom_factor)}px;\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\n            }}\n            QCheckBox::indicator:disabled {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\n            }}\n            QCheckBox::indicator:checked {{\n                image: url({self.get_icon_path('check')});\n            }}\n            QCheckBox:disabled {{\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n\n            /* Combo boxes */\n            QComboBox {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border: none;\n                border-radius: 4px;\n                padding: 6px;\n                margin: 0px;\n                font-size: {int(base_font_size * zoom_factor)}pt;\n            }}\n            QComboBox:disabled {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n            QComboBox::drop-down {{\n                border: none;\n                width: 20px;\n            }}\n            QComboBox::down-arrow {{\n                image: url({self.get_icon_path(\"arrow-down\")});\n                width: 12px;\n                height: 12px;\n            }}\n            QComboBox::down-arrow:on {{\n                image: url({self.get_icon_path('arrow-up')});\n                width: 12px;\n                height: 12px;\n            }}\n            QComboBox::down-arrow:disabled {{\n                image: none;\n            }}\n            QComboBox QAbstractItemView::item:selected {{\n                border: none;\n                background-color: {self.get_color_str(ColorRole.TEXT_SELECTED)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n            }}\n            QComboBox QListView {{\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_SECONDARY)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n            }}\n\n            /* Spin boxes */\n            QSpinBox, QDoubleSpinBox {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border: none;\n                border-radius: 4px;\n                padding: 4px;\n                font-size: {base_font_size * zoom_factor}pt;\n            }}\n            QSpinBox:disabled, QDoubleSpinBox:disabled {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n            QSpinBox::up-button, QSpinBox::down-button,\n            QDoubleSpinBox::up-button, QDoubleSpinBox::down-button {{\n                border: none;\n                width: 20px;\n            }}\n            QSpinBox::up-arrow, QDoubleSpinBox::up-arrow {{\n                image: url({self.get_icon_path('arrow-up')});\n                width: 12px;\n                height: 12px;\n            }}\n            QSpinBox::up-arrow:disabled, QSpinBox::up-arrow:off,\n            QDoubleSpinBox::up-arrow:disabled, QDoubleSpinBox::up-arrow:off {{\n                image: none;\n            }}\n            QSpinBox::down-arrow, QDoubleSpinBox::down-arrow {{\n                image: url({self.get_icon_path('arrow-down')});\n                width: 12px;\n                height: 12px;\n            }}\n            QSpinBox::down-arrow:disabled, QSpinBox::down-arrow:off,\n            QDoubleSpinBox::down-arrow:disabled, QDoubleSpinBox::down-arrow:off {{\n                image: none;\n            }}\n\n            /* Buttons */\n            QPushButton {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border: none;\n                border-radius: 4px;\n                padding: 4px;\n                font-size: {base_font_size * zoom_factor}pt;\n            }}\n            QPushButton:hover {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_HOVER)};\n            }}\n            QPushButton:pressed {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_PRESSED)};\n            }}\n            QPushButton:disabled {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n\n            /* Recommended (primary) buttons */\n            QPushButton[recommended=\"true\"] {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_RECOMMENDED)};\n                color: {self.get_color_str(ColorRole.TEXT_RECOMMENDED)};\n            }}\n            QPushButton[recommended=\"true\"]:hover {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_RECOMMENDED_HOVER)};\n            }}\n            QPushButton[recommended=\"true\"]:pressed {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_RECOMMENDED_PRESSED)};\n            }}\n            QPushButton[recommended=\"false\"] {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE)};\n                color: {self.get_color_str(ColorRole.TEXT_RECOMMENDED)};\n            }}\n            QPushButton[recommended=\"false\"]:hover {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_HOVER)};\n            }}\n            QPushButton[recommended=\"false\"]:pressed {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_PRESSED)};\n            }}\n\n            QScrollBar:vertical {{\n                background-color: {self.get_color_str(ColorRole.SCROLLBAR_BACKGROUND)};\n                width: 12px;\n            }}\n            QScrollBar::handle:vertical {{\n                background-color: {self.get_color_str(ColorRole.SCROLLBAR_HANDLE)};\n                min-height: 20px;\n            }}\n            QScrollBar::add-page:vertical, QScrollBar::sub-page:vertical {{\n                background: none;\n            }}\n            QScrollBar::add-line:vertical, QScrollBar::sub-line:vertical {{\n                height: 0px;\n            }}\n        \"\"\"\n",
          "error": null
        }
      ]
    },
    {
      "id": "8cc8b161-9f32-4a28-b2df-b0eb8bf538ec",
      "timestamp": "2025-08-29T19:53:05.835386+00:00",
      "type": "user_message",
      "content": "",
      "completed": true,
      "tool_results": [
        {
          "id": "toolu_01D6Jyee7AR5oiio3H8VX1Nv",
          "name": "filesystem",
          "content": "File: src/humbug/style_manager.py\nSize: 63,529 bytes\nEncoding: utf-8\n\n\"\"\"Style manager for handling application-wide style and zoom settings.\n\nImplements a singleton pattern to maintain consistent styling across components.\nProvides signals for style changes and utilities for scaled size calculations.\n\"\"\"\n\nfrom enum import Enum, auto\nimport os\nfrom pathlib import Path\nfrom typing import Dict, List\n\nfrom PySide6.QtCore import QObject, Signal, QOperatingSystemVersion, Qt\nfrom PySide6.QtGui import QTextCharFormat, QFontDatabase, QColor, QFontMetricsF, QFont, QPixmap\n\nfrom syntax import TokenType\n\nfrom humbug.color_role import ColorRole\n\n\nclass ColorMode(Enum):\n    \"\"\"Enumeration for color theme modes.\"\"\"\n    LIGHT = auto()\n    DARK = auto()\n\n\nclass StyleManager(QObject):\n    \"\"\"\n    Singleton manager for application-wide style settings.\n\n    Handles zoom factor management and style updates across the application.\n    Emits signals when zoom level changes to notify dependent components.\n\n    Attributes:\n        style_changed (Signal): Emitted when style changes, passing new zoom factor\n        _instance (StyleManager): Singleton instance\n        _zoom_factor (float): Current zoom scaling factor\n        _initialized (bool): Tracks initialization state of QObject base\n    \"\"\"\n\n    style_changed = Signal()\n    _instance = None\n\n    def __new__(cls) -> 'StyleManager':\n        \"\"\"Create or return singleton instance.\"\"\"\n        if cls._instance is None:\n            cls._instance = super(StyleManager, cls).__new__(cls)\n\n        return cls._instance\n\n    def __init__(self) -> None:\n        \"\"\"Initialize QObject base class if not already done.\"\"\"\n        if not hasattr(self, '_initialized'):\n            super().__init__()\n            self._zoom_factor = 1.0\n            self._base_font_size = self._determine_base_font_size()\n            self._user_font_size: float | None = None\n            self._initialized = True\n            self._color_mode = ColorMode.DARK  # Default to dark mode\n            self._colors: Dict[ColorRole, Dict[ColorMode, str]] = self._initialize_colors()\n            self._highlights: Dict[TokenType, QTextCharFormat] = {}\n            self._proportional_highlights: Dict[TokenType, QTextCharFormat] = {}\n\n            self._code_font_families = [\"Menlo\", \"Consolas\", \"Monaco\", \"monospace\"]\n            self._initialize_highlights()\n            self._initialize_proportional_highlights()\n            self._create_theme_icons()\n\n    def _initialize_colors(self) -> Dict[ColorRole, Dict[ColorMode, str]]:\n        \"\"\"Initialize the application colours for both light and dark modes.\"\"\"\n        return {\n            # Background colours\n            ColorRole.BACKGROUND_PRIMARY: {\n                ColorMode.DARK: \"#080808\",\n                ColorMode.LIGHT: \"#e0e0e0\"\n            },\n            ColorRole.BACKGROUND_SECONDARY: {\n                ColorMode.DARK: \"#141414\",\n                ColorMode.LIGHT: \"#ececec\"\n            },\n            ColorRole.BACKGROUND_TERTIARY: {\n                ColorMode.DARK: \"#242424\",\n                ColorMode.LIGHT: \"#fcfcfc\"\n            },\n            ColorRole.BACKGROUND_DIALOG: {\n                ColorMode.DARK: \"#282828\",\n                ColorMode.LIGHT: \"#d0d0d0\"\n            },\n\n            # Text colours\n            ColorRole.TEXT_PRIMARY: {\n                ColorMode.DARK: \"#d8d8d8\",\n                ColorMode.LIGHT: \"#202020\"\n            },\n            ColorRole.TEXT_BRIGHT: {\n                ColorMode.DARK: \"#ffffff\",\n                ColorMode.LIGHT: \"#000000\"\n            },\n            ColorRole.TEXT_HEADING: {\n                ColorMode.DARK: \"#ffe0a0\",\n                ColorMode.LIGHT: \"#204080\"\n            },\n            ColorRole.TEXT_HEADING_BRIGHT: {\n                ColorMode.DARK: \"#ffe8a0\",\n                ColorMode.LIGHT: \"#203880\"\n            },\n            ColorRole.TEXT_DISABLED: {\n                ColorMode.DARK: \"#707070\",\n                ColorMode.LIGHT: \"#909090\"\n            },\n            ColorRole.TEXT_SELECTED: {\n                ColorMode.DARK: \"#404058\",\n                ColorMode.LIGHT: \"#c8c8dc\"\n            },\n            ColorRole.TEXT_FOUND: {\n                ColorMode.DARK: \"#885050\",\n                ColorMode.LIGHT: \"#e0b4b4\"\n            },\n            ColorRole.TEXT_FOUND_DIM: {\n                ColorMode.DARK: \"#583838\",\n                ColorMode.LIGHT: \"#f4d8d8\"\n            },\n            ColorRole.TEXT_RECOMMENDED: {\n                ColorMode.DARK: \"#ffffff\",\n                ColorMode.LIGHT: \"#ffffff\"\n            },\n            ColorRole.TEXT_LINK: {\n                ColorMode.DARK: \"#80a0ff\",\n                ColorMode.LIGHT: \"#0000ff\"\n            },\n            ColorRole.TEXT_INACTIVE: {\n                ColorMode.DARK: \"#909090\",\n                ColorMode.LIGHT: \"#707070\"\n            },\n            ColorRole.TEXT_EPHEMERAL: {\n                ColorMode.DARK: \"#e0a080\",\n                ColorMode.LIGHT: \"#a0785c\"\n            },\n            ColorRole.TEXT_EPHEMERAL_INACTIVE: {\n                ColorMode.DARK: \"#a06040\",\n                ColorMode.LIGHT: \"#c09070\"\n            },\n            ColorRole.TEXT_ERROR: {\n                ColorMode.DARK: \"#e03020\",\n                ColorMode.LIGHT: \"#f04030\"\n            },\n            ColorRole.TEXT_ERROR_INACTIVE: {\n                ColorMode.DARK: \"#e06050\",\n                ColorMode.LIGHT: \"#f07060\"\n            },\n\n            # Edit box colours\n            ColorRole.EDIT_BOX_BORDER: {\n                ColorMode.DARK: \"#6060c0\",\n                ColorMode.LIGHT: \"#404080\"\n            },\n            ColorRole.EDIT_BOX_BACKGROUND: {\n                ColorMode.DARK: \"#242454\",\n                ColorMode.LIGHT: \"#b8b8f8\"\n            },\n            ColorRole.EDIT_BOX_ERROR: {\n                ColorMode.DARK: \"#c03020\",\n                ColorMode.LIGHT: \"#d04030\"\n            },\n\n            # Tab colours\n            ColorRole.TAB_BAR_BACKGROUND: {\n                ColorMode.DARK: \"#000000\",\n                ColorMode.LIGHT: \"#d8d8d8\"\n            },\n            ColorRole.TAB_BACKGROUND_ACTIVE: {\n                ColorMode.DARK: \"#1e1e1e\",\n                ColorMode.LIGHT: \"#ffffff\"\n            },\n            ColorRole.TAB_BACKGROUND_INACTIVE: {\n                ColorMode.DARK: \"#141414\",\n                ColorMode.LIGHT: \"#f0f0f0\"\n            },\n            ColorRole.TAB_BACKGROUND_HOVER: {\n                ColorMode.DARK: \"#242454\",\n                ColorMode.LIGHT: \"#b8b8f8\"\n            },\n            ColorRole.TAB_BACKGROUND_UPDATED: {\n                ColorMode.DARK: \"#3c2054\",\n                ColorMode.LIGHT: \"#f0d0f8\"\n            },\n            ColorRole.TAB_BORDER_ACTIVE: {\n                ColorMode.DARK: \"#8080ff\",\n                ColorMode.LIGHT: \"#3030ff\"\n            },\n\n            # Button colours\n            ColorRole.BUTTON_BACKGROUND: {\n                ColorMode.DARK: \"#0c0c0c\",\n                ColorMode.LIGHT: \"#e8e8e8\"\n            },\n            ColorRole.BUTTON_BACKGROUND_PRESSED: {\n                ColorMode.DARK: \"#505050\",\n                ColorMode.LIGHT: \"#b0b0b0\"\n            },\n            ColorRole.BUTTON_BACKGROUND_HOVER: {\n                ColorMode.DARK: \"#404040\",\n                ColorMode.LIGHT: \"#c0c0c0\"\n            },\n            ColorRole.BUTTON_SECONDARY_BACKGROUND: {\n                ColorMode.DARK: \"#2c2c2c\",\n                ColorMode.LIGHT: \"#d8d8d8\"\n            },\n            ColorRole.BUTTON_SECONDARY_BACKGROUND_PRESSED: {\n                ColorMode.DARK: \"#505050\",\n                ColorMode.LIGHT: \"#b0b0b0\"\n            },\n            ColorRole.BUTTON_SECONDARY_BACKGROUND_HOVER: {\n                ColorMode.DARK: \"#404040\",\n                ColorMode.LIGHT: \"#c0c0c0\"\n            },\n            ColorRole.BUTTON_BACKGROUND_RECOMMENDED: {\n                ColorMode.DARK: \"#2050c0\",\n                ColorMode.LIGHT: \"#3060d0\"\n            },\n            ColorRole.BUTTON_BACKGROUND_RECOMMENDED_PRESSED: {\n                ColorMode.DARK: \"#4070e0\",\n                ColorMode.LIGHT: \"#1040b0\"\n            },\n            ColorRole.BUTTON_BACKGROUND_RECOMMENDED_HOVER: {\n                ColorMode.DARK: \"#3060d0\",\n                ColorMode.LIGHT: \"#2050c0\"\n            },\n            ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE: {\n                ColorMode.DARK: \"#c03020\",\n                ColorMode.LIGHT: \"#d04030\"\n            },\n            ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_PRESSED: {\n                ColorMode.DARK: \"#e05040\",\n                ColorMode.LIGHT: \"#b02010\"\n            },\n            ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_HOVER: {\n                ColorMode.DARK: \"#d04030\",\n                ColorMode.LIGHT: \"#c03020\"\n            },\n            ColorRole.BUTTON_BACKGROUND_DISABLED: {\n                ColorMode.DARK: \"#202020\",\n                ColorMode.LIGHT: \"#d8d8d8\"\n            },\n\n            # Menu elements\n            ColorRole.MENU_BACKGROUND: {\n                ColorMode.DARK: \"#2d2d2d\",\n                ColorMode.LIGHT: \"#f0f0f0\"\n            },\n            ColorRole.MENU_HOVER: {\n                ColorMode.DARK: \"#3060d0\",\n                ColorMode.LIGHT: \"#2050c0\"\n            },\n            ColorRole.MENU_BORDER: {\n                ColorMode.DARK: \"#606060\",\n                ColorMode.LIGHT: \"#b0b0b0\"\n            },\n\n            # Splitter bars\n            ColorRole.SPLITTER: {\n                ColorMode.DARK: \"#606060\",\n                ColorMode.LIGHT: \"#b0b0b0\"\n            },\n\n            # Scroll bar elements\n            ColorRole.SCROLLBAR_BACKGROUND: {\n                ColorMode.DARK: \"#2d2d2d\",\n                ColorMode.LIGHT: \"#f0f0f0\"\n            },\n            ColorRole.SCROLLBAR_HANDLE: {\n                ColorMode.DARK: \"#404040\",\n                ColorMode.LIGHT: \"#c0c0c0\"\n            },\n\n            # Table elements\n            ColorRole.TABLE_BORDER: {\n                ColorMode.DARK: \"#808080\",\n                ColorMode.LIGHT: \"#a0a0a0\"\n            },\n            ColorRole.TABLE_HEADER_BACKGROUND: {\n                ColorMode.DARK: \"#484838\",\n                ColorMode.LIGHT: \"#d0d0e0\"\n            },\n\n            # Message colours\n            ColorRole.MESSAGE_BACKGROUND: {\n                ColorMode.DARK: \"#020202\",\n                ColorMode.LIGHT: \"#f2f2f2\"\n            },\n            ColorRole.MESSAGE_USER_BACKGROUND: {\n                ColorMode.DARK: \"#121212\",\n                ColorMode.LIGHT: \"#e4e4e4\"\n            },\n            ColorRole.MESSAGE_FOCUSED: {\n                ColorMode.DARK: \"#3a4654\",\n                ColorMode.LIGHT: \"#aab6c4\"\n            },\n            ColorRole.MESSAGE_USER: {\n                ColorMode.DARK: \"#8080c0\",\n                ColorMode.LIGHT: \"#6060a0\"\n            },\n            ColorRole.MESSAGE_AI: {\n                ColorMode.DARK: \"#80c080\",\n                ColorMode.LIGHT: \"#40a040\"\n            },\n            ColorRole.MESSAGE_REASONING: {\n                ColorMode.DARK: \"#808080\",\n                ColorMode.LIGHT: \"#808080\"\n            },\n            ColorRole.MESSAGE_TOOL_CALL: {\n                ColorMode.DARK: \"#808080\",\n                ColorMode.LIGHT: \"#808080\"\n            },\n            ColorRole.MESSAGE_TOOL_RESULT: {\n                ColorMode.DARK: \"#808080\",\n                ColorMode.LIGHT: \"#808080\"\n            },\n            ColorRole.MESSAGE_SYSTEM_ERROR: {\n                ColorMode.DARK: \"#c08080\",\n                ColorMode.LIGHT: \"#a04040\"\n            },\n            ColorRole.MESSAGE_SYSTEM_SUCCESS: {\n                ColorMode.DARK: \"#80c080\",\n                ColorMode.LIGHT: \"#40a040\"\n            },\n            ColorRole.MESSAGE_LANGUAGE: {\n                ColorMode.DARK: \"#a07850\",\n                ColorMode.LIGHT: \"#806040\"\n            },\n            ColorRole.MESSAGE_BOOKMARK: {\n                ColorMode.DARK: \"#ffdf00\",\n                ColorMode.LIGHT: \"#806000\"\n            },\n            ColorRole.MESSAGE_STREAMING: {\n                ColorMode.DARK: \"#c0a080\",\n                ColorMode.LIGHT: \"#a07050\"\n            },\n            ColorRole.MESSAGE_TRACE: {\n                ColorMode.DARK: \"#a0a0a0\",\n                ColorMode.LIGHT: \"#606060\"\n            },\n            ColorRole.MESSAGE_INFORMATION: {\n                ColorMode.DARK: \"#80b0f0\",\n                ColorMode.LIGHT: \"#0060c0\"\n            },\n            ColorRole.MESSAGE_WARNING: {\n                ColorMode.DARK: \"#f0c040\",\n                ColorMode.LIGHT: \"#c0a020\"\n            },\n            ColorRole.MESSAGE_ERROR: {\n                ColorMode.DARK: \"#ff6060\",\n                ColorMode.LIGHT: \"#c03030\"\n            },\n\n            # Status bar elements\n            ColorRole.STATUS_BAR_BACKGROUND: {\n                ColorMode.DARK: \"#121212\",\n                ColorMode.LIGHT: \"#e8e8e8\"\n            },\n\n            # Close button states\n            ColorRole.CLOSE_BUTTON_BACKGROUND_HOVER: {\n                ColorMode.DARK: \"#d04030\",\n                ColorMode.LIGHT: \"#c03020\"\n            },\n\n            # Line numbers\n            ColorRole.LINE_NUMBER: {\n                ColorMode.DARK: \"#606060\",\n                ColorMode.LIGHT: \"#c0c0c0\"\n            },\n\n            # Syntax highlighting\n            ColorRole.SYNTAX_ERROR: {\n                ColorMode.DARK: \"#ff0000\",\n                ColorMode.LIGHT: \"#ff0000\"\n            },\n            ColorRole.SYNTAX_01: {\n                ColorMode.DARK: \"#80e0d0\",\n                ColorMode.LIGHT: \"#007070\"\n            },\n            ColorRole.SYNTAX_02: {\n                ColorMode.DARK: \"#f0f0f0\",\n                ColorMode.LIGHT: \"#202020\"\n            },\n            ColorRole.SYNTAX_03: {\n                ColorMode.DARK: \"#68b068\",\n                ColorMode.LIGHT: \"#407040\"\n            },\n            ColorRole.SYNTAX_04: {\n                ColorMode.DARK: \"#ffa0eb\",\n                ColorMode.LIGHT: \"#c000a0\"\n            },\n            ColorRole.SYNTAX_05: {\n                ColorMode.DARK: \"#808080\",\n                ColorMode.LIGHT: \"#606060\"\n            },\n            ColorRole.SYNTAX_06: {\n                ColorMode.DARK: \"#90e0e8\",\n                ColorMode.LIGHT: \"#0080a0\"\n            },\n            ColorRole.SYNTAX_07: {\n                ColorMode.DARK: \"#e0e080\",\n                ColorMode.LIGHT: \"#a0a000\"\n            },\n            ColorRole.SYNTAX_08: {\n                ColorMode.DARK: \"#b090f0\",\n                ColorMode.LIGHT: \"#5040c0\"\n            },\n            ColorRole.SYNTAX_09: {\n                ColorMode.DARK: \"#90e0e8\",\n                ColorMode.LIGHT: \"#0080a0\"\n            },\n            ColorRole.SYNTAX_10: {\n                ColorMode.DARK: \"#d070d0\",\n                ColorMode.LIGHT: \"#a000a0\"\n            },\n            ColorRole.SYNTAX_11: {\n                ColorMode.DARK: \"#80b0f0\",\n                ColorMode.LIGHT: \"#0060c0\"\n            },\n            ColorRole.SYNTAX_12: {\n                ColorMode.DARK: \"#f08080\",\n                ColorMode.LIGHT: \"#c03030\"\n            },\n            ColorRole.SYNTAX_13: {\n                ColorMode.DARK: \"#ffc0eb\",\n                ColorMode.LIGHT: \"#c080a0\"\n            },\n            ColorRole.SYNTAX_14: {\n                ColorMode.DARK: \"#f0e060\",\n                ColorMode.LIGHT: \"#a09040\"\n            },\n            ColorRole.SYNTAX_15: {\n                ColorMode.DARK: \"#70e0e8\",\n                ColorMode.LIGHT: \"#2090a0\"\n            },\n            ColorRole.SYNTAX_16: {\n                ColorMode.DARK: \"#88d048\",\n                ColorMode.LIGHT: \"#508020\"\n            },\n            ColorRole.SYNTAX_17: {\n                ColorMode.DARK: \"#c0c0c0\",\n                ColorMode.LIGHT: \"#404040\"\n            },\n            ColorRole.SYNTAX_18: {\n                ColorMode.DARK: \"#80b080\",\n                ColorMode.LIGHT: \"#609060\"\n            },\n            ColorRole.SYNTAX_19: {\n                ColorMode.DARK: \"#c87050\",\n                ColorMode.LIGHT: \"#a04020\"\n            },\n            ColorRole.SYNTAX_20: {\n                ColorMode.DARK: \"#c05040\",\n                ColorMode.LIGHT: \"#803828\"\n             },\n            ColorRole.SYNTAX_21: {\n                ColorMode.DARK: \"#30c090\",\n                ColorMode.LIGHT: \"#24906c\"\n            },\n\n            # Terminal basic colors\n            ColorRole.TERM_BLACK: {\n                ColorMode.DARK: \"#000000\",\n                ColorMode.LIGHT: \"#000000\"\n            },\n            ColorRole.TERM_RED: {\n                ColorMode.DARK: \"#cd0000\",\n                ColorMode.LIGHT: \"#cd0000\"\n            },\n            ColorRole.TERM_GREEN: {\n                ColorMode.DARK: \"#00cd00\",\n                ColorMode.LIGHT: \"#00cd00\"\n            },\n            ColorRole.TERM_YELLOW: {\n                ColorMode.DARK: \"#cdcd00\",\n                ColorMode.LIGHT: \"#cdcd00\"\n            },\n            ColorRole.TERM_BLUE: {\n                ColorMode.DARK: \"#0000ee\",\n                ColorMode.LIGHT: \"#0000ee\"\n            },\n            ColorRole.TERM_MAGENTA: {\n                ColorMode.DARK: \"#cd00cd\",\n                ColorMode.LIGHT: \"#cd00cd\"\n            },\n            ColorRole.TERM_CYAN: {\n                ColorMode.DARK: \"#00cdcd\",\n                ColorMode.LIGHT: \"#00cdcd\"\n            },\n            ColorRole.TERM_WHITE: {\n                ColorMode.DARK: \"#e5e5e5\",\n                ColorMode.LIGHT: \"#e5e5e5\"\n            },\n\n            # Terminal bright colors\n            ColorRole.TERM_BRIGHT_BLACK: {\n                ColorMode.DARK: \"#7f7f7f\",\n                ColorMode.LIGHT: \"#7f7f7f\"\n            },\n            ColorRole.TERM_BRIGHT_RED: {\n                ColorMode.DARK: \"#ff0000\",\n                ColorMode.LIGHT: \"#ff0000\"\n            },\n            ColorRole.TERM_BRIGHT_GREEN: {\n                ColorMode.DARK: \"#00ff00\",\n                ColorMode.LIGHT: \"#00ff00\"\n            },\n            ColorRole.TERM_BRIGHT_YELLOW: {\n                ColorMode.DARK: \"#ffff00\",\n                ColorMode.LIGHT: \"#ffff00\"\n            },\n            ColorRole.TERM_BRIGHT_BLUE: {\n                ColorMode.DARK: \"#5c5cff\",\n                ColorMode.LIGHT: \"#5c5cff\"\n            },\n            ColorRole.TERM_BRIGHT_MAGENTA: {\n                ColorMode.DARK: \"#ff00ff\",\n                ColorMode.LIGHT: \"#ff00ff\"\n            },\n            ColorRole.TERM_BRIGHT_CYAN: {\n                ColorMode.DARK: \"#00ffff\",\n                ColorMode.LIGHT: \"#00ffff\"\n            },\n            ColorRole.TERM_BRIGHT_WHITE: {\n                ColorMode.DARK: \"#ffffff\",\n                ColorMode.LIGHT: \"#ffffff\"\n            }\n        }\n\n    def _initialize_highlights(self) -> None:\n        # Mapping from token type to colour\n        colour_mapping = {\n            TokenType.ADDRESS: ColorRole.SYNTAX_01,\n            TokenType.ANNOTATION: ColorRole.SYNTAX_08,\n            TokenType.ARGUMENT: ColorRole.SYNTAX_11,\n            TokenType.ATTRIBUTE: ColorRole.SYNTAX_08,\n            TokenType.BACKTICK: ColorRole.SYNTAX_12,\n            TokenType.BOOLEAN: ColorRole.SYNTAX_16,\n            TokenType.BOLD: ColorRole.SYNTAX_21,\n            TokenType.BOLD_END: ColorRole.SYNTAX_07,\n            TokenType.BOLD_START: ColorRole.SYNTAX_07,\n            TokenType.BLOCKQUOTE: ColorRole.SYNTAX_13,\n            TokenType.CHARACTER: ColorRole.SYNTAX_20,\n            TokenType.CODE: ColorRole. SYNTAX_02,\n            TokenType.COMMAND: ColorRole.SYNTAX_07,\n            TokenType.COMMENT: ColorRole.SYNTAX_03,\n            TokenType.CSS_AT_RULE: ColorRole.SYNTAX_04,\n            TokenType.DIMENSION: ColorRole.SYNTAX_16,\n            TokenType.DOC_COMMENT: ColorRole.SYNTAX_03,\n            TokenType.DOCTYPE: ColorRole.SYNTAX_05,\n            TokenType.DIRECTIVE: ColorRole.SYNTAX_18,\n            TokenType.ELEMENT: ColorRole.SYNTAX_06,\n            TokenType.ERROR: ColorRole.SYNTAX_ERROR,\n            TokenType.FENCE: ColorRole.SYNTAX_14,\n            TokenType.FENCE_END: ColorRole.SYNTAX_14,\n            TokenType.FENCE_START: ColorRole.SYNTAX_14,\n            TokenType.FUNCTION_OR_METHOD: ColorRole.SYNTAX_07,\n            TokenType.GENERIC_END: ColorRole.SYNTAX_17,\n            TokenType.GENERIC_START: ColorRole.SYNTAX_17,\n            TokenType.GENERIC_TYPE: ColorRole.SYNTAX_21,\n            TokenType.HASH: ColorRole.SYNTAX_11,\n            TokenType.HEADING: ColorRole.SYNTAX_08,\n            TokenType.HEX: ColorRole.SYNTAX_16,\n            TokenType.HORIZONTAL_RULE: ColorRole.SYNTAX_21,\n            TokenType.HTML_ATTRIBUTE: ColorRole.SYNTAX_09,\n            TokenType.HTML_TAG: ColorRole.SYNTAX_10,\n            TokenType.IDENTIFIER: ColorRole.SYNTAX_11,\n            TokenType.IMAGE_ALT_END: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_ALT_TEXT: ColorRole.SYNTAX_16,\n            TokenType.IMAGE_END: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_START: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_URL: ColorRole.SYNTAX_20,\n            TokenType.INLINE_CODE: ColorRole.SYNTAX_12,\n            TokenType.INLINE_CODE_END: ColorRole.SYNTAX_07,\n            TokenType.INLINE_CODE_START: ColorRole.SYNTAX_07,\n            TokenType.ITALIC: ColorRole.SYNTAX_09,\n            TokenType.ITALIC_END: ColorRole.SYNTAX_07,\n            TokenType.ITALIC_START: ColorRole.SYNTAX_07,\n            TokenType.JSON_KEY: ColorRole.SYNTAX_07,\n            TokenType.KEYWORD: ColorRole.SYNTAX_13,\n            TokenType.LANGUAGE: ColorRole.SYNTAX_14,\n            TokenType.LIFETIME: ColorRole.SYNTAX_17,\n            TokenType.LINK_END: ColorRole.SYNTAX_07,\n            TokenType.LINK_START: ColorRole.SYNTAX_07,\n            TokenType.LINK_TEXT: ColorRole.SYNTAX_16,\n            TokenType.LINK_TEXT_END: ColorRole.SYNTAX_07,\n            TokenType.LINK_URL: ColorRole.SYNTAX_20,\n            TokenType.LIST_MARKER: ColorRole.SYNTAX_15,\n            TokenType.LPAREN: ColorRole.SYNTAX_17,\n            TokenType.NUMBER: ColorRole.SYNTAX_16,\n            TokenType.OPERATOR: ColorRole.SYNTAX_17,\n            TokenType.OPTION: ColorRole.SYNTAX_10,\n            TokenType.OPTION_VALUE: ColorRole.SYNTAX_08,\n            TokenType.PREPROCESSOR: ColorRole.SYNTAX_05,\n            TokenType.REGEXP: ColorRole.SYNTAX_19,\n            TokenType.RPAREN: ColorRole.SYNTAX_17,\n            TokenType.RUNE: ColorRole.SYNTAX_20,\n            TokenType.STRING: ColorRole.SYNTAX_20,\n            TokenType.TABLE: ColorRole.SYNTAX_03,\n            TokenType.TEXT: ColorRole.SYNTAX_17,\n            TokenType.TYPE: ColorRole.SYNTAX_21,\n            TokenType.XML_DOC: ColorRole.SYNTAX_03\n        }\n\n        for token_type, role in colour_mapping.items():\n            text_format = self._create_highlight(role)\n            self._highlights[token_type] = text_format\n\n        self._error_highlight = self._create_highlight(ColorRole.SYNTAX_ERROR)\n\n    def _create_highlight(self, role: ColorRole) -> QTextCharFormat:\n        text_highlight = QTextCharFormat()\n        text_highlight.setFontFamilies(self._code_font_families)\n        text_highlight.setFontFixedPitch(True)\n        text_highlight.setForeground(QColor(self._colors[role][self._color_mode]))\n\n        return text_highlight\n\n    def _initialize_proportional_highlights(self) -> None:\n        # Mapping from token type to colour\n        colour_mapping = {\n            TokenType.BOLD: ColorRole.SYNTAX_21,\n            TokenType.BOLD_END: ColorRole.SYNTAX_07,\n            TokenType.BOLD_START: ColorRole.SYNTAX_07,\n            TokenType.BLOCKQUOTE: ColorRole.SYNTAX_13,\n            TokenType.FENCE: ColorRole.SYNTAX_14,\n            TokenType.HEADING: ColorRole.SYNTAX_08,\n            TokenType.IMAGE_ALT_END: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_ALT_TEXT: ColorRole.SYNTAX_16,\n            TokenType.IMAGE_END: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_START: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_URL: ColorRole.SYNTAX_20,\n            TokenType.INLINE_CODE_END: ColorRole.SYNTAX_07,\n            TokenType.INLINE_CODE_START: ColorRole.SYNTAX_07,\n            TokenType.ITALIC: ColorRole.SYNTAX_09,\n            TokenType.ITALIC_END: ColorRole.SYNTAX_07,\n            TokenType.ITALIC_START: ColorRole.SYNTAX_07,\n            TokenType.LINK_END: ColorRole.SYNTAX_07,\n            TokenType.LINK_START: ColorRole.SYNTAX_07,\n            TokenType.LINK_TEXT: ColorRole.SYNTAX_16,\n            TokenType.LINK_TEXT_END: ColorRole.SYNTAX_07,\n            TokenType.LINK_URL: ColorRole.SYNTAX_20,\n            TokenType.LIST_MARKER: ColorRole.SYNTAX_15,\n            TokenType.TABLE: ColorRole.SYNTAX_03,\n            TokenType.TEXT: ColorRole.SYNTAX_17\n        }\n\n        for token_type, role in colour_mapping.items():\n            text_format = self._create_proportional_highlight(role)\n            self._proportional_highlights[token_type] = text_format\n\n        self._proportional_highlights[TokenType.INLINE_CODE] = self._create_highlight(ColorRole.SYNTAX_12)\n        self._error_proportional_highlight = self._create_proportional_highlight(ColorRole.SYNTAX_ERROR)\n\n    def _create_proportional_highlight(self, role: ColorRole) -> QTextCharFormat:\n        text_highlight = QTextCharFormat()\n        text_highlight.setForeground(QColor(self._colors[role][self._color_mode]))\n\n        return text_highlight\n\n    def _create_app_icon_svg(self, bg_color: str, text_color: str) -> str:\n        \"\"\"\n        Create an application icon SVG with specified colors.\n\n        Args:\n            bg_color: Background color in hex format\n            text_color: Text color in hex format\n\n        Returns:\n            str: SVG markup for the application icon\n        \"\"\"\n        return f'''\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"128\" height=\"128\" viewBox=\"0 0 384 384\">\n                <rect x=\"0\" y=\"0\" width=\"384\" height=\"384\" fill=\"{bg_color}\"/>\n                <g fill=\"{text_color}\">\n                    <g transform=\"translate(38.400004, 250.960113)\">\n                        <path d=\"M 97.234375 0\n                            L 92.125 -64.078125\n                            L 91.46875 -64.078125\n                            L 69.328125-0.65625\n                            L 54.640625 -0.65625\n                            L 32.5 -64.078125\n                            L 31.84375 -64.078125\n                            L 26.734375 0\n                            L 2.09375 0\n                            L 11.796875 -108.109375\n                            L 38 -108.109375\n                            L 61.984375 -45.734375\n                            L 85.96875 -108.109375\n                            L 112.171875 -108.109375\n                            L 121.875 0\n                            Z\"/>\n                    </g>\n                    <g transform=\"translate(162.225522, 250.960113)\">\n                        <path d=\"M 76 -108.109375\n                            L 44.15625 -71.03125\n                            C 46 -72.070312 48.578125 -72.59375 51.890625 -72.59375\n                            C 55.734375 -72.59375 59.617188 -71.785156 63.546875 -70.171875\n                            C 67.484375 -68.554688 71.175781 -66.238281 74.625 -63.21875\n                            C 78.082031 -60.207031 80.898438 -56.210938 83.078125 -51.234375\n                            C 85.265625 -46.253906 86.359375 -40.753906 86.359375 -34.734375\n                            C 86.359375 -28.609375 85.203125 -23.125 82.890625 -18.28125\n                            C 80.578125 -13.4375 77.472656 -9.59375 73.578125 -6.75\n                            C 69.691406 -3.90625 65.429688 -1.738281 60.796875 -0.25\n                            C 56.171875 1.226562 51.328125 1.96875 46.265625 1.96875\n                            C 34.117188 1.96875 23.894531 -1.566406 15.59375 -8.640625\n                            C 7.289062 -15.722656 3.140625 -24.421875 3.140625 -34.734375\n                            C 3.140625 -43.460938 4.363281 -50.644531 6.8125 -56.28125\n                            C 9.257812 -61.914062 13.71875 -69.101562 20.1875 -77.84375\n                            L 45.609375 -108.109375\n                            Z\n                            M 28.703125 -34.734375\n                            C 28.703125 -30.015625 30.226562 -26.101562 33.28125 -23\n                            C 36.34375 -19.894531 40.273438 -18.34375 45.078125 -18.34375\n                            C 49.878906 -18.34375 53.851562 -19.894531 57 -23\n                            C 60.144531 -26.101562 61.71875 -30.015625 61.71875 -34.734375\n                            C 61.71875 -39.535156 60.125 -43.53125 56.9375 -46.71875\n                            C 53.75 -49.90625 49.796875 -51.5 45.078125 -51.5\n                            C 40.535156 -51.5 36.671875 -49.90625 33.484375 -46.71875\n                            C 30.296875 -43.53125 28.703125 -39.535156 28.703125 -34.734375\n                            Z\"/>\n                    </g>\n                    <g transform=\"translate(249.066902, 250.960113)\">\n                        <path d=\"M 7.859375 -108.109375\n                            L 46.515625 -108.109375\n                            C 56.910156 -108.109375 65.382812 -105.332031 71.9375 -99.78125\n                            C 78.488281 -94.238281 81.765625 -86.3125 81.765625 -76\n                            C 81.765625 -68.050781 79.773438 -61.390625 75.796875 -56.015625\n                            C 71.828125 -50.648438 66.4375 -46.875 59.625 -44.6875\n                            L 96.84375 0\n                            L 65.515625 0\n                            L 32.5 -42.71875\n                            L 32.5 0\n                            L 7.859375 0\n                            Z\n                            M 32.5 -60.15625\n                            L 35.375 -60.15625\n                            C 37.65625 -60.15625 39.578125 -60.195312 41.140625 -60.28125\n                            C 42.710938 -60.363281 44.503906 -60.664062 46.515625 -61.1875\n                            C 48.523438 -61.71875 50.140625 -62.460938 51.359375 -63.421875\n                            C 52.585938 -64.390625 53.640625 -65.789062 54.515625 -67.625\n                            C 55.390625 -69.457031 55.828125 -71.679688 55.828125 -74.296875\n                            C 55.828125 -76.921875 55.390625 -79.148438 54.515625 -80.984375\n                            C 53.640625 -82.816406 52.585938 -84.210938 51.359375 -85.171875\n                            C 50.140625 -86.140625 48.523438 -86.882812 46.515625 -87.40625\n                            C 44.503906 -87.925781 42.710938 -88.226562 41.140625 -88.3125\n                            C 39.578125 -88.40625 37.65625 -88.453125 35.375 -88.453125\n                            L 32.5 -88.453125\n                            Z\"/>\n                    </g>\n                </g>\n            </svg>\n        '''\n\n    def _write_icon(self, name: str, svg_data: str) -> None:\n        icon_dir = os.path.expanduser(\"~/.humbug/icons\")\n        with open(os.path.join(icon_dir, name), 'w', encoding='utf-8') as f:\n            f.write(svg_data)\n\n    def _create_active_inactive_theme_icons(self, active: bool, suffix: str, color: str) -> None:\n        prefix = \"\" if active else \"inactive-\"\n\n        # Close button - visible version\n        self._write_icon(f'{prefix}close-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                    d=\"M16,16 L48,48 M48,16 L16,48\"/>\n            </svg>\n        ''')\n\n        # Conversation tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}conversation-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M8 10H8.01\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M12 10H12.01\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M16 10H16.01\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M21 13V7C21 5.11438 21 4.17157 20.4142 3.58579C19.8284 3 18.8856 3 17 3H7C5.11438 3\n                    4.17157 3 3.58579 3.58579C3 4.17157 3 5.11438 3 7V13C3 14.8856 3 15.8284 3.58579 16.4142C4.17157\n                    17 5.11438 17 7 17H7.5C7.77614 17 8 17.2239 8 17.5V20V20.1499C8 20.5037 8.40137 20.7081\n                    8.6875 20.5L13.0956 17.2941C13.3584 17.103 13.675 17 14 17H17C18.8856 17 19.8284 17 20.4142\n                    16.4142C21 15.8284 21 14.8856 21 13Z\" stroke=\"{color}\" stroke-width=\"2\" stroke-linejoin=\"round\"/>\n            </svg>\n        ''')\n\n        # Editor tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}editor-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M13 21H21\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M20.0651 7.39423L7.09967 20.4114C6.72438 20.7882 6.21446 21 5.68265 21H4.00383C3.44943\n                    21 3 20.5466 3 19.9922V18.2987C3 17.7696 3.20962 17.2621 3.58297 16.8873L16.5517 3.86681C19.5632\n                    1.34721 22.5747 4.87462 20.0651 7.39423Z\" stroke=\"{color}\" stroke-width=\"2\"\n                    stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M15.3097 5.30981L18.7274 8.72755\" stroke=\"{color}\" stroke-width=\"2\"\n                    stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n            </svg>\n        ''')\n\n        # Log tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}log-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M5 12H7.75044C7.89947 12 8.03179 11.9046 8.07892 11.7632V11.7632L9.875 6.375V6.375C9.91626\n                    6.25122 10.0918 6.25238 10.1364 6.375V6.375L13.875 16.6562L13.885 16.6837C13.9253 16.7946 14.0812\n                    16.797 14.125 16.6875V16.6875L15.8841 12.2898V12.2898C15.9541 12.1148 16.1236 12 16.3122 12H19\"\n                    stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n            </svg>\n        ''')\n\n        # Shell tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}shell-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M3 7C3 5.11438 3 4.17157 3.58579 3.58579C4.17157 3 5.11438 3 7 3H12H17C18.8856 3 19.8284\n                    3 20.4142 3.58579C21 4.17157 21 5.11438 21 7V10V13C21 14.8856 21 15.8284 20.4142 16.4142C19.8284\n                    17 18.8856 17 17 17H12H7C5.11438 17 4.17157 17 3.58579 16.4142C3 15.8284 3 14.8856 3 13V10V7Z\"\n                    stroke=\"{color}\" stroke-width=\"2\" stroke-linejoin=\"round\"/>\n                <path d=\"M7 21H17\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M12 17V21\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n            </svg>\n        ''')\n\n        # Terminal tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}terminal-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M13 15H16\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n                <path d=\"M8 15L10.5 12.5V12.5C10.7761 12.2239 10.7761 11.7761 10.5 11.5V11.5L8 9\"\n                    stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M3 8C3 6.11438 3 5.17157 3.58579 4.58579C4.17157 4 5.11438 4 7 4H12H17C18.8856 4\n                    19.8284 4 20.4142 4.58579C21 5.17157 21 6.11438 21 8V12V16C21 17.8856 21 18.8284 20.4142\n                    19.4142C19.8284 20 18.8856 20 17 20H12H7C5.11438 20 4.17157 20 3.58579 19.4142C3 18.8284\n                    3 17.8856 3 16V12V8Z\" stroke=\"{color}\" stroke-width=\"2\" stroke-linejoin=\"round\"/>\n            </svg>\n        ''')\n\n        # Wiki tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}wiki-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M17.8284 6.82843C18.4065 7.40649 18.6955 7.69552 18.8478 8.06306C19 8.4306 19 8.83935\n                    19 9.65685L19 17C19 18.8856 19 19.8284 18.4142 20.4142C17.8284 21 16.8856 21 15 21H9C7.11438\n                    21 6.17157 21 5.58579 20.4142C5 19.8284 5 18.8856 5 17L5 7C5 5.11438 5 4.17157 5.58579\n                    3.58579C6.17157 3 7.11438 3 9 3H12.3431C13.1606 3 13.5694 3 13.9369 3.15224C14.3045 3.30448\n                    14.5935 3.59351 15.1716 4.17157L17.8284 6.82843Z\" stroke=\"{color}\"\n                    stroke-width=\"2\" stroke-linejoin=\"round\"/>\n                <path d=\"M9 6L11 6\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M10 9L12 9\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M9 12L11 12\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M10 15L12 15\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n            </svg>\n        ''')\n\n    def _create_theme_icons(self) -> None:\n        \"\"\"Create theme-specific icons in the user's .humbug directory.\"\"\"\n        icon_dir = os.path.expanduser(\"~/.humbug/icons\")\n        os.makedirs(icon_dir, exist_ok=True)\n\n        # Create collapsed and expanded arrows for both themes\n        for mode in ColorMode:\n            color = self._colors[ColorRole.TEXT_PRIMARY][mode]\n            inactive_color = self._colors[ColorRole.TEXT_INACTIVE][mode]\n            suffix = mode.name.lower()\n\n            # Right-pointing arrow\n            self._write_icon(f'arrow-right-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M24,16 L40,32 L24,48\"/>\n                </svg>\n            ''')\n\n            # Left-pointing arrow\n            self._write_icon(f'arrow-left-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M40,16 L24,32 L40,48\"/>\n                </svg>\n            ''')\n\n            # Up-pointing arrow\n            self._write_icon(f'arrow-up-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M16,40 L32,24 L48,40\"/>\n                </svg>\n            ''')\n\n            # Down-pointing arrow\n            self._write_icon(f'arrow-down-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M16,24 L32,40 L48,24\"/>\n                </svg>\n            ''')\n\n            # Close button - visible version\n            self._write_icon(f'close-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M16,16 L48,48 M48,16 L16,48\"/>\n                </svg>\n            ''')\n\n            # Checkbox check mark\n            self._write_icon(f'check-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M16,32 L28,44 L48,20\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                </svg>\n            ''')\n\n            # Right-pointing expand\n            self._write_icon(f'expand-right-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M20,8 L44,32 L20,56\"/>\n                </svg>\n            ''')\n\n            # Left-pointing expand\n            self._write_icon(f'expand-left-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M44,8 L20,32 L44,56\"/>\n                </svg>\n            ''')\n\n            # Down-pointing expand\n            self._write_icon(f'expand-down-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M8,20 L32,44 L56,20\"/>\n                </svg>\n            ''')\n\n            # Bulb on icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n            self._write_icon(f'info-{suffix}.svg', f'''\n                <svg width=\"800px\" height=\"800px\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path d=\"M12 7C9.23858 7 7 9.23858 7 12C7 13.3613 7.54402 14.5955 8.42651 15.4972C8.77025 15.8484 9.05281 16.2663\n                        9.14923 16.7482L9.67833 19.3924C9.86537 20.3272 10.6862 21 11.6395 21H12.3605C13.3138 21 14.1346 20.3272\n                        14.3217 19.3924L14.8508 16.7482C14.9472 16.2663 15.2297 15.8484 15.5735 15.4972C16.456 14.5955 17\n                        13.3613 17 12C17 9.23858 14.7614 7 12 7Z\" stroke=\"{color}\" stroke-width=\"2\"/>\n                    <path d=\"M12 4V3\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M18 6L19 5\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M20 12H21\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M4 12H3\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M5 5L6 6\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M10 17H14\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                </svg>\n            ''')\n\n            # Alert triangle icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n            self._write_icon(f'warning-{suffix}.svg', f'''\n                <svg width=\"800px\" height=\"800px\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path d=\"M12 10V13\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n                    <path d=\"M12 16V15.9888\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n                    <path d=\"M10.2518 5.147L3.6508 17.0287C2.91021 18.3618 3.87415 20 5.39912 20H18.6011C20.126 20 21.09\n                        18.3618 20.3494 17.0287L13.7484 5.147C12.9864 3.77538 11.0138 3.77538 10.2518 5.147Z\"\n                        stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                </svg>\n            ''')\n\n            # Alert hexagon icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n            self._write_icon(f'critical-{suffix}.svg', f'''\n                <svg width=\"800px\" height=\"800px\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path d=\"M3 9.22843V14.7716C3 15.302 3.21071 15.8107 3.58579 16.1858L7.81421 20.4142C8.18929 20.7893 8.69799\n                        21 9.22843 21H14.7716C15.302 21 15.8107 20.7893 16.1858 20.4142L20.4142 16.1858C20.7893 15.8107 21\n                        15.302 21 14.7716V9.22843C21 8.69799 20.7893 8.18929 20.4142 7.81421L16.1858 3.58579C15.8107 3.21071\n                        15.302 3 14.7716 3H9.22843C8.69799 3 8.18929 3.21071 7.81421 3.58579L3.58579 7.81421C3.21071 8.18929\n                        3 8.69799 3 9.22843Z\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M12 8V13\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n                    <path d=\"M12 16V15.9888\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n                </svg>\n            ''')\n\n            # Help circle icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n            self._write_icon(f'question-{suffix}.svg', f'''\n                <svg width=\"800px\" height=\"800px\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path d=\"M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12\n                        3C16.9706 3 21 7.02944 21 12Z\" stroke=\"{color}\" stroke-width=\"2\"/>\n                    <path d=\"M10.5 8.67709C10.8665 8.26188 11.4027 8 12 8C13.1046 8 14 8.89543 14 10C14 10.9337\n                        13.3601 11.718 12.4949 11.9383C12.2273 12.0064 12 12.2239 12 12.5V12.5V13\"\n                        stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M12 16H12.01\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'save-{suffix}.svg', f'''\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M8,40, L8,56 L56,56 L56,40\"/>\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M32,8, L32,40\"/>\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M20,28, L32,40, L44,28\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'copy-{suffix}.svg', f'''\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <rect x=\"22\" y=\"10\" width=\"32\" height=\"32\" stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"/>\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M22,22, L10,22 L10,54 L42,54 L42,42\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'fork-{suffix}.svg', f'''\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M32,8 L32,32 M32,32 L8,56 L8,40 M8,56 L24,56 M32,32 L56,56 L56,40 M56,56 L40,56\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'delete-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M12.5,20 L12.5,56 L51.5,56 L51.5,20 M4,20 L60,20 M18,20 L24,8 L40,8 L46,20\"/>\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M25.5,28 L25.5,46 M38.5,28 L38.5,46\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'edit-{suffix}.svg', f'''\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M8,56 L56,56 M40,12 L52,24 L24,52 L8,56 L12,40 L40,12 Z\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'submit-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M8,32 L32,8 L56,32\"/>\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M32,56 L32,8\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'stop-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <circle cx=\"32\" cy=\"32\" r=\"28\" fill=\"none\" stroke=\"{color}\" stroke-width=\"6\"/>\n                    <rect x=\"20\" y=\"20\" width=\"24\" height=\"24\" fill=\"{color}\" stroke=\"none\"/>\n                </svg>\n            ''')\n\n            self._create_active_inactive_theme_icons(True, suffix, color)\n            self._create_active_inactive_theme_icons(False, suffix, inactive_color)\n\n        # Create the standard application icon for about dialog\n        self._write_icon('app-icon.svg', self._create_app_icon_svg('#4040c0', '#ffffff'))\n\n        # Create light mode disabled version\n        self._write_icon('app-icon-disabled-light.svg', self._create_app_icon_svg('#c0c0c0', '#e0e0e0'))\n\n        # Create dark mode disabled version\n        self._write_icon('app-icon-disabled-dark.svg', self._create_app_icon_svg('#202020', '#404040'))\n\n    def get_icon_path(self, name: str) -> str:\n        \"\"\"\n        Get the path to a theme-appropriate icon.\n\n        Args:\n            name: Base name of the icon (without theme suffix or extension)\n\n        Returns:\n            Full path to the icon file\n        \"\"\"\n        icon_dir = os.path.expanduser(\"~/.humbug/icons\")\n        theme = \"dark\" if self._color_mode == ColorMode.DARK else \"light\"\n        return Path(os.path.join(icon_dir, f\"{name}-{theme}.svg\")).as_posix()\n\n    def scale_icon(self, icon_path: str, target_size: int) -> QPixmap:\n        \"\"\"\n        Load and scale an icon to the appropriate size.\n\n        Args:\n            icon_path: Path to the icon file\n            target_size: Desired size in pixels\n\n        Returns:\n            Scaled QPixmap of the icon\n        \"\"\"\n        pixmap = QPixmap(icon_path)\n        scaled_size = int(target_size * self._zoom_factor)\n        return pixmap.scaled(\n            scaled_size,\n            scaled_size,\n            Qt.AspectRatioMode.KeepAspectRatio,\n            Qt.TransformationMode.SmoothTransformation\n        )\n\n    def get_color(self, role: ColorRole) -> QColor:\n        \"\"\"\n        Get a color for a specific role.\n\n        Args:\n            role: The ColorRole to look up\n\n        Returns:\n            QColor: The color for the specified role\n\n        Raises:\n            KeyError: If no color is defined for the role\n        \"\"\"\n        return QColor(self._colors[role][self._color_mode])\n\n    def get_color_str(self, role: ColorRole) -> str:\n        \"\"\"\n        Get a color string for a specific role.\n\n        Args:\n            role: The ColorRole to look up\n\n        Returns:\n            str: The color string (hex format) for the specified role\n\n        Raises:\n            KeyError: If no color is defined for the role\n        \"\"\"\n        return self._colors[role][self._color_mode]\n\n    def get_highlight(self, token_type: TokenType) -> QTextCharFormat:\n        \"\"\"\n        Get the highlight format for a specific token type.\n\n        Args:\n            token_type: The TokenType to look up\n\n        Returns:\n            QTextCharFormat: The highlight format for the specified token type\n        \"\"\"\n        if token_type not in self._highlights:\n            print(f\"token type {token_type} not mapped\")\n\n        return self._highlights.get(token_type, self._error_highlight)\n\n    def get_proportional_highlight(self, token_type: TokenType) -> QTextCharFormat:\n        \"\"\"\n        Get the proportionally-spaced highlight format for a specific token type.\n\n        Args:\n            token_type: The TokenType to look up\n\n        Returns:\n            QTextCharFormat: The highlight format for the specified token type\n        \"\"\"\n        if token_type not in self._proportional_highlights:\n            print(f\"token type {token_type} not mapped\")\n\n        return self._proportional_highlights.get(token_type, self._error_proportional_highlight)\n\n    def _determine_base_font_size(self) -> float:\n        \"\"\"\n        Determine the default system font size based on the operating system.\n\n        Returns:\n            int: Base font size in points.\n        \"\"\"\n        # Get current OS\n        os_type = QOperatingSystemVersion.current()\n\n        # Get system default font\n        system_font = QFontDatabase.systemFont(QFontDatabase.SystemFont.GeneralFont)\n        system_size = system_font.pointSizeF()\n\n        # Apply OS-specific adjustments if system detection fails\n        if system_size > 0:\n            return system_size\n\n        if os_type.type() == QOperatingSystemVersion.OSType.MacOS:  # type: ignore\n            # macOS typically uses 13pt as default\n            return 13\n\n        if os_type.type() == QOperatingSystemVersion.OSType.Windows:  # type: ignore\n            # Windows typically uses 9pt as default\n            return 9\n\n        # Linux typically uses 10pt as default\n        return 10\n\n    def base_font_size(self) -> float:\n        \"\"\"Get the base font size for the current system.\"\"\"\n        return self._user_font_size or self._base_font_size\n\n    def set_user_font_size(self, size: float | None) -> None:\n        \"\"\"Set user-specific font size override.\"\"\"\n        if size != self._user_font_size:\n            self._user_font_size = size\n\n            if size:\n                self.style_changed.emit()\n\n    def color_mode(self) -> ColorMode:\n        \"\"\"Get the current color mode.\"\"\"\n        return self._color_mode\n\n    def set_color_mode(self, mode: ColorMode) -> None:\n        \"\"\"\n        Set the color mode and update application styles.\n\n        Args:\n            mode: The ColorMode to switch to\n        \"\"\"\n        if mode != self._color_mode:\n            self._color_mode = mode\n            self._initialize_highlights()\n            self._initialize_proportional_highlights()\n            self.style_changed.emit()\n\n    def zoom_factor(self) -> float:\n        \"\"\"Current zoom scaling factor.\"\"\"\n        return self._zoom_factor\n\n    def set_zoom(self, factor: float) -> None:\n        \"\"\"\n        Set new zoom factor and update application styles.\n\n        Args:\n            factor: New zoom factor to apply (clamped between 0.5 and 2.0)\n        \"\"\"\n        new_factor = max(0.5, min(2.0, factor))\n        if new_factor != self._zoom_factor:\n            self._zoom_factor = new_factor\n            self.style_changed.emit()\n\n    def get_space_width(self) -> float:\n        \"\"\"Get the width of a space character\"\"\"\n        font = QFont(self._code_font_families)\n        font.setPointSizeF(self.base_font_size() * self._zoom_factor)\n        font_metrics = QFontMetricsF(font)\n        space_width = font_metrics.horizontalAdvance('        ') / 8\n        return space_width\n\n    def monospace_font_families(self) -> List[str]:\n        \"\"\"Get the standard monospace font family fallback sequence.\"\"\"\n        return self._code_font_families\n\n    def message_bubble_spacing(self) -> float:\n        \"\"\"Get the number of pixels to use in message bubble spacing.\"\"\"\n        return 8.0\n\n    def get_dialog_stylesheet(self) -> str:\n        \"\"\"\n        Get a complete stylesheet for dialog windows.\n\n        Returns:\n            A stylesheet string with styling for all common dialog components\n        \"\"\"\n        zoom_factor = self.zoom_factor()\n        base_font_size = self.base_font_size()\n\n        return f\"\"\"\n            QDialog {{\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\n                font-size: {base_font_size * zoom_factor}pt;\n            }}\n\n            QScrollArea {{\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\n                border: none;\n            }}\n\n            QScrollArea > QWidget > QWidget {{\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\n                border: none;\n            }}\n\n            /* Labels */\n            QLabel {{\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\n                border: none;\n                border-radius: 4px;\n                padding: 0px;\n                margin: 0px;\n                font-size: {base_font_size * zoom_factor}pt;\n            }}\n\n            /* Text inputs */\n            QLineEdit {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border: none;\n                border-radius: 4px;\n                padding: 4px;\n                font-size: {int(base_font_size * zoom_factor)}pt;\n            }}\n            QLineEdit:disabled {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n\n            /* Checkboxes */\n            QCheckBox {{\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border: none;\n                border-radius: 4px;\n                padding: 0px;\n                margin: 0px;\n            }}\n            QCheckBox::indicator {{\n                width: {int(18 * zoom_factor)}px;\n                height: {int(18 * zoom_factor)}px;\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\n            }}\n            QCheckBox::indicator:disabled {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\n            }}\n            QCheckBox::indicator:checked {{\n                image: url({self.get_icon_path('check')});\n            }}\n            QCheckBox:disabled {{\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n\n            /* Combo boxes */\n            QComboBox {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border: none;\n                border-radius: 4px;\n                padding: 6px;\n                margin: 0px;\n                font-size: {int(base_font_size * zoom_factor)}pt;\n            }}\n            QComboBox:disabled {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n            QComboBox::drop-down {{\n                border: none;\n                width: 20px;\n            }}\n            QComboBox::down-arrow {{\n                image: url({self.get_icon_path(\"arrow-down\")});\n                width: 12px;\n                height: 12px;\n            }}\n            QComboBox::down-arrow:on {{\n                image: url({self.get_icon_path('arrow-up')});\n                width: 12px;\n                height: 12px;\n            }}\n            QComboBox::down-arrow:disabled {{\n                image: none;\n            }}\n            QComboBox QAbstractItemView::item:selected {{\n                border: none;\n                background-color: {self.get_color_str(ColorRole.TEXT_SELECTED)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n            }}\n            QComboBox QListView {{\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_SECONDARY)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n            }}\n\n            /* Spin boxes */\n            QSpinBox, QDoubleSpinBox {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border: none;\n                border-radius: 4px;\n                padding: 4px;\n                font-size: {base_font_size * zoom_factor}pt;\n            }}\n            QSpinBox:disabled, QDoubleSpinBox:disabled {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n            QSpinBox::up-button, QSpinBox::down-button,\n            QDoubleSpinBox::up-button, QDoubleSpinBox::down-button {{\n                border: none;\n                width: 20px;\n            }}\n            QSpinBox::up-arrow, QDoubleSpinBox::up-arrow {{\n                image: url({self.get_icon_path('arrow-up')});\n                width: 12px;\n                height: 12px;\n            }}\n            QSpinBox::up-arrow:disabled, QSpinBox::up-arrow:off,\n            QDoubleSpinBox::up-arrow:disabled, QDoubleSpinBox::up-arrow:off {{\n                image: none;\n            }}\n            QSpinBox::down-arrow, QDoubleSpinBox::down-arrow {{\n                image: url({self.get_icon_path('arrow-down')});\n                width: 12px;\n                height: 12px;\n            }}\n            QSpinBox::down-arrow:disabled, QSpinBox::down-arrow:off,\n            QDoubleSpinBox::down-arrow:disabled, QDoubleSpinBox::down-arrow:off {{\n                image: none;\n            }}\n\n            /* Buttons */\n            QPushButton {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border: none;\n                border-radius: 4px;\n                padding: 4px;\n                font-size: {base_font_size * zoom_factor}pt;\n            }}\n            QPushButton:hover {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_HOVER)};\n            }}\n            QPushButton:pressed {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_PRESSED)};\n            }}\n            QPushButton:disabled {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n\n            /* Recommended (primary) buttons */\n            QPushButton[recommended=\"true\"] {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_RECOMMENDED)};\n                color: {self.get_color_str(ColorRole.TEXT_RECOMMENDED)};\n            }}\n            QPushButton[recommended=\"true\"]:hover {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_RECOMMENDED_HOVER)};\n            }}\n            QPushButton[recommended=\"true\"]:pressed {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_RECOMMENDED_PRESSED)};\n            }}\n            QPushButton[recommended=\"false\"] {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE)};\n                color: {self.get_color_str(ColorRole.TEXT_RECOMMENDED)};\n            }}\n            QPushButton[recommended=\"false\"]:hover {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_HOVER)};\n            }}\n            QPushButton[recommended=\"false\"]:pressed {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_PRESSED)};\n            }}\n\n            QScrollBar:vertical {{\n                background-color: {self.get_color_str(ColorRole.SCROLLBAR_BACKGROUND)};\n                width: 12px;\n            }}\n            QScrollBar::handle:vertical {{\n                background-color: {self.get_color_str(ColorRole.SCROLLBAR_HANDLE)};\n                min-height: 20px;\n            }}\n            QScrollBar::add-page:vertical, QScrollBar::sub-page:vertical {{\n                background: none;\n            }}\n            QScrollBar::add-line:vertical, QScrollBar::sub-line:vertical {{\n                height: 0px;\n            }}\n        \"\"\"\n",
          "error": null
        }
      ]
    },
    {
      "id": "b11a0748-8ad5-48b1-930b-a4d2701feebd",
      "timestamp": "2025-08-29T19:53:08.283458+00:00",
      "type": "ai_response",
      "content": "I need to find where the colors are defined in the StyleManager to add the CANARY_BACKGROUND color. Let me add it to the `_initialize_colors` method:",
      "completed": true,
      "usage": {
        "prompt_tokens": 49646,
        "completion_tokens": 20471,
        "total_tokens": 70117
      },
      "model": "claude-sonnet-4-20250514",
      "reasoning_capability": 1,
      "temperature": 0.7,
      "tool_calls": [
        {
          "id": "toolu_01H3T6ff5D55G96x77A1L9bX",
          "name": "filesystem",
          "arguments": {
            "operation": "write_file",
            "path": "src/humbug/style_manager.py",
            "content": "\"\"\"Style manager for handling application-wide style and zoom settings.\n\nImplements a singleton pattern to maintain consistent styling across components.\nProvides signals for style changes and utilities for scaled size calculations.\n\"\"\"\n\nfrom enum import Enum, auto\nimport os\nfrom pathlib import Path\nfrom typing import Dict, List\n\nfrom PySide6.QtCore import QObject, Signal, QOperatingSystemVersion, Qt\nfrom PySide6.QtGui import QTextCharFormat, QFontDatabase, QColor, QFontMetricsF, QFont, QPixmap\n\nfrom syntax import TokenType\n\nfrom humbug.color_role import ColorRole\n\n\nclass ColorMode(Enum):\n    \"\"\"Enumeration for color theme modes.\"\"\"\n    LIGHT = auto()\n    DARK = auto()\n\n\nclass StyleManager(QObject):\n    \"\"\"\n    Singleton manager for application-wide style settings.\n\n    Handles zoom factor management and style updates across the application.\n    Emits signals when zoom level changes to notify dependent components.\n\n    Attributes:\n        style_changed (Signal): Emitted when style changes, passing new zoom factor\n        _instance (StyleManager): Singleton instance\n        _zoom_factor (float): Current zoom scaling factor\n        _initialized (bool): Tracks initialization state of QObject base\n    \"\"\"\n\n    style_changed = Signal()\n    _instance = None\n\n    def __new__(cls) -> 'StyleManager':\n        \"\"\"Create or return singleton instance.\"\"\"\n        if cls._instance is None:\n            cls._instance = super(StyleManager, cls).__new__(cls)\n\n        return cls._instance\n\n    def __init__(self) -> None:\n        \"\"\"Initialize QObject base class if not already done.\"\"\"\n        if not hasattr(self, '_initialized'):\n            super().__init__()\n            self._zoom_factor = 1.0\n            self._base_font_size = self._determine_base_font_size()\n            self._user_font_size: float | None = None\n            self._initialized = True\n            self._color_mode = ColorMode.DARK  # Default to dark mode\n            self._colors: Dict[ColorRole, Dict[ColorMode, str]] = self._initialize_colors()\n            self._highlights: Dict[TokenType, QTextCharFormat] = {}\n            self._proportional_highlights: Dict[TokenType, QTextCharFormat] = {}\n\n            self._code_font_families = [\"Menlo\", \"Consolas\", \"Monaco\", \"monospace\"]\n            self._initialize_highlights()\n            self._initialize_proportional_highlights()\n            self._create_theme_icons()\n\n    def _initialize_colors(self) -> Dict[ColorRole, Dict[ColorMode, str]]:\n        \"\"\"Initialize the application colours for both light and dark modes.\"\"\"\n        return {\n            # Background colours\n            ColorRole.BACKGROUND_PRIMARY: {\n                ColorMode.DARK: \"#080808\",\n                ColorMode.LIGHT: \"#e0e0e0\"\n            },\n            ColorRole.BACKGROUND_SECONDARY: {\n                ColorMode.DARK: \"#141414\",\n                ColorMode.LIGHT: \"#ececec\"\n            },\n            ColorRole.BACKGROUND_TERTIARY: {\n                ColorMode.DARK: \"#242424\",\n                ColorMode.LIGHT: \"#fcfcfc\"\n            },\n            ColorRole.BACKGROUND_DIALOG: {\n                ColorMode.DARK: \"#282828\",\n                ColorMode.LIGHT: \"#d0d0d0\"\n            },\n\n            # Text colours\n            ColorRole.TEXT_PRIMARY: {\n                ColorMode.DARK: \"#d8d8d8\",\n                ColorMode.LIGHT: \"#202020\"\n            },\n            ColorRole.TEXT_BRIGHT: {\n                ColorMode.DARK: \"#ffffff\",\n                ColorMode.LIGHT: \"#000000\"\n            },\n            ColorRole.TEXT_HEADING: {\n                ColorMode.DARK: \"#ffe0a0\",\n                ColorMode.LIGHT: \"#204080\"\n            },\n            ColorRole.TEXT_HEADING_BRIGHT: {\n                ColorMode.DARK: \"#ffe8a0\",\n                ColorMode.LIGHT: \"#203880\"\n            },\n            ColorRole.TEXT_DISABLED: {\n                ColorMode.DARK: \"#707070\",\n                ColorMode.LIGHT: \"#909090\"\n            },\n            ColorRole.TEXT_SELECTED: {\n                ColorMode.DARK: \"#404058\",\n                ColorMode.LIGHT: \"#c8c8dc\"\n            },\n            ColorRole.TEXT_FOUND: {\n                ColorMode.DARK: \"#885050\",\n                ColorMode.LIGHT: \"#e0b4b4\"\n            },\n            ColorRole.TEXT_FOUND_DIM: {\n                ColorMode.DARK: \"#583838\",\n                ColorMode.LIGHT: \"#f4d8d8\"\n            },\n            ColorRole.TEXT_RECOMMENDED: {\n                ColorMode.DARK: \"#ffffff\",\n                ColorMode.LIGHT: \"#ffffff\"\n            },\n            ColorRole.TEXT_LINK: {\n                ColorMode.DARK: \"#80a0ff\",\n                ColorMode.LIGHT: \"#0000ff\"\n            },\n            ColorRole.TEXT_INACTIVE: {\n                ColorMode.DARK: \"#909090\",\n                ColorMode.LIGHT: \"#707070\"\n            },\n            ColorRole.TEXT_EPHEMERAL: {\n                ColorMode.DARK: \"#e0a080\",\n                ColorMode.LIGHT: \"#a0785c\"\n            },\n            ColorRole.TEXT_EPHEMERAL_INACTIVE: {\n                ColorMode.DARK: \"#a06040\",\n                ColorMode.LIGHT: \"#c09070\"\n            },\n            ColorRole.TEXT_ERROR: {\n                ColorMode.DARK: \"#e03020\",\n                ColorMode.LIGHT: \"#f04030\"\n            },\n            ColorRole.TEXT_ERROR_INACTIVE: {\n                ColorMode.DARK: \"#e06050\",\n                ColorMode.LIGHT: \"#f07060\"\n            },\n\n            # Edit box colours\n            ColorRole.EDIT_BOX_BORDER: {\n                ColorMode.DARK: \"#6060c0\",\n                ColorMode.LIGHT: \"#404080\"\n            },\n            ColorRole.EDIT_BOX_BACKGROUND: {\n                ColorMode.DARK: \"#242454\",\n                ColorMode.LIGHT: \"#b8b8f8\"\n            },\n            ColorRole.EDIT_BOX_ERROR: {\n                ColorMode.DARK: \"#c03020\",\n                ColorMode.LIGHT: \"#d04030\"\n            },\n\n            # Tab colours\n            ColorRole.TAB_BAR_BACKGROUND: {\n                ColorMode.DARK: \"#000000\",\n                ColorMode.LIGHT: \"#d8d8d8\"\n            },\n            ColorRole.TAB_BACKGROUND_ACTIVE: {\n                ColorMode.DARK: \"#1e1e1e\",\n                ColorMode.LIGHT: \"#ffffff\"\n            },\n            ColorRole.TAB_BACKGROUND_INACTIVE: {\n                ColorMode.DARK: \"#141414\",\n                ColorMode.LIGHT: \"#f0f0f0\"\n            },\n            ColorRole.TAB_BACKGROUND_HOVER: {\n                ColorMode.DARK: \"#242454\",\n                ColorMode.LIGHT: \"#b8b8f8\"\n            },\n            ColorRole.TAB_BACKGROUND_UPDATED: {\n                ColorMode.DARK: \"#3c2054\",\n                ColorMode.LIGHT: \"#f0d0f8\"\n            },\n            ColorRole.TAB_BORDER_ACTIVE: {\n                ColorMode.DARK: \"#8080ff\",\n                ColorMode.LIGHT: \"#3030ff\"\n            },\n\n            # Button colours\n            ColorRole.BUTTON_BACKGROUND: {\n                ColorMode.DARK: \"#0c0c0c\",\n                ColorMode.LIGHT: \"#e8e8e8\"\n            },\n            ColorRole.BUTTON_BACKGROUND_PRESSED: {\n                ColorMode.DARK: \"#505050\",\n                ColorMode.LIGHT: \"#b0b0b0\"\n            },\n            ColorRole.BUTTON_BACKGROUND_HOVER: {\n                ColorMode.DARK: \"#404040\",\n                ColorMode.LIGHT: \"#c0c0c0\"\n            },\n            ColorRole.BUTTON_SECONDARY_BACKGROUND: {\n                ColorMode.DARK: \"#2c2c2c\",\n                ColorMode.LIGHT: \"#d8d8d8\"\n            },\n            ColorRole.BUTTON_SECONDARY_BACKGROUND_PRESSED: {\n                ColorMode.DARK: \"#505050\",\n                ColorMode.LIGHT: \"#b0b0b0\"\n            },\n            ColorRole.BUTTON_SECONDARY_BACKGROUND_HOVER: {\n                ColorMode.DARK: \"#404040\",\n                ColorMode.LIGHT: \"#c0c0c0\"\n            },\n            ColorRole.BUTTON_BACKGROUND_RECOMMENDED: {\n                ColorMode.DARK: \"#2050c0\",\n                ColorMode.LIGHT: \"#3060d0\"\n            },\n            ColorRole.BUTTON_BACKGROUND_RECOMMENDED_PRESSED: {\n                ColorMode.DARK: \"#4070e0\",\n                ColorMode.LIGHT: \"#1040b0\"\n            },\n            ColorRole.BUTTON_BACKGROUND_RECOMMENDED_HOVER: {\n                ColorMode.DARK: \"#3060d0\",\n                ColorMode.LIGHT: \"#2050c0\"\n            },\n            ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE: {\n                ColorMode.DARK: \"#c03020\",\n                ColorMode.LIGHT: \"#d04030\"\n            },\n            ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_PRESSED: {\n                ColorMode.DARK: \"#e05040\",\n                ColorMode.LIGHT: \"#b02010\"\n            },\n            ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_HOVER: {\n                ColorMode.DARK: \"#d04030\",\n                ColorMode.LIGHT: \"#c03020\"\n            },\n            ColorRole.BUTTON_BACKGROUND_DISABLED: {\n                ColorMode.DARK: \"#202020\",\n                ColorMode.LIGHT: \"#d8d8d8\"\n            },\n\n            # Menu elements\n            ColorRole.MENU_BACKGROUND: {\n                ColorMode.DARK: \"#2d2d2d\",\n                ColorMode.LIGHT: \"#f0f0f0\"\n            },\n            ColorRole.MENU_HOVER: {\n                ColorMode.DARK: \"#3060d0\",\n                ColorMode.LIGHT: \"#2050c0\"\n            },\n            ColorRole.MENU_BORDER: {\n                ColorMode.DARK: \"#606060\",\n                ColorMode.LIGHT: \"#b0b0b0\"\n            },\n\n            # Splitter bars\n            ColorRole.SPLITTER: {\n                ColorMode.DARK: \"#606060\",\n                ColorMode.LIGHT: \"#b0b0b0\"\n            },\n\n            # Scroll bar elements\n            ColorRole.SCROLLBAR_BACKGROUND: {\n                ColorMode.DARK: \"#2d2d2d\",\n                ColorMode.LIGHT: \"#f0f0f0\"\n            },\n            ColorRole.SCROLLBAR_HANDLE: {\n                ColorMode.DARK: \"#404040\",\n                ColorMode.LIGHT: \"#c0c0c0\"\n            },\n\n            # Table elements\n            ColorRole.TABLE_BORDER: {\n                ColorMode.DARK: \"#808080\",\n                ColorMode.LIGHT: \"#a0a0a0\"\n            },\n            ColorRole.TABLE_HEADER_BACKGROUND: {\n                ColorMode.DARK: \"#484838\",\n                ColorMode.LIGHT: \"#d0d0e0\"\n            },\n\n            # Message colours\n            ColorRole.MESSAGE_BACKGROUND: {\n                ColorMode.DARK: \"#020202\",\n                ColorMode.LIGHT: \"#f2f2f2\"\n            },\n            ColorRole.MESSAGE_USER_BACKGROUND: {\n                ColorMode.DARK: \"#121212\",\n                ColorMode.LIGHT: \"#e4e4e4\"\n            },\n            ColorRole.MESSAGE_FOCUSED: {\n                ColorMode.DARK: \"#3a4654\",\n                ColorMode.LIGHT: \"#aab6c4\"\n            },\n            ColorRole.MESSAGE_USER: {\n                ColorMode.DARK: \"#8080c0\",\n                ColorMode.LIGHT: \"#6060a0\"\n            },\n            ColorRole.MESSAGE_AI: {\n                ColorMode.DARK: \"#80c080\",\n                ColorMode.LIGHT: \"#40a040\"\n            },\n            ColorRole.MESSAGE_REASONING: {\n                ColorMode.DARK: \"#808080\",\n                ColorMode.LIGHT: \"#808080\"\n            },\n            ColorRole.MESSAGE_TOOL_CALL: {\n                ColorMode.DARK: \"#808080\",\n                ColorMode.LIGHT: \"#808080\"\n            },\n            ColorRole.MESSAGE_TOOL_RESULT: {\n                ColorMode.DARK: \"#808080\",\n                ColorMode.LIGHT: \"#808080\"\n            },\n            ColorRole.MESSAGE_SYSTEM_ERROR: {\n                ColorMode.DARK: \"#c08080\",\n                ColorMode.LIGHT: \"#a04040\"\n            },\n            ColorRole.MESSAGE_SYSTEM_SUCCESS: {\n                ColorMode.DARK: \"#80c080\",\n                ColorMode.LIGHT: \"#40a040\"\n            },\n            ColorRole.MESSAGE_LANGUAGE: {\n                ColorMode.DARK: \"#a07850\",\n                ColorMode.LIGHT: \"#806040\"\n            },\n            ColorRole.MESSAGE_BOOKMARK: {\n                ColorMode.DARK: \"#ffdf00\",\n                ColorMode.LIGHT: \"#806000\"\n            },\n            ColorRole.MESSAGE_STREAMING: {\n                ColorMode.DARK: \"#c0a080\",\n                ColorMode.LIGHT: \"#a07050\"\n            },\n            ColorRole.MESSAGE_TRACE: {\n                ColorMode.DARK: \"#a0a0a0\",\n                ColorMode.LIGHT: \"#606060\"\n            },\n            ColorRole.MESSAGE_INFORMATION: {\n                ColorMode.DARK: \"#80b0f0\",\n                ColorMode.LIGHT: \"#0060c0\"\n            },\n            ColorRole.MESSAGE_WARNING: {\n                ColorMode.DARK: \"#f0c040\",\n                ColorMode.LIGHT: \"#c0a020\"\n            },\n            ColorRole.MESSAGE_ERROR: {\n                ColorMode.DARK: \"#ff6060\",\n                ColorMode.LIGHT: \"#c03030\"\n            },\n\n            # Status bar elements\n            ColorRole.STATUS_BAR_BACKGROUND: {\n                ColorMode.DARK: \"#121212\",\n                ColorMode.LIGHT: \"#e8e8e8\"\n            },\n            ColorRole.CANARY_BACKGROUND: {\n                ColorMode.DARK: \"#802020\",\n                ColorMode.LIGHT: \"#c04040\"\n            },\n\n            # Close button states\n            ColorRole.CLOSE_BUTTON_BACKGROUND_HOVER: {\n                ColorMode.DARK: \"#d04030\",\n                ColorMode.LIGHT: \"#c03020\"\n            },\n\n            # Line numbers\n            ColorRole.LINE_NUMBER: {\n                ColorMode.DARK: \"#606060\",\n                ColorMode.LIGHT: \"#c0c0c0\"\n            },\n\n            # Syntax highlighting\n            ColorRole.SYNTAX_ERROR: {\n                ColorMode.DARK: \"#ff0000\",\n                ColorMode.LIGHT: \"#ff0000\"\n            },\n            ColorRole.SYNTAX_01: {\n                ColorMode.DARK: \"#80e0d0\",\n                ColorMode.LIGHT: \"#007070\"\n            },\n            ColorRole.SYNTAX_02: {\n                ColorMode.DARK: \"#f0f0f0\",\n                ColorMode.LIGHT: \"#202020\"\n            },\n            ColorRole.SYNTAX_03: {\n                ColorMode.DARK: \"#68b068\",\n                ColorMode.LIGHT: \"#407040\"\n            },\n            ColorRole.SYNTAX_04: {\n                ColorMode.DARK: \"#ffa0eb\",\n                ColorMode.LIGHT: \"#c000a0\"\n            },\n            ColorRole.SYNTAX_05: {\n                ColorMode.DARK: \"#808080\",\n                ColorMode.LIGHT: \"#606060\"\n            },\n            ColorRole.SYNTAX_06: {\n                ColorMode.DARK: \"#90e0e8\",\n                ColorMode.LIGHT: \"#0080a0\"\n            },\n            ColorRole.SYNTAX_07: {\n                ColorMode.DARK: \"#e0e080\",\n                ColorMode.LIGHT: \"#a0a000\"\n            },\n            ColorRole.SYNTAX_08: {\n                ColorMode.DARK: \"#b090f0\",\n                ColorMode.LIGHT: \"#5040c0\"\n            },\n            ColorRole.SYNTAX_09: {\n                ColorMode.DARK: \"#90e0e8\",\n                ColorMode.LIGHT: \"#0080a0\"\n            },\n            ColorRole.SYNTAX_10: {\n                ColorMode.DARK: \"#d070d0\",\n                ColorMode.LIGHT: \"#a000a0\"\n            },\n            ColorRole.SYNTAX_11: {\n                ColorMode.DARK: \"#80b0f0\",\n                ColorMode.LIGHT: \"#0060c0\"\n            },\n            ColorRole.SYNTAX_12: {\n                ColorMode.DARK: \"#f08080\",\n                ColorMode.LIGHT: \"#c03030\"\n            },\n            ColorRole.SYNTAX_13: {\n                ColorMode.DARK: \"#ffc0eb\",\n                ColorMode.LIGHT: \"#c080a0\"\n            },\n            ColorRole.SYNTAX_14: {\n                ColorMode.DARK: \"#f0e060\",\n                ColorMode.LIGHT: \"#a09040\"\n            },\n            ColorRole.SYNTAX_15: {\n                ColorMode.DARK: \"#70e0e8\",\n                ColorMode.LIGHT: \"#2090a0\"\n            },\n            ColorRole.SYNTAX_16: {\n                ColorMode.DARK: \"#88d048\",\n                ColorMode.LIGHT: \"#508020\"\n            },\n            ColorRole.SYNTAX_17: {\n                ColorMode.DARK: \"#c0c0c0\",\n                ColorMode.LIGHT: \"#404040\"\n            },\n            ColorRole.SYNTAX_18: {\n                ColorMode.DARK: \"#80b080\",\n                ColorMode.LIGHT: \"#609060\"\n            },\n            ColorRole.SYNTAX_19: {\n                ColorMode.DARK: \"#c87050\",\n                ColorMode.LIGHT: \"#a04020\"\n            },\n            ColorRole.SYNTAX_20: {\n                ColorMode.DARK: \"#c05040\",\n                ColorMode.LIGHT: \"#803828\"\n             },\n            ColorRole.SYNTAX_21: {\n                ColorMode.DARK: \"#30c090\",\n                ColorMode.LIGHT: \"#24906c\"\n            },\n\n            # Terminal basic colors\n            ColorRole.TERM_BLACK: {\n                ColorMode.DARK: \"#000000\",\n                ColorMode.LIGHT: \"#000000\"\n            },\n            ColorRole.TERM_RED: {\n                ColorMode.DARK: \"#cd0000\",\n                ColorMode.LIGHT: \"#cd0000\"\n            },\n            ColorRole.TERM_GREEN: {\n                ColorMode.DARK: \"#00cd00\",\n                ColorMode.LIGHT: \"#00cd00\"\n            },\n            ColorRole.TERM_YELLOW: {\n                ColorMode.DARK: \"#cdcd00\",\n                ColorMode.LIGHT: \"#cdcd00\"\n            },\n            ColorRole.TERM_BLUE: {\n                ColorMode.DARK: \"#0000ee\",\n                ColorMode.LIGHT: \"#0000ee\"\n            },\n            ColorRole.TERM_MAGENTA: {\n                ColorMode.DARK: \"#cd00cd\",\n                ColorMode.LIGHT: \"#cd00cd\"\n            },\n            ColorRole.TERM_CYAN: {\n                ColorMode.DARK: \"#00cdcd\",\n                ColorMode.LIGHT: \"#00cdcd\"\n            },\n            ColorRole.TERM_WHITE: {\n                ColorMode.DARK: \"#e5e5e5\",\n                ColorMode.LIGHT: \"#e5e5e5\"\n            },\n\n            # Terminal bright colors\n            ColorRole.TERM_BRIGHT_BLACK: {\n                ColorMode.DARK: \"#7f7f7f\",\n                ColorMode.LIGHT: \"#7f7f7f\"\n            },\n            ColorRole.TERM_BRIGHT_RED: {\n                ColorMode.DARK: \"#ff0000\",\n                ColorMode.LIGHT: \"#ff0000\"\n            },\n            ColorRole.TERM_BRIGHT_GREEN: {\n                ColorMode.DARK: \"#00ff00\",\n                ColorMode.LIGHT: \"#00ff00\"\n            },\n            ColorRole.TERM_BRIGHT_YELLOW: {\n                ColorMode.DARK: \"#ffff00\",\n                ColorMode.LIGHT: \"#ffff00\"\n            },\n            ColorRole.TERM_BRIGHT_BLUE: {\n                ColorMode.DARK: \"#5c5cff\",\n                ColorMode.LIGHT: \"#5c5cff\"\n            },\n            ColorRole.TERM_BRIGHT_MAGENTA: {\n                ColorMode.DARK: \"#ff00ff\",\n                ColorMode.LIGHT: \"#ff00ff\"\n            },\n            ColorRole.TERM_BRIGHT_CYAN: {\n                ColorMode.DARK: \"#00ffff\",\n                ColorMode.LIGHT: \"#00ffff\"\n            },\n            ColorRole.TERM_BRIGHT_WHITE: {\n                ColorMode.DARK: \"#ffffff\",\n                ColorMode.LIGHT: \"#ffffff\"\n            }\n        }\n\n    def _initialize_highlights(self) -> None:\n        # Mapping from token type to colour\n        colour_mapping = {\n            TokenType.ADDRESS: ColorRole.SYNTAX_01,\n            TokenType.ANNOTATION: ColorRole.SYNTAX_08,\n            TokenType.ARGUMENT: ColorRole.SYNTAX_11,\n            TokenType.ATTRIBUTE: ColorRole.SYNTAX_08,\n            TokenType.BACKTICK: ColorRole.SYNTAX_12,\n            TokenType.BOOLEAN: ColorRole.SYNTAX_16,\n            TokenType.BOLD: ColorRole.SYNTAX_21,\n            TokenType.BOLD_END: ColorRole.SYNTAX_07,\n            TokenType.BOLD_START: ColorRole.SYNTAX_07,\n            TokenType.BLOCKQUOTE: ColorRole.SYNTAX_13,\n            TokenType.CHARACTER: ColorRole.SYNTAX_20,\n            TokenType.CODE: ColorRole. SYNTAX_02,\n            TokenType.COMMAND: ColorRole.SYNTAX_07,\n            TokenType.COMMENT: ColorRole.SYNTAX_03,\n            TokenType.CSS_AT_RULE: ColorRole.SYNTAX_04,\n            TokenType.DIMENSION: ColorRole.SYNTAX_16,\n            TokenType.DOC_COMMENT: ColorRole.SYNTAX_03,\n            TokenType.DOCTYPE: ColorRole.SYNTAX_05,\n            TokenType.DIRECTIVE: ColorRole.SYNTAX_18,\n            TokenType.ELEMENT: ColorRole.SYNTAX_06,\n            TokenType.ERROR: ColorRole.SYNTAX_ERROR,\n            TokenType.FENCE: ColorRole.SYNTAX_14,\n            TokenType.FENCE_END: ColorRole.SYNTAX_14,\n            TokenType.FENCE_START: ColorRole.SYNTAX_14,\n            TokenType.FUNCTION_OR_METHOD: ColorRole.SYNTAX_07,\n            TokenType.GENERIC_END: ColorRole.SYNTAX_17,\n            TokenType.GENERIC_START: ColorRole.SYNTAX_17,\n            TokenType.GENERIC_TYPE: ColorRole.SYNTAX_21,\n            TokenType.HASH: ColorRole.SYNTAX_11,\n            TokenType.HEADING: ColorRole.SYNTAX_08,\n            TokenType.HEX: ColorRole.SYNTAX_16,\n            TokenType.HORIZONTAL_RULE: ColorRole.SYNTAX_21,\n            TokenType.HTML_ATTRIBUTE: ColorRole.SYNTAX_09,\n            TokenType.HTML_TAG: ColorRole.SYNTAX_10,\n            TokenType.IDENTIFIER: ColorRole.SYNTAX_11,\n            TokenType.IMAGE_ALT_END: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_ALT_TEXT: ColorRole.SYNTAX_16,\n            TokenType.IMAGE_END: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_START: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_URL: ColorRole.SYNTAX_20,\n            TokenType.INLINE_CODE: ColorRole.SYNTAX_12,\n            TokenType.INLINE_CODE_END: ColorRole.SYNTAX_07,\n            TokenType.INLINE_CODE_START: ColorRole.SYNTAX_07,\n            TokenType.ITALIC: ColorRole.SYNTAX_09,\n            TokenType.ITALIC_END: ColorRole.SYNTAX_07,\n            TokenType.ITALIC_START: ColorRole.SYNTAX_07,\n            TokenType.JSON_KEY: ColorRole.SYNTAX_07,\n            TokenType.KEYWORD: ColorRole.SYNTAX_13,\n            TokenType.LANGUAGE: ColorRole.SYNTAX_14,\n            TokenType.LIFETIME: ColorRole.SYNTAX_17,\n            TokenType.LINK_END: ColorRole.SYNTAX_07,\n            TokenType.LINK_START: ColorRole.SYNTAX_07,\n            TokenType.LINK_TEXT: ColorRole.SYNTAX_16,\n            TokenType.LINK_TEXT_END: ColorRole.SYNTAX_07,\n            TokenType.LINK_URL: ColorRole.SYNTAX_20,\n            TokenType.LIST_MARKER: ColorRole.SYNTAX_15,\n            TokenType.LPAREN: ColorRole.SYNTAX_17,\n            TokenType.NUMBER: ColorRole.SYNTAX_16,\n            TokenType.OPERATOR: ColorRole.SYNTAX_17,\n            TokenType.OPTION: ColorRole.SYNTAX_10,\n            TokenType.OPTION_VALUE: ColorRole.SYNTAX_08,\n            TokenType.PREPROCESSOR: ColorRole.SYNTAX_05,\n            TokenType.REGEXP: ColorRole.SYNTAX_19,\n            TokenType.RPAREN: ColorRole.SYNTAX_17,\n            TokenType.RUNE: ColorRole.SYNTAX_20,\n            TokenType.STRING: ColorRole.SYNTAX_20,\n            TokenType.TABLE: ColorRole.SYNTAX_03,\n            TokenType.TEXT: ColorRole.SYNTAX_17,\n            TokenType.TYPE: ColorRole.SYNTAX_21,\n            TokenType.XML_DOC: ColorRole.SYNTAX_03\n        }\n\n        for token_type, role in colour_mapping.items():\n            text_format = self._create_highlight(role)\n            self._highlights[token_type] = text_format\n\n        self._error_highlight = self._create_highlight(ColorRole.SYNTAX_ERROR)\n\n    def _create_highlight(self, role: ColorRole) -> QTextCharFormat:\n        text_highlight = QTextCharFormat()\n        text_highlight.setFontFamilies(self._code_font_families)\n        text_highlight.setFontFixedPitch(True)\n        text_highlight.setForeground(QColor(self._colors[role][self._color_mode]))\n\n        return text_highlight\n\n    def _initialize_proportional_highlights(self) -> None:\n        # Mapping from token type to colour\n        colour_mapping = {\n            TokenType.BOLD: ColorRole.SYNTAX_21,\n            TokenType.BOLD_END: ColorRole.SYNTAX_07,\n            TokenType.BOLD_START: ColorRole.SYNTAX_07,\n            TokenType.BLOCKQUOTE: ColorRole.SYNTAX_13,\n            TokenType.FENCE: ColorRole.SYNTAX_14,\n            TokenType.HEADING: ColorRole.SYNTAX_08,\n            TokenType.IMAGE_ALT_END: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_ALT_TEXT: ColorRole.SYNTAX_16,\n            TokenType.IMAGE_END: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_START: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_URL: ColorRole.SYNTAX_20,\n            TokenType.INLINE_CODE_END: ColorRole.SYNTAX_07,\n            TokenType.INLINE_CODE_START: ColorRole.SYNTAX_07,\n            TokenType.ITALIC: ColorRole.SYNTAX_09,\n            TokenType.ITALIC_END: ColorRole.SYNTAX_07,\n            TokenType.ITALIC_START: ColorRole.SYNTAX_07,\n            TokenType.LINK_END: ColorRole.SYNTAX_07,\n            TokenType.LINK_START: ColorRole.SYNTAX_07,\n            TokenType.LINK_TEXT: ColorRole.SYNTAX_16,\n            TokenType.LINK_TEXT_END: ColorRole.SYNTAX_07,\n            TokenType.LINK_URL: ColorRole.SYNTAX_20,\n            TokenType.LIST_MARKER: ColorRole.SYNTAX_15,\n            TokenType.TABLE: ColorRole.SYNTAX_03,\n            TokenType.TEXT: ColorRole.SYNTAX_17\n        }\n\n        for token_type, role in colour_mapping.items():\n            text_format = self._create_proportional_highlight(role)\n            self._proportional_highlights[token_type] = text_format\n\n        self._proportional_highlights[TokenType.INLINE_CODE] = self._create_highlight(ColorRole.SYNTAX_12)\n        self._error_proportional_highlight = self._create_proportional_highlight(ColorRole.SYNTAX_ERROR)\n\n    def _create_proportional_highlight(self, role: ColorRole) -> QTextCharFormat:\n        text_highlight = QTextCharFormat()\n        text_highlight.setForeground(QColor(self._colors[role][self._color_mode]))\n\n        return text_highlight\n\n    def _create_app_icon_svg(self, bg_color: str, text_color: str) -> str:\n        \"\"\"\n        Create an application icon SVG with specified colors.\n\n        Args:\n            bg_color: Background color in hex format\n            text_color: Text color in hex format\n\n        Returns:\n            str: SVG markup for the application icon\n        \"\"\"\n        return f'''\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"128\" height=\"128\" viewBox=\"0 0 384 384\">\n                <rect x=\"0\" y=\"0\" width=\"384\" height=\"384\" fill=\"{bg_color}\"/>\n                <g fill=\"{text_color}\">\n                    <g transform=\"translate(38.400004, 250.960113)\">\n                        <path d=\"M 97.234375 0\n                            L 92.125 -64.078125\n                            L 91.46875 -64.078125\n                            L 69.328125-0.65625\n                            L 54.640625 -0.65625\n                            L 32.5 -64.078125\n                            L 31.84375 -64.078125\n                            L 26.734375 0\n                            L 2.09375 0\n                            L 11.796875 -108.109375\n                            L 38 -108.109375\n                            L 61.984375 -45.734375\n                            L 85.96875 -108.109375\n                            L 112.171875 -108.109375\n                            L 121.875 0\n                            Z\"/>\n                    </g>\n                    <g transform=\"translate(162.225522, 250.960113)\">\n                        <path d=\"M 76 -108.109375\n                            L 44.15625 -71.03125\n                            C 46 -72.070312 48.578125 -72.59375 51.890625 -72.59375\n                            C 55.734375 -72.59375 59.617188 -71.785156 63.546875 -70.171875\n                            C 67.484375 -68.554688 71.175781 -66.238281 74.625 -63.21875\n                            C 78.082031 -60.207031 80.898438 -56.210938 83.078125 -51.234375\n                            C 85.265625 -46.253906 86.359375 -40.753906 86.359375 -34.734375\n                            C 86.359375 -28.609375 85.203125 -23.125 82.890625 -18.28125\n                            C 80.578125 -13.4375 77.472656 -9.59375 73.578125 -6.75\n                            C 69.691406 -3.90625 65.429688 -1.738281 60.796875 -0.25\n                            C 56.171875 1.226562 51.328125 1.96875 46.265625 1.96875\n                            C 34.117188 1.96875 23.894531 -1.566406 15.59375 -8.640625\n                            C 7.289062 -15.722656 3.140625 -24.421875 3.140625 -34.734375\n                            C 3.140625 -43.460938 4.363281 -50.644531 6.8125 -56.28125\n                            C 9.257812 -61.914062 13.71875 -69.101562 20.1875 -77.84375\n                            L 45.609375 -108.109375\n                            Z\n                            M 28.703125 -34.734375\n                            C 28.703125 -30.015625 30.226562 -26.101562 33.28125 -23\n                            C 36.34375 -19.894531 40.273438 -18.34375 45.078125 -18.34375\n                            C 49.878906 -18.34375 53.851562 -19.894531 57 -23\n                            C 60.144531 -26.101562 61.71875 -30.015625 61.71875 -34.734375\n                            C 61.71875 -39.535156 60.125 -43.53125 56.9375 -46.71875\n                            C 53.75 -49.90625 49.796875 -51.5 45.078125 -51.5\n                            C 40.535156 -51.5 36.671875 -49.90625 33.484375 -46.71875\n                            C 30.296875 -43.53125 28.703125 -39.535156 28.703125 -34.734375\n                            Z\"/>\n                    </g>\n                    <g transform=\"translate(249.066902, 250.960113)\">\n                        <path d=\"M 7.859375 -108.109375\n                            L 46.515625 -108.109375\n                            C 56.910156 -108.109375 65.382812 -105.332031 71.9375 -99.78125\n                            C 78.488281 -94.238281 81.765625 -86.3125 81.765625 -76\n                            C 81.765625 -68.050781 79.773438 -61.390625 75.796875 -56.015625\n                            C 71.828125 -50.648438 66.4375 -46.875 59.625 -44.6875\n                            L 96.84375 0\n                            L 65.515625 0\n                            L 32.5 -42.71875\n                            L 32.5 0\n                            L 7.859375 0\n                            Z\n                            M 32.5 -60.15625\n                            L 35.375 -60.15625\n                            C 37.65625 -60.15625 39.578125 -60.195312 41.140625 -60.28125\n                            C 42.710938 -60.363281 44.503906 -60.664062 46.515625 -61.1875\n                            C 48.523438 -61.71875 50.140625 -62.460938 51.359375 -63.421875\n                            C 52.585938 -64.390625 53.640625 -65.789062 54.515625 -67.625\n                            C 55.390625 -69.457031 55.828125 -71.679688 55.828125 -74.296875\n                            C 55.828125 -76.921875 55.390625 -79.148438 54.515625 -80.984375\n                            C 53.640625 -82.816406 52.585938 -84.210938 51.359375 -85.171875\n                            C 50.140625 -86.140625 48.523438 -86.882812 46.515625 -87.40625\n                            C 44.503906 -87.925781 42.710938 -88.226562 41.140625 -88.3125\n                            C 39.578125 -88.40625 37.65625 -88.453125 35.375 -88.453125\n                            L 32.5 -88.453125\n                            Z\"/>\n                    </g>\n                </g>\n            </svg>\n        '''\n\n    def _write_icon(self, name: str, svg_data: str) -> None:\n        icon_dir = os.path.expanduser(\"~/.humbug/icons\")\n        with open(os.path.join(icon_dir, name), 'w', encoding='utf-8') as f:\n            f.write(svg_data)\n\n    def _create_active_inactive_theme_icons(self, active: bool, suffix: str, color: str) -> None:\n        prefix = \"\" if active else \"inactive-\"\n\n        # Close button - visible version\n        self._write_icon(f'{prefix}close-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                    d=\"M16,16 L48,48 M48,16 L16,48\"/>\n            </svg>\n        ''')\n\n        # Conversation tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}conversation-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M8 10H8.01\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M12 10H12.01\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M16 10H16.01\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M21 13V7C21 5.11438 21 4.17157 20.4142 3.58579C19.8284 3 18.8856 3 17 3H7C5.11438 3\n                    4.17157 3 3.58579 3.58579C3 4.17157 3 5.11438 3 7V13C3 14.8856 3 15.8284 3.58579 16.4142C4.17157\n                    17 5.11438 17 7 17H7.5C7.77614 17 8 17.2239 8 17.5V20V20.1499C8 20.5037 8.40137 20.7081\n                    8.6875 20.5L13.0956 17.2941C13.3584 17.103 13.675 17 14 17H17C18.8856 17 19.8284 17 20.4142\n                    16.4142C21 15.8284 21 14.8856 21 13Z\" stroke=\"{color}\" stroke-width=\"2\" stroke-linejoin=\"round\"/>\n            </svg>\n        ''')\n\n        # Editor tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}editor-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M13 21H21\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M20.0651 7.39423L7.09967 20.4114C6.72438 20.7882 6.21446 21 5.68265 21H4.00383C3.44943\n                    21 3 20.5466 3 19.9922V18.2987C3 17.7696 3.20962 17.2621 3.58297 16.8873L16.5517 3.86681C19.5632\n                    1.34721 22.5747 4.87462 20.0651 7.39423Z\" stroke=\"{color}\" stroke-width=\"2\"\n                    stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M15.3097 5.30981L18.7274 8.72755\" stroke=\"{color}\" stroke-width=\"2\"\n                    stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n            </svg>\n        ''')\n\n        # Log tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}log-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M5 12H7.75044C7.89947 12 8.03179 11.9046 8.07892 11.7632V11.7632L9.875 6.375V6.375C9.91626\n                    6.25122 10.0918 6.25238 10.1364 6.375V6.375L13.875 16.6562L13.885 16.6837C13.9253 16.7946 14.0812\n                    16.797 14.125 16.6875V16.6875L15.8841 12.2898V12.2898C15.9541 12.1148 16.1236 12 16.3122 12H19\"\n                    stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n            </svg>\n        ''')\n\n        # Shell tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}shell-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M3 7C3 5.11438 3 4.17157 3.58579 3.58579C4.17157 3 5.11438 3 7 3H12H17C18.8856 3 19.8284\n                    3 20.4142 3.58579C21 4.17157 21 5.11438 21 7V10V13C21 14.8856 21 15.8284 20.4142 16.4142C19.8284\n                    17 18.8856 17 17 17H12H7C5.11438 17 4.17157 17 3.58579 16.4142C3 15.8284 3 14.8856 3 13V10V7Z\"\n                    stroke=\"{color}\" stroke-width=\"2\" stroke-linejoin=\"round\"/>\n                <path d=\"M7 21H17\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M12 17V21\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n            </svg>\n        ''')\n\n        # Terminal tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}terminal-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M13 15H16\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n                <path d=\"M8 15L10.5 12.5V12.5C10.7761 12.2239 10.7761 11.7761 10.5 11.5V11.5L8 9\"\n                    stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M3 8C3 6.11438 3 5.17157 3.58579 4.58579C4.17157 4 5.11438 4 7 4H12H17C18.8856 4\n                    19.8284 4 20.4142 4.58579C21 5.17157 21 6.11438 21 8V12V16C21 17.8856 21 18.8284 20.4142\n                    19.4142C19.8284 20 18.8856 20 17 20H12H7C5.11438 20 4.17157 20 3.58579 19.4142C3 18.8284\n                    3 17.8856 3 16V12V8Z\" stroke=\"{color}\" stroke-width=\"2\" stroke-linejoin=\"round\"/>\n            </svg>\n        ''')\n\n        # Wiki tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}wiki-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M17.8284 6.82843C18.4065 7.40649 18.6955 7.69552 18.8478 8.06306C19 8.4306 19 8.83935\n                    19 9.65685L19 17C19 18.8856 19 19.8284 18.4142 20.4142C17.8284 21 16.8856 21 15 21H9C7.11438\n                    21 6.17157 21 5.58579 20.4142C5 19.8284 5 18.8856 5 17L5 7C5 5.11438 5 4.17157 5.58579\n                    3.58579C6.17157 3 7.11438 3 9 3H12.3431C13.1606 3 13.5694 3 13.9369 3.15224C14.3045 3.30448\n                    14.5935 3.59351 15.1716 4.17157L17.8284 6.82843Z\" stroke=\"{color}\"\n                    stroke-width=\"2\" stroke-linejoin=\"round\"/>\n                <path d=\"M9 6L11 6\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M10 9L12 9\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M9 12L11 12\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M10 15L12 15\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n            </svg>\n        ''')\n\n    def _create_theme_icons(self) -> None:\n        \"\"\"Create theme-specific icons in the user's .humbug directory.\"\"\"\n        icon_dir = os.path.expanduser(\"~/.humbug/icons\")\n        os.makedirs(icon_dir, exist_ok=True)\n\n        # Create collapsed and expanded arrows for both themes\n        for mode in ColorMode:\n            color = self._colors[ColorRole.TEXT_PRIMARY][mode]\n            inactive_color = self._colors[ColorRole.TEXT_INACTIVE][mode]\n            suffix = mode.name.lower()\n\n            # Right-pointing arrow\n            self._write_icon(f'arrow-right-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M24,16 L40,32 L24,48\"/>\n                </svg>\n            ''')\n\n            # Left-pointing arrow\n            self._write_icon(f'arrow-left-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M40,16 L24,32 L40,48\"/>\n                </svg>\n            ''')\n\n            # Up-pointing arrow\n            self._write_icon(f'arrow-up-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M16,40 L32,24 L48,40\"/>\n                </svg>\n            ''')\n\n            # Down-pointing arrow\n            self._write_icon(f'arrow-down-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M16,24 L32,40 L48,24\"/>\n                </svg>\n            ''')\n\n            # Close button - visible version\n            self._write_icon(f'close-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M16,16 L48,48 M48,16 L16,48\"/>\n                </svg>\n            ''')\n\n            # Checkbox check mark\n            self._write_icon(f'check-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M16,32 L28,44 L48,20\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                </svg>\n            ''')\n\n            # Right-pointing expand\n            self._write_icon(f'expand-right-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M20,8 L44,32 L20,56\"/>\n                </svg>\n            ''')\n\n            # Left-pointing expand\n            self._write_icon(f'expand-left-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M44,8 L20,32 L44,56\"/>\n                </svg>\n            ''')\n\n            # Down-pointing expand\n            self._write_icon(f'expand-down-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M8,20 L32,44 L56,20\"/>\n                </svg>\n            ''')\n\n            # Bulb on icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n            self._write_icon(f'info-{suffix}.svg', f'''\n                <svg width=\"800px\" height=\"800px\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path d=\"M12 7C9.23858 7 7 9.23858 7 12C7 13.3613 7.54402 14.5955 8.42651 15.4972C8.77025 15.8484 9.05281 16.2663\n                        9.14923 16.7482L9.67833 19.3924C9.86537 20.3272 10.6862 21 11.6395 21H12.3605C13.3138 21 14.1346 20.3272\n                        14.3217 19.3924L14.8508 16.7482C14.9472 16.2663 15.2297 15.8484 15.5735 15.4972C16.456 14.5955 17\n                        13.3613 17 12C17 9.23858 14.7614 7 12 7Z\" stroke=\"{color}\" stroke-width=\"2\"/>\n                    <path d=\"M12 4V3\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M18 6L19 5\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M20 12H21\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M4 12H3\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M5 5L6 6\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M10 17H14\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                </svg>\n            ''')\n\n            # Alert triangle icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n            self._write_icon(f'warning-{suffix}.svg', f'''\n                <svg width=\"800px\" height=\"800px\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path d=\"M12 10V13\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n                    <path d=\"M12 16V15.9888\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n                    <path d=\"M10.2518 5.147L3.6508 17.0287C2.91021 18.3618 3.87415 20 5.39912 20H18.6011C20.126 20 21.09\n                        18.3618 20.3494 17.0287L13.7484 5.147C12.9864 3.77538 11.0138 3.77538 10.2518 5.147Z\"\n                        stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                </svg>\n            ''')\n\n            # Alert hexagon icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n            self._write_icon(f'critical-{suffix}.svg', f'''\n                <svg width=\"800px\" height=\"800px\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path d=\"M3 9.22843V14.7716C3 15.302 3.21071 15.8107 3.58579 16.1858L7.81421 20.4142C8.18929 20.7893 8.69799\n                        21 9.22843 21H14.7716C15.302 21 15.8107 20.7893 16.1858 20.4142L20.4142 16.1858C20.7893 15.8107 21\n                        15.302 21 14.7716V9.22843C21 8.69799 20.7893 8.18929 20.4142 7.81421L16.1858 3.58579C15.8107 3.21071\n                        15.302 3 14.7716 3H9.22843C8.69799 3 8.18929 3.21071 7.81421 3.58579L3.58579 7.81421C3.21071 8.18929\n                        3 8.69799 3 9.22843Z\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M12 8V13\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n                    <path d=\"M12 16V15.9888\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n                </svg>\n            ''')\n\n            # Help circle icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n            self._write_icon(f'question-{suffix}.svg', f'''\n                <svg width=\"800px\" height=\"800px\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path d=\"M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12\n                        3C16.9706 3 21 7.02944 21 12Z\" stroke=\"{color}\" stroke-width=\"2\"/>\n                    <path d=\"M10.5 8.67709C10.8665 8.26188 11.4027 8 12 8C13.1046 8 14 8.89543 14 10C14 10.9337\n                        13.3601 11.718 12.4949 11.9383C12.2273 12.0064 12 12.2239 12 12.5V12.5V13\"\n                        stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M12 16H12.01\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'save-{suffix}.svg', f'''\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M8,40, L8,56 L56,56 L56,40\"/>\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M32,8, L32,40\"/>\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M20,28, L32,40, L44,28\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'copy-{suffix}.svg', f'''\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <rect x=\"22\" y=\"10\" width=\"32\" height=\"32\" stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"/>\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M22,22, L10,22 L10,54 L42,54 L42,42\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'fork-{suffix}.svg', f'''\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M32,8 L32,32 M32,32 L8,56 L8,40 M8,56 L24,56 M32,32 L56,56 L56,40 M56,56 L40,56\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'delete-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M12.5,20 L12.5,56 L51.5,56 L51.5,20 M4,20 L60,20 M18,20 L24,8 L40,8 L46,20\"/>\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M25.5,28 L25.5,46 M38.5,28 L38.5,46\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'edit-{suffix}.svg', f'''\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M8,56 L56,56 M40,12 L52,24 L24,52 L8,56 L12,40 L40,12 Z\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'submit-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M8,32 L32,8 L56,32\"/>\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M32,56 L32,8\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'stop-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <circle cx=\"32\" cy=\"32\" r=\"28\" fill=\"none\" stroke=\"{color}\" stroke-width=\"6\"/>\n                    <rect x=\"20\" y=\"20\" width=\"24\" height=\"24\" fill=\"{color}\" stroke=\"none\"/>\n                </svg>\n            ''')\n\n            self._create_active_inactive_theme_icons(True, suffix, color)\n            self._create_active_inactive_theme_icons(False, suffix, inactive_color)\n\n        # Create the standard application icon for about dialog\n        self._write_icon('app-icon.svg', self._create_app_icon_svg('#4040c0', '#ffffff'))\n\n        # Create light mode disabled version\n        self._write_icon('app-icon-disabled-light.svg', self._create_app_icon_svg('#c0c0c0', '#e0e0e0'))\n\n        # Create dark mode disabled version\n        self._write_icon('app-icon-disabled-dark.svg', self._create_app_icon_svg('#202020', '#404040'))\n\n    def get_icon_path(self, name: str) -> str:\n        \"\"\"\n        Get the path to a theme-appropriate icon.\n\n        Args:\n            name: Base name of the icon (without theme suffix or extension)\n\n        Returns:\n            Full path to the icon file\n        \"\"\"\n        icon_dir = os.path.expanduser(\"~/.humbug/icons\")\n        theme = \"dark\" if self._color_mode == ColorMode.DARK else \"light\"\n        return Path(os.path.join(icon_dir, f\"{name}-{theme}.svg\")).as_posix()\n\n    def scale_icon(self, icon_path: str, target_size: int) -> QPixmap:\n        \"\"\"\n        Load and scale an icon to the appropriate size.\n\n        Args:\n            icon_path: Path to the icon file\n            target_size: Desired size in pixels\n\n        Returns:\n            Scaled QPixmap of the icon\n        \"\"\"\n        pixmap = QPixmap(icon_path)\n        scaled_size = int(target_size * self._zoom_factor)\n        return pixmap.scaled(\n            scaled_size,\n            scaled_size,\n            Qt.AspectRatioMode.KeepAspectRatio,\n            Qt.TransformationMode.SmoothTransformation\n        )\n\n    def get_color(self, role: ColorRole) -> QColor:\n        \"\"\"\n        Get a color for a specific role.\n\n        Args:\n            role: The ColorRole to look up\n\n        Returns:\n            QColor: The color for the specified role\n\n        Raises:\n            KeyError: If no color is defined for the role\n        \"\"\"\n        return QColor(self._colors[role][self._color_mode])\n\n    def get_color_str(self, role: ColorRole) -> str:\n        \"\"\"\n        Get a color string for a specific role.\n\n        Args:\n            role: The ColorRole to look up\n\n        Returns:\n            str: The color string (hex format) for the specified role\n\n        Raises:\n            KeyError: If no color is defined for the role\n        \"\"\"\n        return self._colors[role][self._color_mode]\n\n    def get_highlight(self, token_type: TokenType) -> QTextCharFormat:\n        \"\"\"\n        Get the highlight format for a specific token type.\n\n        Args:\n            token_type: The TokenType to look up\n\n        Returns:\n            QTextCharFormat: The highlight format for the specified token type\n        \"\"\"\n        if token_type not in self._highlights:\n            print(f\"token type {token_type} not mapped\")\n\n        return self._highlights.get(token_type, self._error_highlight)\n\n    def get_proportional_highlight(self, token_type: TokenType) -> QTextCharFormat:\n        \"\"\"\n        Get the proportionally-spaced highlight format for a specific token type.\n\n        Args:\n            token_type: The TokenType to look up\n\n        Returns:\n            QTextCharFormat: The highlight format for the specified token type\n        \"\"\"\n        if token_type not in self._proportional_highlights:\n            print(f\"token type {token_type} not mapped\")\n\n        return self._proportional_highlights.get(token_type, self._error_proportional_highlight)\n\n    def _determine_base_font_size(self) -> float:\n        \"\"\"\n        Determine the default system font size based on the operating system.\n\n        Returns:\n            int: Base font size in points.\n        \"\"\"\n        # Get current OS\n        os_type = QOperatingSystemVersion.current()\n\n        # Get system default font\n        system_font = QFontDatabase.systemFont(QFontDatabase.SystemFont.GeneralFont)\n        system_size = system_font.pointSizeF()\n\n        # Apply OS-specific adjustments if system detection fails\n        if system_size > 0:\n            return system_size\n\n        if os_type.type() == QOperatingSystemVersion.OSType.MacOS:  # type: ignore\n            # macOS typically uses 13pt as default\n            return 13\n\n        if os_type.type() == QOperatingSystemVersion.OSType.Windows:  # type: ignore\n            # Windows typically uses 9pt as default\n            return 9\n\n        # Linux typically uses 10pt as default\n        return 10\n\n    def base_font_size(self) -> float:\n        \"\"\"Get the base font size for the current system.\"\"\"\n        return self._user_font_size or self._base_font_size\n\n    def set_user_font_size(self, size: float | None) -> None:\n        \"\"\"Set user-specific font size override.\"\"\"\n        if size != self._user_font_size:\n            self._user_font_size = size\n\n            if size:\n                self.style_changed.emit()\n\n    def color_mode(self) -> ColorMode:\n        \"\"\"Get the current color mode.\"\"\"\n        return self._color_mode\n\n    def set_color_mode(self, mode: ColorMode) -> None:\n        \"\"\"\n        Set the color mode and update application styles.\n\n        Args:\n            mode: The ColorMode to switch to\n        \"\"\"\n        if mode != self._color_mode:\n            self._color_mode = mode\n            self._initialize_highlights()\n            self._initialize_proportional_highlights()\n            self.style_changed.emit()\n\n    def zoom_factor(self) -> float:\n        \"\"\"Current zoom scaling factor.\"\"\"\n        return self._zoom_factor\n\n    def set_zoom(self, factor: float) -> None:\n        \"\"\"\n        Set new zoom factor and update application styles.\n\n        Args:\n            factor: New zoom factor to apply (clamped between 0.5 and 2.0)\n        \"\"\"\n        new_factor = max(0.5, min(2.0, factor))\n        if new_factor != self._zoom_factor:\n            self._zoom_factor = new_factor\n            self.style_changed.emit()\n\n    def get_space_width(self) -> float:\n        \"\"\"Get the width of a space character\"\"\"\n        font = QFont(self._code_font_families)\n        font.setPointSizeF(self.base_font_size() * self._zoom_factor)\n        font_metrics = QFontMetricsF(font)\n        space_width = font_metrics.horizontalAdvance('        ') / 8\n        return space_width\n\n    def monospace_font_families(self) -> List[str]:\n        \"\"\"Get the standard monospace font family fallback sequence.\"\"\"\n        return self._code_font_families\n\n    def message_bubble_spacing(self) -> float:\n        \"\"\"Get the number of pixels to use in message bubble spacing.\"\"\"\n        return 8.0\n\n    def get_dialog_stylesheet(self) -> str:\n        \"\"\"\n        Get a complete stylesheet for dialog windows.\n\n        Returns:\n            A stylesheet string with styling for all common dialog components\n        \"\"\"\n        zoom_factor = self.zoom_factor()\n        base_font_size = self.base_font_size()\n\n        return f\"\"\"\n            QDialog {{\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\n                font-size: {base_font_size * zoom_factor}pt;\n            }}\n\n            QScrollArea {{\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\n                border: none;\n            }}\n\n            QScrollArea > QWidget > QWidget {{\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\n                border: none;\n            }}\n\n            /* Labels */\n            QLabel {{\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\n                border: none;\n                border-radius: 4px;\n                padding: 0px;\n                margin: 0px;\n                font-size: {base_font_size * zoom_factor}pt;\n            }}\n\n            /* Text inputs */\n            QLineEdit {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border: none;\n                border-radius: 4px;\n                padding: 4px;\n                font-size: {int(base_font_size * zoom_factor)}pt;\n            }}\n            QLineEdit:disabled {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n\n            /* Checkboxes */\n            QCheckBox {{\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border: none;\n                border-radius: 4px;\n                padding: 0px;\n                margin: 0px;\n            }}\n            QCheckBox::indicator {{\n                width: {int(18 * zoom_factor)}px;\n                height: {int(18 * zoom_factor)}px;\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\n            }}\n            QCheckBox::indicator:disabled {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\n            }}\n            QCheckBox::indicator:checked {{\n                image: url({self.get_icon_path('check')});\n            }}\n            QCheckBox:disabled {{\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n\n            /* Combo boxes */\n            QComboBox {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border: none;\n                border-radius: 4px;\n                padding: 6px;\n                margin: 0px;\n                font-size: {int(base_font_size * zoom_factor)}pt;\n            }}\n            QComboBox:disabled {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n            QComboBox::drop-down {{\n                border: none;\n                width: 20px;\n            }}\n            QComboBox::down-arrow {{\n                image: url({self.get_icon_path(\"arrow-down\")});\n                width: 12px;\n                height: 12px;\n            }}\n            QComboBox::down-arrow:on {{\n                image: url({self.get_icon_path('arrow-up')});\n                width: 12px;\n                height: 12px;\n            }}\n            QComboBox::down-arrow:disabled {{\n                image: none;\n            }}\n            QComboBox QAbstractItemView::item:selected {{\n                border: none;\n                background-color: {self.get_color_str(ColorRole.TEXT_SELECTED)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n            }}\n            QComboBox QListView {{\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_SECONDARY)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n            }}\n\n            /* Spin boxes */\n            QSpinBox, QDoubleSpinBox {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border: none;\n                border-radius: 4px;\n                padding: 4px;\n                font-size: {base_font_size * zoom_factor}pt;\n            }}\n            QSpinBox:disabled, QDoubleSpinBox:disabled {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n            QSpinBox::up-button, QSpinBox::down-button,\n            QDoubleSpinBox::up-button, QDoubleSpinBox::down-button {{\n                border: none;\n                width: 20px;\n            }}\n            QSpinBox::up-arrow, QDoubleSpinBox::up-arrow {{\n                image: url({self.get_icon_path('arrow-up')});\n                width: 12px;\n                height: 12px;\n            }}\n            QSpinBox::up-arrow:disabled, QSpinBox::up-arrow:off,\n            QDoubleSpinBox::up-arrow:disabled, QDoubleSpinBox::up-arrow:off {{\n                image: none;\n            }}\n            QSpinBox::down-arrow, QDoubleSpinBox::down-arrow {{\n                image: url({self.get_icon_path('arrow-down')});\n                width: 12px;\n                height: 12px;\n            }}\n            QSpinBox::down-arrow:disabled, QSpinBox::down-arrow:off,\n            QDoubleSpinBox::down-arrow:disabled, QDoubleSpinBox::down-arrow:off {{\n                image: none;\n            }}\n\n            /* Buttons */\n            QPushButton {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border: none;\n                border-radius: 4px;\n                padding: 4px;\n                font-size: {base_font_size * zoom_factor}pt;\n            }}\n            QPushButton:hover {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_HOVER)};\n            }}\n            QPushButton:pressed {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_PRESSED)};\n            }}\n            QPushButton:disabled {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n\n            /* Recommended (primary) buttons */\n            QPushButton[recommended=\"true\"] {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_RECOMMENDED)};\n                color: {self.get_color_str(ColorRole.TEXT_RECOMMENDED)};\n            }}\n            QPushButton[recommended=\"true\"]:hover {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_RECOMMENDED_HOVER)};\n            }}\n            QPushButton[recommended=\"true\"]:pressed {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_RECOMMENDED_PRESSED)};\n            }}\n            QPushButton[recommended=\"false\"] {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE)};\n                color: {self.get_color_str(ColorRole.TEXT_RECOMMENDED)};\n            }}\n            QPushButton[recommended=\"false\"]:hover {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_HOVER)};\n            }}\n            QPushButton[recommended=\"false\"]:pressed {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_PRESSED)};\n            }}\n\n            QScrollBar:vertical {{\n                background-color: {self.get_color_str(ColorRole.SCROLLBAR_BACKGROUND)};\n                width: 12px;\n            }}\n            QScrollBar::handle:vertical {{\n                background-color: {self.get_color_str(ColorRole.SCROLLBAR_HANDLE)};\n                min-height: 20px;\n            }}\n            QScrollBar::add-page:vertical, QScrollBar::sub-page:vertical {{\n                background: none;\n            }}\n            QScrollBar::add-line:vertical, QScrollBar::sub-line:vertical {{\n                height: 0px;\n            }}\n        \"\"\""
          }
        }
      ]
    },
    {
      "id": "31afe8f3-00f5-494d-985b-fc6a8614bd2c",
      "timestamp": "2025-08-29T19:57:54.377861+00:00",
      "type": "tool_call",
      "content": "```json\n{\n    \"id\": \"toolu_01H3T6ff5D55G96x77A1L9bX\",\n    \"name\": \"filesystem\",\n    \"arguments\": {\n        \"operation\": \"write_file\",\n        \"path\": \"src/humbug/style_manager.py\",\n        \"content\": \"\\\"\\\"\\\"Style manager for handling application-wide style and zoom settings.\\n\\nImplements a singleton pattern to maintain consistent styling across components.\\nProvides signals for style changes and utilities for scaled size calculations.\\n\\\"\\\"\\\"\\n\\nfrom enum import Enum, auto\\nimport os\\nfrom pathlib import Path\\nfrom typing import Dict, List\\n\\nfrom PySide6.QtCore import QObject, Signal, QOperatingSystemVersion, Qt\\nfrom PySide6.QtGui import QTextCharFormat, QFontDatabase, QColor, QFontMetricsF, QFont, QPixmap\\n\\nfrom syntax import TokenType\\n\\nfrom humbug.color_role import ColorRole\\n\\n\\nclass ColorMode(Enum):\\n    \\\"\\\"\\\"Enumeration for color theme modes.\\\"\\\"\\\"\\n    LIGHT = auto()\\n    DARK = auto()\\n\\n\\nclass StyleManager(QObject):\\n    \\\"\\\"\\\"\\n    Singleton manager for application-wide style settings.\\n\\n    Handles zoom factor management and style updates across the application.\\n    Emits signals when zoom level changes to notify dependent components.\\n\\n    Attributes:\\n        style_changed (Signal): Emitted when style changes, passing new zoom factor\\n        _instance (StyleManager): Singleton instance\\n        _zoom_factor (float): Current zoom scaling factor\\n        _initialized (bool): Tracks initialization state of QObject base\\n    \\\"\\\"\\\"\\n\\n    style_changed = Signal()\\n    _instance = None\\n\\n    def __new__(cls) -> 'StyleManager':\\n        \\\"\\\"\\\"Create or return singleton instance.\\\"\\\"\\\"\\n        if cls._instance is None:\\n            cls._instance = super(StyleManager, cls).__new__(cls)\\n\\n        return cls._instance\\n\\n    def __init__(self) -> None:\\n        \\\"\\\"\\\"Initialize QObject base class if not already done.\\\"\\\"\\\"\\n        if not hasattr(self, '_initialized'):\\n            super().__init__()\\n            self._zoom_factor = 1.0\\n            self._base_font_size = self._determine_base_font_size()\\n            self._user_font_size: float | None = None\\n            self._initialized = True\\n            self._color_mode = ColorMode.DARK  # Default to dark mode\\n            self._colors: Dict[ColorRole, Dict[ColorMode, str]] = self._initialize_colors()\\n            self._highlights: Dict[TokenType, QTextCharFormat] = {}\\n            self._proportional_highlights: Dict[TokenType, QTextCharFormat] = {}\\n\\n            self._code_font_families = [\\\"Menlo\\\", \\\"Consolas\\\", \\\"Monaco\\\", \\\"monospace\\\"]\\n            self._initialize_highlights()\\n            self._initialize_proportional_highlights()\\n            self._create_theme_icons()\\n\\n    def _initialize_colors(self) -> Dict[ColorRole, Dict[ColorMode, str]]:\\n        \\\"\\\"\\\"Initialize the application colours for both light and dark modes.\\\"\\\"\\\"\\n        return {\\n            # Background colours\\n            ColorRole.BACKGROUND_PRIMARY: {\\n                ColorMode.DARK: \\\"#080808\\\",\\n                ColorMode.LIGHT: \\\"#e0e0e0\\\"\\n            },\\n            ColorRole.BACKGROUND_SECONDARY: {\\n                ColorMode.DARK: \\\"#141414\\\",\\n                ColorMode.LIGHT: \\\"#ececec\\\"\\n            },\\n            ColorRole.BACKGROUND_TERTIARY: {\\n                ColorMode.DARK: \\\"#242424\\\",\\n                ColorMode.LIGHT: \\\"#fcfcfc\\\"\\n            },\\n            ColorRole.BACKGROUND_DIALOG: {\\n                ColorMode.DARK: \\\"#282828\\\",\\n                ColorMode.LIGHT: \\\"#d0d0d0\\\"\\n            },\\n\\n            # Text colours\\n            ColorRole.TEXT_PRIMARY: {\\n                ColorMode.DARK: \\\"#d8d8d8\\\",\\n                ColorMode.LIGHT: \\\"#202020\\\"\\n            },\\n            ColorRole.TEXT_BRIGHT: {\\n                ColorMode.DARK: \\\"#ffffff\\\",\\n                ColorMode.LIGHT: \\\"#000000\\\"\\n            },\\n            ColorRole.TEXT_HEADING: {\\n                ColorMode.DARK: \\\"#ffe0a0\\\",\\n                ColorMode.LIGHT: \\\"#204080\\\"\\n            },\\n            ColorRole.TEXT_HEADING_BRIGHT: {\\n                ColorMode.DARK: \\\"#ffe8a0\\\",\\n                ColorMode.LIGHT: \\\"#203880\\\"\\n            },\\n            ColorRole.TEXT_DISABLED: {\\n                ColorMode.DARK: \\\"#707070\\\",\\n                ColorMode.LIGHT: \\\"#909090\\\"\\n            },\\n            ColorRole.TEXT_SELECTED: {\\n                ColorMode.DARK: \\\"#404058\\\",\\n                ColorMode.LIGHT: \\\"#c8c8dc\\\"\\n            },\\n            ColorRole.TEXT_FOUND: {\\n                ColorMode.DARK: \\\"#885050\\\",\\n                ColorMode.LIGHT: \\\"#e0b4b4\\\"\\n            },\\n            ColorRole.TEXT_FOUND_DIM: {\\n                ColorMode.DARK: \\\"#583838\\\",\\n                ColorMode.LIGHT: \\\"#f4d8d8\\\"\\n            },\\n            ColorRole.TEXT_RECOMMENDED: {\\n                ColorMode.DARK: \\\"#ffffff\\\",\\n                ColorMode.LIGHT: \\\"#ffffff\\\"\\n            },\\n            ColorRole.TEXT_LINK: {\\n                ColorMode.DARK: \\\"#80a0ff\\\",\\n                ColorMode.LIGHT: \\\"#0000ff\\\"\\n            },\\n            ColorRole.TEXT_INACTIVE: {\\n                ColorMode.DARK: \\\"#909090\\\",\\n                ColorMode.LIGHT: \\\"#707070\\\"\\n            },\\n            ColorRole.TEXT_EPHEMERAL: {\\n                ColorMode.DARK: \\\"#e0a080\\\",\\n                ColorMode.LIGHT: \\\"#a0785c\\\"\\n            },\\n            ColorRole.TEXT_EPHEMERAL_INACTIVE: {\\n                ColorMode.DARK: \\\"#a06040\\\",\\n                ColorMode.LIGHT: \\\"#c09070\\\"\\n            },\\n            ColorRole.TEXT_ERROR: {\\n                ColorMode.DARK: \\\"#e03020\\\",\\n                ColorMode.LIGHT: \\\"#f04030\\\"\\n            },\\n            ColorRole.TEXT_ERROR_INACTIVE: {\\n                ColorMode.DARK: \\\"#e06050\\\",\\n                ColorMode.LIGHT: \\\"#f07060\\\"\\n            },\\n\\n            # Edit box colours\\n            ColorRole.EDIT_BOX_BORDER: {\\n                ColorMode.DARK: \\\"#6060c0\\\",\\n                ColorMode.LIGHT: \\\"#404080\\\"\\n            },\\n            ColorRole.EDIT_BOX_BACKGROUND: {\\n                ColorMode.DARK: \\\"#242454\\\",\\n                ColorMode.LIGHT: \\\"#b8b8f8\\\"\\n            },\\n            ColorRole.EDIT_BOX_ERROR: {\\n                ColorMode.DARK: \\\"#c03020\\\",\\n                ColorMode.LIGHT: \\\"#d04030\\\"\\n            },\\n\\n            # Tab colours\\n            ColorRole.TAB_BAR_BACKGROUND: {\\n                ColorMode.DARK: \\\"#000000\\\",\\n                ColorMode.LIGHT: \\\"#d8d8d8\\\"\\n            },\\n            ColorRole.TAB_BACKGROUND_ACTIVE: {\\n                ColorMode.DARK: \\\"#1e1e1e\\\",\\n                ColorMode.LIGHT: \\\"#ffffff\\\"\\n            },\\n            ColorRole.TAB_BACKGROUND_INACTIVE: {\\n                ColorMode.DARK: \\\"#141414\\\",\\n                ColorMode.LIGHT: \\\"#f0f0f0\\\"\\n            },\\n            ColorRole.TAB_BACKGROUND_HOVER: {\\n                ColorMode.DARK: \\\"#242454\\\",\\n                ColorMode.LIGHT: \\\"#b8b8f8\\\"\\n            },\\n            ColorRole.TAB_BACKGROUND_UPDATED: {\\n                ColorMode.DARK: \\\"#3c2054\\\",\\n                ColorMode.LIGHT: \\\"#f0d0f8\\\"\\n            },\\n            ColorRole.TAB_BORDER_ACTIVE: {\\n                ColorMode.DARK: \\\"#8080ff\\\",\\n                ColorMode.LIGHT: \\\"#3030ff\\\"\\n            },\\n\\n            # Button colours\\n            ColorRole.BUTTON_BACKGROUND: {\\n                ColorMode.DARK: \\\"#0c0c0c\\\",\\n                ColorMode.LIGHT: \\\"#e8e8e8\\\"\\n            },\\n            ColorRole.BUTTON_BACKGROUND_PRESSED: {\\n                ColorMode.DARK: \\\"#505050\\\",\\n                ColorMode.LIGHT: \\\"#b0b0b0\\\"\\n            },\\n            ColorRole.BUTTON_BACKGROUND_HOVER: {\\n                ColorMode.DARK: \\\"#404040\\\",\\n                ColorMode.LIGHT: \\\"#c0c0c0\\\"\\n            },\\n            ColorRole.BUTTON_SECONDARY_BACKGROUND: {\\n                ColorMode.DARK: \\\"#2c2c2c\\\",\\n                ColorMode.LIGHT: \\\"#d8d8d8\\\"\\n            },\\n            ColorRole.BUTTON_SECONDARY_BACKGROUND_PRESSED: {\\n                ColorMode.DARK: \\\"#505050\\\",\\n                ColorMode.LIGHT: \\\"#b0b0b0\\\"\\n            },\\n            ColorRole.BUTTON_SECONDARY_BACKGROUND_HOVER: {\\n                ColorMode.DARK: \\\"#404040\\\",\\n                ColorMode.LIGHT: \\\"#c0c0c0\\\"\\n            },\\n            ColorRole.BUTTON_BACKGROUND_RECOMMENDED: {\\n                ColorMode.DARK: \\\"#2050c0\\\",\\n                ColorMode.LIGHT: \\\"#3060d0\\\"\\n            },\\n            ColorRole.BUTTON_BACKGROUND_RECOMMENDED_PRESSED: {\\n                ColorMode.DARK: \\\"#4070e0\\\",\\n                ColorMode.LIGHT: \\\"#1040b0\\\"\\n            },\\n            ColorRole.BUTTON_BACKGROUND_RECOMMENDED_HOVER: {\\n                ColorMode.DARK: \\\"#3060d0\\\",\\n                ColorMode.LIGHT: \\\"#2050c0\\\"\\n            },\\n            ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE: {\\n                ColorMode.DARK: \\\"#c03020\\\",\\n                ColorMode.LIGHT: \\\"#d04030\\\"\\n            },\\n            ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_PRESSED: {\\n                ColorMode.DARK: \\\"#e05040\\\",\\n                ColorMode.LIGHT: \\\"#b02010\\\"\\n            },\\n            ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_HOVER: {\\n                ColorMode.DARK: \\\"#d04030\\\",\\n                ColorMode.LIGHT: \\\"#c03020\\\"\\n            },\\n            ColorRole.BUTTON_BACKGROUND_DISABLED: {\\n                ColorMode.DARK: \\\"#202020\\\",\\n                ColorMode.LIGHT: \\\"#d8d8d8\\\"\\n            },\\n\\n            # Menu elements\\n            ColorRole.MENU_BACKGROUND: {\\n                ColorMode.DARK: \\\"#2d2d2d\\\",\\n                ColorMode.LIGHT: \\\"#f0f0f0\\\"\\n            },\\n            ColorRole.MENU_HOVER: {\\n                ColorMode.DARK: \\\"#3060d0\\\",\\n                ColorMode.LIGHT: \\\"#2050c0\\\"\\n            },\\n            ColorRole.MENU_BORDER: {\\n                ColorMode.DARK: \\\"#606060\\\",\\n                ColorMode.LIGHT: \\\"#b0b0b0\\\"\\n            },\\n\\n            # Splitter bars\\n            ColorRole.SPLITTER: {\\n                ColorMode.DARK: \\\"#606060\\\",\\n                ColorMode.LIGHT: \\\"#b0b0b0\\\"\\n            },\\n\\n            # Scroll bar elements\\n            ColorRole.SCROLLBAR_BACKGROUND: {\\n                ColorMode.DARK: \\\"#2d2d2d\\\",\\n                ColorMode.LIGHT: \\\"#f0f0f0\\\"\\n            },\\n            ColorRole.SCROLLBAR_HANDLE: {\\n                ColorMode.DARK: \\\"#404040\\\",\\n                ColorMode.LIGHT: \\\"#c0c0c0\\\"\\n            },\\n\\n            # Table elements\\n            ColorRole.TABLE_BORDER: {\\n                ColorMode.DARK: \\\"#808080\\\",\\n                ColorMode.LIGHT: \\\"#a0a0a0\\\"\\n            },\\n            ColorRole.TABLE_HEADER_BACKGROUND: {\\n                ColorMode.DARK: \\\"#484838\\\",\\n                ColorMode.LIGHT: \\\"#d0d0e0\\\"\\n            },\\n\\n            # Message colours\\n            ColorRole.MESSAGE_BACKGROUND: {\\n                ColorMode.DARK: \\\"#020202\\\",\\n                ColorMode.LIGHT: \\\"#f2f2f2\\\"\\n            },\\n            ColorRole.MESSAGE_USER_BACKGROUND: {\\n                ColorMode.DARK: \\\"#121212\\\",\\n                ColorMode.LIGHT: \\\"#e4e4e4\\\"\\n            },\\n            ColorRole.MESSAGE_FOCUSED: {\\n                ColorMode.DARK: \\\"#3a4654\\\",\\n                ColorMode.LIGHT: \\\"#aab6c4\\\"\\n            },\\n            ColorRole.MESSAGE_USER: {\\n                ColorMode.DARK: \\\"#8080c0\\\",\\n                ColorMode.LIGHT: \\\"#6060a0\\\"\\n            },\\n            ColorRole.MESSAGE_AI: {\\n                ColorMode.DARK: \\\"#80c080\\\",\\n                ColorMode.LIGHT: \\\"#40a040\\\"\\n            },\\n            ColorRole.MESSAGE_REASONING: {\\n                ColorMode.DARK: \\\"#808080\\\",\\n                ColorMode.LIGHT: \\\"#808080\\\"\\n            },\\n            ColorRole.MESSAGE_TOOL_CALL: {\\n                ColorMode.DARK: \\\"#808080\\\",\\n                ColorMode.LIGHT: \\\"#808080\\\"\\n            },\\n            ColorRole.MESSAGE_TOOL_RESULT: {\\n                ColorMode.DARK: \\\"#808080\\\",\\n                ColorMode.LIGHT: \\\"#808080\\\"\\n            },\\n            ColorRole.MESSAGE_SYSTEM_ERROR: {\\n                ColorMode.DARK: \\\"#c08080\\\",\\n                ColorMode.LIGHT: \\\"#a04040\\\"\\n            },\\n            ColorRole.MESSAGE_SYSTEM_SUCCESS: {\\n                ColorMode.DARK: \\\"#80c080\\\",\\n                ColorMode.LIGHT: \\\"#40a040\\\"\\n            },\\n            ColorRole.MESSAGE_LANGUAGE: {\\n                ColorMode.DARK: \\\"#a07850\\\",\\n                ColorMode.LIGHT: \\\"#806040\\\"\\n            },\\n            ColorRole.MESSAGE_BOOKMARK: {\\n                ColorMode.DARK: \\\"#ffdf00\\\",\\n                ColorMode.LIGHT: \\\"#806000\\\"\\n            },\\n            ColorRole.MESSAGE_STREAMING: {\\n                ColorMode.DARK: \\\"#c0a080\\\",\\n                ColorMode.LIGHT: \\\"#a07050\\\"\\n            },\\n            ColorRole.MESSAGE_TRACE: {\\n                ColorMode.DARK: \\\"#a0a0a0\\\",\\n                ColorMode.LIGHT: \\\"#606060\\\"\\n            },\\n            ColorRole.MESSAGE_INFORMATION: {\\n                ColorMode.DARK: \\\"#80b0f0\\\",\\n                ColorMode.LIGHT: \\\"#0060c0\\\"\\n            },\\n            ColorRole.MESSAGE_WARNING: {\\n                ColorMode.DARK: \\\"#f0c040\\\",\\n                ColorMode.LIGHT: \\\"#c0a020\\\"\\n            },\\n            ColorRole.MESSAGE_ERROR: {\\n                ColorMode.DARK: \\\"#ff6060\\\",\\n                ColorMode.LIGHT: \\\"#c03030\\\"\\n            },\\n\\n            # Status bar elements\\n            ColorRole.STATUS_BAR_BACKGROUND: {\\n                ColorMode.DARK: \\\"#121212\\\",\\n                ColorMode.LIGHT: \\\"#e8e8e8\\\"\\n            },\\n            ColorRole.CANARY_BACKGROUND: {\\n                ColorMode.DARK: \\\"#802020\\\",\\n                ColorMode.LIGHT: \\\"#c04040\\\"\\n            },\\n\\n            # Close button states\\n            ColorRole.CLOSE_BUTTON_BACKGROUND_HOVER: {\\n                ColorMode.DARK: \\\"#d04030\\\",\\n                ColorMode.LIGHT: \\\"#c03020\\\"\\n            },\\n\\n            # Line numbers\\n            ColorRole.LINE_NUMBER: {\\n                ColorMode.DARK: \\\"#606060\\\",\\n                ColorMode.LIGHT: \\\"#c0c0c0\\\"\\n            },\\n\\n            # Syntax highlighting\\n            ColorRole.SYNTAX_ERROR: {\\n                ColorMode.DARK: \\\"#ff0000\\\",\\n                ColorMode.LIGHT: \\\"#ff0000\\\"\\n            },\\n            ColorRole.SYNTAX_01: {\\n                ColorMode.DARK: \\\"#80e0d0\\\",\\n                ColorMode.LIGHT: \\\"#007070\\\"\\n            },\\n            ColorRole.SYNTAX_02: {\\n                ColorMode.DARK: \\\"#f0f0f0\\\",\\n                ColorMode.LIGHT: \\\"#202020\\\"\\n            },\\n            ColorRole.SYNTAX_03: {\\n                ColorMode.DARK: \\\"#68b068\\\",\\n                ColorMode.LIGHT: \\\"#407040\\\"\\n            },\\n            ColorRole.SYNTAX_04: {\\n                ColorMode.DARK: \\\"#ffa0eb\\\",\\n                ColorMode.LIGHT: \\\"#c000a0\\\"\\n            },\\n            ColorRole.SYNTAX_05: {\\n                ColorMode.DARK: \\\"#808080\\\",\\n                ColorMode.LIGHT: \\\"#606060\\\"\\n            },\\n            ColorRole.SYNTAX_06: {\\n                ColorMode.DARK: \\\"#90e0e8\\\",\\n                ColorMode.LIGHT: \\\"#0080a0\\\"\\n            },\\n            ColorRole.SYNTAX_07: {\\n                ColorMode.DARK: \\\"#e0e080\\\",\\n                ColorMode.LIGHT: \\\"#a0a000\\\"\\n            },\\n            ColorRole.SYNTAX_08: {\\n                ColorMode.DARK: \\\"#b090f0\\\",\\n                ColorMode.LIGHT: \\\"#5040c0\\\"\\n            },\\n            ColorRole.SYNTAX_09: {\\n                ColorMode.DARK: \\\"#90e0e8\\\",\\n                ColorMode.LIGHT: \\\"#0080a0\\\"\\n            },\\n            ColorRole.SYNTAX_10: {\\n                ColorMode.DARK: \\\"#d070d0\\\",\\n                ColorMode.LIGHT: \\\"#a000a0\\\"\\n            },\\n            ColorRole.SYNTAX_11: {\\n                ColorMode.DARK: \\\"#80b0f0\\\",\\n                ColorMode.LIGHT: \\\"#0060c0\\\"\\n            },\\n            ColorRole.SYNTAX_12: {\\n                ColorMode.DARK: \\\"#f08080\\\",\\n                ColorMode.LIGHT: \\\"#c03030\\\"\\n            },\\n            ColorRole.SYNTAX_13: {\\n                ColorMode.DARK: \\\"#ffc0eb\\\",\\n                ColorMode.LIGHT: \\\"#c080a0\\\"\\n            },\\n            ColorRole.SYNTAX_14: {\\n                ColorMode.DARK: \\\"#f0e060\\\",\\n                ColorMode.LIGHT: \\\"#a09040\\\"\\n            },\\n            ColorRole.SYNTAX_15: {\\n                ColorMode.DARK: \\\"#70e0e8\\\",\\n                ColorMode.LIGHT: \\\"#2090a0\\\"\\n            },\\n            ColorRole.SYNTAX_16: {\\n                ColorMode.DARK: \\\"#88d048\\\",\\n                ColorMode.LIGHT: \\\"#508020\\\"\\n            },\\n            ColorRole.SYNTAX_17: {\\n                ColorMode.DARK: \\\"#c0c0c0\\\",\\n                ColorMode.LIGHT: \\\"#404040\\\"\\n            },\\n            ColorRole.SYNTAX_18: {\\n                ColorMode.DARK: \\\"#80b080\\\",\\n                ColorMode.LIGHT: \\\"#609060\\\"\\n            },\\n            ColorRole.SYNTAX_19: {\\n                ColorMode.DARK: \\\"#c87050\\\",\\n                ColorMode.LIGHT: \\\"#a04020\\\"\\n            },\\n            ColorRole.SYNTAX_20: {\\n                ColorMode.DARK: \\\"#c05040\\\",\\n                ColorMode.LIGHT: \\\"#803828\\\"\\n             },\\n            ColorRole.SYNTAX_21: {\\n                ColorMode.DARK: \\\"#30c090\\\",\\n                ColorMode.LIGHT: \\\"#24906c\\\"\\n            },\\n\\n            # Terminal basic colors\\n            ColorRole.TERM_BLACK: {\\n                ColorMode.DARK: \\\"#000000\\\",\\n                ColorMode.LIGHT: \\\"#000000\\\"\\n            },\\n            ColorRole.TERM_RED: {\\n                ColorMode.DARK: \\\"#cd0000\\\",\\n                ColorMode.LIGHT: \\\"#cd0000\\\"\\n            },\\n            ColorRole.TERM_GREEN: {\\n                ColorMode.DARK: \\\"#00cd00\\\",\\n                ColorMode.LIGHT: \\\"#00cd00\\\"\\n            },\\n            ColorRole.TERM_YELLOW: {\\n                ColorMode.DARK: \\\"#cdcd00\\\",\\n                ColorMode.LIGHT: \\\"#cdcd00\\\"\\n            },\\n            ColorRole.TERM_BLUE: {\\n                ColorMode.DARK: \\\"#0000ee\\\",\\n                ColorMode.LIGHT: \\\"#0000ee\\\"\\n            },\\n            ColorRole.TERM_MAGENTA: {\\n                ColorMode.DARK: \\\"#cd00cd\\\",\\n                ColorMode.LIGHT: \\\"#cd00cd\\\"\\n            },\\n            ColorRole.TERM_CYAN: {\\n                ColorMode.DARK: \\\"#00cdcd\\\",\\n                ColorMode.LIGHT: \\\"#00cdcd\\\"\\n            },\\n            ColorRole.TERM_WHITE: {\\n                ColorMode.DARK: \\\"#e5e5e5\\\",\\n                ColorMode.LIGHT: \\\"#e5e5e5\\\"\\n            },\\n\\n            # Terminal bright colors\\n            ColorRole.TERM_BRIGHT_BLACK: {\\n                ColorMode.DARK: \\\"#7f7f7f\\\",\\n                ColorMode.LIGHT: \\\"#7f7f7f\\\"\\n            },\\n            ColorRole.TERM_BRIGHT_RED: {\\n                ColorMode.DARK: \\\"#ff0000\\\",\\n                ColorMode.LIGHT: \\\"#ff0000\\\"\\n            },\\n            ColorRole.TERM_BRIGHT_GREEN: {\\n                ColorMode.DARK: \\\"#00ff00\\\",\\n                ColorMode.LIGHT: \\\"#00ff00\\\"\\n            },\\n            ColorRole.TERM_BRIGHT_YELLOW: {\\n                ColorMode.DARK: \\\"#ffff00\\\",\\n                ColorMode.LIGHT: \\\"#ffff00\\\"\\n            },\\n            ColorRole.TERM_BRIGHT_BLUE: {\\n                ColorMode.DARK: \\\"#5c5cff\\\",\\n                ColorMode.LIGHT: \\\"#5c5cff\\\"\\n            },\\n            ColorRole.TERM_BRIGHT_MAGENTA: {\\n                ColorMode.DARK: \\\"#ff00ff\\\",\\n                ColorMode.LIGHT: \\\"#ff00ff\\\"\\n            },\\n            ColorRole.TERM_BRIGHT_CYAN: {\\n                ColorMode.DARK: \\\"#00ffff\\\",\\n                ColorMode.LIGHT: \\\"#00ffff\\\"\\n            },\\n            ColorRole.TERM_BRIGHT_WHITE: {\\n                ColorMode.DARK: \\\"#ffffff\\\",\\n                ColorMode.LIGHT: \\\"#ffffff\\\"\\n            }\\n        }\\n\\n    def _initialize_highlights(self) -> None:\\n        # Mapping from token type to colour\\n        colour_mapping = {\\n            TokenType.ADDRESS: ColorRole.SYNTAX_01,\\n            TokenType.ANNOTATION: ColorRole.SYNTAX_08,\\n            TokenType.ARGUMENT: ColorRole.SYNTAX_11,\\n            TokenType.ATTRIBUTE: ColorRole.SYNTAX_08,\\n            TokenType.BACKTICK: ColorRole.SYNTAX_12,\\n            TokenType.BOOLEAN: ColorRole.SYNTAX_16,\\n            TokenType.BOLD: ColorRole.SYNTAX_21,\\n            TokenType.BOLD_END: ColorRole.SYNTAX_07,\\n            TokenType.BOLD_START: ColorRole.SYNTAX_07,\\n            TokenType.BLOCKQUOTE: ColorRole.SYNTAX_13,\\n            TokenType.CHARACTER: ColorRole.SYNTAX_20,\\n            TokenType.CODE: ColorRole. SYNTAX_02,\\n            TokenType.COMMAND: ColorRole.SYNTAX_07,\\n            TokenType.COMMENT: ColorRole.SYNTAX_03,\\n            TokenType.CSS_AT_RULE: ColorRole.SYNTAX_04,\\n            TokenType.DIMENSION: ColorRole.SYNTAX_16,\\n            TokenType.DOC_COMMENT: ColorRole.SYNTAX_03,\\n            TokenType.DOCTYPE: ColorRole.SYNTAX_05,\\n            TokenType.DIRECTIVE: ColorRole.SYNTAX_18,\\n            TokenType.ELEMENT: ColorRole.SYNTAX_06,\\n            TokenType.ERROR: ColorRole.SYNTAX_ERROR,\\n            TokenType.FENCE: ColorRole.SYNTAX_14,\\n            TokenType.FENCE_END: ColorRole.SYNTAX_14,\\n            TokenType.FENCE_START: ColorRole.SYNTAX_14,\\n            TokenType.FUNCTION_OR_METHOD: ColorRole.SYNTAX_07,\\n            TokenType.GENERIC_END: ColorRole.SYNTAX_17,\\n            TokenType.GENERIC_START: ColorRole.SYNTAX_17,\\n            TokenType.GENERIC_TYPE: ColorRole.SYNTAX_21,\\n            TokenType.HASH: ColorRole.SYNTAX_11,\\n            TokenType.HEADING: ColorRole.SYNTAX_08,\\n            TokenType.HEX: ColorRole.SYNTAX_16,\\n            TokenType.HORIZONTAL_RULE: ColorRole.SYNTAX_21,\\n            TokenType.HTML_ATTRIBUTE: ColorRole.SYNTAX_09,\\n            TokenType.HTML_TAG: ColorRole.SYNTAX_10,\\n            TokenType.IDENTIFIER: ColorRole.SYNTAX_11,\\n            TokenType.IMAGE_ALT_END: ColorRole.SYNTAX_07,\\n            TokenType.IMAGE_ALT_TEXT: ColorRole.SYNTAX_16,\\n            TokenType.IMAGE_END: ColorRole.SYNTAX_07,\\n            TokenType.IMAGE_START: ColorRole.SYNTAX_07,\\n            TokenType.IMAGE_URL: ColorRole.SYNTAX_20,\\n            TokenType.INLINE_CODE: ColorRole.SYNTAX_12,\\n            TokenType.INLINE_CODE_END: ColorRole.SYNTAX_07,\\n            TokenType.INLINE_CODE_START: ColorRole.SYNTAX_07,\\n            TokenType.ITALIC: ColorRole.SYNTAX_09,\\n            TokenType.ITALIC_END: ColorRole.SYNTAX_07,\\n            TokenType.ITALIC_START: ColorRole.SYNTAX_07,\\n            TokenType.JSON_KEY: ColorRole.SYNTAX_07,\\n            TokenType.KEYWORD: ColorRole.SYNTAX_13,\\n            TokenType.LANGUAGE: ColorRole.SYNTAX_14,\\n            TokenType.LIFETIME: ColorRole.SYNTAX_17,\\n            TokenType.LINK_END: ColorRole.SYNTAX_07,\\n            TokenType.LINK_START: ColorRole.SYNTAX_07,\\n            TokenType.LINK_TEXT: ColorRole.SYNTAX_16,\\n            TokenType.LINK_TEXT_END: ColorRole.SYNTAX_07,\\n            TokenType.LINK_URL: ColorRole.SYNTAX_20,\\n            TokenType.LIST_MARKER: ColorRole.SYNTAX_15,\\n            TokenType.LPAREN: ColorRole.SYNTAX_17,\\n            TokenType.NUMBER: ColorRole.SYNTAX_16,\\n            TokenType.OPERATOR: ColorRole.SYNTAX_17,\\n            TokenType.OPTION: ColorRole.SYNTAX_10,\\n            TokenType.OPTION_VALUE: ColorRole.SYNTAX_08,\\n            TokenType.PREPROCESSOR: ColorRole.SYNTAX_05,\\n            TokenType.REGEXP: ColorRole.SYNTAX_19,\\n            TokenType.RPAREN: ColorRole.SYNTAX_17,\\n            TokenType.RUNE: ColorRole.SYNTAX_20,\\n            TokenType.STRING: ColorRole.SYNTAX_20,\\n            TokenType.TABLE: ColorRole.SYNTAX_03,\\n            TokenType.TEXT: ColorRole.SYNTAX_17,\\n            TokenType.TYPE: ColorRole.SYNTAX_21,\\n            TokenType.XML_DOC: ColorRole.SYNTAX_03\\n        }\\n\\n        for token_type, role in colour_mapping.items():\\n            text_format = self._create_highlight(role)\\n            self._highlights[token_type] = text_format\\n\\n        self._error_highlight = self._create_highlight(ColorRole.SYNTAX_ERROR)\\n\\n    def _create_highlight(self, role: ColorRole) -> QTextCharFormat:\\n        text_highlight = QTextCharFormat()\\n        text_highlight.setFontFamilies(self._code_font_families)\\n        text_highlight.setFontFixedPitch(True)\\n        text_highlight.setForeground(QColor(self._colors[role][self._color_mode]))\\n\\n        return text_highlight\\n\\n    def _initialize_proportional_highlights(self) -> None:\\n        # Mapping from token type to colour\\n        colour_mapping = {\\n            TokenType.BOLD: ColorRole.SYNTAX_21,\\n            TokenType.BOLD_END: ColorRole.SYNTAX_07,\\n            TokenType.BOLD_START: ColorRole.SYNTAX_07,\\n            TokenType.BLOCKQUOTE: ColorRole.SYNTAX_13,\\n            TokenType.FENCE: ColorRole.SYNTAX_14,\\n            TokenType.HEADING: ColorRole.SYNTAX_08,\\n            TokenType.IMAGE_ALT_END: ColorRole.SYNTAX_07,\\n            TokenType.IMAGE_ALT_TEXT: ColorRole.SYNTAX_16,\\n            TokenType.IMAGE_END: ColorRole.SYNTAX_07,\\n            TokenType.IMAGE_START: ColorRole.SYNTAX_07,\\n            TokenType.IMAGE_URL: ColorRole.SYNTAX_20,\\n            TokenType.INLINE_CODE_END: ColorRole.SYNTAX_07,\\n            TokenType.INLINE_CODE_START: ColorRole.SYNTAX_07,\\n            TokenType.ITALIC: ColorRole.SYNTAX_09,\\n            TokenType.ITALIC_END: ColorRole.SYNTAX_07,\\n            TokenType.ITALIC_START: ColorRole.SYNTAX_07,\\n            TokenType.LINK_END: ColorRole.SYNTAX_07,\\n            TokenType.LINK_START: ColorRole.SYNTAX_07,\\n            TokenType.LINK_TEXT: ColorRole.SYNTAX_16,\\n            TokenType.LINK_TEXT_END: ColorRole.SYNTAX_07,\\n            TokenType.LINK_URL: ColorRole.SYNTAX_20,\\n            TokenType.LIST_MARKER: ColorRole.SYNTAX_15,\\n            TokenType.TABLE: ColorRole.SYNTAX_03,\\n            TokenType.TEXT: ColorRole.SYNTAX_17\\n        }\\n\\n        for token_type, role in colour_mapping.items():\\n            text_format = self._create_proportional_highlight(role)\\n            self._proportional_highlights[token_type] = text_format\\n\\n        self._proportional_highlights[TokenType.INLINE_CODE] = self._create_highlight(ColorRole.SYNTAX_12)\\n        self._error_proportional_highlight = self._create_proportional_highlight(ColorRole.SYNTAX_ERROR)\\n\\n    def _create_proportional_highlight(self, role: ColorRole) -> QTextCharFormat:\\n        text_highlight = QTextCharFormat()\\n        text_highlight.setForeground(QColor(self._colors[role][self._color_mode]))\\n\\n        return text_highlight\\n\\n    def _create_app_icon_svg(self, bg_color: str, text_color: str) -> str:\\n        \\\"\\\"\\\"\\n        Create an application icon SVG with specified colors.\\n\\n        Args:\\n            bg_color: Background color in hex format\\n            text_color: Text color in hex format\\n\\n        Returns:\\n            str: SVG markup for the application icon\\n        \\\"\\\"\\\"\\n        return f'''\\n            <svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"128\\\" height=\\\"128\\\" viewBox=\\\"0 0 384 384\\\">\\n                <rect x=\\\"0\\\" y=\\\"0\\\" width=\\\"384\\\" height=\\\"384\\\" fill=\\\"{bg_color}\\\"/>\\n                <g fill=\\\"{text_color}\\\">\\n                    <g transform=\\\"translate(38.400004, 250.960113)\\\">\\n                        <path d=\\\"M 97.234375 0\\n                            L 92.125 -64.078125\\n                            L 91.46875 -64.078125\\n                            L 69.328125-0.65625\\n                            L 54.640625 -0.65625\\n                            L 32.5 -64.078125\\n                            L 31.84375 -64.078125\\n                            L 26.734375 0\\n                            L 2.09375 0\\n                            L 11.796875 -108.109375\\n                            L 38 -108.109375\\n                            L 61.984375 -45.734375\\n                            L 85.96875 -108.109375\\n                            L 112.171875 -108.109375\\n                            L 121.875 0\\n                            Z\\\"/>\\n                    </g>\\n                    <g transform=\\\"translate(162.225522, 250.960113)\\\">\\n                        <path d=\\\"M 76 -108.109375\\n                            L 44.15625 -71.03125\\n                            C 46 -72.070312 48.578125 -72.59375 51.890625 -72.59375\\n                            C 55.734375 -72.59375 59.617188 -71.785156 63.546875 -70.171875\\n                            C 67.484375 -68.554688 71.175781 -66.238281 74.625 -63.21875\\n                            C 78.082031 -60.207031 80.898438 -56.210938 83.078125 -51.234375\\n                            C 85.265625 -46.253906 86.359375 -40.753906 86.359375 -34.734375\\n                            C 86.359375 -28.609375 85.203125 -23.125 82.890625 -18.28125\\n                            C 80.578125 -13.4375 77.472656 -9.59375 73.578125 -6.75\\n                            C 69.691406 -3.90625 65.429688 -1.738281 60.796875 -0.25\\n                            C 56.171875 1.226562 51.328125 1.96875 46.265625 1.96875\\n                            C 34.117188 1.96875 23.894531 -1.566406 15.59375 -8.640625\\n                            C 7.289062 -15.722656 3.140625 -24.421875 3.140625 -34.734375\\n                            C 3.140625 -43.460938 4.363281 -50.644531 6.8125 -56.28125\\n                            C 9.257812 -61.914062 13.71875 -69.101562 20.1875 -77.84375\\n                            L 45.609375 -108.109375\\n                            Z\\n                            M 28.703125 -34.734375\\n                            C 28.703125 -30.015625 30.226562 -26.101562 33.28125 -23\\n                            C 36.34375 -19.894531 40.273438 -18.34375 45.078125 -18.34375\\n                            C 49.878906 -18.34375 53.851562 -19.894531 57 -23\\n                            C 60.144531 -26.101562 61.71875 -30.015625 61.71875 -34.734375\\n                            C 61.71875 -39.535156 60.125 -43.53125 56.9375 -46.71875\\n                            C 53.75 -49.90625 49.796875 -51.5 45.078125 -51.5\\n                            C 40.535156 -51.5 36.671875 -49.90625 33.484375 -46.71875\\n                            C 30.296875 -43.53125 28.703125 -39.535156 28.703125 -34.734375\\n                            Z\\\"/>\\n                    </g>\\n                    <g transform=\\\"translate(249.066902, 250.960113)\\\">\\n                        <path d=\\\"M 7.859375 -108.109375\\n                            L 46.515625 -108.109375\\n                            C 56.910156 -108.109375 65.382812 -105.332031 71.9375 -99.78125\\n                            C 78.488281 -94.238281 81.765625 -86.3125 81.765625 -76\\n                            C 81.765625 -68.050781 79.773438 -61.390625 75.796875 -56.015625\\n                            C 71.828125 -50.648438 66.4375 -46.875 59.625 -44.6875\\n                            L 96.84375 0\\n                            L 65.515625 0\\n                            L 32.5 -42.71875\\n                            L 32.5 0\\n                            L 7.859375 0\\n                            Z\\n                            M 32.5 -60.15625\\n                            L 35.375 -60.15625\\n                            C 37.65625 -60.15625 39.578125 -60.195312 41.140625 -60.28125\\n                            C 42.710938 -60.363281 44.503906 -60.664062 46.515625 -61.1875\\n                            C 48.523438 -61.71875 50.140625 -62.460938 51.359375 -63.421875\\n                            C 52.585938 -64.390625 53.640625 -65.789062 54.515625 -67.625\\n                            C 55.390625 -69.457031 55.828125 -71.679688 55.828125 -74.296875\\n                            C 55.828125 -76.921875 55.390625 -79.148438 54.515625 -80.984375\\n                            C 53.640625 -82.816406 52.585938 -84.210938 51.359375 -85.171875\\n                            C 50.140625 -86.140625 48.523438 -86.882812 46.515625 -87.40625\\n                            C 44.503906 -87.925781 42.710938 -88.226562 41.140625 -88.3125\\n                            C 39.578125 -88.40625 37.65625 -88.453125 35.375 -88.453125\\n                            L 32.5 -88.453125\\n                            Z\\\"/>\\n                    </g>\\n                </g>\\n            </svg>\\n        '''\\n\\n    def _write_icon(self, name: str, svg_data: str) -> None:\\n        icon_dir = os.path.expanduser(\\\"~/.humbug/icons\\\")\\n        with open(os.path.join(icon_dir, name), 'w', encoding='utf-8') as f:\\n            f.write(svg_data)\\n\\n    def _create_active_inactive_theme_icons(self, active: bool, suffix: str, color: str) -> None:\\n        prefix = \\\"\\\" if active else \\\"inactive-\\\"\\n\\n        # Close button - visible version\\n        self._write_icon(f'{prefix}close-{suffix}.svg', f'''\\n            <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                    d=\\\"M16,16 L48,48 M48,16 L16,48\\\"/>\\n            </svg>\\n        ''')\\n\\n        # Conversation tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\\n        self._write_icon(f'{prefix}conversation-{suffix}.svg', f'''\\n            <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                <path d=\\\"M8 10H8.01\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M12 10H12.01\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M16 10H16.01\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M21 13V7C21 5.11438 21 4.17157 20.4142 3.58579C19.8284 3 18.8856 3 17 3H7C5.11438 3\\n                    4.17157 3 3.58579 3.58579C3 4.17157 3 5.11438 3 7V13C3 14.8856 3 15.8284 3.58579 16.4142C4.17157\\n                    17 5.11438 17 7 17H7.5C7.77614 17 8 17.2239 8 17.5V20V20.1499C8 20.5037 8.40137 20.7081\\n                    8.6875 20.5L13.0956 17.2941C13.3584 17.103 13.675 17 14 17H17C18.8856 17 19.8284 17 20.4142\\n                    16.4142C21 15.8284 21 14.8856 21 13Z\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linejoin=\\\"round\\\"/>\\n            </svg>\\n        ''')\\n\\n        # Editor tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\\n        self._write_icon(f'{prefix}editor-{suffix}.svg', f'''\\n            <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                <path d=\\\"M13 21H21\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M20.0651 7.39423L7.09967 20.4114C6.72438 20.7882 6.21446 21 5.68265 21H4.00383C3.44943\\n                    21 3 20.5466 3 19.9922V18.2987C3 17.7696 3.20962 17.2621 3.58297 16.8873L16.5517 3.86681C19.5632\\n                    1.34721 22.5747 4.87462 20.0651 7.39423Z\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\"\\n                    stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M15.3097 5.30981L18.7274 8.72755\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\"\\n                    stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n            </svg>\\n        ''')\\n\\n        # Log tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\\n        self._write_icon(f'{prefix}log-{suffix}.svg', f'''\\n            <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                <path d=\\\"M5 12H7.75044C7.89947 12 8.03179 11.9046 8.07892 11.7632V11.7632L9.875 6.375V6.375C9.91626\\n                    6.25122 10.0918 6.25238 10.1364 6.375V6.375L13.875 16.6562L13.885 16.6837C13.9253 16.7946 14.0812\\n                    16.797 14.125 16.6875V16.6875L15.8841 12.2898V12.2898C15.9541 12.1148 16.1236 12 16.3122 12H19\\\"\\n                    stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n            </svg>\\n        ''')\\n\\n        # Shell tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\\n        self._write_icon(f'{prefix}shell-{suffix}.svg', f'''\\n            <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                <path d=\\\"M3 7C3 5.11438 3 4.17157 3.58579 3.58579C4.17157 3 5.11438 3 7 3H12H17C18.8856 3 19.8284\\n                    3 20.4142 3.58579C21 4.17157 21 5.11438 21 7V10V13C21 14.8856 21 15.8284 20.4142 16.4142C19.8284\\n                    17 18.8856 17 17 17H12H7C5.11438 17 4.17157 17 3.58579 16.4142C3 15.8284 3 14.8856 3 13V10V7Z\\\"\\n                    stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M7 21H17\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M12 17V21\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\"/>\\n            </svg>\\n        ''')\\n\\n        # Terminal tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\\n        self._write_icon(f'{prefix}terminal-{suffix}.svg', f'''\\n            <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                <path d=\\\"M13 15H16\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\"/>\\n                <path d=\\\"M8 15L10.5 12.5V12.5C10.7761 12.2239 10.7761 11.7761 10.5 11.5V11.5L8 9\\\"\\n                    stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M3 8C3 6.11438 3 5.17157 3.58579 4.58579C4.17157 4 5.11438 4 7 4H12H17C18.8856 4\\n                    19.8284 4 20.4142 4.58579C21 5.17157 21 6.11438 21 8V12V16C21 17.8856 21 18.8284 20.4142\\n                    19.4142C19.8284 20 18.8856 20 17 20H12H7C5.11438 20 4.17157 20 3.58579 19.4142C3 18.8284\\n                    3 17.8856 3 16V12V8Z\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linejoin=\\\"round\\\"/>\\n            </svg>\\n        ''')\\n\\n        # Wiki tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\\n        self._write_icon(f'{prefix}wiki-{suffix}.svg', f'''\\n            <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                <path d=\\\"M17.8284 6.82843C18.4065 7.40649 18.6955 7.69552 18.8478 8.06306C19 8.4306 19 8.83935\\n                    19 9.65685L19 17C19 18.8856 19 19.8284 18.4142 20.4142C17.8284 21 16.8856 21 15 21H9C7.11438\\n                    21 6.17157 21 5.58579 20.4142C5 19.8284 5 18.8856 5 17L5 7C5 5.11438 5 4.17157 5.58579\\n                    3.58579C6.17157 3 7.11438 3 9 3H12.3431C13.1606 3 13.5694 3 13.9369 3.15224C14.3045 3.30448\\n                    14.5935 3.59351 15.1716 4.17157L17.8284 6.82843Z\\\" stroke=\\\"{color}\\\"\\n                    stroke-width=\\\"2\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M9 6L11 6\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M10 9L12 9\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M9 12L11 12\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                <path d=\\\"M10 15L12 15\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n            </svg>\\n        ''')\\n\\n    def _create_theme_icons(self) -> None:\\n        \\\"\\\"\\\"Create theme-specific icons in the user's .humbug directory.\\\"\\\"\\\"\\n        icon_dir = os.path.expanduser(\\\"~/.humbug/icons\\\")\\n        os.makedirs(icon_dir, exist_ok=True)\\n\\n        # Create collapsed and expanded arrows for both themes\\n        for mode in ColorMode:\\n            color = self._colors[ColorRole.TEXT_PRIMARY][mode]\\n            inactive_color = self._colors[ColorRole.TEXT_INACTIVE][mode]\\n            suffix = mode.name.lower()\\n\\n            # Right-pointing arrow\\n            self._write_icon(f'arrow-right-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\" d=\\\"M24,16 L40,32 L24,48\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Left-pointing arrow\\n            self._write_icon(f'arrow-left-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\" d=\\\"M40,16 L24,32 L40,48\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Up-pointing arrow\\n            self._write_icon(f'arrow-up-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\" d=\\\"M16,40 L32,24 L48,40\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Down-pointing arrow\\n            self._write_icon(f'arrow-down-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\" d=\\\"M16,24 L32,40 L48,24\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Close button - visible version\\n            self._write_icon(f'close-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                        d=\\\"M16,16 L48,48 M48,16 L16,48\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Checkbox check mark\\n            self._write_icon(f'check-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                        d=\\\"M16,32 L28,44 L48,20\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Right-pointing expand\\n            self._write_icon(f'expand-right-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\" d=\\\"M20,8 L44,32 L20,56\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Left-pointing expand\\n            self._write_icon(f'expand-left-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\" d=\\\"M44,8 L20,32 L44,56\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Down-pointing expand\\n            self._write_icon(f'expand-down-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\" d=\\\"M8,20 L32,44 L56,20\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Bulb on icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\\n            self._write_icon(f'info-{suffix}.svg', f'''\\n                <svg width=\\\"800px\\\" height=\\\"800px\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path d=\\\"M12 7C9.23858 7 7 9.23858 7 12C7 13.3613 7.54402 14.5955 8.42651 15.4972C8.77025 15.8484 9.05281 16.2663\\n                        9.14923 16.7482L9.67833 19.3924C9.86537 20.3272 10.6862 21 11.6395 21H12.3605C13.3138 21 14.1346 20.3272\\n                        14.3217 19.3924L14.8508 16.7482C14.9472 16.2663 15.2297 15.8484 15.5735 15.4972C16.456 14.5955 17\\n                        13.3613 17 12C17 9.23858 14.7614 7 12 7Z\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\"/>\\n                    <path d=\\\"M12 4V3\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                    <path d=\\\"M18 6L19 5\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                    <path d=\\\"M20 12H21\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                    <path d=\\\"M4 12H3\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                    <path d=\\\"M5 5L6 6\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                    <path d=\\\"M10 17H14\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Alert triangle icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\\n            self._write_icon(f'warning-{suffix}.svg', f'''\\n                <svg width=\\\"800px\\\" height=\\\"800px\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path d=\\\"M12 10V13\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\"/>\\n                    <path d=\\\"M12 16V15.9888\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\"/>\\n                    <path d=\\\"M10.2518 5.147L3.6508 17.0287C2.91021 18.3618 3.87415 20 5.39912 20H18.6011C20.126 20 21.09\\n                        18.3618 20.3494 17.0287L13.7484 5.147C12.9864 3.77538 11.0138 3.77538 10.2518 5.147Z\\\"\\n                        stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Alert hexagon icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\\n            self._write_icon(f'critical-{suffix}.svg', f'''\\n                <svg width=\\\"800px\\\" height=\\\"800px\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path d=\\\"M3 9.22843V14.7716C3 15.302 3.21071 15.8107 3.58579 16.1858L7.81421 20.4142C8.18929 20.7893 8.69799\\n                        21 9.22843 21H14.7716C15.302 21 15.8107 20.7893 16.1858 20.4142L20.4142 16.1858C20.7893 15.8107 21\\n                        15.302 21 14.7716V9.22843C21 8.69799 20.7893 8.18929 20.4142 7.81421L16.1858 3.58579C15.8107 3.21071\\n                        15.302 3 14.7716 3H9.22843C8.69799 3 8.18929 3.21071 7.81421 3.58579L3.58579 7.81421C3.21071 8.18929\\n                        3 8.69799 3 9.22843Z\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                    <path d=\\\"M12 8V13\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\"/>\\n                    <path d=\\\"M12 16V15.9888\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\"/>\\n                </svg>\\n            ''')\\n\\n            # Help circle icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\\n            self._write_icon(f'question-{suffix}.svg', f'''\\n                <svg width=\\\"800px\\\" height=\\\"800px\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path d=\\\"M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12\\n                        3C16.9706 3 21 7.02944 21 12Z\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\"/>\\n                    <path d=\\\"M10.5 8.67709C10.8665 8.26188 11.4027 8 12 8C13.1046 8 14 8.89543 14 10C14 10.9337\\n                        13.3601 11.718 12.4949 11.9383C12.2273 12.0064 12 12.2239 12 12.5V12.5V13\\\"\\n                        stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                    <path d=\\\"M12 16H12.01\\\" stroke=\\\"{color}\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n                </svg>\\n            ''')\\n\\n            self._write_icon(f'save-{suffix}.svg', f'''\\n                <svg width=\\\"64\\\" height=\\\"64\\\" viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                        d=\\\"M8,40, L8,56 L56,56 L56,40\\\"/>\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                        d=\\\"M32,8, L32,40\\\"/>\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                        d=\\\"M20,28, L32,40, L44,28\\\"/>\\n                </svg>\\n            ''')\\n\\n            self._write_icon(f'copy-{suffix}.svg', f'''\\n                <svg width=\\\"64\\\" height=\\\"64\\\" viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <rect x=\\\"22\\\" y=\\\"10\\\" width=\\\"32\\\" height=\\\"32\\\" stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"/>\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                        d=\\\"M22,22, L10,22 L10,54 L42,54 L42,42\\\"/>\\n                </svg>\\n            ''')\\n\\n            self._write_icon(f'fork-{suffix}.svg', f'''\\n                <svg width=\\\"64\\\" height=\\\"64\\\" viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                        d=\\\"M32,8 L32,32 M32,32 L8,56 L8,40 M8,56 L24,56 M32,32 L56,56 L56,40 M56,56 L40,56\\\"/>\\n                </svg>\\n            ''')\\n\\n            self._write_icon(f'delete-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                        d=\\\"M12.5,20 L12.5,56 L51.5,56 L51.5,20 M4,20 L60,20 M18,20 L24,8 L40,8 L46,20\\\"/>\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                        d=\\\"M25.5,28 L25.5,46 M38.5,28 L38.5,46\\\"/>\\n                </svg>\\n            ''')\\n\\n            self._write_icon(f'edit-{suffix}.svg', f'''\\n                <svg width=\\\"64\\\" height=\\\"64\\\" viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\"\\n                        d=\\\"M8,56 L56,56 M40,12 L52,24 L24,52 L8,56 L12,40 L40,12 Z\\\"/>\\n                </svg>\\n            ''')\\n\\n            self._write_icon(f'submit-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\" d=\\\"M8,32 L32,8 L56,32\\\"/>\\n                    <path stroke=\\\"{color}\\\" stroke-width=\\\"6\\\" fill=\\\"none\\\" d=\\\"M32,56 L32,8\\\"/>\\n                </svg>\\n            ''')\\n\\n            self._write_icon(f'stop-{suffix}.svg', f'''\\n                <svg viewBox=\\\"0 0 64 64\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                    <circle cx=\\\"32\\\" cy=\\\"32\\\" r=\\\"28\\\" fill=\\\"none\\\" stroke=\\\"{color}\\\" stroke-width=\\\"6\\\"/>\\n                    <rect x=\\\"20\\\" y=\\\"20\\\" width=\\\"24\\\" height=\\\"24\\\" fill=\\\"{color}\\\" stroke=\\\"none\\\"/>\\n                </svg>\\n            ''')\\n\\n            self._create_active_inactive_theme_icons(True, suffix, color)\\n            self._create_active_inactive_theme_icons(False, suffix, inactive_color)\\n\\n        # Create the standard application icon for about dialog\\n        self._write_icon('app-icon.svg', self._create_app_icon_svg('#4040c0', '#ffffff'))\\n\\n        # Create light mode disabled version\\n        self._write_icon('app-icon-disabled-light.svg', self._create_app_icon_svg('#c0c0c0', '#e0e0e0'))\\n\\n        # Create dark mode disabled version\\n        self._write_icon('app-icon-disabled-dark.svg', self._create_app_icon_svg('#202020', '#404040'))\\n\\n    def get_icon_path(self, name: str) -> str:\\n        \\\"\\\"\\\"\\n        Get the path to a theme-appropriate icon.\\n\\n        Args:\\n            name: Base name of the icon (without theme suffix or extension)\\n\\n        Returns:\\n            Full path to the icon file\\n        \\\"\\\"\\\"\\n        icon_dir = os.path.expanduser(\\\"~/.humbug/icons\\\")\\n        theme = \\\"dark\\\" if self._color_mode == ColorMode.DARK else \\\"light\\\"\\n        return Path(os.path.join(icon_dir, f\\\"{name}-{theme}.svg\\\")).as_posix()\\n\\n    def scale_icon(self, icon_path: str, target_size: int) -> QPixmap:\\n        \\\"\\\"\\\"\\n        Load and scale an icon to the appropriate size.\\n\\n        Args:\\n            icon_path: Path to the icon file\\n            target_size: Desired size in pixels\\n\\n        Returns:\\n            Scaled QPixmap of the icon\\n        \\\"\\\"\\\"\\n        pixmap = QPixmap(icon_path)\\n        scaled_size = int(target_size * self._zoom_factor)\\n        return pixmap.scaled(\\n            scaled_size,\\n            scaled_size,\\n            Qt.AspectRatioMode.KeepAspectRatio,\\n            Qt.TransformationMode.SmoothTransformation\\n        )\\n\\n    def get_color(self, role: ColorRole) -> QColor:\\n        \\\"\\\"\\\"\\n        Get a color for a specific role.\\n\\n        Args:\\n            role: The ColorRole to look up\\n\\n        Returns:\\n            QColor: The color for the specified role\\n\\n        Raises:\\n            KeyError: If no color is defined for the role\\n        \\\"\\\"\\\"\\n        return QColor(self._colors[role][self._color_mode])\\n\\n    def get_color_str(self, role: ColorRole) -> str:\\n        \\\"\\\"\\\"\\n        Get a color string for a specific role.\\n\\n        Args:\\n            role: The ColorRole to look up\\n\\n        Returns:\\n            str: The color string (hex format) for the specified role\\n\\n        Raises:\\n            KeyError: If no color is defined for the role\\n        \\\"\\\"\\\"\\n        return self._colors[role][self._color_mode]\\n\\n    def get_highlight(self, token_type: TokenType) -> QTextCharFormat:\\n        \\\"\\\"\\\"\\n        Get the highlight format for a specific token type.\\n\\n        Args:\\n            token_type: The TokenType to look up\\n\\n        Returns:\\n            QTextCharFormat: The highlight format for the specified token type\\n        \\\"\\\"\\\"\\n        if token_type not in self._highlights:\\n            print(f\\\"token type {token_type} not mapped\\\")\\n\\n        return self._highlights.get(token_type, self._error_highlight)\\n\\n    def get_proportional_highlight(self, token_type: TokenType) -> QTextCharFormat:\\n        \\\"\\\"\\\"\\n        Get the proportionally-spaced highlight format for a specific token type.\\n\\n        Args:\\n            token_type: The TokenType to look up\\n\\n        Returns:\\n            QTextCharFormat: The highlight format for the specified token type\\n        \\\"\\\"\\\"\\n        if token_type not in self._proportional_highlights:\\n            print(f\\\"token type {token_type} not mapped\\\")\\n\\n        return self._proportional_highlights.get(token_type, self._error_proportional_highlight)\\n\\n    def _determine_base_font_size(self) -> float:\\n        \\\"\\\"\\\"\\n        Determine the default system font size based on the operating system.\\n\\n        Returns:\\n            int: Base font size in points.\\n        \\\"\\\"\\\"\\n        # Get current OS\\n        os_type = QOperatingSystemVersion.current()\\n\\n        # Get system default font\\n        system_font = QFontDatabase.systemFont(QFontDatabase.SystemFont.GeneralFont)\\n        system_size = system_font.pointSizeF()\\n\\n        # Apply OS-specific adjustments if system detection fails\\n        if system_size > 0:\\n            return system_size\\n\\n        if os_type.type() == QOperatingSystemVersion.OSType.MacOS:  # type: ignore\\n            # macOS typically uses 13pt as default\\n            return 13\\n\\n        if os_type.type() == QOperatingSystemVersion.OSType.Windows:  # type: ignore\\n            # Windows typically uses 9pt as default\\n            return 9\\n\\n        # Linux typically uses 10pt as default\\n        return 10\\n\\n    def base_font_size(self) -> float:\\n        \\\"\\\"\\\"Get the base font size for the current system.\\\"\\\"\\\"\\n        return self._user_font_size or self._base_font_size\\n\\n    def set_user_font_size(self, size: float | None) -> None:\\n        \\\"\\\"\\\"Set user-specific font size override.\\\"\\\"\\\"\\n        if size != self._user_font_size:\\n            self._user_font_size = size\\n\\n            if size:\\n                self.style_changed.emit()\\n\\n    def color_mode(self) -> ColorMode:\\n        \\\"\\\"\\\"Get the current color mode.\\\"\\\"\\\"\\n        return self._color_mode\\n\\n    def set_color_mode(self, mode: ColorMode) -> None:\\n        \\\"\\\"\\\"\\n        Set the color mode and update application styles.\\n\\n        Args:\\n            mode: The ColorMode to switch to\\n        \\\"\\\"\\\"\\n        if mode != self._color_mode:\\n            self._color_mode = mode\\n            self._initialize_highlights()\\n            self._initialize_proportional_highlights()\\n            self.style_changed.emit()\\n\\n    def zoom_factor(self) -> float:\\n        \\\"\\\"\\\"Current zoom scaling factor.\\\"\\\"\\\"\\n        return self._zoom_factor\\n\\n    def set_zoom(self, factor: float) -> None:\\n        \\\"\\\"\\\"\\n        Set new zoom factor and update application styles.\\n\\n        Args:\\n            factor: New zoom factor to apply (clamped between 0.5 and 2.0)\\n        \\\"\\\"\\\"\\n        new_factor = max(0.5, min(2.0, factor))\\n        if new_factor != self._zoom_factor:\\n            self._zoom_factor = new_factor\\n            self.style_changed.emit()\\n\\n    def get_space_width(self) -> float:\\n        \\\"\\\"\\\"Get the width of a space character\\\"\\\"\\\"\\n        font = QFont(self._code_font_families)\\n        font.setPointSizeF(self.base_font_size() * self._zoom_factor)\\n        font_metrics = QFontMetricsF(font)\\n        space_width = font_metrics.horizontalAdvance('        ') / 8\\n        return space_width\\n\\n    def monospace_font_families(self) -> List[str]:\\n        \\\"\\\"\\\"Get the standard monospace font family fallback sequence.\\\"\\\"\\\"\\n        return self._code_font_families\\n\\n    def message_bubble_spacing(self) -> float:\\n        \\\"\\\"\\\"Get the number of pixels to use in message bubble spacing.\\\"\\\"\\\"\\n        return 8.0\\n\\n    def get_dialog_stylesheet(self) -> str:\\n        \\\"\\\"\\\"\\n        Get a complete stylesheet for dialog windows.\\n\\n        Returns:\\n            A stylesheet string with styling for all common dialog components\\n        \\\"\\\"\\\"\\n        zoom_factor = self.zoom_factor()\\n        base_font_size = self.base_font_size()\\n\\n        return f\\\"\\\"\\\"\\n            QDialog {{\\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\\n                font-size: {base_font_size * zoom_factor}pt;\\n            }}\\n\\n            QScrollArea {{\\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\\n                border: none;\\n            }}\\n\\n            QScrollArea > QWidget > QWidget {{\\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\\n                border: none;\\n            }}\\n\\n            /* Labels */\\n            QLabel {{\\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\\n                border: none;\\n                border-radius: 4px;\\n                padding: 0px;\\n                margin: 0px;\\n                font-size: {base_font_size * zoom_factor}pt;\\n            }}\\n\\n            /* Text inputs */\\n            QLineEdit {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\\n                border: none;\\n                border-radius: 4px;\\n                padding: 4px;\\n                font-size: {int(base_font_size * zoom_factor)}pt;\\n            }}\\n            QLineEdit:disabled {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\\n            }}\\n\\n            /* Checkboxes */\\n            QCheckBox {{\\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\\n                border: none;\\n                border-radius: 4px;\\n                padding: 0px;\\n                margin: 0px;\\n            }}\\n            QCheckBox::indicator {{\\n                width: {int(18 * zoom_factor)}px;\\n                height: {int(18 * zoom_factor)}px;\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\\n            }}\\n            QCheckBox::indicator:disabled {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\\n            }}\\n            QCheckBox::indicator:checked {{\\n                image: url({self.get_icon_path('check')});\\n            }}\\n            QCheckBox:disabled {{\\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\\n            }}\\n\\n            /* Combo boxes */\\n            QComboBox {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\\n                border: none;\\n                border-radius: 4px;\\n                padding: 6px;\\n                margin: 0px;\\n                font-size: {int(base_font_size * zoom_factor)}pt;\\n            }}\\n            QComboBox:disabled {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\\n            }}\\n            QComboBox::drop-down {{\\n                border: none;\\n                width: 20px;\\n            }}\\n            QComboBox::down-arrow {{\\n                image: url({self.get_icon_path(\\\"arrow-down\\\")});\\n                width: 12px;\\n                height: 12px;\\n            }}\\n            QComboBox::down-arrow:on {{\\n                image: url({self.get_icon_path('arrow-up')});\\n                width: 12px;\\n                height: 12px;\\n            }}\\n            QComboBox::down-arrow:disabled {{\\n                image: none;\\n            }}\\n            QComboBox QAbstractItemView::item:selected {{\\n                border: none;\\n                background-color: {self.get_color_str(ColorRole.TEXT_SELECTED)};\\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\\n            }}\\n            QComboBox QListView {{\\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_SECONDARY)};\\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\\n            }}\\n\\n            /* Spin boxes */\\n            QSpinBox, QDoubleSpinBox {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\\n                border: none;\\n                border-radius: 4px;\\n                padding: 4px;\\n                font-size: {base_font_size * zoom_factor}pt;\\n            }}\\n            QSpinBox:disabled, QDoubleSpinBox:disabled {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\\n            }}\\n            QSpinBox::up-button, QSpinBox::down-button,\\n            QDoubleSpinBox::up-button, QDoubleSpinBox::down-button {{\\n                border: none;\\n                width: 20px;\\n            }}\\n            QSpinBox::up-arrow, QDoubleSpinBox::up-arrow {{\\n                image: url({self.get_icon_path('arrow-up')});\\n                width: 12px;\\n                height: 12px;\\n            }}\\n            QSpinBox::up-arrow:disabled, QSpinBox::up-arrow:off,\\n            QDoubleSpinBox::up-arrow:disabled, QDoubleSpinBox::up-arrow:off {{\\n                image: none;\\n            }}\\n            QSpinBox::down-arrow, QDoubleSpinBox::down-arrow {{\\n                image: url({self.get_icon_path('arrow-down')});\\n                width: 12px;\\n                height: 12px;\\n            }}\\n            QSpinBox::down-arrow:disabled, QSpinBox::down-arrow:off,\\n            QDoubleSpinBox::down-arrow:disabled, QDoubleSpinBox::down-arrow:off {{\\n                image: none;\\n            }}\\n\\n            /* Buttons */\\n            QPushButton {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\\n                border: none;\\n                border-radius: 4px;\\n                padding: 4px;\\n                font-size: {base_font_size * zoom_factor}pt;\\n            }}\\n            QPushButton:hover {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_HOVER)};\\n            }}\\n            QPushButton:pressed {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_PRESSED)};\\n            }}\\n            QPushButton:disabled {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\\n            }}\\n\\n            /* Recommended (primary) buttons */\\n            QPushButton[recommended=\\\"true\\\"] {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_RECOMMENDED)};\\n                color: {self.get_color_str(ColorRole.TEXT_RECOMMENDED)};\\n            }}\\n            QPushButton[recommended=\\\"true\\\"]:hover {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_RECOMMENDED_HOVER)};\\n            }}\\n            QPushButton[recommended=\\\"true\\\"]:pressed {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_RECOMMENDED_PRESSED)};\\n            }}\\n            QPushButton[recommended=\\\"false\\\"] {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE)};\\n                color: {self.get_color_str(ColorRole.TEXT_RECOMMENDED)};\\n            }}\\n            QPushButton[recommended=\\\"false\\\"]:hover {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_HOVER)};\\n            }}\\n            QPushButton[recommended=\\\"false\\\"]:pressed {{\\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_PRESSED)};\\n            }}\\n\\n            QScrollBar:vertical {{\\n                background-color: {self.get_color_str(ColorRole.SCROLLBAR_BACKGROUND)};\\n                width: 12px;\\n            }}\\n            QScrollBar::handle:vertical {{\\n                background-color: {self.get_color_str(ColorRole.SCROLLBAR_HANDLE)};\\n                min-height: 20px;\\n            }}\\n            QScrollBar::add-page:vertical, QScrollBar::sub-page:vertical {{\\n                background: none;\\n            }}\\n            QScrollBar::add-line:vertical, QScrollBar::sub-line:vertical {{\\n                height: 0px;\\n            }}\\n        \\\"\\\"\\\"\"\n    }\n}\n```",
      "completed": true,
      "tool_calls": [
        {
          "id": "toolu_01H3T6ff5D55G96x77A1L9bX",
          "name": "filesystem",
          "arguments": {
            "operation": "write_file",
            "path": "src/humbug/style_manager.py",
            "content": "\"\"\"Style manager for handling application-wide style and zoom settings.\n\nImplements a singleton pattern to maintain consistent styling across components.\nProvides signals for style changes and utilities for scaled size calculations.\n\"\"\"\n\nfrom enum import Enum, auto\nimport os\nfrom pathlib import Path\nfrom typing import Dict, List\n\nfrom PySide6.QtCore import QObject, Signal, QOperatingSystemVersion, Qt\nfrom PySide6.QtGui import QTextCharFormat, QFontDatabase, QColor, QFontMetricsF, QFont, QPixmap\n\nfrom syntax import TokenType\n\nfrom humbug.color_role import ColorRole\n\n\nclass ColorMode(Enum):\n    \"\"\"Enumeration for color theme modes.\"\"\"\n    LIGHT = auto()\n    DARK = auto()\n\n\nclass StyleManager(QObject):\n    \"\"\"\n    Singleton manager for application-wide style settings.\n\n    Handles zoom factor management and style updates across the application.\n    Emits signals when zoom level changes to notify dependent components.\n\n    Attributes:\n        style_changed (Signal): Emitted when style changes, passing new zoom factor\n        _instance (StyleManager): Singleton instance\n        _zoom_factor (float): Current zoom scaling factor\n        _initialized (bool): Tracks initialization state of QObject base\n    \"\"\"\n\n    style_changed = Signal()\n    _instance = None\n\n    def __new__(cls) -> 'StyleManager':\n        \"\"\"Create or return singleton instance.\"\"\"\n        if cls._instance is None:\n            cls._instance = super(StyleManager, cls).__new__(cls)\n\n        return cls._instance\n\n    def __init__(self) -> None:\n        \"\"\"Initialize QObject base class if not already done.\"\"\"\n        if not hasattr(self, '_initialized'):\n            super().__init__()\n            self._zoom_factor = 1.0\n            self._base_font_size = self._determine_base_font_size()\n            self._user_font_size: float | None = None\n            self._initialized = True\n            self._color_mode = ColorMode.DARK  # Default to dark mode\n            self._colors: Dict[ColorRole, Dict[ColorMode, str]] = self._initialize_colors()\n            self._highlights: Dict[TokenType, QTextCharFormat] = {}\n            self._proportional_highlights: Dict[TokenType, QTextCharFormat] = {}\n\n            self._code_font_families = [\"Menlo\", \"Consolas\", \"Monaco\", \"monospace\"]\n            self._initialize_highlights()\n            self._initialize_proportional_highlights()\n            self._create_theme_icons()\n\n    def _initialize_colors(self) -> Dict[ColorRole, Dict[ColorMode, str]]:\n        \"\"\"Initialize the application colours for both light and dark modes.\"\"\"\n        return {\n            # Background colours\n            ColorRole.BACKGROUND_PRIMARY: {\n                ColorMode.DARK: \"#080808\",\n                ColorMode.LIGHT: \"#e0e0e0\"\n            },\n            ColorRole.BACKGROUND_SECONDARY: {\n                ColorMode.DARK: \"#141414\",\n                ColorMode.LIGHT: \"#ececec\"\n            },\n            ColorRole.BACKGROUND_TERTIARY: {\n                ColorMode.DARK: \"#242424\",\n                ColorMode.LIGHT: \"#fcfcfc\"\n            },\n            ColorRole.BACKGROUND_DIALOG: {\n                ColorMode.DARK: \"#282828\",\n                ColorMode.LIGHT: \"#d0d0d0\"\n            },\n\n            # Text colours\n            ColorRole.TEXT_PRIMARY: {\n                ColorMode.DARK: \"#d8d8d8\",\n                ColorMode.LIGHT: \"#202020\"\n            },\n            ColorRole.TEXT_BRIGHT: {\n                ColorMode.DARK: \"#ffffff\",\n                ColorMode.LIGHT: \"#000000\"\n            },\n            ColorRole.TEXT_HEADING: {\n                ColorMode.DARK: \"#ffe0a0\",\n                ColorMode.LIGHT: \"#204080\"\n            },\n            ColorRole.TEXT_HEADING_BRIGHT: {\n                ColorMode.DARK: \"#ffe8a0\",\n                ColorMode.LIGHT: \"#203880\"\n            },\n            ColorRole.TEXT_DISABLED: {\n                ColorMode.DARK: \"#707070\",\n                ColorMode.LIGHT: \"#909090\"\n            },\n            ColorRole.TEXT_SELECTED: {\n                ColorMode.DARK: \"#404058\",\n                ColorMode.LIGHT: \"#c8c8dc\"\n            },\n            ColorRole.TEXT_FOUND: {\n                ColorMode.DARK: \"#885050\",\n                ColorMode.LIGHT: \"#e0b4b4\"\n            },\n            ColorRole.TEXT_FOUND_DIM: {\n                ColorMode.DARK: \"#583838\",\n                ColorMode.LIGHT: \"#f4d8d8\"\n            },\n            ColorRole.TEXT_RECOMMENDED: {\n                ColorMode.DARK: \"#ffffff\",\n                ColorMode.LIGHT: \"#ffffff\"\n            },\n            ColorRole.TEXT_LINK: {\n                ColorMode.DARK: \"#80a0ff\",\n                ColorMode.LIGHT: \"#0000ff\"\n            },\n            ColorRole.TEXT_INACTIVE: {\n                ColorMode.DARK: \"#909090\",\n                ColorMode.LIGHT: \"#707070\"\n            },\n            ColorRole.TEXT_EPHEMERAL: {\n                ColorMode.DARK: \"#e0a080\",\n                ColorMode.LIGHT: \"#a0785c\"\n            },\n            ColorRole.TEXT_EPHEMERAL_INACTIVE: {\n                ColorMode.DARK: \"#a06040\",\n                ColorMode.LIGHT: \"#c09070\"\n            },\n            ColorRole.TEXT_ERROR: {\n                ColorMode.DARK: \"#e03020\",\n                ColorMode.LIGHT: \"#f04030\"\n            },\n            ColorRole.TEXT_ERROR_INACTIVE: {\n                ColorMode.DARK: \"#e06050\",\n                ColorMode.LIGHT: \"#f07060\"\n            },\n\n            # Edit box colours\n            ColorRole.EDIT_BOX_BORDER: {\n                ColorMode.DARK: \"#6060c0\",\n                ColorMode.LIGHT: \"#404080\"\n            },\n            ColorRole.EDIT_BOX_BACKGROUND: {\n                ColorMode.DARK: \"#242454\",\n                ColorMode.LIGHT: \"#b8b8f8\"\n            },\n            ColorRole.EDIT_BOX_ERROR: {\n                ColorMode.DARK: \"#c03020\",\n                ColorMode.LIGHT: \"#d04030\"\n            },\n\n            # Tab colours\n            ColorRole.TAB_BAR_BACKGROUND: {\n                ColorMode.DARK: \"#000000\",\n                ColorMode.LIGHT: \"#d8d8d8\"\n            },\n            ColorRole.TAB_BACKGROUND_ACTIVE: {\n                ColorMode.DARK: \"#1e1e1e\",\n                ColorMode.LIGHT: \"#ffffff\"\n            },\n            ColorRole.TAB_BACKGROUND_INACTIVE: {\n                ColorMode.DARK: \"#141414\",\n                ColorMode.LIGHT: \"#f0f0f0\"\n            },\n            ColorRole.TAB_BACKGROUND_HOVER: {\n                ColorMode.DARK: \"#242454\",\n                ColorMode.LIGHT: \"#b8b8f8\"\n            },\n            ColorRole.TAB_BACKGROUND_UPDATED: {\n                ColorMode.DARK: \"#3c2054\",\n                ColorMode.LIGHT: \"#f0d0f8\"\n            },\n            ColorRole.TAB_BORDER_ACTIVE: {\n                ColorMode.DARK: \"#8080ff\",\n                ColorMode.LIGHT: \"#3030ff\"\n            },\n\n            # Button colours\n            ColorRole.BUTTON_BACKGROUND: {\n                ColorMode.DARK: \"#0c0c0c\",\n                ColorMode.LIGHT: \"#e8e8e8\"\n            },\n            ColorRole.BUTTON_BACKGROUND_PRESSED: {\n                ColorMode.DARK: \"#505050\",\n                ColorMode.LIGHT: \"#b0b0b0\"\n            },\n            ColorRole.BUTTON_BACKGROUND_HOVER: {\n                ColorMode.DARK: \"#404040\",\n                ColorMode.LIGHT: \"#c0c0c0\"\n            },\n            ColorRole.BUTTON_SECONDARY_BACKGROUND: {\n                ColorMode.DARK: \"#2c2c2c\",\n                ColorMode.LIGHT: \"#d8d8d8\"\n            },\n            ColorRole.BUTTON_SECONDARY_BACKGROUND_PRESSED: {\n                ColorMode.DARK: \"#505050\",\n                ColorMode.LIGHT: \"#b0b0b0\"\n            },\n            ColorRole.BUTTON_SECONDARY_BACKGROUND_HOVER: {\n                ColorMode.DARK: \"#404040\",\n                ColorMode.LIGHT: \"#c0c0c0\"\n            },\n            ColorRole.BUTTON_BACKGROUND_RECOMMENDED: {\n                ColorMode.DARK: \"#2050c0\",\n                ColorMode.LIGHT: \"#3060d0\"\n            },\n            ColorRole.BUTTON_BACKGROUND_RECOMMENDED_PRESSED: {\n                ColorMode.DARK: \"#4070e0\",\n                ColorMode.LIGHT: \"#1040b0\"\n            },\n            ColorRole.BUTTON_BACKGROUND_RECOMMENDED_HOVER: {\n                ColorMode.DARK: \"#3060d0\",\n                ColorMode.LIGHT: \"#2050c0\"\n            },\n            ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE: {\n                ColorMode.DARK: \"#c03020\",\n                ColorMode.LIGHT: \"#d04030\"\n            },\n            ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_PRESSED: {\n                ColorMode.DARK: \"#e05040\",\n                ColorMode.LIGHT: \"#b02010\"\n            },\n            ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_HOVER: {\n                ColorMode.DARK: \"#d04030\",\n                ColorMode.LIGHT: \"#c03020\"\n            },\n            ColorRole.BUTTON_BACKGROUND_DISABLED: {\n                ColorMode.DARK: \"#202020\",\n                ColorMode.LIGHT: \"#d8d8d8\"\n            },\n\n            # Menu elements\n            ColorRole.MENU_BACKGROUND: {\n                ColorMode.DARK: \"#2d2d2d\",\n                ColorMode.LIGHT: \"#f0f0f0\"\n            },\n            ColorRole.MENU_HOVER: {\n                ColorMode.DARK: \"#3060d0\",\n                ColorMode.LIGHT: \"#2050c0\"\n            },\n            ColorRole.MENU_BORDER: {\n                ColorMode.DARK: \"#606060\",\n                ColorMode.LIGHT: \"#b0b0b0\"\n            },\n\n            # Splitter bars\n            ColorRole.SPLITTER: {\n                ColorMode.DARK: \"#606060\",\n                ColorMode.LIGHT: \"#b0b0b0\"\n            },\n\n            # Scroll bar elements\n            ColorRole.SCROLLBAR_BACKGROUND: {\n                ColorMode.DARK: \"#2d2d2d\",\n                ColorMode.LIGHT: \"#f0f0f0\"\n            },\n            ColorRole.SCROLLBAR_HANDLE: {\n                ColorMode.DARK: \"#404040\",\n                ColorMode.LIGHT: \"#c0c0c0\"\n            },\n\n            # Table elements\n            ColorRole.TABLE_BORDER: {\n                ColorMode.DARK: \"#808080\",\n                ColorMode.LIGHT: \"#a0a0a0\"\n            },\n            ColorRole.TABLE_HEADER_BACKGROUND: {\n                ColorMode.DARK: \"#484838\",\n                ColorMode.LIGHT: \"#d0d0e0\"\n            },\n\n            # Message colours\n            ColorRole.MESSAGE_BACKGROUND: {\n                ColorMode.DARK: \"#020202\",\n                ColorMode.LIGHT: \"#f2f2f2\"\n            },\n            ColorRole.MESSAGE_USER_BACKGROUND: {\n                ColorMode.DARK: \"#121212\",\n                ColorMode.LIGHT: \"#e4e4e4\"\n            },\n            ColorRole.MESSAGE_FOCUSED: {\n                ColorMode.DARK: \"#3a4654\",\n                ColorMode.LIGHT: \"#aab6c4\"\n            },\n            ColorRole.MESSAGE_USER: {\n                ColorMode.DARK: \"#8080c0\",\n                ColorMode.LIGHT: \"#6060a0\"\n            },\n            ColorRole.MESSAGE_AI: {\n                ColorMode.DARK: \"#80c080\",\n                ColorMode.LIGHT: \"#40a040\"\n            },\n            ColorRole.MESSAGE_REASONING: {\n                ColorMode.DARK: \"#808080\",\n                ColorMode.LIGHT: \"#808080\"\n            },\n            ColorRole.MESSAGE_TOOL_CALL: {\n                ColorMode.DARK: \"#808080\",\n                ColorMode.LIGHT: \"#808080\"\n            },\n            ColorRole.MESSAGE_TOOL_RESULT: {\n                ColorMode.DARK: \"#808080\",\n                ColorMode.LIGHT: \"#808080\"\n            },\n            ColorRole.MESSAGE_SYSTEM_ERROR: {\n                ColorMode.DARK: \"#c08080\",\n                ColorMode.LIGHT: \"#a04040\"\n            },\n            ColorRole.MESSAGE_SYSTEM_SUCCESS: {\n                ColorMode.DARK: \"#80c080\",\n                ColorMode.LIGHT: \"#40a040\"\n            },\n            ColorRole.MESSAGE_LANGUAGE: {\n                ColorMode.DARK: \"#a07850\",\n                ColorMode.LIGHT: \"#806040\"\n            },\n            ColorRole.MESSAGE_BOOKMARK: {\n                ColorMode.DARK: \"#ffdf00\",\n                ColorMode.LIGHT: \"#806000\"\n            },\n            ColorRole.MESSAGE_STREAMING: {\n                ColorMode.DARK: \"#c0a080\",\n                ColorMode.LIGHT: \"#a07050\"\n            },\n            ColorRole.MESSAGE_TRACE: {\n                ColorMode.DARK: \"#a0a0a0\",\n                ColorMode.LIGHT: \"#606060\"\n            },\n            ColorRole.MESSAGE_INFORMATION: {\n                ColorMode.DARK: \"#80b0f0\",\n                ColorMode.LIGHT: \"#0060c0\"\n            },\n            ColorRole.MESSAGE_WARNING: {\n                ColorMode.DARK: \"#f0c040\",\n                ColorMode.LIGHT: \"#c0a020\"\n            },\n            ColorRole.MESSAGE_ERROR: {\n                ColorMode.DARK: \"#ff6060\",\n                ColorMode.LIGHT: \"#c03030\"\n            },\n\n            # Status bar elements\n            ColorRole.STATUS_BAR_BACKGROUND: {\n                ColorMode.DARK: \"#121212\",\n                ColorMode.LIGHT: \"#e8e8e8\"\n            },\n            ColorRole.CANARY_BACKGROUND: {\n                ColorMode.DARK: \"#802020\",\n                ColorMode.LIGHT: \"#c04040\"\n            },\n\n            # Close button states\n            ColorRole.CLOSE_BUTTON_BACKGROUND_HOVER: {\n                ColorMode.DARK: \"#d04030\",\n                ColorMode.LIGHT: \"#c03020\"\n            },\n\n            # Line numbers\n            ColorRole.LINE_NUMBER: {\n                ColorMode.DARK: \"#606060\",\n                ColorMode.LIGHT: \"#c0c0c0\"\n            },\n\n            # Syntax highlighting\n            ColorRole.SYNTAX_ERROR: {\n                ColorMode.DARK: \"#ff0000\",\n                ColorMode.LIGHT: \"#ff0000\"\n            },\n            ColorRole.SYNTAX_01: {\n                ColorMode.DARK: \"#80e0d0\",\n                ColorMode.LIGHT: \"#007070\"\n            },\n            ColorRole.SYNTAX_02: {\n                ColorMode.DARK: \"#f0f0f0\",\n                ColorMode.LIGHT: \"#202020\"\n            },\n            ColorRole.SYNTAX_03: {\n                ColorMode.DARK: \"#68b068\",\n                ColorMode.LIGHT: \"#407040\"\n            },\n            ColorRole.SYNTAX_04: {\n                ColorMode.DARK: \"#ffa0eb\",\n                ColorMode.LIGHT: \"#c000a0\"\n            },\n            ColorRole.SYNTAX_05: {\n                ColorMode.DARK: \"#808080\",\n                ColorMode.LIGHT: \"#606060\"\n            },\n            ColorRole.SYNTAX_06: {\n                ColorMode.DARK: \"#90e0e8\",\n                ColorMode.LIGHT: \"#0080a0\"\n            },\n            ColorRole.SYNTAX_07: {\n                ColorMode.DARK: \"#e0e080\",\n                ColorMode.LIGHT: \"#a0a000\"\n            },\n            ColorRole.SYNTAX_08: {\n                ColorMode.DARK: \"#b090f0\",\n                ColorMode.LIGHT: \"#5040c0\"\n            },\n            ColorRole.SYNTAX_09: {\n                ColorMode.DARK: \"#90e0e8\",\n                ColorMode.LIGHT: \"#0080a0\"\n            },\n            ColorRole.SYNTAX_10: {\n                ColorMode.DARK: \"#d070d0\",\n                ColorMode.LIGHT: \"#a000a0\"\n            },\n            ColorRole.SYNTAX_11: {\n                ColorMode.DARK: \"#80b0f0\",\n                ColorMode.LIGHT: \"#0060c0\"\n            },\n            ColorRole.SYNTAX_12: {\n                ColorMode.DARK: \"#f08080\",\n                ColorMode.LIGHT: \"#c03030\"\n            },\n            ColorRole.SYNTAX_13: {\n                ColorMode.DARK: \"#ffc0eb\",\n                ColorMode.LIGHT: \"#c080a0\"\n            },\n            ColorRole.SYNTAX_14: {\n                ColorMode.DARK: \"#f0e060\",\n                ColorMode.LIGHT: \"#a09040\"\n            },\n            ColorRole.SYNTAX_15: {\n                ColorMode.DARK: \"#70e0e8\",\n                ColorMode.LIGHT: \"#2090a0\"\n            },\n            ColorRole.SYNTAX_16: {\n                ColorMode.DARK: \"#88d048\",\n                ColorMode.LIGHT: \"#508020\"\n            },\n            ColorRole.SYNTAX_17: {\n                ColorMode.DARK: \"#c0c0c0\",\n                ColorMode.LIGHT: \"#404040\"\n            },\n            ColorRole.SYNTAX_18: {\n                ColorMode.DARK: \"#80b080\",\n                ColorMode.LIGHT: \"#609060\"\n            },\n            ColorRole.SYNTAX_19: {\n                ColorMode.DARK: \"#c87050\",\n                ColorMode.LIGHT: \"#a04020\"\n            },\n            ColorRole.SYNTAX_20: {\n                ColorMode.DARK: \"#c05040\",\n                ColorMode.LIGHT: \"#803828\"\n             },\n            ColorRole.SYNTAX_21: {\n                ColorMode.DARK: \"#30c090\",\n                ColorMode.LIGHT: \"#24906c\"\n            },\n\n            # Terminal basic colors\n            ColorRole.TERM_BLACK: {\n                ColorMode.DARK: \"#000000\",\n                ColorMode.LIGHT: \"#000000\"\n            },\n            ColorRole.TERM_RED: {\n                ColorMode.DARK: \"#cd0000\",\n                ColorMode.LIGHT: \"#cd0000\"\n            },\n            ColorRole.TERM_GREEN: {\n                ColorMode.DARK: \"#00cd00\",\n                ColorMode.LIGHT: \"#00cd00\"\n            },\n            ColorRole.TERM_YELLOW: {\n                ColorMode.DARK: \"#cdcd00\",\n                ColorMode.LIGHT: \"#cdcd00\"\n            },\n            ColorRole.TERM_BLUE: {\n                ColorMode.DARK: \"#0000ee\",\n                ColorMode.LIGHT: \"#0000ee\"\n            },\n            ColorRole.TERM_MAGENTA: {\n                ColorMode.DARK: \"#cd00cd\",\n                ColorMode.LIGHT: \"#cd00cd\"\n            },\n            ColorRole.TERM_CYAN: {\n                ColorMode.DARK: \"#00cdcd\",\n                ColorMode.LIGHT: \"#00cdcd\"\n            },\n            ColorRole.TERM_WHITE: {\n                ColorMode.DARK: \"#e5e5e5\",\n                ColorMode.LIGHT: \"#e5e5e5\"\n            },\n\n            # Terminal bright colors\n            ColorRole.TERM_BRIGHT_BLACK: {\n                ColorMode.DARK: \"#7f7f7f\",\n                ColorMode.LIGHT: \"#7f7f7f\"\n            },\n            ColorRole.TERM_BRIGHT_RED: {\n                ColorMode.DARK: \"#ff0000\",\n                ColorMode.LIGHT: \"#ff0000\"\n            },\n            ColorRole.TERM_BRIGHT_GREEN: {\n                ColorMode.DARK: \"#00ff00\",\n                ColorMode.LIGHT: \"#00ff00\"\n            },\n            ColorRole.TERM_BRIGHT_YELLOW: {\n                ColorMode.DARK: \"#ffff00\",\n                ColorMode.LIGHT: \"#ffff00\"\n            },\n            ColorRole.TERM_BRIGHT_BLUE: {\n                ColorMode.DARK: \"#5c5cff\",\n                ColorMode.LIGHT: \"#5c5cff\"\n            },\n            ColorRole.TERM_BRIGHT_MAGENTA: {\n                ColorMode.DARK: \"#ff00ff\",\n                ColorMode.LIGHT: \"#ff00ff\"\n            },\n            ColorRole.TERM_BRIGHT_CYAN: {\n                ColorMode.DARK: \"#00ffff\",\n                ColorMode.LIGHT: \"#00ffff\"\n            },\n            ColorRole.TERM_BRIGHT_WHITE: {\n                ColorMode.DARK: \"#ffffff\",\n                ColorMode.LIGHT: \"#ffffff\"\n            }\n        }\n\n    def _initialize_highlights(self) -> None:\n        # Mapping from token type to colour\n        colour_mapping = {\n            TokenType.ADDRESS: ColorRole.SYNTAX_01,\n            TokenType.ANNOTATION: ColorRole.SYNTAX_08,\n            TokenType.ARGUMENT: ColorRole.SYNTAX_11,\n            TokenType.ATTRIBUTE: ColorRole.SYNTAX_08,\n            TokenType.BACKTICK: ColorRole.SYNTAX_12,\n            TokenType.BOOLEAN: ColorRole.SYNTAX_16,\n            TokenType.BOLD: ColorRole.SYNTAX_21,\n            TokenType.BOLD_END: ColorRole.SYNTAX_07,\n            TokenType.BOLD_START: ColorRole.SYNTAX_07,\n            TokenType.BLOCKQUOTE: ColorRole.SYNTAX_13,\n            TokenType.CHARACTER: ColorRole.SYNTAX_20,\n            TokenType.CODE: ColorRole. SYNTAX_02,\n            TokenType.COMMAND: ColorRole.SYNTAX_07,\n            TokenType.COMMENT: ColorRole.SYNTAX_03,\n            TokenType.CSS_AT_RULE: ColorRole.SYNTAX_04,\n            TokenType.DIMENSION: ColorRole.SYNTAX_16,\n            TokenType.DOC_COMMENT: ColorRole.SYNTAX_03,\n            TokenType.DOCTYPE: ColorRole.SYNTAX_05,\n            TokenType.DIRECTIVE: ColorRole.SYNTAX_18,\n            TokenType.ELEMENT: ColorRole.SYNTAX_06,\n            TokenType.ERROR: ColorRole.SYNTAX_ERROR,\n            TokenType.FENCE: ColorRole.SYNTAX_14,\n            TokenType.FENCE_END: ColorRole.SYNTAX_14,\n            TokenType.FENCE_START: ColorRole.SYNTAX_14,\n            TokenType.FUNCTION_OR_METHOD: ColorRole.SYNTAX_07,\n            TokenType.GENERIC_END: ColorRole.SYNTAX_17,\n            TokenType.GENERIC_START: ColorRole.SYNTAX_17,\n            TokenType.GENERIC_TYPE: ColorRole.SYNTAX_21,\n            TokenType.HASH: ColorRole.SYNTAX_11,\n            TokenType.HEADING: ColorRole.SYNTAX_08,\n            TokenType.HEX: ColorRole.SYNTAX_16,\n            TokenType.HORIZONTAL_RULE: ColorRole.SYNTAX_21,\n            TokenType.HTML_ATTRIBUTE: ColorRole.SYNTAX_09,\n            TokenType.HTML_TAG: ColorRole.SYNTAX_10,\n            TokenType.IDENTIFIER: ColorRole.SYNTAX_11,\n            TokenType.IMAGE_ALT_END: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_ALT_TEXT: ColorRole.SYNTAX_16,\n            TokenType.IMAGE_END: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_START: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_URL: ColorRole.SYNTAX_20,\n            TokenType.INLINE_CODE: ColorRole.SYNTAX_12,\n            TokenType.INLINE_CODE_END: ColorRole.SYNTAX_07,\n            TokenType.INLINE_CODE_START: ColorRole.SYNTAX_07,\n            TokenType.ITALIC: ColorRole.SYNTAX_09,\n            TokenType.ITALIC_END: ColorRole.SYNTAX_07,\n            TokenType.ITALIC_START: ColorRole.SYNTAX_07,\n            TokenType.JSON_KEY: ColorRole.SYNTAX_07,\n            TokenType.KEYWORD: ColorRole.SYNTAX_13,\n            TokenType.LANGUAGE: ColorRole.SYNTAX_14,\n            TokenType.LIFETIME: ColorRole.SYNTAX_17,\n            TokenType.LINK_END: ColorRole.SYNTAX_07,\n            TokenType.LINK_START: ColorRole.SYNTAX_07,\n            TokenType.LINK_TEXT: ColorRole.SYNTAX_16,\n            TokenType.LINK_TEXT_END: ColorRole.SYNTAX_07,\n            TokenType.LINK_URL: ColorRole.SYNTAX_20,\n            TokenType.LIST_MARKER: ColorRole.SYNTAX_15,\n            TokenType.LPAREN: ColorRole.SYNTAX_17,\n            TokenType.NUMBER: ColorRole.SYNTAX_16,\n            TokenType.OPERATOR: ColorRole.SYNTAX_17,\n            TokenType.OPTION: ColorRole.SYNTAX_10,\n            TokenType.OPTION_VALUE: ColorRole.SYNTAX_08,\n            TokenType.PREPROCESSOR: ColorRole.SYNTAX_05,\n            TokenType.REGEXP: ColorRole.SYNTAX_19,\n            TokenType.RPAREN: ColorRole.SYNTAX_17,\n            TokenType.RUNE: ColorRole.SYNTAX_20,\n            TokenType.STRING: ColorRole.SYNTAX_20,\n            TokenType.TABLE: ColorRole.SYNTAX_03,\n            TokenType.TEXT: ColorRole.SYNTAX_17,\n            TokenType.TYPE: ColorRole.SYNTAX_21,\n            TokenType.XML_DOC: ColorRole.SYNTAX_03\n        }\n\n        for token_type, role in colour_mapping.items():\n            text_format = self._create_highlight(role)\n            self._highlights[token_type] = text_format\n\n        self._error_highlight = self._create_highlight(ColorRole.SYNTAX_ERROR)\n\n    def _create_highlight(self, role: ColorRole) -> QTextCharFormat:\n        text_highlight = QTextCharFormat()\n        text_highlight.setFontFamilies(self._code_font_families)\n        text_highlight.setFontFixedPitch(True)\n        text_highlight.setForeground(QColor(self._colors[role][self._color_mode]))\n\n        return text_highlight\n\n    def _initialize_proportional_highlights(self) -> None:\n        # Mapping from token type to colour\n        colour_mapping = {\n            TokenType.BOLD: ColorRole.SYNTAX_21,\n            TokenType.BOLD_END: ColorRole.SYNTAX_07,\n            TokenType.BOLD_START: ColorRole.SYNTAX_07,\n            TokenType.BLOCKQUOTE: ColorRole.SYNTAX_13,\n            TokenType.FENCE: ColorRole.SYNTAX_14,\n            TokenType.HEADING: ColorRole.SYNTAX_08,\n            TokenType.IMAGE_ALT_END: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_ALT_TEXT: ColorRole.SYNTAX_16,\n            TokenType.IMAGE_END: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_START: ColorRole.SYNTAX_07,\n            TokenType.IMAGE_URL: ColorRole.SYNTAX_20,\n            TokenType.INLINE_CODE_END: ColorRole.SYNTAX_07,\n            TokenType.INLINE_CODE_START: ColorRole.SYNTAX_07,\n            TokenType.ITALIC: ColorRole.SYNTAX_09,\n            TokenType.ITALIC_END: ColorRole.SYNTAX_07,\n            TokenType.ITALIC_START: ColorRole.SYNTAX_07,\n            TokenType.LINK_END: ColorRole.SYNTAX_07,\n            TokenType.LINK_START: ColorRole.SYNTAX_07,\n            TokenType.LINK_TEXT: ColorRole.SYNTAX_16,\n            TokenType.LINK_TEXT_END: ColorRole.SYNTAX_07,\n            TokenType.LINK_URL: ColorRole.SYNTAX_20,\n            TokenType.LIST_MARKER: ColorRole.SYNTAX_15,\n            TokenType.TABLE: ColorRole.SYNTAX_03,\n            TokenType.TEXT: ColorRole.SYNTAX_17\n        }\n\n        for token_type, role in colour_mapping.items():\n            text_format = self._create_proportional_highlight(role)\n            self._proportional_highlights[token_type] = text_format\n\n        self._proportional_highlights[TokenType.INLINE_CODE] = self._create_highlight(ColorRole.SYNTAX_12)\n        self._error_proportional_highlight = self._create_proportional_highlight(ColorRole.SYNTAX_ERROR)\n\n    def _create_proportional_highlight(self, role: ColorRole) -> QTextCharFormat:\n        text_highlight = QTextCharFormat()\n        text_highlight.setForeground(QColor(self._colors[role][self._color_mode]))\n\n        return text_highlight\n\n    def _create_app_icon_svg(self, bg_color: str, text_color: str) -> str:\n        \"\"\"\n        Create an application icon SVG with specified colors.\n\n        Args:\n            bg_color: Background color in hex format\n            text_color: Text color in hex format\n\n        Returns:\n            str: SVG markup for the application icon\n        \"\"\"\n        return f'''\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"128\" height=\"128\" viewBox=\"0 0 384 384\">\n                <rect x=\"0\" y=\"0\" width=\"384\" height=\"384\" fill=\"{bg_color}\"/>\n                <g fill=\"{text_color}\">\n                    <g transform=\"translate(38.400004, 250.960113)\">\n                        <path d=\"M 97.234375 0\n                            L 92.125 -64.078125\n                            L 91.46875 -64.078125\n                            L 69.328125-0.65625\n                            L 54.640625 -0.65625\n                            L 32.5 -64.078125\n                            L 31.84375 -64.078125\n                            L 26.734375 0\n                            L 2.09375 0\n                            L 11.796875 -108.109375\n                            L 38 -108.109375\n                            L 61.984375 -45.734375\n                            L 85.96875 -108.109375\n                            L 112.171875 -108.109375\n                            L 121.875 0\n                            Z\"/>\n                    </g>\n                    <g transform=\"translate(162.225522, 250.960113)\">\n                        <path d=\"M 76 -108.109375\n                            L 44.15625 -71.03125\n                            C 46 -72.070312 48.578125 -72.59375 51.890625 -72.59375\n                            C 55.734375 -72.59375 59.617188 -71.785156 63.546875 -70.171875\n                            C 67.484375 -68.554688 71.175781 -66.238281 74.625 -63.21875\n                            C 78.082031 -60.207031 80.898438 -56.210938 83.078125 -51.234375\n                            C 85.265625 -46.253906 86.359375 -40.753906 86.359375 -34.734375\n                            C 86.359375 -28.609375 85.203125 -23.125 82.890625 -18.28125\n                            C 80.578125 -13.4375 77.472656 -9.59375 73.578125 -6.75\n                            C 69.691406 -3.90625 65.429688 -1.738281 60.796875 -0.25\n                            C 56.171875 1.226562 51.328125 1.96875 46.265625 1.96875\n                            C 34.117188 1.96875 23.894531 -1.566406 15.59375 -8.640625\n                            C 7.289062 -15.722656 3.140625 -24.421875 3.140625 -34.734375\n                            C 3.140625 -43.460938 4.363281 -50.644531 6.8125 -56.28125\n                            C 9.257812 -61.914062 13.71875 -69.101562 20.1875 -77.84375\n                            L 45.609375 -108.109375\n                            Z\n                            M 28.703125 -34.734375\n                            C 28.703125 -30.015625 30.226562 -26.101562 33.28125 -23\n                            C 36.34375 -19.894531 40.273438 -18.34375 45.078125 -18.34375\n                            C 49.878906 -18.34375 53.851562 -19.894531 57 -23\n                            C 60.144531 -26.101562 61.71875 -30.015625 61.71875 -34.734375\n                            C 61.71875 -39.535156 60.125 -43.53125 56.9375 -46.71875\n                            C 53.75 -49.90625 49.796875 -51.5 45.078125 -51.5\n                            C 40.535156 -51.5 36.671875 -49.90625 33.484375 -46.71875\n                            C 30.296875 -43.53125 28.703125 -39.535156 28.703125 -34.734375\n                            Z\"/>\n                    </g>\n                    <g transform=\"translate(249.066902, 250.960113)\">\n                        <path d=\"M 7.859375 -108.109375\n                            L 46.515625 -108.109375\n                            C 56.910156 -108.109375 65.382812 -105.332031 71.9375 -99.78125\n                            C 78.488281 -94.238281 81.765625 -86.3125 81.765625 -76\n                            C 81.765625 -68.050781 79.773438 -61.390625 75.796875 -56.015625\n                            C 71.828125 -50.648438 66.4375 -46.875 59.625 -44.6875\n                            L 96.84375 0\n                            L 65.515625 0\n                            L 32.5 -42.71875\n                            L 32.5 0\n                            L 7.859375 0\n                            Z\n                            M 32.5 -60.15625\n                            L 35.375 -60.15625\n                            C 37.65625 -60.15625 39.578125 -60.195312 41.140625 -60.28125\n                            C 42.710938 -60.363281 44.503906 -60.664062 46.515625 -61.1875\n                            C 48.523438 -61.71875 50.140625 -62.460938 51.359375 -63.421875\n                            C 52.585938 -64.390625 53.640625 -65.789062 54.515625 -67.625\n                            C 55.390625 -69.457031 55.828125 -71.679688 55.828125 -74.296875\n                            C 55.828125 -76.921875 55.390625 -79.148438 54.515625 -80.984375\n                            C 53.640625 -82.816406 52.585938 -84.210938 51.359375 -85.171875\n                            C 50.140625 -86.140625 48.523438 -86.882812 46.515625 -87.40625\n                            C 44.503906 -87.925781 42.710938 -88.226562 41.140625 -88.3125\n                            C 39.578125 -88.40625 37.65625 -88.453125 35.375 -88.453125\n                            L 32.5 -88.453125\n                            Z\"/>\n                    </g>\n                </g>\n            </svg>\n        '''\n\n    def _write_icon(self, name: str, svg_data: str) -> None:\n        icon_dir = os.path.expanduser(\"~/.humbug/icons\")\n        with open(os.path.join(icon_dir, name), 'w', encoding='utf-8') as f:\n            f.write(svg_data)\n\n    def _create_active_inactive_theme_icons(self, active: bool, suffix: str, color: str) -> None:\n        prefix = \"\" if active else \"inactive-\"\n\n        # Close button - visible version\n        self._write_icon(f'{prefix}close-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                    d=\"M16,16 L48,48 M48,16 L16,48\"/>\n            </svg>\n        ''')\n\n        # Conversation tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}conversation-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M8 10H8.01\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M12 10H12.01\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M16 10H16.01\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M21 13V7C21 5.11438 21 4.17157 20.4142 3.58579C19.8284 3 18.8856 3 17 3H7C5.11438 3\n                    4.17157 3 3.58579 3.58579C3 4.17157 3 5.11438 3 7V13C3 14.8856 3 15.8284 3.58579 16.4142C4.17157\n                    17 5.11438 17 7 17H7.5C7.77614 17 8 17.2239 8 17.5V20V20.1499C8 20.5037 8.40137 20.7081\n                    8.6875 20.5L13.0956 17.2941C13.3584 17.103 13.675 17 14 17H17C18.8856 17 19.8284 17 20.4142\n                    16.4142C21 15.8284 21 14.8856 21 13Z\" stroke=\"{color}\" stroke-width=\"2\" stroke-linejoin=\"round\"/>\n            </svg>\n        ''')\n\n        # Editor tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}editor-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M13 21H21\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M20.0651 7.39423L7.09967 20.4114C6.72438 20.7882 6.21446 21 5.68265 21H4.00383C3.44943\n                    21 3 20.5466 3 19.9922V18.2987C3 17.7696 3.20962 17.2621 3.58297 16.8873L16.5517 3.86681C19.5632\n                    1.34721 22.5747 4.87462 20.0651 7.39423Z\" stroke=\"{color}\" stroke-width=\"2\"\n                    stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M15.3097 5.30981L18.7274 8.72755\" stroke=\"{color}\" stroke-width=\"2\"\n                    stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n            </svg>\n        ''')\n\n        # Log tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}log-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M5 12H7.75044C7.89947 12 8.03179 11.9046 8.07892 11.7632V11.7632L9.875 6.375V6.375C9.91626\n                    6.25122 10.0918 6.25238 10.1364 6.375V6.375L13.875 16.6562L13.885 16.6837C13.9253 16.7946 14.0812\n                    16.797 14.125 16.6875V16.6875L15.8841 12.2898V12.2898C15.9541 12.1148 16.1236 12 16.3122 12H19\"\n                    stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n            </svg>\n        ''')\n\n        # Shell tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}shell-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M3 7C3 5.11438 3 4.17157 3.58579 3.58579C4.17157 3 5.11438 3 7 3H12H17C18.8856 3 19.8284\n                    3 20.4142 3.58579C21 4.17157 21 5.11438 21 7V10V13C21 14.8856 21 15.8284 20.4142 16.4142C19.8284\n                    17 18.8856 17 17 17H12H7C5.11438 17 4.17157 17 3.58579 16.4142C3 15.8284 3 14.8856 3 13V10V7Z\"\n                    stroke=\"{color}\" stroke-width=\"2\" stroke-linejoin=\"round\"/>\n                <path d=\"M7 21H17\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M12 17V21\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n            </svg>\n        ''')\n\n        # Terminal tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}terminal-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M13 15H16\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n                <path d=\"M8 15L10.5 12.5V12.5C10.7761 12.2239 10.7761 11.7761 10.5 11.5V11.5L8 9\"\n                    stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M3 8C3 6.11438 3 5.17157 3.58579 4.58579C4.17157 4 5.11438 4 7 4H12H17C18.8856 4\n                    19.8284 4 20.4142 4.58579C21 5.17157 21 6.11438 21 8V12V16C21 17.8856 21 18.8284 20.4142\n                    19.4142C19.8284 20 18.8856 20 17 20H12H7C5.11438 20 4.17157 20 3.58579 19.4142C3 18.8284\n                    3 17.8856 3 16V12V8Z\" stroke=\"{color}\" stroke-width=\"2\" stroke-linejoin=\"round\"/>\n            </svg>\n        ''')\n\n        # Wiki tab icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n        self._write_icon(f'{prefix}wiki-{suffix}.svg', f'''\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M17.8284 6.82843C18.4065 7.40649 18.6955 7.69552 18.8478 8.06306C19 8.4306 19 8.83935\n                    19 9.65685L19 17C19 18.8856 19 19.8284 18.4142 20.4142C17.8284 21 16.8856 21 15 21H9C7.11438\n                    21 6.17157 21 5.58579 20.4142C5 19.8284 5 18.8856 5 17L5 7C5 5.11438 5 4.17157 5.58579\n                    3.58579C6.17157 3 7.11438 3 9 3H12.3431C13.1606 3 13.5694 3 13.9369 3.15224C14.3045 3.30448\n                    14.5935 3.59351 15.1716 4.17157L17.8284 6.82843Z\" stroke=\"{color}\"\n                    stroke-width=\"2\" stroke-linejoin=\"round\"/>\n                <path d=\"M9 6L11 6\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M10 9L12 9\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M9 12L11 12\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M10 15L12 15\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n            </svg>\n        ''')\n\n    def _create_theme_icons(self) -> None:\n        \"\"\"Create theme-specific icons in the user's .humbug directory.\"\"\"\n        icon_dir = os.path.expanduser(\"~/.humbug/icons\")\n        os.makedirs(icon_dir, exist_ok=True)\n\n        # Create collapsed and expanded arrows for both themes\n        for mode in ColorMode:\n            color = self._colors[ColorRole.TEXT_PRIMARY][mode]\n            inactive_color = self._colors[ColorRole.TEXT_INACTIVE][mode]\n            suffix = mode.name.lower()\n\n            # Right-pointing arrow\n            self._write_icon(f'arrow-right-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M24,16 L40,32 L24,48\"/>\n                </svg>\n            ''')\n\n            # Left-pointing arrow\n            self._write_icon(f'arrow-left-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M40,16 L24,32 L40,48\"/>\n                </svg>\n            ''')\n\n            # Up-pointing arrow\n            self._write_icon(f'arrow-up-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M16,40 L32,24 L48,40\"/>\n                </svg>\n            ''')\n\n            # Down-pointing arrow\n            self._write_icon(f'arrow-down-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M16,24 L32,40 L48,24\"/>\n                </svg>\n            ''')\n\n            # Close button - visible version\n            self._write_icon(f'close-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M16,16 L48,48 M48,16 L16,48\"/>\n                </svg>\n            ''')\n\n            # Checkbox check mark\n            self._write_icon(f'check-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M16,32 L28,44 L48,20\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                </svg>\n            ''')\n\n            # Right-pointing expand\n            self._write_icon(f'expand-right-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M20,8 L44,32 L20,56\"/>\n                </svg>\n            ''')\n\n            # Left-pointing expand\n            self._write_icon(f'expand-left-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M44,8 L20,32 L44,56\"/>\n                </svg>\n            ''')\n\n            # Down-pointing expand\n            self._write_icon(f'expand-down-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M8,20 L32,44 L56,20\"/>\n                </svg>\n            ''')\n\n            # Bulb on icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n            self._write_icon(f'info-{suffix}.svg', f'''\n                <svg width=\"800px\" height=\"800px\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path d=\"M12 7C9.23858 7 7 9.23858 7 12C7 13.3613 7.54402 14.5955 8.42651 15.4972C8.77025 15.8484 9.05281 16.2663\n                        9.14923 16.7482L9.67833 19.3924C9.86537 20.3272 10.6862 21 11.6395 21H12.3605C13.3138 21 14.1346 20.3272\n                        14.3217 19.3924L14.8508 16.7482C14.9472 16.2663 15.2297 15.8484 15.5735 15.4972C16.456 14.5955 17\n                        13.3613 17 12C17 9.23858 14.7614 7 12 7Z\" stroke=\"{color}\" stroke-width=\"2\"/>\n                    <path d=\"M12 4V3\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M18 6L19 5\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M20 12H21\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M4 12H3\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M5 5L6 6\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M10 17H14\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                </svg>\n            ''')\n\n            # Alert triangle icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n            self._write_icon(f'warning-{suffix}.svg', f'''\n                <svg width=\"800px\" height=\"800px\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path d=\"M12 10V13\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n                    <path d=\"M12 16V15.9888\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n                    <path d=\"M10.2518 5.147L3.6508 17.0287C2.91021 18.3618 3.87415 20 5.39912 20H18.6011C20.126 20 21.09\n                        18.3618 20.3494 17.0287L13.7484 5.147C12.9864 3.77538 11.0138 3.77538 10.2518 5.147Z\"\n                        stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                </svg>\n            ''')\n\n            # Alert hexagon icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n            self._write_icon(f'critical-{suffix}.svg', f'''\n                <svg width=\"800px\" height=\"800px\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path d=\"M3 9.22843V14.7716C3 15.302 3.21071 15.8107 3.58579 16.1858L7.81421 20.4142C8.18929 20.7893 8.69799\n                        21 9.22843 21H14.7716C15.302 21 15.8107 20.7893 16.1858 20.4142L20.4142 16.1858C20.7893 15.8107 21\n                        15.302 21 14.7716V9.22843C21 8.69799 20.7893 8.18929 20.4142 7.81421L16.1858 3.58579C15.8107 3.21071\n                        15.302 3 14.7716 3H9.22843C8.69799 3 8.18929 3.21071 7.81421 3.58579L3.58579 7.81421C3.21071 8.18929\n                        3 8.69799 3 9.22843Z\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M12 8V13\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n                    <path d=\"M12 16V15.9888\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n                </svg>\n            ''')\n\n            # Help circle icon (from https://www.svgrepo.com/collection/scarlab-oval-line-icons/)\n            self._write_icon(f'question-{suffix}.svg', f'''\n                <svg width=\"800px\" height=\"800px\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path d=\"M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12\n                        3C16.9706 3 21 7.02944 21 12Z\" stroke=\"{color}\" stroke-width=\"2\"/>\n                    <path d=\"M10.5 8.67709C10.8665 8.26188 11.4027 8 12 8C13.1046 8 14 8.89543 14 10C14 10.9337\n                        13.3601 11.718 12.4949 11.9383C12.2273 12.0064 12 12.2239 12 12.5V12.5V13\"\n                        stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M12 16H12.01\" stroke=\"{color}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'save-{suffix}.svg', f'''\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M8,40, L8,56 L56,56 L56,40\"/>\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M32,8, L32,40\"/>\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M20,28, L32,40, L44,28\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'copy-{suffix}.svg', f'''\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <rect x=\"22\" y=\"10\" width=\"32\" height=\"32\" stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"/>\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M22,22, L10,22 L10,54 L42,54 L42,42\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'fork-{suffix}.svg', f'''\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M32,8 L32,32 M32,32 L8,56 L8,40 M8,56 L24,56 M32,32 L56,56 L56,40 M56,56 L40,56\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'delete-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M12.5,20 L12.5,56 L51.5,56 L51.5,20 M4,20 L60,20 M18,20 L24,8 L40,8 L46,20\"/>\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M25.5,28 L25.5,46 M38.5,28 L38.5,46\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'edit-{suffix}.svg', f'''\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\"\n                        d=\"M8,56 L56,56 M40,12 L52,24 L24,52 L8,56 L12,40 L40,12 Z\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'submit-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M8,32 L32,8 L56,32\"/>\n                    <path stroke=\"{color}\" stroke-width=\"6\" fill=\"none\" d=\"M32,56 L32,8\"/>\n                </svg>\n            ''')\n\n            self._write_icon(f'stop-{suffix}.svg', f'''\n                <svg viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <circle cx=\"32\" cy=\"32\" r=\"28\" fill=\"none\" stroke=\"{color}\" stroke-width=\"6\"/>\n                    <rect x=\"20\" y=\"20\" width=\"24\" height=\"24\" fill=\"{color}\" stroke=\"none\"/>\n                </svg>\n            ''')\n\n            self._create_active_inactive_theme_icons(True, suffix, color)\n            self._create_active_inactive_theme_icons(False, suffix, inactive_color)\n\n        # Create the standard application icon for about dialog\n        self._write_icon('app-icon.svg', self._create_app_icon_svg('#4040c0', '#ffffff'))\n\n        # Create light mode disabled version\n        self._write_icon('app-icon-disabled-light.svg', self._create_app_icon_svg('#c0c0c0', '#e0e0e0'))\n\n        # Create dark mode disabled version\n        self._write_icon('app-icon-disabled-dark.svg', self._create_app_icon_svg('#202020', '#404040'))\n\n    def get_icon_path(self, name: str) -> str:\n        \"\"\"\n        Get the path to a theme-appropriate icon.\n\n        Args:\n            name: Base name of the icon (without theme suffix or extension)\n\n        Returns:\n            Full path to the icon file\n        \"\"\"\n        icon_dir = os.path.expanduser(\"~/.humbug/icons\")\n        theme = \"dark\" if self._color_mode == ColorMode.DARK else \"light\"\n        return Path(os.path.join(icon_dir, f\"{name}-{theme}.svg\")).as_posix()\n\n    def scale_icon(self, icon_path: str, target_size: int) -> QPixmap:\n        \"\"\"\n        Load and scale an icon to the appropriate size.\n\n        Args:\n            icon_path: Path to the icon file\n            target_size: Desired size in pixels\n\n        Returns:\n            Scaled QPixmap of the icon\n        \"\"\"\n        pixmap = QPixmap(icon_path)\n        scaled_size = int(target_size * self._zoom_factor)\n        return pixmap.scaled(\n            scaled_size,\n            scaled_size,\n            Qt.AspectRatioMode.KeepAspectRatio,\n            Qt.TransformationMode.SmoothTransformation\n        )\n\n    def get_color(self, role: ColorRole) -> QColor:\n        \"\"\"\n        Get a color for a specific role.\n\n        Args:\n            role: The ColorRole to look up\n\n        Returns:\n            QColor: The color for the specified role\n\n        Raises:\n            KeyError: If no color is defined for the role\n        \"\"\"\n        return QColor(self._colors[role][self._color_mode])\n\n    def get_color_str(self, role: ColorRole) -> str:\n        \"\"\"\n        Get a color string for a specific role.\n\n        Args:\n            role: The ColorRole to look up\n\n        Returns:\n            str: The color string (hex format) for the specified role\n\n        Raises:\n            KeyError: If no color is defined for the role\n        \"\"\"\n        return self._colors[role][self._color_mode]\n\n    def get_highlight(self, token_type: TokenType) -> QTextCharFormat:\n        \"\"\"\n        Get the highlight format for a specific token type.\n\n        Args:\n            token_type: The TokenType to look up\n\n        Returns:\n            QTextCharFormat: The highlight format for the specified token type\n        \"\"\"\n        if token_type not in self._highlights:\n            print(f\"token type {token_type} not mapped\")\n\n        return self._highlights.get(token_type, self._error_highlight)\n\n    def get_proportional_highlight(self, token_type: TokenType) -> QTextCharFormat:\n        \"\"\"\n        Get the proportionally-spaced highlight format for a specific token type.\n\n        Args:\n            token_type: The TokenType to look up\n\n        Returns:\n            QTextCharFormat: The highlight format for the specified token type\n        \"\"\"\n        if token_type not in self._proportional_highlights:\n            print(f\"token type {token_type} not mapped\")\n\n        return self._proportional_highlights.get(token_type, self._error_proportional_highlight)\n\n    def _determine_base_font_size(self) -> float:\n        \"\"\"\n        Determine the default system font size based on the operating system.\n\n        Returns:\n            int: Base font size in points.\n        \"\"\"\n        # Get current OS\n        os_type = QOperatingSystemVersion.current()\n\n        # Get system default font\n        system_font = QFontDatabase.systemFont(QFontDatabase.SystemFont.GeneralFont)\n        system_size = system_font.pointSizeF()\n\n        # Apply OS-specific adjustments if system detection fails\n        if system_size > 0:\n            return system_size\n\n        if os_type.type() == QOperatingSystemVersion.OSType.MacOS:  # type: ignore\n            # macOS typically uses 13pt as default\n            return 13\n\n        if os_type.type() == QOperatingSystemVersion.OSType.Windows:  # type: ignore\n            # Windows typically uses 9pt as default\n            return 9\n\n        # Linux typically uses 10pt as default\n        return 10\n\n    def base_font_size(self) -> float:\n        \"\"\"Get the base font size for the current system.\"\"\"\n        return self._user_font_size or self._base_font_size\n\n    def set_user_font_size(self, size: float | None) -> None:\n        \"\"\"Set user-specific font size override.\"\"\"\n        if size != self._user_font_size:\n            self._user_font_size = size\n\n            if size:\n                self.style_changed.emit()\n\n    def color_mode(self) -> ColorMode:\n        \"\"\"Get the current color mode.\"\"\"\n        return self._color_mode\n\n    def set_color_mode(self, mode: ColorMode) -> None:\n        \"\"\"\n        Set the color mode and update application styles.\n\n        Args:\n            mode: The ColorMode to switch to\n        \"\"\"\n        if mode != self._color_mode:\n            self._color_mode = mode\n            self._initialize_highlights()\n            self._initialize_proportional_highlights()\n            self.style_changed.emit()\n\n    def zoom_factor(self) -> float:\n        \"\"\"Current zoom scaling factor.\"\"\"\n        return self._zoom_factor\n\n    def set_zoom(self, factor: float) -> None:\n        \"\"\"\n        Set new zoom factor and update application styles.\n\n        Args:\n            factor: New zoom factor to apply (clamped between 0.5 and 2.0)\n        \"\"\"\n        new_factor = max(0.5, min(2.0, factor))\n        if new_factor != self._zoom_factor:\n            self._zoom_factor = new_factor\n            self.style_changed.emit()\n\n    def get_space_width(self) -> float:\n        \"\"\"Get the width of a space character\"\"\"\n        font = QFont(self._code_font_families)\n        font.setPointSizeF(self.base_font_size() * self._zoom_factor)\n        font_metrics = QFontMetricsF(font)\n        space_width = font_metrics.horizontalAdvance('        ') / 8\n        return space_width\n\n    def monospace_font_families(self) -> List[str]:\n        \"\"\"Get the standard monospace font family fallback sequence.\"\"\"\n        return self._code_font_families\n\n    def message_bubble_spacing(self) -> float:\n        \"\"\"Get the number of pixels to use in message bubble spacing.\"\"\"\n        return 8.0\n\n    def get_dialog_stylesheet(self) -> str:\n        \"\"\"\n        Get a complete stylesheet for dialog windows.\n\n        Returns:\n            A stylesheet string with styling for all common dialog components\n        \"\"\"\n        zoom_factor = self.zoom_factor()\n        base_font_size = self.base_font_size()\n\n        return f\"\"\"\n            QDialog {{\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\n                font-size: {base_font_size * zoom_factor}pt;\n            }}\n\n            QScrollArea {{\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\n                border: none;\n            }}\n\n            QScrollArea > QWidget > QWidget {{\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\n                border: none;\n            }}\n\n            /* Labels */\n            QLabel {{\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_DIALOG)};\n                border: none;\n                border-radius: 4px;\n                padding: 0px;\n                margin: 0px;\n                font-size: {base_font_size * zoom_factor}pt;\n            }}\n\n            /* Text inputs */\n            QLineEdit {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border: none;\n                border-radius: 4px;\n                padding: 4px;\n                font-size: {int(base_font_size * zoom_factor)}pt;\n            }}\n            QLineEdit:disabled {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n\n            /* Checkboxes */\n            QCheckBox {{\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border: none;\n                border-radius: 4px;\n                padding: 0px;\n                margin: 0px;\n            }}\n            QCheckBox::indicator {{\n                width: {int(18 * zoom_factor)}px;\n                height: {int(18 * zoom_factor)}px;\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\n            }}\n            QCheckBox::indicator:disabled {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\n            }}\n            QCheckBox::indicator:checked {{\n                image: url({self.get_icon_path('check')});\n            }}\n            QCheckBox:disabled {{\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n\n            /* Combo boxes */\n            QComboBox {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border: none;\n                border-radius: 4px;\n                padding: 6px;\n                margin: 0px;\n                font-size: {int(base_font_size * zoom_factor)}pt;\n            }}\n            QComboBox:disabled {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n            QComboBox::drop-down {{\n                border: none;\n                width: 20px;\n            }}\n            QComboBox::down-arrow {{\n                image: url({self.get_icon_path(\"arrow-down\")});\n                width: 12px;\n                height: 12px;\n            }}\n            QComboBox::down-arrow:on {{\n                image: url({self.get_icon_path('arrow-up')});\n                width: 12px;\n                height: 12px;\n            }}\n            QComboBox::down-arrow:disabled {{\n                image: none;\n            }}\n            QComboBox QAbstractItemView::item:selected {{\n                border: none;\n                background-color: {self.get_color_str(ColorRole.TEXT_SELECTED)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n            }}\n            QComboBox QListView {{\n                background-color: {self.get_color_str(ColorRole.BACKGROUND_SECONDARY)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n            }}\n\n            /* Spin boxes */\n            QSpinBox, QDoubleSpinBox {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border: none;\n                border-radius: 4px;\n                padding: 4px;\n                font-size: {base_font_size * zoom_factor}pt;\n            }}\n            QSpinBox:disabled, QDoubleSpinBox:disabled {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n            QSpinBox::up-button, QSpinBox::down-button,\n            QDoubleSpinBox::up-button, QDoubleSpinBox::down-button {{\n                border: none;\n                width: 20px;\n            }}\n            QSpinBox::up-arrow, QDoubleSpinBox::up-arrow {{\n                image: url({self.get_icon_path('arrow-up')});\n                width: 12px;\n                height: 12px;\n            }}\n            QSpinBox::up-arrow:disabled, QSpinBox::up-arrow:off,\n            QDoubleSpinBox::up-arrow:disabled, QDoubleSpinBox::up-arrow:off {{\n                image: none;\n            }}\n            QSpinBox::down-arrow, QDoubleSpinBox::down-arrow {{\n                image: url({self.get_icon_path('arrow-down')});\n                width: 12px;\n                height: 12px;\n            }}\n            QSpinBox::down-arrow:disabled, QSpinBox::down-arrow:off,\n            QDoubleSpinBox::down-arrow:disabled, QDoubleSpinBox::down-arrow:off {{\n                image: none;\n            }}\n\n            /* Buttons */\n            QPushButton {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND)};\n                color: {self.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border: none;\n                border-radius: 4px;\n                padding: 4px;\n                font-size: {base_font_size * zoom_factor}pt;\n            }}\n            QPushButton:hover {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_HOVER)};\n            }}\n            QPushButton:pressed {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_PRESSED)};\n            }}\n            QPushButton:disabled {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DISABLED)};\n                color: {self.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n\n            /* Recommended (primary) buttons */\n            QPushButton[recommended=\"true\"] {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_RECOMMENDED)};\n                color: {self.get_color_str(ColorRole.TEXT_RECOMMENDED)};\n            }}\n            QPushButton[recommended=\"true\"]:hover {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_RECOMMENDED_HOVER)};\n            }}\n            QPushButton[recommended=\"true\"]:pressed {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_RECOMMENDED_PRESSED)};\n            }}\n            QPushButton[recommended=\"false\"] {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE)};\n                color: {self.get_color_str(ColorRole.TEXT_RECOMMENDED)};\n            }}\n            QPushButton[recommended=\"false\"]:hover {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_HOVER)};\n            }}\n            QPushButton[recommended=\"false\"]:pressed {{\n                background-color: {self.get_color_str(ColorRole.BUTTON_BACKGROUND_DESTRUCTIVE_PRESSED)};\n            }}\n\n            QScrollBar:vertical {{\n                background-color: {self.get_color_str(ColorRole.SCROLLBAR_BACKGROUND)};\n                width: 12px;\n            }}\n            QScrollBar::handle:vertical {{\n                background-color: {self.get_color_str(ColorRole.SCROLLBAR_HANDLE)};\n                min-height: 20px;\n            }}\n            QScrollBar::add-page:vertical, QScrollBar::sub-page:vertical {{\n                background: none;\n            }}\n            QScrollBar::add-line:vertical, QScrollBar::sub-line:vertical {{\n                height: 0px;\n            }}\n        \"\"\""
          }
        }
      ]
    },
    {
      "id": "17e94f50-c542-41cb-85db-d2250c24a614",
      "timestamp": "2025-08-29T20:18:18.095176+00:00",
      "type": "tool_result",
      "content": "```json\n{\n    \"id\": \"toolu_01H3T6ff5D55G96x77A1L9bX\",\n    \"name\": \"filesystem\",\n    \"content\": \"File written successfully: src/humbug/style_manager.py (63,672 bytes)\",\n    \"error\": null\n}\n```",
      "completed": true,
      "tool_results": [
        {
          "id": "toolu_01H3T6ff5D55G96x77A1L9bX",
          "name": "filesystem",
          "content": "File written successfully: src/humbug/style_manager.py (63,672 bytes)",
          "error": null
        }
      ]
    },
    {
      "id": "ac8b654e-5687-41e9-b8ca-c30978cf5ac8",
      "timestamp": "2025-08-29T20:18:18.113211+00:00",
      "type": "user_message",
      "content": "",
      "completed": true,
      "tool_results": [
        {
          "id": "toolu_01H3T6ff5D55G96x77A1L9bX",
          "name": "filesystem",
          "content": "File written successfully: src/humbug/style_manager.py (63,672 bytes)",
          "error": null
        }
      ]
    },
    {
      "id": "56ede567-6b8f-4ac0-9103-15ad108ec447",
      "timestamp": "2025-08-29T20:18:20.812276+00:00",
      "type": "ai_response",
      "content": "Now I need to modify the MainWindow to connect to the exception notifier and update the status bar styling. Let me update the main window:",
      "completed": true,
      "usage": {
        "prompt_tokens": 70150,
        "completion_tokens": 17279,
        "total_tokens": 87429
      },
      "model": "claude-sonnet-4-20250514",
      "reasoning_capability": 1,
      "temperature": 0.7,
      "tool_calls": [
        {
          "id": "toolu_016RQWfX9P8iTgZZp6iQNEHs",
          "name": "filesystem",
          "arguments": {
            "operation": "write_file",
            "path": "src/humbug/main_window.py",
            "content": "\"\"\"Main window implementation for Humbug application.\"\"\"\n\nimport json\nimport logging\nimport os\nfrom pathlib import Path\nfrom typing import cast, Dict, Tuple\n\nfrom PySide6.QtWidgets import (\n    QMainWindow, QWidget, QVBoxLayout, QMenuBar, QFileDialog,\n    QSplitter, QLabel, QApplication, QDialog, QMenu, QStatusBar\n)\nfrom PySide6.QtCore import Qt, QTimer, QEvent\nfrom PySide6.QtGui import QKeyEvent, QAction, QKeySequence, QActionGroup\n\nfrom metaphor import (\n    MetaphorASTBuilder, MetaphorASTBuilderError, MetaphorFormatVisitor, MetaphorASTRootNode,\n    format_errors, format_preamble\n)\n\nfrom ai_tool import AIToolManager\nfrom ai_tool.tools.calculator_ai_tool import CalculatorAITool\nfrom ai_tool.tools.clock_ai_tool import ClockAITool\nfrom ai_tool.tools.filesystem_ai_tool import FileSystemAITool\n\nfrom humbug.about_dialog import AboutDialog\nfrom humbug.color_role import ColorRole\nfrom humbug.delegate_ai_tool import DelegateAITool\nfrom humbug.exception_notifier import get_exception_notifier\nfrom humbug.message_box import MessageBox, MessageBoxType\nfrom humbug.language.language_manager import LanguageManager\nfrom humbug.mindspace.mindspace_error import MindspaceError, MindspaceExistsError\nfrom humbug.mindspace.mindspace_folders_dialog import MindspaceFoldersDialog\nfrom humbug.mindspace.mindspace_log_level import MindspaceLogLevel\nfrom humbug.mindspace.mindspace_manager import MindspaceManager\nfrom humbug.mindspace.mindspace_settings import MindspaceSettings\nfrom humbug.mindspace.mindspace_settings_dialog import MindspaceSettingsDialog\nfrom humbug.mindspace.mindspace_view import MindspaceView\nfrom humbug.mindspace.mindspace_view_type import MindspaceViewType\nfrom humbug.style_manager import StyleManager, ColorMode\nfrom humbug.status_message import StatusMessage\nfrom humbug.system_ai_tool import SystemAITool\nfrom humbug.tabs.column_manager import ColumnManager\nfrom humbug.tabs.conversation.conversation_error import ConversationError\nfrom humbug.tabs.conversation.conversation_tab import ConversationTab\nfrom humbug.tabs.shell.commands.shell_command_clear import ShellCommandClear\nfrom humbug.tabs.shell.commands.shell_command_conversation import ShellCommandConversation\nfrom humbug.tabs.shell.commands.shell_command_edit import ShellCommandEdit\nfrom humbug.tabs.shell.commands.shell_command_help import ShellCommandHelp\nfrom humbug.tabs.shell.commands.shell_command_log import ShellCommandLog\nfrom humbug.tabs.shell.commands.shell_command_m6rc import ShellCommandM6rc\nfrom humbug.tabs.shell.commands.shell_command_terminal import ShellCommandTerminal\nfrom humbug.tabs.shell.commands.shell_command_wiki import ShellCommandWiki\nfrom humbug.tabs.shell.shell_command_registry import ShellCommandRegistry\nfrom humbug.tabs.tab_base import TabBase\nfrom humbug.tabs.wiki.wiki_error import WikiError\nfrom humbug.tabs.wiki.wiki_tab import WikiTab\nfrom humbug.user.user_manager import UserManager, UserError\nfrom humbug.user.user_settings import UserSettings\nfrom humbug.user.user_settings_dialog import UserSettingsDialog\n\n\nclass MainWindow(QMainWindow):\n    \"\"\"Main window for the Humbug application.\"\"\"\n\n    def __init__(self) -> None:\n        \"\"\"Initialize the main window.\"\"\"\n        super().__init__()\n\n        self._logger = logging.getLogger(\"MainWindow\")\n\n        self._language_manager = LanguageManager()\n        self._language_manager.language_changed.connect(self._on_language_changed)\n        strings = self._language_manager.strings()\n\n        # Humbug menu actions\n        self._about_action = QAction(strings.about_humbug, self)\n        self._about_action.setMenuRole(QAction.MenuRole.AboutRole)\n        self._about_action.triggered.connect(self._show_about_dialog)\n\n        self._user_settings_action = QAction(strings.user_settings, self)\n        self._user_settings_action.setMenuRole(QAction.MenuRole.PreferencesRole)\n        self._user_settings_action.setShortcut(QKeySequence(\"Ctrl+,\"))\n        self._user_settings_action.triggered.connect(self._show_user_settings_dialog)\n\n        self._quit_action = QAction(strings.quit_humbug, self)\n        self._quit_action.setMenuRole(QAction.MenuRole.QuitRole)\n        self._quit_action.setShortcut(QKeySequence(\"Ctrl+Q\"))\n        self._quit_action.triggered.connect(self.close)\n\n        # File menu actions\n        self._new_mindspace_action = QAction(strings.new_mindspace, self)\n        self._new_mindspace_action.setShortcut(QKeySequence(\"Ctrl+Alt+N\"))\n        self._new_mindspace_action.triggered.connect(self._new_mindspace)\n\n        self._new_conv_action = QAction(strings.new_conversation, self)\n        self._new_conv_action.setShortcut(QKeySequence(\"Ctrl+Shift+N\"))\n        self._new_conv_action.triggered.connect(self._new_conversation)\n\n        self._new_metaphor_conv_action = QAction(strings.new_metaphor_conversation, self)\n        self._new_metaphor_conv_action.setShortcut(QKeySequence(\"Ctrl+Shift+M\"))\n        self._new_metaphor_conv_action.triggered.connect(self._new_metaphor_conversation)\n\n        self._new_file_action = QAction(strings.new_file, self)\n        self._new_file_action.setShortcut(QKeySequence.StandardKey.New)\n        self._new_file_action.triggered.connect(self._new_file)\n\n        self._new_terminal_action = QAction(strings.new_terminal, self)\n        self._new_terminal_action.setShortcut(QKeySequence(\"Ctrl+Alt+T\"))\n        self._new_terminal_action.triggered.connect(self._new_terminal)\n\n        self._open_mindspace_action = QAction(strings.open_mindspace, self)\n        self._open_mindspace_action.setShortcut(QKeySequence(\"Ctrl+Alt+O\"))\n        self._open_mindspace_action.triggered.connect(self._open_mindspace)\n\n        self._open_wiki_action = QAction(strings.open_wiki, self)\n        self._open_wiki_action.setShortcut(QKeySequence(\"Ctrl+Shift+W\"))\n        self._open_wiki_action.triggered.connect(self._open_wiki)\n\n        self._open_conv_action = QAction(strings.open_conversation, self)\n        self._open_conv_action.setShortcut(QKeySequence(\"Ctrl+Shift+O\"))\n        self._open_conv_action.triggered.connect(self._open_conversation)\n\n        self._open_file_action = QAction(strings.open_file, self)\n        self._open_file_action.setShortcut(QKeySequence.StandardKey.Open)\n        self._open_file_action.triggered.connect(self._open_file)\n\n        self._fork_conv_action = QAction(strings.fork_conversation, self)\n        self._fork_conv_action.setShortcut(QKeySequence(\"Ctrl+Shift+F\"))\n        self._fork_conv_action.triggered.connect(self._fork_conversation)\n\n        self._save_action = QAction(strings.save, self)\n        self._save_action.setShortcut(QKeySequence.StandardKey.Save)\n        self._save_action.triggered.connect(self._save_file)\n\n        self._save_as_action = QAction(strings.save_as, self)\n        self._save_as_action.setShortcut(QKeySequence.StandardKey.SaveAs)\n        self._save_as_action.triggered.connect(self._save_file_as)\n\n        self._close_tab_action = QAction(strings.close_tab, self)\n        self._close_tab_action.setShortcut(QKeySequence(\"Ctrl+W\"))\n        self._close_tab_action.triggered.connect(self._close_tab)\n\n        self._close_mindspace_action = QAction(strings.close_mindspace, self)\n        self._close_mindspace_action.setShortcut(QKeySequence(\"Ctrl+Alt+W\"))\n        self._close_mindspace_action.triggered.connect(self._close_mindspace)\n\n        # Edit menu actions\n        self._submit_message_action = QAction(strings.submit_message, self)\n        self._submit_message_action.setShortcut(QKeySequence(\"Ctrl+J\"))\n        self._submit_message_action.triggered.connect(self._submit_message)\n\n        self._undo_action = QAction(strings.undo, self)\n        self._undo_action.setShortcut(QKeySequence(\"Ctrl+Z\"))\n        self._undo_action.triggered.connect(self._undo)\n\n        self._redo_action = QAction(strings.redo, self)\n        self._redo_action.setShortcut(QKeySequence(\"Ctrl+Shift+Z\"))\n        self._redo_action.triggered.connect(self._redo)\n\n        self._cut_action = QAction(strings.cut, self)\n        self._cut_action.setShortcut(QKeySequence(\"Ctrl+X\"))\n        self._cut_action.triggered.connect(self._cut)\n\n        self._copy_action = QAction(strings.copy, self)\n        self._copy_action.setShortcut(QKeySequence(\"Ctrl+C\"))\n        self._copy_action.triggered.connect(self._copy)\n\n        self._paste_action = QAction(strings.paste, self)\n        self._paste_action.setShortcut(QKeySequence(\"Ctrl+V\"))\n        self._paste_action.triggered.connect(self._paste)\n\n        self._find_action = QAction(strings.find, self)\n        self._find_action.setShortcut(QKeySequence.StandardKey.Find)\n        self._find_action.triggered.connect(self._find)\n\n        self._mindspace_settings_action = QAction(strings.mindspace_settings, self)\n        self._mindspace_settings_action.setShortcut(QKeySequence(\"Ctrl+Alt+,\"))\n        self._mindspace_settings_action.triggered.connect(self._show_mindspace_settings_dialog)\n\n        self._conv_settings_action = QAction(strings.conversation_settings, self)\n        self._conv_settings_action.setShortcut(QKeySequence(\"Ctrl+Shift+,\"))\n        self._conv_settings_action.triggered.connect(self._show_conversation_settings_dialog)\n\n        # View menu actions - Theme menu will be created in _on_language_changed\n        self._theme_menu: QMenu | None = None\n        self._theme_actions: Dict[ColorMode, QAction] = {}\n\n        self._zoom_in_action = QAction(strings.zoom_in, self)\n        self._zoom_in_action.setShortcut(QKeySequence(\"Ctrl+=\"))\n        self._zoom_in_action.triggered.connect(lambda: self._handle_zoom(1.0800597))\n\n        self._zoom_out_action = QAction(strings.zoom_out, self)\n        self._zoom_out_action.setShortcut(QKeySequence(\"Ctrl+-\"))\n        self._zoom_out_action.triggered.connect(lambda: self._handle_zoom(1/1.0800597))\n\n        self._reset_zoom_action = QAction(strings.reset_zoom, self)\n        self._reset_zoom_action.setShortcut(QKeySequence(\"Ctrl+0\"))\n        self._reset_zoom_action.triggered.connect(lambda: self._set_zoom(1.0))\n\n        self._show_system_log_action = QAction(strings.show_system_log, self)\n        self._show_system_log_action.setShortcut(QKeySequence(\"Ctrl+Shift+L\"))\n        self._show_system_log_action.triggered.connect(self._show_system_log)\n\n        self._show_system_shell_action = QAction(strings.show_system_shell, self)\n        self._show_system_shell_action.setShortcut(QKeySequence(\"Ctrl+Shift+Y\"))\n        self._show_system_shell_action.triggered.connect(self._show_system_shell)\n\n        self._show_all_columns_action = QAction(strings.show_all_columns, self)\n        self._show_all_columns_action.setShortcut(QKeySequence(\"Ctrl+\\\\\"))\n        self._show_all_columns_action.triggered.connect(self._show_all_columns)\n\n        self._split_column_left_action = QAction(strings.split_column_left, self)\n        self._split_column_left_action.setShortcut(QKeySequence(\"Ctrl+Shift+[\"))\n\n        self._split_column_right_action = QAction(strings.split_column_right, self)\n        self._split_column_right_action.setShortcut(QKeySequence(\"Ctrl+Shift+]\"))\n\n        self._merge_column_left_action = QAction(strings.merge_column_left, self)\n        self._merge_column_left_action.setShortcut(QKeySequence(\"Ctrl+[\"))\n\n        self._merge_column_right_action = QAction(strings.merge_column_right, self)\n        self._merge_column_right_action.setShortcut(QKeySequence(\"Ctrl+]\"))\n\n        self._swap_column_left_action = QAction(strings.swap_column_left, self)\n        self._swap_column_left_action.setShortcut(QKeySequence(\"Ctrl+Alt+[\"))\n\n        self._swap_column_right_action = QAction(strings.swap_column_right, self)\n        self._swap_column_right_action.setShortcut(QKeySequence(\"Ctrl+Alt+]\"))\n\n        self._next_message_action = QAction(strings.next_message, self)\n        self._next_message_action.setShortcut(QKeySequence(\"Alt+Down\"))\n        self._next_message_action.triggered.connect(self._navigate_next_message)\n\n        self._previous_message_action = QAction(strings.previous_message, self)\n        self._previous_message_action.setShortcut(QKeySequence(\"Alt+Up\"))\n        self._previous_message_action.triggered.connect(self._navigate_previous_message)\n\n        self._toggle_bookmark_action = QAction(strings.bookmark_section, self)\n        self._toggle_bookmark_action.setCheckable(True)\n        self._toggle_bookmark_action.setShortcut(QKeySequence(\"Ctrl+B\"))\n        self._toggle_bookmark_action.triggered.connect(self._toggle_bookmark)\n\n        self._next_bookmark_action = QAction(strings.next_bookmark, self)\n        self._next_bookmark_action.setShortcut(QKeySequence(\"Ctrl+Shift+N\"))\n        self._next_bookmark_action.triggered.connect(self._navigate_next_bookmark)\n\n        self._previous_bookmark_action = QAction(strings.previous_bookmark, self)\n        self._previous_bookmark_action.setShortcut(QKeySequence(\"Ctrl+Shift+P\"))\n        self._previous_bookmark_action.triggered.connect(self._navigate_previous_bookmark)\n\n        self._menu_bar = QMenuBar(self)\n        self.setMenuBar(self._menu_bar)\n\n        # Humbug menu\n        self._humbug_menu = self._menu_bar.addMenu(strings.humbug_menu)\n        self._humbug_menu.addAction(self._about_action)\n        self._humbug_menu.addSeparator()\n        self._humbug_menu.addAction(self._user_settings_action)\n        self._humbug_menu.addSeparator()\n        self._humbug_menu.addAction(self._quit_action)\n\n        # File menu\n        self._file_menu = self._menu_bar.addMenu(strings.file_menu)\n        self._file_menu.addAction(self._new_mindspace_action)\n        self._file_menu.addAction(self._new_conv_action)\n        self._file_menu.addAction(self._new_metaphor_conv_action)\n        self._file_menu.addAction(self._new_file_action)\n        self._file_menu.addAction(self._new_terminal_action)\n        self._file_menu.addSeparator()\n        self._file_menu.addAction(self._open_mindspace_action)\n        self._file_menu.addAction(self._open_wiki_action)\n        self._file_menu.addAction(self._open_conv_action)\n        self._file_menu.addAction(self._open_file_action)\n        self._file_menu.addSeparator()\n        self._file_menu.addAction(self._fork_conv_action)\n        self._file_menu.addSeparator()\n        self._file_menu.addAction(self._save_action)\n        self._file_menu.addAction(self._save_as_action)\n        self._file_menu.addSeparator()\n        self._file_menu.addAction(self._close_mindspace_action)\n        self._file_menu.addAction(self._close_tab_action)\n\n        # Edit menu\n        self._edit_menu = self._menu_bar.addMenu(strings.edit_menu)\n        self._edit_menu.addAction(self._submit_message_action)\n        self._edit_menu.addSeparator()\n        self._edit_menu.addAction(self._undo_action)\n        self._edit_menu.addAction(self._redo_action)\n        self._edit_menu.addSeparator()\n        self._edit_menu.addAction(self._cut_action)\n        self._edit_menu.addAction(self._copy_action)\n        self._edit_menu.addAction(self._paste_action)\n        self._edit_menu.addSeparator()\n        self._edit_menu.addAction(self._find_action)\n        self._edit_menu.addSeparator()\n        self._edit_menu.addAction(self._mindspace_settings_action)\n        self._edit_menu.addAction(self._conv_settings_action)\n\n        # View menu\n        self._view_menu = self._menu_bar.addMenu(strings.view_menu)\n\n        # Theme menu will be added when language changes\n        self._view_menu.addSeparator()\n        self._view_menu.addAction(self._zoom_in_action)\n        self._view_menu.addAction(self._zoom_out_action)\n        self._view_menu.addAction(self._reset_zoom_action)\n        self._view_menu.addSeparator()\n        self._view_menu.addAction(self._show_system_log_action)\n        self._view_menu.addAction(self._show_system_shell_action)\n        self._view_menu.addSeparator()\n        self._view_menu.addAction(self._show_all_columns_action)\n        self._view_menu.addAction(self._split_column_left_action)\n        self._view_menu.addAction(self._split_column_right_action)\n        self._view_menu.addAction(self._merge_column_left_action)\n        self._view_menu.addAction(self._merge_column_right_action)\n        self._view_menu.addAction(self._swap_column_left_action)\n        self._view_menu.addAction(self._swap_column_right_action)\n        self._view_menu.addSeparator()\n        self._view_menu.addAction(self._next_message_action)\n        self._view_menu.addAction(self._previous_message_action)\n        self._view_menu.addSeparator()\n        self._view_menu.addAction(self._toggle_bookmark_action)\n        self._view_menu.addAction(self._next_bookmark_action)\n        self._view_menu.addAction(self._previous_bookmark_action)\n\n        self.setWindowTitle(\"Humbug\")\n        self.setMinimumSize(1280, 800)\n\n        # Main widget and layout\n        main_widget = QWidget()\n        self.setCentralWidget(main_widget)\n        layout = QVBoxLayout(main_widget)\n        layout.setSpacing(0)\n        layout.setContentsMargins(0, 0, 0, 0)\n\n        # Create splitter\n        self._splitter = QSplitter(Qt.Orientation.Horizontal)\n        layout.addWidget(self._splitter)\n\n        # Create and add mindspace view\n        self._mindspace_view = MindspaceView(self)\n        self._mindspace_view.file_clicked.connect(self._on_mindspace_view_file_clicked)\n        self._mindspace_view.file_deleted.connect(self._on_mindspace_view_file_deleted)\n        self._mindspace_view.file_renamed.connect(self._on_mindspace_view_file_renamed)\n        self._mindspace_view.file_edited.connect(self._on_mindspace_view_file_edited)\n        self._mindspace_view.file_opened_in_wiki.connect(self._on_mindspace_view_file_opened_in_wiki)\n        self._splitter.addWidget(self._mindspace_view)\n\n        # Create tab manager in splitter\n        self._column_manager = ColumnManager(self)\n        self._column_manager.tab_changed.connect(self._on_column_manager_tab_changed)\n        self._column_manager.fork_requested.connect(self._on_column_manager_fork_requested)\n        self._column_manager.fork_from_index_requested.connect(self._on_column_manager_fork_from_index_requested)\n        self._column_manager.open_wiki_link_requested.connect(self._on_column_manager_open_wiki_link_requested)\n        self._column_manager.edit_file_requested.connect(self._on_column_manager_edit_file_requested)\n        self._splitter.addWidget(self._column_manager)\n\n        # Set initial mindspace view width\n        self._splitter.setSizes([300, self.width() - 300])\n\n        # Set the stretch factors: 0 for mindspace view (no stretch) and 1 for column manager (stretch to fill)\n        self._splitter.setStretchFactor(0, 0)\n        self._splitter.setStretchFactor(1, 1)\n\n        self._style_manager = StyleManager()\n        self._style_manager.style_changed.connect(self._on_style_changed)\n\n        # Create a timer that fires every 50ms to keep our menu states correct\n        self._menu_timer = QTimer()\n        self._menu_timer.setInterval(50)\n        self._menu_timer.timeout.connect(self._update_menu_state)\n        self._menu_timer.start()\n\n        # Create status bar\n        self._status_bar = QStatusBar()\n        self._status_message_label = QLabel()\n        self._status_bar.addPermanentWidget(self._status_message_label)\n\n        self.setStatusBar(self._status_bar)\n        self._column_manager.status_message.connect(self._on_column_manager_status_message)\n\n        # Connect to exception notifier for canary functionality\n        self._canary_active = False\n        exception_notifier = get_exception_notifier()\n        exception_notifier.exception_occurred.connect(self._on_exception_occurred)\n\n        self._on_language_changed()\n\n        self._user_manager = UserManager()\n        user_settings = self._user_manager.settings()\n        self._style_manager.set_user_font_size(user_settings.font_size)\n        self._language_manager.set_language(user_settings.language)\n\n        # Set theme from user settings\n        self._style_manager.set_color_mode(user_settings.theme)\n        self._update_theme_menu()\n\n        self._mindspace_manager = MindspaceManager()\n\n        # Initialize command registry and register commands\n        self._command_registry = ShellCommandRegistry()\n        self._command_registry.register_command(ShellCommandClear(self._column_manager))\n        self._command_registry.register_command(ShellCommandConversation(self._column_manager))\n        self._command_registry.register_command(ShellCommandEdit(self._column_manager))\n        self._command_registry.register_command(ShellCommandLog(self._column_manager))\n        self._command_registry.register_command(ShellCommandM6rc(self._column_manager))\n        self._command_registry.register_command(ShellCommandTerminal(self._column_manager))\n        self._command_registry.register_command(ShellCommandWiki(self._column_manager))\n\n        # Register help command last so it can see all other commands\n        self._command_registry.register_command(ShellCommandHelp(self._command_registry))\n\n        self._ai_tool_manager = AIToolManager()\n        self._ai_tool_manager.register_tool(\n            CalculatorAITool(), \"Calculator: performs arithmetic, trigonometry, logarithms, and other calculations\"\n        )\n        self._ai_tool_manager.register_tool(ClockAITool(), \"Clock: gets the current time and date\")\n        self._ai_tool_manager.register_tool(\n            DelegateAITool(self._column_manager), \"Delegate: delegates tasks to specialized AI instances\"\n        )\n        self._ai_tool_manager.register_tool(\n            FileSystemAITool(self._resolve_mindspace_path), \"FileSystem: handles file operations in the current mindspace\"\n        )\n        self._ai_tool_manager.register_tool(SystemAITool(self._column_manager), \"System: implements UI automations within Humbug\")\n\n        QTimer.singleShot(0, self._restore_last_mindspace)\n\n    def changeEvent(self, event: QEvent) -> None:\n        \"\"\"Handle change events.\"\"\"\n        # If our window state changes then update the column manager's style\n        if event.type() == QEvent.Type.WindowStateChange:\n            self._column_manager.apply_style()\n\n        return super().changeEvent(event)\n\n    def _on_exception_occurred(self) -> None:\n        \"\"\"Handle uncaught exception notification by activating canary.\"\"\"\n        self._logger.debug(\"Uncaught exception detected, activating canary\")\n        self._canary_active = True\n        self._on_style_changed()  # Refresh styles to apply canary background\n\n    def _update_menu_state(self) -> None:\n        \"\"\"Update enabled/disabled state of menu items.\"\"\"\n        # Update mindspace-specific actions\n        has_mindspace = self._mindspace_manager.has_mindspace()\n        self._close_mindspace_action.setEnabled(has_mindspace)\n        self._new_conv_action.setEnabled(has_mindspace)\n        self._new_metaphor_conv_action.setEnabled(has_mindspace)\n        self._new_file_action.setEnabled(has_mindspace)\n        self._open_wiki_action.setEnabled(has_mindspace)\n        self._open_conv_action.setEnabled(has_mindspace)\n        self._open_file_action.setEnabled(has_mindspace)\n        self._new_terminal_action.setEnabled(has_mindspace)\n        self._mindspace_settings_action.setEnabled(has_mindspace)\n\n        # Update tab-specific actions\n        column_manager = self._column_manager\n        self._fork_conv_action.setEnabled(column_manager.can_fork_conversation())\n        self._save_action.setEnabled(column_manager.can_save_file())\n        self._save_as_action.setEnabled(column_manager.can_save_file_as())\n        self._close_tab_action.setEnabled(column_manager.can_close_tab())\n        self._undo_action.setEnabled(column_manager.can_undo())\n        self._redo_action.setEnabled(column_manager.can_redo())\n        self._cut_action.setEnabled(column_manager.can_cut())\n        self._copy_action.setEnabled(column_manager.can_copy())\n        self._paste_action.setEnabled(column_manager.can_paste())\n        self._find_action.setEnabled(column_manager.can_show_find())\n        self._submit_message_action.setEnabled(column_manager.can_submit_message())\n        self._conv_settings_action.setEnabled(column_manager.can_show_conversation_settings_dialog())\n\n        # Update view actions\n        current_zoom = self._style_manager.zoom_factor()\n        left_to_right = self._language_manager.left_to_right()\n        self._zoom_in_action.setEnabled(current_zoom < 2.0)\n        self._zoom_out_action.setEnabled(current_zoom > 0.5)\n        self._show_system_log_action.setEnabled(has_mindspace)\n        self._show_system_shell_action.setEnabled(has_mindspace)\n        self._show_all_columns_action.setEnabled(column_manager.can_show_all_columns())\n        self._split_column_left_action.setEnabled(column_manager.can_split_column())\n        self._split_column_right_action.setEnabled(column_manager.can_split_column())\n        self._merge_column_left_action.setEnabled(column_manager.can_merge_column(left_to_right))\n        self._merge_column_right_action.setEnabled(column_manager.can_merge_column(not left_to_right))\n        self._swap_column_left_action.setEnabled(column_manager.can_swap_column(left_to_right))\n        self._swap_column_right_action.setEnabled(column_manager.can_swap_column(not left_to_right))\n        self._next_message_action.setEnabled(column_manager.can_navigate_next_message())\n        self._previous_message_action.setEnabled(column_manager.can_navigate_previous_message())\n        self._toggle_bookmark_action.setEnabled(column_manager.can_toggle_bookmark())\n        self._next_bookmark_action.setEnabled(column_manager.can_navigate_next_bookmark())\n        self._previous_bookmark_action.setEnabled(column_manager.can_navigate_previous_bookmark())\n\n    def _on_language_changed(self) -> None:\n        \"\"\"Update UI text when language changes.\"\"\"\n        app = cast(QApplication, QApplication.instance())\n        left_to_right = self._language_manager.left_to_right()\n        if left_to_right:\n            app.setLayoutDirection(Qt.LayoutDirection.LeftToRight)\n\n        else:\n            app.setLayoutDirection(Qt.LayoutDirection.RightToLeft)\n\n        strings = self._language_manager.strings()\n\n        # Update menu titles\n        self._humbug_menu.setTitle(strings.humbug_menu)\n        self._edit_menu.setTitle(strings.edit_menu)\n        self._file_menu.setTitle(strings.file_menu)\n        self._view_menu.setTitle(strings.view_menu)\n\n        # Update action texts\n        self._about_action.setText(strings.about_humbug)\n        self._user_settings_action.setText(strings.user_settings)\n        self._quit_action.setText(strings.quit_humbug)\n        self._new_mindspace_action.setText(strings.new_mindspace)\n        self._new_conv_action.setText(strings.new_conversation)\n        self._new_metaphor_conv_action.setText(strings.new_metaphor_conversation)\n        self._new_file_action.setText(strings.new_file)\n        self._open_mindspace_action.setText(strings.open_mindspace)\n        self._open_wiki_action.setText(strings.open_wiki)\n        self._open_conv_action.setText(strings.open_conversation)\n        self._open_file_action.setText(strings.open_file)\n        self._fork_conv_action.setText(strings.fork_conversation)\n        self._save_action.setText(strings.save)\n        self._save_as_action.setText(strings.save_as)\n        self._close_tab_action.setText(strings.close_tab)\n        self._close_mindspace_action.setText(strings.close_mindspace)\n        self._submit_message_action.setText(strings.submit_message)\n        self._undo_action.setText(strings.undo)\n        self._redo_action.setText(strings.redo)\n        self._cut_action.setText(strings.cut)\n        self._copy_action.setText(strings.copy)\n        self._paste_action.setText(strings.paste)\n        self._find_action.setText(strings.find)\n        self._mindspace_settings_action.setText(strings.mindspace_settings)\n        self._conv_settings_action.setText(strings.conversation_settings)\n\n        # Recreate the theme menu with updated language strings\n        if self._theme_menu is not None:\n            self._view_menu.removeAction(self._theme_menu.menuAction())\n\n        self._theme_menu = self._create_theme_menu()\n        self._view_menu.insertMenu(self._zoom_in_action, self._theme_menu)\n\n        self._zoom_in_action.setText(strings.zoom_in)\n        self._zoom_out_action.setText(strings.zoom_out)\n        self._reset_zoom_action.setText(strings.reset_zoom)\n        self._show_system_shell_action.setText(strings.show_system_shell)\n        self._show_all_columns_action.setText(strings.show_all_columns)\n        self._split_column_left_action.setText(strings.split_column_left)\n        self._split_column_right_action.setText(strings.split_column_right)\n        self._merge_column_left_action.setText(strings.merge_column_left)\n        self._merge_column_right_action.setText(strings.merge_column_right)\n        self._swap_column_left_action.setText(strings.swap_column_left)\n        self._swap_column_right_action.setText(strings.swap_column_right)\n        self._next_message_action.setText(strings.next_message)\n        self._previous_message_action.setText(strings.previous_message)\n        self._toggle_bookmark_action.setText(strings.bookmark_section)\n        self._next_bookmark_action.setText(strings.next_bookmark)\n        self._previous_bookmark_action.setText(strings.previous_bookmark)\n\n        # Our logic for left and right reverses for right-to-left languages\n        left_to_right = self._language_manager.left_to_right()\n        self._split_column_left_action.triggered.disconnect()\n        self._split_column_left_action.triggered.connect(lambda: self._split_column(left_to_right))\n        self._split_column_right_action.triggered.disconnect()\n        self._split_column_right_action.triggered.connect(lambda: self._split_column(not left_to_right))\n        self._merge_column_left_action.triggered.disconnect()\n        self._merge_column_left_action.triggered.connect(lambda: self._merge_column(left_to_right))\n        self._merge_column_right_action.triggered.disconnect()\n        self._merge_column_right_action.triggered.connect(lambda: self._merge_column(not left_to_right))\n        self._swap_column_left_action.triggered.disconnect()\n        self._swap_column_left_action.triggered.connect(lambda: self._swap_column(left_to_right))\n        self._swap_column_right_action.triggered.disconnect()\n        self._swap_column_right_action.triggered.connect(lambda: self._swap_column(not left_to_right))\n\n        self._on_style_changed()\n\n    def _create_theme_menu(self) -> QMenu:\n        \"\"\"\n        Create a display theme submenu with available themes.\n\n        Returns:\n            QMenu: The theme submenu\n        \"\"\"\n        strings = self._language_manager.strings()\n\n        # Create the theme menu\n        theme_menu = QMenu(strings.display_theme, self)\n\n        # Create an action group so only one theme can be selected at a time\n        theme_action_group = QActionGroup(self)\n        theme_action_group.setExclusive(True)\n\n        # Create the theme actions dictionary to store references\n        self._theme_actions = {}\n\n        # Add Light theme action\n        light_action = QAction(strings.theme_light, self)\n        light_action.setCheckable(True)\n        light_action.setChecked(self._style_manager.color_mode() == ColorMode.LIGHT)\n        light_action.triggered.connect(lambda: self._set_color_mode(ColorMode.LIGHT))\n        theme_action_group.addAction(light_action)\n        theme_menu.addAction(light_action)\n        self._theme_actions[ColorMode.LIGHT] = light_action\n\n        # Add Dark theme action\n        dark_action = QAction(strings.theme_dark, self)\n        dark_action.setCheckable(True)\n        dark_action.setChecked(self._style_manager.color_mode() == ColorMode.DARK)\n        dark_action.triggered.connect(lambda: self._set_color_mode(ColorMode.DARK))\n        theme_action_group.addAction(dark_action)\n        theme_menu.addAction(dark_action)\n        self._theme_actions[ColorMode.DARK] = dark_action\n\n        return theme_menu\n\n    def _update_theme_menu(self) -> None:\n        \"\"\"Update the theme menu to reflect the current selected theme.\"\"\"\n        # Set the checked state for the appropriate theme action\n        for theme, action in self._theme_actions.items():\n            action.setChecked(theme == self._style_manager.color_mode())\n\n    def _set_color_mode(self, theme: ColorMode) -> None:\n        \"\"\"\n        Set the color mode (theme) for the application.\n\n        Args:\n            theme: The new theme to apply\n        \"\"\"\n        self._style_manager.set_color_mode(theme)\n\n    def _map_tab_to_mindspace_view(self, tab: TabBase) -> MindspaceViewType:\n        \"\"\"Map a tab to its corresponding mindspace view type.\"\"\"\n        if isinstance(tab, ConversationTab):\n            return MindspaceViewType.CONVERSATIONS\n\n        if isinstance(tab, WikiTab):\n            return MindspaceViewType.WIKI\n\n        return MindspaceViewType.FILES\n\n    def _on_column_manager_tab_changed(self) -> None:\n        \"\"\"Handle tab change events.\"\"\"\n        current_tab = self._column_manager.get_current_tab()\n        if current_tab is None:\n            return\n\n        path = current_tab.path()\n        if path is None:\n            return\n\n        view_type = self._map_tab_to_mindspace_view(current_tab)\n        self._mindspace_view.reveal_and_select_file(view_type, path)\n\n    def _on_column_manager_status_message(self, message: StatusMessage) -> None:\n        \"\"\"Update status bar with new message.\"\"\"\n        self._status_message_label.setText(message.text)\n        if message.timeout:\n            QTimer.singleShot(message.timeout, self._status_message_label.clear)\n\n    def _restore_last_mindspace(self) -> None:\n        \"\"\"Restore last mindspace on startup if available.\"\"\"\n        try:\n            with open(os.path.expanduser(\"~/.humbug/mindspace.json\"), encoding='utf-8') as f:\n                data = json.load(f)\n                mindspace_path = data.get(\"lastMindspace\")\n                if mindspace_path and os.path.exists(mindspace_path):\n                    try:\n                        self._mindspace_manager.open_mindspace(mindspace_path)\n                        self._mindspace_view.set_mindspace(mindspace_path)\n                        self._restore_mindspace_state()\n\n                    except MindspaceError as e:\n                        self._logger.error(\"Failed to restore mindspace: %s\", str(e))\n                        # Don't show error dialog on startup, just log it\n\n        except (FileNotFoundError, json.JSONDecodeError):\n            pass\n\n    def _new_mindspace(self) -> None:\n        \"\"\"Show folder selection dialog and create new mindspace.\"\"\"\n        self._menu_timer.stop()\n        strings = self._language_manager.strings()\n        dir_path = QFileDialog.getExistingDirectory(\n            self, strings.file_dialog_new_mindspace\n        )\n        self._menu_timer.start()\n        if not dir_path:\n            return\n\n        if self._mindspace_manager.is_already_mindspace(dir_path):\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.mindspace_exists_error\n            )\n            return\n\n        # Show folder configuration dialog\n        dialog = MindspaceFoldersDialog(dir_path, self)\n        if dialog.exec() != QDialog.DialogCode.Accepted:\n            return\n\n        try:\n            # Create mindspace with selected folders\n            self._mindspace_manager.create_mindspace(dir_path, dialog.get_selected_folders())\n\n        except MindspaceExistsError:\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.mindspace_exists_error\n            )\n            return\n\n        except MindspaceError as e:\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.error_creating_mindspace.format(str(e))\n            )\n            return\n\n        self._open_mindspace_path(dir_path)\n\n    def _open_mindspace(self) -> None:\n        \"\"\"Open a new mindspace.\"\"\"\n        self._menu_timer.stop()\n        strings = self._language_manager.strings()\n        dir_path = QFileDialog.getExistingDirectory(self, strings.file_dialog_open_mindspace)\n        self._menu_timer.start()\n        if not dir_path:\n            return\n\n        self._open_mindspace_path(dir_path)\n\n    def _open_mindspace_path(self, path: str) -> None:\n        # Before we do anything, check if the new location is a mindspace\n        if not self._mindspace_manager.check_mindspace(path):\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.error_opening_mindspace.format(path)\n            )\n            return\n\n        # If we're switching mindspaces, save the current one first\n        if self._mindspace_manager.has_mindspace():\n            self._save_mindspace_state()\n            if not self._close_all_tabs():\n                return\n\n            self._mindspace_manager.close_mindspace()\n\n        # Open the new mindspace\n        try:\n            self._mindspace_manager.open_mindspace(path)\n            self._mindspace_view.set_mindspace(path)\n\n        except MindspaceError as e:\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.error_opening_mindspace.format(str(e))\n            )\n            return\n\n        # Restore the state of the newly opened mindspace\n        self._restore_mindspace_state()\n\n    def _close_mindspace(self) -> None:\n        if not self._mindspace_manager.has_mindspace():\n            self._logger.error(\"No mindspace active, cannot close\")\n            return\n\n        self._save_mindspace_state()\n        if not self._close_all_tabs():\n            return\n\n        self._mindspace_view.set_mindspace(\"\")\n        self._mindspace_manager.close_mindspace()\n\n    def _save_mindspace_state(self) -> None:\n        \"\"\"Save current mindspace state.\"\"\"\n        if not self._mindspace_manager.has_mindspace():\n            self._logger.error(\"No mindspace active, cannot save\")\n            return\n\n        try:\n            mindspace_state = self._column_manager.save_state()\n            self._mindspace_manager.save_mindspace_state(mindspace_state)\n\n        except MindspaceError as e:\n            self._logger.error(\"Failed to save mindspace state: %s\", str(e))\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.error_saving_mindspace.format(str(e))\n            )\n\n    def _restore_mindspace_state(self) -> None:\n        \"\"\"Restore previously open tabs from mindspace state.\"\"\"\n        saved_state = self._mindspace_manager.load_mindspace_state()\n        if not saved_state:\n            self._logger.debug(\"No saved states found\")\n            return\n\n        try:\n            self._column_manager.restore_state(saved_state)\n\n        except MindspaceError as e:\n            self._logger.error(\"Failed to restore mindspace state: %s\", str(e))\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.error_restoring_mindspace.format(str(e))\n            )\n\n    def _close_all_tabs(self) -> bool:\n        return self._column_manager.close_all_tabs()\n\n    def _undo(self) -> None:\n        self._column_manager.undo()\n\n    def _redo(self) -> None:\n        self._column_manager.redo()\n\n    def _cut(self) -> None:\n        self._column_manager.cut()\n\n    def _copy(self) -> None:\n        self._column_manager.copy()\n\n    def _paste(self) -> None:\n        self._column_manager.paste()\n\n    def _find(self) -> None:\n        self._column_manager.show_find()\n\n    def _show_about_dialog(self) -> None:\n        \"\"\"Show the About dialog.\"\"\"\n        dialog = AboutDialog(self)\n        dialog.exec()\n\n    def _new_terminal(self) -> None:\n        \"\"\"Create a new terminal tab.\"\"\"\n        if not self._mindspace_manager.has_mindspace():\n            return\n\n        self._column_manager.new_terminal()\n\n    def _new_file(self) -> None:\n        \"\"\"Create a new empty editor tab.\"\"\"\n        if not self._mindspace_manager.has_mindspace():\n            return\n\n        self._column_manager.new_file()\n\n    def _on_mindspace_view_file_opened_in_wiki(self, path: str, ephemeral: bool) -> None:\n        \"\"\"Handle click of a wiki link from the mindspace view.\"\"\"\n        wiki_tab = self._column_manager.open_wiki_page(path, ephemeral)\n        if wiki_tab is None:\n            return\n\n        self._mindspace_manager.add_interaction(\n            MindspaceLogLevel.INFO,\n            f\"User opened wiki: '{path}'\\ntab ID: {wiki_tab.tab_id()}\"\n        )\n\n    def _on_mindspace_view_file_clicked(self, source: MindspaceViewType, path: str, ephemeral: bool) -> None:\n        \"\"\"Handle click of a file from the mindspace view.\"\"\"\n        self._column_manager.open_file_by_mindspace_view_type(source, path, ephemeral)\n\n    def _on_mindspace_view_file_deleted(self, path: str) -> None:\n        \"\"\"Handle deletion of a file by closing any open tab.\n\n        Args:\n            path: Path of file being deleted\n        \"\"\"\n        self._column_manager.close_deleted_file(path)\n\n    def _on_mindspace_view_file_renamed(self, old_path: str, new_path: str) -> None:\n        \"\"\"Handle renaming of files.\n\n        Args:\n            old_path: Original path of renamed file\n            new_path: New path after renaming\n        \"\"\"\n        self._column_manager.handle_file_rename(old_path, new_path)\n\n    def _on_mindspace_view_file_edited(self, path: str, ephemeral: bool) -> None:\n        \"\"\"Handle file edited event from the mindspace view.\"\"\"\n        self._open_file_path(path, ephemeral)\n\n    def _open_file(self) -> None:\n        \"\"\"Show open file dialog and create editor tab.\"\"\"\n        self._menu_timer.stop()\n        strings = self._language_manager.strings()\n        file_path, _ = QFileDialog.getOpenFileName(\n            self,\n            strings.file_dialog_open_file,\n            self._mindspace_manager.file_dialog_directory()\n        )\n        self._menu_timer.start()\n\n        if not file_path:\n            return\n\n        self._mindspace_manager.update_file_dialog_directory(file_path)\n        self._open_file_path(file_path, False)\n\n    def _open_file_path(self, path: str, ephemeral: bool) -> None:\n        \"\"\"Open file in editor tab.\"\"\"\n        try:\n            editor_tab = self._column_manager.open_file(path, ephemeral)\n\n            self._mindspace_manager.add_interaction(\n                MindspaceLogLevel.INFO,\n                f\"User opened editor for file: '{path}'\\nTab ID: {editor_tab.tab_id()}\"\n            )\n\n        except OSError as e:\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.error_opening_file_title,\n                strings.could_not_open.format(path, str(e))\n            )\n\n    def _save_file(self) -> None:\n        \"\"\"Save the current file.\"\"\"\n        path = self._column_manager.save_file()\n        self._mindspace_view.reveal_and_select_file(MindspaceViewType.FILES, path)\n\n    def _save_file_as(self) -> None:\n        \"\"\"Save the current file with a new name.\"\"\"\n        path = self._column_manager.save_file_as()\n        self._mindspace_view.reveal_and_select_file(MindspaceViewType.FILES, path)\n\n    def _open_wiki(self) -> None:\n        \"\"\"Open the wiki page in a new tab.\"\"\"\n        self._column_manager.open_wiki_page(self._mindspace_manager.get_absolute_path(\".\"), False)\n\n    def _show_system_log(self) -> None:\n        \"\"\"Show the log tab.\"\"\"\n        self._column_manager.show_system_log()\n\n    def _show_system_shell(self) -> None:\n        \"\"\"Show the shell tab.\"\"\"\n        self._column_manager.show_system_shell()\n\n    def _show_all_columns(self) -> None:\n        \"\"\"Show all columns equally.\"\"\"\n        self._column_manager.show_all_columns()\n\n    def _split_column(self, split_left: bool) -> None:\n        \"\"\"Split the current column.\"\"\"\n        self._column_manager.split_column(split_left)\n\n    def _merge_column(self, merge_left: bool) -> None:\n        \"\"\"Merge the current column.\"\"\"\n        self._column_manager.merge_column(merge_left)\n\n    def _swap_column(self, swap_left: bool) -> None:\n        \"\"\"Swap the current column.\"\"\"\n        self._column_manager.swap_column(swap_left)\n\n    def _on_style_changed(self) -> None:\n        style_manager = self._style_manager\n        zoom_factor = style_manager.zoom_factor()\n        base_font_size = style_manager.base_font_size()\n\n        # Determine status bar background color based on canary state\n        status_bg_color = (\n            style_manager.get_color_str(ColorRole.CANARY_BACKGROUND)\n            if self._canary_active\n            else style_manager.get_color_str(ColorRole.STATUS_BAR_BACKGROUND)\n        )\n\n        self.setStyleSheet(f\"\"\"\n            QMainWindow {{\n                background-color: {style_manager.get_color_str(ColorRole.BACKGROUND_PRIMARY)};\n                color: {style_manager.get_color_str(ColorRole.TEXT_PRIMARY)};\n            }}\n\n            QMenuBar {{\n                background-color: {style_manager.get_color_str(ColorRole.MENU_BACKGROUND)};\n                padding: 4px;\n                font-size: {base_font_size}pt;\n            }}\n            QMenuBar::item {{\n                background-color: transparent;\n                color: {style_manager.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border-radius: 4px;\n                padding: 4px 8px 4px 8px;\n            }}\n            QMenuBar::item:selected {{\n                background-color: {style_manager.get_color_str(ColorRole.MENU_HOVER)};\n            }}\n\n            QMenu {{\n                background-color: {style_manager.get_color_str(ColorRole.MENU_BACKGROUND)};\n                color: {style_manager.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border-color: {style_manager.get_color_str(ColorRole.MENU_BORDER)};\n                border-width: 1px;\n                border-style: solid;\n                border-radius: 8px;\n                margin: 0px;\n            }}\n            QMenu::item {{\n                margin: 2px;\n                padding: 4px 8px 4px 8px;\n                border-radius: 4px;\n            }}\n            QMenu::item:disabled {{\n                color: {style_manager.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n            QMenu::item:selected {{\n                background-color: {style_manager.get_color_str(ColorRole.MENU_HOVER)}\n            }}\n\n            QStatusBar {{\n                background-color: {status_bg_color};\n                color: {self._style_manager.get_color_str(ColorRole.TEXT_PRIMARY)};\n                padding: {2 * zoom_factor}px;\n                border-top: 1px solid {self._style_manager.get_color_str(ColorRole.SPLITTER)};\n            }}\n            QStatusBar::item {{\n                border: 0;\n                padding: 0;\n            }}\n\n            QStatusBar QLabel {{\n                color: {self._style_manager.get_color_str(ColorRole.TEXT_PRIMARY)};\n                padding: 0;\n            }}\n\n            QSplitter::handle {{\n                background-color: {style_manager.get_color_str(ColorRole.SPLITTER)};\n                margin: 0;\n                width: 1px;\n            }}\n        \"\"\")\n\n        # Update status bar font\n        status_font = self.font()\n        status_font.setPointSizeF(base_font_size * zoom_factor)\n        self._status_bar.setFont(status_font)\n        self._status_message_label.setFont(status_font)\n\n        # Apply styles to the mindspace view and column manager\n        self._mindspace_view.apply_style()\n        self._column_manager.apply_style()\n\n    def _new_conversation(self) -> ConversationTab | None:\n        \"\"\"Create new conversation tab.\"\"\"\n        if not self._mindspace_manager.has_mindspace():\n            return None\n\n        try:\n            self._mindspace_manager.ensure_mindspace_dir(\"conversations\")\n            conversation_tab = self._column_manager.new_conversation()\n\n        except MindspaceError as e:\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.error_opening_conversation.format(str(e))\n            )\n            self._mindspace_manager.add_interaction(\n                MindspaceLogLevel.ERROR,\n                f\"User failed to create new conversation: {str(e)}\"\n            )\n            return None\n\n        self._mindspace_manager.add_interaction(\n            MindspaceLogLevel.INFO,\n            f\"User created new conversation\\ntab ID: {conversation_tab.tab_id()}\"\n        )\n        return conversation_tab\n\n    def _get_canonical_mindspace_path(self, path: str) -> str | None:\n        \"\"\"Get the canonical path of the current mindspace.\"\"\"\n        if not self._mindspace_manager.has_mindspace():\n            return None\n\n        # Get the absolute path of the current mindspace\n        return self._mindspace_manager.get_relative_path(path)\n\n    def _resolve_mindspace_path(self, path: str) -> Tuple[Path, str]:\n        # Check if our path starts with a separator.  If it does we'll assume it's for the root of the mindspace.\n        if path.startswith(os.sep):\n            path = path[1:]\n\n        # Convert to absolute path via mindspace manager\n        abs_path = self._mindspace_manager.get_absolute_path(path)\n        resolved_path = Path(abs_path).resolve()\n\n        # Verify the resolved path is still within mindspace\n        relative_path = self._mindspace_manager.get_mindspace_relative_path(str(resolved_path))\n        if relative_path is None:\n            raise ValueError(f\"Path is outside mindspace boundaries: {path}\")\n\n        return resolved_path, relative_path\n\n    def _new_metaphor_conversation(self) -> None:\n        \"\"\"Create new conversation from Metaphor file.\"\"\"\n        # Show file dialog\n        self._menu_timer.stop()\n        strings = self._language_manager.strings()\n        file_path, _ = QFileDialog.getOpenFileName(\n            self,\n            strings.file_dialog_open_metaphor,\n            self._mindspace_manager.file_dialog_directory(),\n            f\"{strings.file_filter_metaphor};;{strings.file_filter_all}\"\n        )\n        self._menu_timer.start()\n\n        if not file_path:\n            return\n\n        self._mindspace_manager.update_file_dialog_directory(file_path)\n        search_path = self._mindspace_manager.mindspace_path()\n\n        metaphor_ast_builder = MetaphorASTBuilder(self._get_canonical_mindspace_path)\n        try:\n            syntax_tree = MetaphorASTRootNode()\n            metaphor_ast_builder.build_ast_from_file(syntax_tree, file_path, [search_path], search_path, [file_path])\n            formatter = MetaphorFormatVisitor()\n            prompt = format_preamble() + formatter.format(syntax_tree)\n\n        except MetaphorASTBuilderError as e:\n            self._column_manager.show_system_shell()\n            error = f\"Metaphor compiler error prevented new Metaphor conversation:\\n\\n{format_errors(e.errors)}\"\n            self._mindspace_manager.add_interaction(MindspaceLogLevel.WARN, error)\n            self._column_manager.show_system_log()\n            return\n\n        conversation_tab = self._new_conversation()\n        if conversation_tab is None:\n            return\n\n        # Set input text\n        conversation_tab.set_input_text(prompt)\n\n    def _open_conversation(self) -> None:\n        \"\"\"Show open conversation dialog and create conversation tab.\"\"\"\n        self._menu_timer.stop()\n        strings = self._language_manager.strings()\n        file_path, _ = QFileDialog.getOpenFileName(\n            self,\n            strings.file_dialog_open_conversation,\n            self._mindspace_manager.conversations_directory(),\n            f\"{strings.file_filter_conversation};;{strings.file_filter_all}\"\n        )\n        self._menu_timer.start()\n\n        if not file_path:\n            return\n\n        self._mindspace_manager.update_conversations_directory(file_path)\n        self._open_conversation_path(file_path, False)\n\n    def _open_conversation_path(self, path: str, ephemeral: bool) -> ConversationTab | None:\n        \"\"\"Open an existing conversation file.\"\"\"\n        try:\n            tab = self._column_manager.open_conversation(path, ephemeral)\n            return tab\n\n        except ConversationError as e:\n            self._logger.error(\"Error opening conversation: %s: %s\", path, str(e))\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.conversation_error_title,\n                strings.error_opening_conversation.format(path, str(e))\n            )\n            return None\n\n    def _fork_conversation(self) -> None:\n        \"\"\"Create a new conversation tab with the history of the current conversation.\"\"\"\n        # Create task to fork conversation\n        try:\n            self._column_manager.fork_conversation_from_index(None)\n\n        except ConversationError as e:\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.conversation_error_title,\n                strings.error_forking_conversation.format(str(e))\n            )\n\n    def _on_column_manager_fork_requested(self) -> None:\n        \"\"\"Handle fork conversation requests.\"\"\"\n        self._fork_conversation()\n\n    def _on_column_manager_fork_from_index_requested(self, index: int) -> None:\n        \"\"\"Handle fork conversation requests from a specific index.\"\"\"\n        try:\n            self._column_manager.fork_conversation_from_index(index)\n\n        except ConversationError as e:\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.conversation_error_title,\n                strings.error_forking_conversation.format(str(e))\n            )\n\n    def _on_column_manager_open_wiki_link_requested(self, path: str) -> None:\n        \"\"\"Handle requests to open a wiki page.\"\"\"\n        try:\n            self._column_manager.open_wiki_page(path, True)\n\n        except WikiError as e:\n            self._logger.info(\"Error opening wiki page: %s: %s\", path, str(e))\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.wiki_error_title,\n                strings.could_not_open.format(path, str(e))\n            )\n\n    def _on_column_manager_edit_file_requested(self, path: str) -> None:\n        \"\"\"Handle requests to open a file in the editor.\"\"\"\n        self._open_file_path(path, False)\n\n    def _close_tab(self) -> None:\n        \"\"\"Close the current tab.\"\"\"\n        tab = self._column_manager.get_current_tab()\n        if tab is None:\n            self._logger.error(\"No current tab to close\")\n            return\n\n        self._column_manager.close_tab()\n        self._mindspace_manager.add_interaction(\n            MindspaceLogLevel.INFO,\n            f\"User closed tab\\nTab ID: {tab.tab_id()}\"\n        )\n\n    def _submit_message(self) -> None:\n        \"\"\"Handle message submission.\"\"\"\n        self._column_manager.submit_message()\n\n    def _navigate_next_message(self) -> None:\n        \"\"\"Navigate to the next message in conversation.\"\"\"\n        self._column_manager.navigate_next_message()\n\n    def _navigate_previous_message(self) -> None:\n        \"\"\"Navigate to the previous message in conversation.\"\"\"\n        self._column_manager.navigate_previous_message()\n\n    def _toggle_bookmark(self) -> None:\n        \"\"\"Handle toggling a bookmark.\"\"\"\n        self._column_manager.toggle_bookmark()\n\n    def _navigate_next_bookmark(self) -> None:\n        \"\"\"Move to the next bookmark.\"\"\"\n        self._column_manager.navigate_next_bookmark()\n\n    def _navigate_previous_bookmark(self) -> None:\n        \"\"\"Move to the previous bookmark.\"\"\"\n        self._column_manager.navigate_previous_bookmark()\n\n    def _show_user_settings_dialog(self) -> None:\n        \"\"\"Show the user settings dialog.\"\"\"\n        dialog = UserSettingsDialog(self)\n        dialog.set_settings(self._user_manager.settings())\n\n        def _on_settings_changed(new_settings: UserSettings) -> None:\n            try:\n                self._user_manager.update_settings(new_settings)\n                self._style_manager.set_user_font_size(new_settings.font_size)\n                self._language_manager.set_language(new_settings.language)\n\n                # Update theme from settings if it changed\n                new_theme = new_settings.theme\n                if new_theme != self._style_manager.color_mode():\n                    self._style_manager.set_color_mode(new_theme)\n                    self._update_theme_menu()\n\n                self._logger.info(\"User settings saved successfully\")\n\n            except UserError as e:\n                self._logger.error(\"Failed to save user settings: %s\", str(e))\n                strings = self._language_manager.strings()\n                MessageBox.show_message(\n                    self,\n                    MessageBoxType.CRITICAL,\n                    strings.settings_error_title,\n                    strings.error_saving_user_settings.format(str(e))\n                )\n\n        dialog.settings_changed.connect(_on_settings_changed)\n        dialog.exec()\n\n    def _show_mindspace_settings_dialog(self) -> None:\n        \"\"\"Show the mindspace settings dialog.\"\"\"\n        if not self._mindspace_manager.has_mindspace():\n            return\n\n        settings = cast(MindspaceSettings, self._mindspace_manager.settings())\n        dialog = MindspaceSettingsDialog(self)\n        dialog.set_settings(settings)\n\n        def _on_settings_changed(new_settings: MindspaceSettings) -> None:\n            try:\n                self._mindspace_manager.update_settings(new_settings)\n\n            except OSError as e:\n                self._logger.error(\"Failed to save mindspace settings: %s\", str(e))\n                strings = self._language_manager.strings()\n                MessageBox.show_message(\n                    self,\n                    MessageBoxType.CRITICAL,\n                    strings.settings_error_title,\n                    strings.error_saving_mindspace_settings.format(str(e))\n                )\n\n        dialog.settings_changed.connect(_on_settings_changed)\n        dialog.exec()\n\n    def _show_conversation_settings_dialog(self) -> None:\n        \"\"\"Show the conversation settings dialog.\"\"\"\n        self._column_manager.show_conversation_settings_dialog()\n\n    def keyPressEvent(self, event: QKeyEvent) -> None:\n        \"\"\"Handle global key events.\"\"\"\n        if event.key() == Qt.Key.Key_Escape:\n            if self._column_manager.handle_esc_key():\n                return\n\n        super().keyPressEvent(event)\n\n    def _handle_zoom(self, factor: float) -> None:\n        \"\"\"Handle zoom in/out requests.\"\"\"\n        new_zoom = self._style_manager.zoom_factor() * factor\n        self._set_zoom(new_zoom)\n\n    def _set_zoom(self, zoom_level: float) -> None:\n        \"\"\"Set zoom level for the application.\"\"\"\n        self._style_manager.set_zoom(zoom_level)\n\n    def closeEvent(self, event: QEvent) -> None:\n        \"\"\"Handle application close request.\"\"\"\n        self._save_mindspace_state()\n        if not self._close_all_tabs():\n            event.ignore()\n            return\n\n        event.accept()"
          }
        }
      ]
    },
    {
      "id": "a8719b1a-c37a-416a-8e3c-36c6d27e38a3",
      "timestamp": "2025-08-29T20:21:53.170509+00:00",
      "type": "tool_call",
      "content": "```json\n{\n    \"id\": \"toolu_016RQWfX9P8iTgZZp6iQNEHs\",\n    \"name\": \"filesystem\",\n    \"arguments\": {\n        \"operation\": \"write_file\",\n        \"path\": \"src/humbug/main_window.py\",\n        \"content\": \"\\\"\\\"\\\"Main window implementation for Humbug application.\\\"\\\"\\\"\\n\\nimport json\\nimport logging\\nimport os\\nfrom pathlib import Path\\nfrom typing import cast, Dict, Tuple\\n\\nfrom PySide6.QtWidgets import (\\n    QMainWindow, QWidget, QVBoxLayout, QMenuBar, QFileDialog,\\n    QSplitter, QLabel, QApplication, QDialog, QMenu, QStatusBar\\n)\\nfrom PySide6.QtCore import Qt, QTimer, QEvent\\nfrom PySide6.QtGui import QKeyEvent, QAction, QKeySequence, QActionGroup\\n\\nfrom metaphor import (\\n    MetaphorASTBuilder, MetaphorASTBuilderError, MetaphorFormatVisitor, MetaphorASTRootNode,\\n    format_errors, format_preamble\\n)\\n\\nfrom ai_tool import AIToolManager\\nfrom ai_tool.tools.calculator_ai_tool import CalculatorAITool\\nfrom ai_tool.tools.clock_ai_tool import ClockAITool\\nfrom ai_tool.tools.filesystem_ai_tool import FileSystemAITool\\n\\nfrom humbug.about_dialog import AboutDialog\\nfrom humbug.color_role import ColorRole\\nfrom humbug.delegate_ai_tool import DelegateAITool\\nfrom humbug.exception_notifier import get_exception_notifier\\nfrom humbug.message_box import MessageBox, MessageBoxType\\nfrom humbug.language.language_manager import LanguageManager\\nfrom humbug.mindspace.mindspace_error import MindspaceError, MindspaceExistsError\\nfrom humbug.mindspace.mindspace_folders_dialog import MindspaceFoldersDialog\\nfrom humbug.mindspace.mindspace_log_level import MindspaceLogLevel\\nfrom humbug.mindspace.mindspace_manager import MindspaceManager\\nfrom humbug.mindspace.mindspace_settings import MindspaceSettings\\nfrom humbug.mindspace.mindspace_settings_dialog import MindspaceSettingsDialog\\nfrom humbug.mindspace.mindspace_view import MindspaceView\\nfrom humbug.mindspace.mindspace_view_type import MindspaceViewType\\nfrom humbug.style_manager import StyleManager, ColorMode\\nfrom humbug.status_message import StatusMessage\\nfrom humbug.system_ai_tool import SystemAITool\\nfrom humbug.tabs.column_manager import ColumnManager\\nfrom humbug.tabs.conversation.conversation_error import ConversationError\\nfrom humbug.tabs.conversation.conversation_tab import ConversationTab\\nfrom humbug.tabs.shell.commands.shell_command_clear import ShellCommandClear\\nfrom humbug.tabs.shell.commands.shell_command_conversation import ShellCommandConversation\\nfrom humbug.tabs.shell.commands.shell_command_edit import ShellCommandEdit\\nfrom humbug.tabs.shell.commands.shell_command_help import ShellCommandHelp\\nfrom humbug.tabs.shell.commands.shell_command_log import ShellCommandLog\\nfrom humbug.tabs.shell.commands.shell_command_m6rc import ShellCommandM6rc\\nfrom humbug.tabs.shell.commands.shell_command_terminal import ShellCommandTerminal\\nfrom humbug.tabs.shell.commands.shell_command_wiki import ShellCommandWiki\\nfrom humbug.tabs.shell.shell_command_registry import ShellCommandRegistry\\nfrom humbug.tabs.tab_base import TabBase\\nfrom humbug.tabs.wiki.wiki_error import WikiError\\nfrom humbug.tabs.wiki.wiki_tab import WikiTab\\nfrom humbug.user.user_manager import UserManager, UserError\\nfrom humbug.user.user_settings import UserSettings\\nfrom humbug.user.user_settings_dialog import UserSettingsDialog\\n\\n\\nclass MainWindow(QMainWindow):\\n    \\\"\\\"\\\"Main window for the Humbug application.\\\"\\\"\\\"\\n\\n    def __init__(self) -> None:\\n        \\\"\\\"\\\"Initialize the main window.\\\"\\\"\\\"\\n        super().__init__()\\n\\n        self._logger = logging.getLogger(\\\"MainWindow\\\")\\n\\n        self._language_manager = LanguageManager()\\n        self._language_manager.language_changed.connect(self._on_language_changed)\\n        strings = self._language_manager.strings()\\n\\n        # Humbug menu actions\\n        self._about_action = QAction(strings.about_humbug, self)\\n        self._about_action.setMenuRole(QAction.MenuRole.AboutRole)\\n        self._about_action.triggered.connect(self._show_about_dialog)\\n\\n        self._user_settings_action = QAction(strings.user_settings, self)\\n        self._user_settings_action.setMenuRole(QAction.MenuRole.PreferencesRole)\\n        self._user_settings_action.setShortcut(QKeySequence(\\\"Ctrl+,\\\"))\\n        self._user_settings_action.triggered.connect(self._show_user_settings_dialog)\\n\\n        self._quit_action = QAction(strings.quit_humbug, self)\\n        self._quit_action.setMenuRole(QAction.MenuRole.QuitRole)\\n        self._quit_action.setShortcut(QKeySequence(\\\"Ctrl+Q\\\"))\\n        self._quit_action.triggered.connect(self.close)\\n\\n        # File menu actions\\n        self._new_mindspace_action = QAction(strings.new_mindspace, self)\\n        self._new_mindspace_action.setShortcut(QKeySequence(\\\"Ctrl+Alt+N\\\"))\\n        self._new_mindspace_action.triggered.connect(self._new_mindspace)\\n\\n        self._new_conv_action = QAction(strings.new_conversation, self)\\n        self._new_conv_action.setShortcut(QKeySequence(\\\"Ctrl+Shift+N\\\"))\\n        self._new_conv_action.triggered.connect(self._new_conversation)\\n\\n        self._new_metaphor_conv_action = QAction(strings.new_metaphor_conversation, self)\\n        self._new_metaphor_conv_action.setShortcut(QKeySequence(\\\"Ctrl+Shift+M\\\"))\\n        self._new_metaphor_conv_action.triggered.connect(self._new_metaphor_conversation)\\n\\n        self._new_file_action = QAction(strings.new_file, self)\\n        self._new_file_action.setShortcut(QKeySequence.StandardKey.New)\\n        self._new_file_action.triggered.connect(self._new_file)\\n\\n        self._new_terminal_action = QAction(strings.new_terminal, self)\\n        self._new_terminal_action.setShortcut(QKeySequence(\\\"Ctrl+Alt+T\\\"))\\n        self._new_terminal_action.triggered.connect(self._new_terminal)\\n\\n        self._open_mindspace_action = QAction(strings.open_mindspace, self)\\n        self._open_mindspace_action.setShortcut(QKeySequence(\\\"Ctrl+Alt+O\\\"))\\n        self._open_mindspace_action.triggered.connect(self._open_mindspace)\\n\\n        self._open_wiki_action = QAction(strings.open_wiki, self)\\n        self._open_wiki_action.setShortcut(QKeySequence(\\\"Ctrl+Shift+W\\\"))\\n        self._open_wiki_action.triggered.connect(self._open_wiki)\\n\\n        self._open_conv_action = QAction(strings.open_conversation, self)\\n        self._open_conv_action.setShortcut(QKeySequence(\\\"Ctrl+Shift+O\\\"))\\n        self._open_conv_action.triggered.connect(self._open_conversation)\\n\\n        self._open_file_action = QAction(strings.open_file, self)\\n        self._open_file_action.setShortcut(QKeySequence.StandardKey.Open)\\n        self._open_file_action.triggered.connect(self._open_file)\\n\\n        self._fork_conv_action = QAction(strings.fork_conversation, self)\\n        self._fork_conv_action.setShortcut(QKeySequence(\\\"Ctrl+Shift+F\\\"))\\n        self._fork_conv_action.triggered.connect(self._fork_conversation)\\n\\n        self._save_action = QAction(strings.save, self)\\n        self._save_action.setShortcut(QKeySequence.StandardKey.Save)\\n        self._save_action.triggered.connect(self._save_file)\\n\\n        self._save_as_action = QAction(strings.save_as, self)\\n        self._save_as_action.setShortcut(QKeySequence.StandardKey.SaveAs)\\n        self._save_as_action.triggered.connect(self._save_file_as)\\n\\n        self._close_tab_action = QAction(strings.close_tab, self)\\n        self._close_tab_action.setShortcut(QKeySequence(\\\"Ctrl+W\\\"))\\n        self._close_tab_action.triggered.connect(self._close_tab)\\n\\n        self._close_mindspace_action = QAction(strings.close_mindspace, self)\\n        self._close_mindspace_action.setShortcut(QKeySequence(\\\"Ctrl+Alt+W\\\"))\\n        self._close_mindspace_action.triggered.connect(self._close_mindspace)\\n\\n        # Edit menu actions\\n        self._submit_message_action = QAction(strings.submit_message, self)\\n        self._submit_message_action.setShortcut(QKeySequence(\\\"Ctrl+J\\\"))\\n        self._submit_message_action.triggered.connect(self._submit_message)\\n\\n        self._undo_action = QAction(strings.undo, self)\\n        self._undo_action.setShortcut(QKeySequence(\\\"Ctrl+Z\\\"))\\n        self._undo_action.triggered.connect(self._undo)\\n\\n        self._redo_action = QAction(strings.redo, self)\\n        self._redo_action.setShortcut(QKeySequence(\\\"Ctrl+Shift+Z\\\"))\\n        self._redo_action.triggered.connect(self._redo)\\n\\n        self._cut_action = QAction(strings.cut, self)\\n        self._cut_action.setShortcut(QKeySequence(\\\"Ctrl+X\\\"))\\n        self._cut_action.triggered.connect(self._cut)\\n\\n        self._copy_action = QAction(strings.copy, self)\\n        self._copy_action.setShortcut(QKeySequence(\\\"Ctrl+C\\\"))\\n        self._copy_action.triggered.connect(self._copy)\\n\\n        self._paste_action = QAction(strings.paste, self)\\n        self._paste_action.setShortcut(QKeySequence(\\\"Ctrl+V\\\"))\\n        self._paste_action.triggered.connect(self._paste)\\n\\n        self._find_action = QAction(strings.find, self)\\n        self._find_action.setShortcut(QKeySequence.StandardKey.Find)\\n        self._find_action.triggered.connect(self._find)\\n\\n        self._mindspace_settings_action = QAction(strings.mindspace_settings, self)\\n        self._mindspace_settings_action.setShortcut(QKeySequence(\\\"Ctrl+Alt+,\\\"))\\n        self._mindspace_settings_action.triggered.connect(self._show_mindspace_settings_dialog)\\n\\n        self._conv_settings_action = QAction(strings.conversation_settings, self)\\n        self._conv_settings_action.setShortcut(QKeySequence(\\\"Ctrl+Shift+,\\\"))\\n        self._conv_settings_action.triggered.connect(self._show_conversation_settings_dialog)\\n\\n        # View menu actions - Theme menu will be created in _on_language_changed\\n        self._theme_menu: QMenu | None = None\\n        self._theme_actions: Dict[ColorMode, QAction] = {}\\n\\n        self._zoom_in_action = QAction(strings.zoom_in, self)\\n        self._zoom_in_action.setShortcut(QKeySequence(\\\"Ctrl+=\\\"))\\n        self._zoom_in_action.triggered.connect(lambda: self._handle_zoom(1.0800597))\\n\\n        self._zoom_out_action = QAction(strings.zoom_out, self)\\n        self._zoom_out_action.setShortcut(QKeySequence(\\\"Ctrl+-\\\"))\\n        self._zoom_out_action.triggered.connect(lambda: self._handle_zoom(1/1.0800597))\\n\\n        self._reset_zoom_action = QAction(strings.reset_zoom, self)\\n        self._reset_zoom_action.setShortcut(QKeySequence(\\\"Ctrl+0\\\"))\\n        self._reset_zoom_action.triggered.connect(lambda: self._set_zoom(1.0))\\n\\n        self._show_system_log_action = QAction(strings.show_system_log, self)\\n        self._show_system_log_action.setShortcut(QKeySequence(\\\"Ctrl+Shift+L\\\"))\\n        self._show_system_log_action.triggered.connect(self._show_system_log)\\n\\n        self._show_system_shell_action = QAction(strings.show_system_shell, self)\\n        self._show_system_shell_action.setShortcut(QKeySequence(\\\"Ctrl+Shift+Y\\\"))\\n        self._show_system_shell_action.triggered.connect(self._show_system_shell)\\n\\n        self._show_all_columns_action = QAction(strings.show_all_columns, self)\\n        self._show_all_columns_action.setShortcut(QKeySequence(\\\"Ctrl+\\\\\\\\\\\"))\\n        self._show_all_columns_action.triggered.connect(self._show_all_columns)\\n\\n        self._split_column_left_action = QAction(strings.split_column_left, self)\\n        self._split_column_left_action.setShortcut(QKeySequence(\\\"Ctrl+Shift+[\\\"))\\n\\n        self._split_column_right_action = QAction(strings.split_column_right, self)\\n        self._split_column_right_action.setShortcut(QKeySequence(\\\"Ctrl+Shift+]\\\"))\\n\\n        self._merge_column_left_action = QAction(strings.merge_column_left, self)\\n        self._merge_column_left_action.setShortcut(QKeySequence(\\\"Ctrl+[\\\"))\\n\\n        self._merge_column_right_action = QAction(strings.merge_column_right, self)\\n        self._merge_column_right_action.setShortcut(QKeySequence(\\\"Ctrl+]\\\"))\\n\\n        self._swap_column_left_action = QAction(strings.swap_column_left, self)\\n        self._swap_column_left_action.setShortcut(QKeySequence(\\\"Ctrl+Alt+[\\\"))\\n\\n        self._swap_column_right_action = QAction(strings.swap_column_right, self)\\n        self._swap_column_right_action.setShortcut(QKeySequence(\\\"Ctrl+Alt+]\\\"))\\n\\n        self._next_message_action = QAction(strings.next_message, self)\\n        self._next_message_action.setShortcut(QKeySequence(\\\"Alt+Down\\\"))\\n        self._next_message_action.triggered.connect(self._navigate_next_message)\\n\\n        self._previous_message_action = QAction(strings.previous_message, self)\\n        self._previous_message_action.setShortcut(QKeySequence(\\\"Alt+Up\\\"))\\n        self._previous_message_action.triggered.connect(self._navigate_previous_message)\\n\\n        self._toggle_bookmark_action = QAction(strings.bookmark_section, self)\\n        self._toggle_bookmark_action.setCheckable(True)\\n        self._toggle_bookmark_action.setShortcut(QKeySequence(\\\"Ctrl+B\\\"))\\n        self._toggle_bookmark_action.triggered.connect(self._toggle_bookmark)\\n\\n        self._next_bookmark_action = QAction(strings.next_bookmark, self)\\n        self._next_bookmark_action.setShortcut(QKeySequence(\\\"Ctrl+Shift+N\\\"))\\n        self._next_bookmark_action.triggered.connect(self._navigate_next_bookmark)\\n\\n        self._previous_bookmark_action = QAction(strings.previous_bookmark, self)\\n        self._previous_bookmark_action.setShortcut(QKeySequence(\\\"Ctrl+Shift+P\\\"))\\n        self._previous_bookmark_action.triggered.connect(self._navigate_previous_bookmark)\\n\\n        self._menu_bar = QMenuBar(self)\\n        self.setMenuBar(self._menu_bar)\\n\\n        # Humbug menu\\n        self._humbug_menu = self._menu_bar.addMenu(strings.humbug_menu)\\n        self._humbug_menu.addAction(self._about_action)\\n        self._humbug_menu.addSeparator()\\n        self._humbug_menu.addAction(self._user_settings_action)\\n        self._humbug_menu.addSeparator()\\n        self._humbug_menu.addAction(self._quit_action)\\n\\n        # File menu\\n        self._file_menu = self._menu_bar.addMenu(strings.file_menu)\\n        self._file_menu.addAction(self._new_mindspace_action)\\n        self._file_menu.addAction(self._new_conv_action)\\n        self._file_menu.addAction(self._new_metaphor_conv_action)\\n        self._file_menu.addAction(self._new_file_action)\\n        self._file_menu.addAction(self._new_terminal_action)\\n        self._file_menu.addSeparator()\\n        self._file_menu.addAction(self._open_mindspace_action)\\n        self._file_menu.addAction(self._open_wiki_action)\\n        self._file_menu.addAction(self._open_conv_action)\\n        self._file_menu.addAction(self._open_file_action)\\n        self._file_menu.addSeparator()\\n        self._file_menu.addAction(self._fork_conv_action)\\n        self._file_menu.addSeparator()\\n        self._file_menu.addAction(self._save_action)\\n        self._file_menu.addAction(self._save_as_action)\\n        self._file_menu.addSeparator()\\n        self._file_menu.addAction(self._close_mindspace_action)\\n        self._file_menu.addAction(self._close_tab_action)\\n\\n        # Edit menu\\n        self._edit_menu = self._menu_bar.addMenu(strings.edit_menu)\\n        self._edit_menu.addAction(self._submit_message_action)\\n        self._edit_menu.addSeparator()\\n        self._edit_menu.addAction(self._undo_action)\\n        self._edit_menu.addAction(self._redo_action)\\n        self._edit_menu.addSeparator()\\n        self._edit_menu.addAction(self._cut_action)\\n        self._edit_menu.addAction(self._copy_action)\\n        self._edit_menu.addAction(self._paste_action)\\n        self._edit_menu.addSeparator()\\n        self._edit_menu.addAction(self._find_action)\\n        self._edit_menu.addSeparator()\\n        self._edit_menu.addAction(self._mindspace_settings_action)\\n        self._edit_menu.addAction(self._conv_settings_action)\\n\\n        # View menu\\n        self._view_menu = self._menu_bar.addMenu(strings.view_menu)\\n\\n        # Theme menu will be added when language changes\\n        self._view_menu.addSeparator()\\n        self._view_menu.addAction(self._zoom_in_action)\\n        self._view_menu.addAction(self._zoom_out_action)\\n        self._view_menu.addAction(self._reset_zoom_action)\\n        self._view_menu.addSeparator()\\n        self._view_menu.addAction(self._show_system_log_action)\\n        self._view_menu.addAction(self._show_system_shell_action)\\n        self._view_menu.addSeparator()\\n        self._view_menu.addAction(self._show_all_columns_action)\\n        self._view_menu.addAction(self._split_column_left_action)\\n        self._view_menu.addAction(self._split_column_right_action)\\n        self._view_menu.addAction(self._merge_column_left_action)\\n        self._view_menu.addAction(self._merge_column_right_action)\\n        self._view_menu.addAction(self._swap_column_left_action)\\n        self._view_menu.addAction(self._swap_column_right_action)\\n        self._view_menu.addSeparator()\\n        self._view_menu.addAction(self._next_message_action)\\n        self._view_menu.addAction(self._previous_message_action)\\n        self._view_menu.addSeparator()\\n        self._view_menu.addAction(self._toggle_bookmark_action)\\n        self._view_menu.addAction(self._next_bookmark_action)\\n        self._view_menu.addAction(self._previous_bookmark_action)\\n\\n        self.setWindowTitle(\\\"Humbug\\\")\\n        self.setMinimumSize(1280, 800)\\n\\n        # Main widget and layout\\n        main_widget = QWidget()\\n        self.setCentralWidget(main_widget)\\n        layout = QVBoxLayout(main_widget)\\n        layout.setSpacing(0)\\n        layout.setContentsMargins(0, 0, 0, 0)\\n\\n        # Create splitter\\n        self._splitter = QSplitter(Qt.Orientation.Horizontal)\\n        layout.addWidget(self._splitter)\\n\\n        # Create and add mindspace view\\n        self._mindspace_view = MindspaceView(self)\\n        self._mindspace_view.file_clicked.connect(self._on_mindspace_view_file_clicked)\\n        self._mindspace_view.file_deleted.connect(self._on_mindspace_view_file_deleted)\\n        self._mindspace_view.file_renamed.connect(self._on_mindspace_view_file_renamed)\\n        self._mindspace_view.file_edited.connect(self._on_mindspace_view_file_edited)\\n        self._mindspace_view.file_opened_in_wiki.connect(self._on_mindspace_view_file_opened_in_wiki)\\n        self._splitter.addWidget(self._mindspace_view)\\n\\n        # Create tab manager in splitter\\n        self._column_manager = ColumnManager(self)\\n        self._column_manager.tab_changed.connect(self._on_column_manager_tab_changed)\\n        self._column_manager.fork_requested.connect(self._on_column_manager_fork_requested)\\n        self._column_manager.fork_from_index_requested.connect(self._on_column_manager_fork_from_index_requested)\\n        self._column_manager.open_wiki_link_requested.connect(self._on_column_manager_open_wiki_link_requested)\\n        self._column_manager.edit_file_requested.connect(self._on_column_manager_edit_file_requested)\\n        self._splitter.addWidget(self._column_manager)\\n\\n        # Set initial mindspace view width\\n        self._splitter.setSizes([300, self.width() - 300])\\n\\n        # Set the stretch factors: 0 for mindspace view (no stretch) and 1 for column manager (stretch to fill)\\n        self._splitter.setStretchFactor(0, 0)\\n        self._splitter.setStretchFactor(1, 1)\\n\\n        self._style_manager = StyleManager()\\n        self._style_manager.style_changed.connect(self._on_style_changed)\\n\\n        # Create a timer that fires every 50ms to keep our menu states correct\\n        self._menu_timer = QTimer()\\n        self._menu_timer.setInterval(50)\\n        self._menu_timer.timeout.connect(self._update_menu_state)\\n        self._menu_timer.start()\\n\\n        # Create status bar\\n        self._status_bar = QStatusBar()\\n        self._status_message_label = QLabel()\\n        self._status_bar.addPermanentWidget(self._status_message_label)\\n\\n        self.setStatusBar(self._status_bar)\\n        self._column_manager.status_message.connect(self._on_column_manager_status_message)\\n\\n        # Connect to exception notifier for canary functionality\\n        self._canary_active = False\\n        exception_notifier = get_exception_notifier()\\n        exception_notifier.exception_occurred.connect(self._on_exception_occurred)\\n\\n        self._on_language_changed()\\n\\n        self._user_manager = UserManager()\\n        user_settings = self._user_manager.settings()\\n        self._style_manager.set_user_font_size(user_settings.font_size)\\n        self._language_manager.set_language(user_settings.language)\\n\\n        # Set theme from user settings\\n        self._style_manager.set_color_mode(user_settings.theme)\\n        self._update_theme_menu()\\n\\n        self._mindspace_manager = MindspaceManager()\\n\\n        # Initialize command registry and register commands\\n        self._command_registry = ShellCommandRegistry()\\n        self._command_registry.register_command(ShellCommandClear(self._column_manager))\\n        self._command_registry.register_command(ShellCommandConversation(self._column_manager))\\n        self._command_registry.register_command(ShellCommandEdit(self._column_manager))\\n        self._command_registry.register_command(ShellCommandLog(self._column_manager))\\n        self._command_registry.register_command(ShellCommandM6rc(self._column_manager))\\n        self._command_registry.register_command(ShellCommandTerminal(self._column_manager))\\n        self._command_registry.register_command(ShellCommandWiki(self._column_manager))\\n\\n        # Register help command last so it can see all other commands\\n        self._command_registry.register_command(ShellCommandHelp(self._command_registry))\\n\\n        self._ai_tool_manager = AIToolManager()\\n        self._ai_tool_manager.register_tool(\\n            CalculatorAITool(), \\\"Calculator: performs arithmetic, trigonometry, logarithms, and other calculations\\\"\\n        )\\n        self._ai_tool_manager.register_tool(ClockAITool(), \\\"Clock: gets the current time and date\\\")\\n        self._ai_tool_manager.register_tool(\\n            DelegateAITool(self._column_manager), \\\"Delegate: delegates tasks to specialized AI instances\\\"\\n        )\\n        self._ai_tool_manager.register_tool(\\n            FileSystemAITool(self._resolve_mindspace_path), \\\"FileSystem: handles file operations in the current mindspace\\\"\\n        )\\n        self._ai_tool_manager.register_tool(SystemAITool(self._column_manager), \\\"System: implements UI automations within Humbug\\\")\\n\\n        QTimer.singleShot(0, self._restore_last_mindspace)\\n\\n    def changeEvent(self, event: QEvent) -> None:\\n        \\\"\\\"\\\"Handle change events.\\\"\\\"\\\"\\n        # If our window state changes then update the column manager's style\\n        if event.type() == QEvent.Type.WindowStateChange:\\n            self._column_manager.apply_style()\\n\\n        return super().changeEvent(event)\\n\\n    def _on_exception_occurred(self) -> None:\\n        \\\"\\\"\\\"Handle uncaught exception notification by activating canary.\\\"\\\"\\\"\\n        self._logger.debug(\\\"Uncaught exception detected, activating canary\\\")\\n        self._canary_active = True\\n        self._on_style_changed()  # Refresh styles to apply canary background\\n\\n    def _update_menu_state(self) -> None:\\n        \\\"\\\"\\\"Update enabled/disabled state of menu items.\\\"\\\"\\\"\\n        # Update mindspace-specific actions\\n        has_mindspace = self._mindspace_manager.has_mindspace()\\n        self._close_mindspace_action.setEnabled(has_mindspace)\\n        self._new_conv_action.setEnabled(has_mindspace)\\n        self._new_metaphor_conv_action.setEnabled(has_mindspace)\\n        self._new_file_action.setEnabled(has_mindspace)\\n        self._open_wiki_action.setEnabled(has_mindspace)\\n        self._open_conv_action.setEnabled(has_mindspace)\\n        self._open_file_action.setEnabled(has_mindspace)\\n        self._new_terminal_action.setEnabled(has_mindspace)\\n        self._mindspace_settings_action.setEnabled(has_mindspace)\\n\\n        # Update tab-specific actions\\n        column_manager = self._column_manager\\n        self._fork_conv_action.setEnabled(column_manager.can_fork_conversation())\\n        self._save_action.setEnabled(column_manager.can_save_file())\\n        self._save_as_action.setEnabled(column_manager.can_save_file_as())\\n        self._close_tab_action.setEnabled(column_manager.can_close_tab())\\n        self._undo_action.setEnabled(column_manager.can_undo())\\n        self._redo_action.setEnabled(column_manager.can_redo())\\n        self._cut_action.setEnabled(column_manager.can_cut())\\n        self._copy_action.setEnabled(column_manager.can_copy())\\n        self._paste_action.setEnabled(column_manager.can_paste())\\n        self._find_action.setEnabled(column_manager.can_show_find())\\n        self._submit_message_action.setEnabled(column_manager.can_submit_message())\\n        self._conv_settings_action.setEnabled(column_manager.can_show_conversation_settings_dialog())\\n\\n        # Update view actions\\n        current_zoom = self._style_manager.zoom_factor()\\n        left_to_right = self._language_manager.left_to_right()\\n        self._zoom_in_action.setEnabled(current_zoom < 2.0)\\n        self._zoom_out_action.setEnabled(current_zoom > 0.5)\\n        self._show_system_log_action.setEnabled(has_mindspace)\\n        self._show_system_shell_action.setEnabled(has_mindspace)\\n        self._show_all_columns_action.setEnabled(column_manager.can_show_all_columns())\\n        self._split_column_left_action.setEnabled(column_manager.can_split_column())\\n        self._split_column_right_action.setEnabled(column_manager.can_split_column())\\n        self._merge_column_left_action.setEnabled(column_manager.can_merge_column(left_to_right))\\n        self._merge_column_right_action.setEnabled(column_manager.can_merge_column(not left_to_right))\\n        self._swap_column_left_action.setEnabled(column_manager.can_swap_column(left_to_right))\\n        self._swap_column_right_action.setEnabled(column_manager.can_swap_column(not left_to_right))\\n        self._next_message_action.setEnabled(column_manager.can_navigate_next_message())\\n        self._previous_message_action.setEnabled(column_manager.can_navigate_previous_message())\\n        self._toggle_bookmark_action.setEnabled(column_manager.can_toggle_bookmark())\\n        self._next_bookmark_action.setEnabled(column_manager.can_navigate_next_bookmark())\\n        self._previous_bookmark_action.setEnabled(column_manager.can_navigate_previous_bookmark())\\n\\n    def _on_language_changed(self) -> None:\\n        \\\"\\\"\\\"Update UI text when language changes.\\\"\\\"\\\"\\n        app = cast(QApplication, QApplication.instance())\\n        left_to_right = self._language_manager.left_to_right()\\n        if left_to_right:\\n            app.setLayoutDirection(Qt.LayoutDirection.LeftToRight)\\n\\n        else:\\n            app.setLayoutDirection(Qt.LayoutDirection.RightToLeft)\\n\\n        strings = self._language_manager.strings()\\n\\n        # Update menu titles\\n        self._humbug_menu.setTitle(strings.humbug_menu)\\n        self._edit_menu.setTitle(strings.edit_menu)\\n        self._file_menu.setTitle(strings.file_menu)\\n        self._view_menu.setTitle(strings.view_menu)\\n\\n        # Update action texts\\n        self._about_action.setText(strings.about_humbug)\\n        self._user_settings_action.setText(strings.user_settings)\\n        self._quit_action.setText(strings.quit_humbug)\\n        self._new_mindspace_action.setText(strings.new_mindspace)\\n        self._new_conv_action.setText(strings.new_conversation)\\n        self._new_metaphor_conv_action.setText(strings.new_metaphor_conversation)\\n        self._new_file_action.setText(strings.new_file)\\n        self._open_mindspace_action.setText(strings.open_mindspace)\\n        self._open_wiki_action.setText(strings.open_wiki)\\n        self._open_conv_action.setText(strings.open_conversation)\\n        self._open_file_action.setText(strings.open_file)\\n        self._fork_conv_action.setText(strings.fork_conversation)\\n        self._save_action.setText(strings.save)\\n        self._save_as_action.setText(strings.save_as)\\n        self._close_tab_action.setText(strings.close_tab)\\n        self._close_mindspace_action.setText(strings.close_mindspace)\\n        self._submit_message_action.setText(strings.submit_message)\\n        self._undo_action.setText(strings.undo)\\n        self._redo_action.setText(strings.redo)\\n        self._cut_action.setText(strings.cut)\\n        self._copy_action.setText(strings.copy)\\n        self._paste_action.setText(strings.paste)\\n        self._find_action.setText(strings.find)\\n        self._mindspace_settings_action.setText(strings.mindspace_settings)\\n        self._conv_settings_action.setText(strings.conversation_settings)\\n\\n        # Recreate the theme menu with updated language strings\\n        if self._theme_menu is not None:\\n            self._view_menu.removeAction(self._theme_menu.menuAction())\\n\\n        self._theme_menu = self._create_theme_menu()\\n        self._view_menu.insertMenu(self._zoom_in_action, self._theme_menu)\\n\\n        self._zoom_in_action.setText(strings.zoom_in)\\n        self._zoom_out_action.setText(strings.zoom_out)\\n        self._reset_zoom_action.setText(strings.reset_zoom)\\n        self._show_system_shell_action.setText(strings.show_system_shell)\\n        self._show_all_columns_action.setText(strings.show_all_columns)\\n        self._split_column_left_action.setText(strings.split_column_left)\\n        self._split_column_right_action.setText(strings.split_column_right)\\n        self._merge_column_left_action.setText(strings.merge_column_left)\\n        self._merge_column_right_action.setText(strings.merge_column_right)\\n        self._swap_column_left_action.setText(strings.swap_column_left)\\n        self._swap_column_right_action.setText(strings.swap_column_right)\\n        self._next_message_action.setText(strings.next_message)\\n        self._previous_message_action.setText(strings.previous_message)\\n        self._toggle_bookmark_action.setText(strings.bookmark_section)\\n        self._next_bookmark_action.setText(strings.next_bookmark)\\n        self._previous_bookmark_action.setText(strings.previous_bookmark)\\n\\n        # Our logic for left and right reverses for right-to-left languages\\n        left_to_right = self._language_manager.left_to_right()\\n        self._split_column_left_action.triggered.disconnect()\\n        self._split_column_left_action.triggered.connect(lambda: self._split_column(left_to_right))\\n        self._split_column_right_action.triggered.disconnect()\\n        self._split_column_right_action.triggered.connect(lambda: self._split_column(not left_to_right))\\n        self._merge_column_left_action.triggered.disconnect()\\n        self._merge_column_left_action.triggered.connect(lambda: self._merge_column(left_to_right))\\n        self._merge_column_right_action.triggered.disconnect()\\n        self._merge_column_right_action.triggered.connect(lambda: self._merge_column(not left_to_right))\\n        self._swap_column_left_action.triggered.disconnect()\\n        self._swap_column_left_action.triggered.connect(lambda: self._swap_column(left_to_right))\\n        self._swap_column_right_action.triggered.disconnect()\\n        self._swap_column_right_action.triggered.connect(lambda: self._swap_column(not left_to_right))\\n\\n        self._on_style_changed()\\n\\n    def _create_theme_menu(self) -> QMenu:\\n        \\\"\\\"\\\"\\n        Create a display theme submenu with available themes.\\n\\n        Returns:\\n            QMenu: The theme submenu\\n        \\\"\\\"\\\"\\n        strings = self._language_manager.strings()\\n\\n        # Create the theme menu\\n        theme_menu = QMenu(strings.display_theme, self)\\n\\n        # Create an action group so only one theme can be selected at a time\\n        theme_action_group = QActionGroup(self)\\n        theme_action_group.setExclusive(True)\\n\\n        # Create the theme actions dictionary to store references\\n        self._theme_actions = {}\\n\\n        # Add Light theme action\\n        light_action = QAction(strings.theme_light, self)\\n        light_action.setCheckable(True)\\n        light_action.setChecked(self._style_manager.color_mode() == ColorMode.LIGHT)\\n        light_action.triggered.connect(lambda: self._set_color_mode(ColorMode.LIGHT))\\n        theme_action_group.addAction(light_action)\\n        theme_menu.addAction(light_action)\\n        self._theme_actions[ColorMode.LIGHT] = light_action\\n\\n        # Add Dark theme action\\n        dark_action = QAction(strings.theme_dark, self)\\n        dark_action.setCheckable(True)\\n        dark_action.setChecked(self._style_manager.color_mode() == ColorMode.DARK)\\n        dark_action.triggered.connect(lambda: self._set_color_mode(ColorMode.DARK))\\n        theme_action_group.addAction(dark_action)\\n        theme_menu.addAction(dark_action)\\n        self._theme_actions[ColorMode.DARK] = dark_action\\n\\n        return theme_menu\\n\\n    def _update_theme_menu(self) -> None:\\n        \\\"\\\"\\\"Update the theme menu to reflect the current selected theme.\\\"\\\"\\\"\\n        # Set the checked state for the appropriate theme action\\n        for theme, action in self._theme_actions.items():\\n            action.setChecked(theme == self._style_manager.color_mode())\\n\\n    def _set_color_mode(self, theme: ColorMode) -> None:\\n        \\\"\\\"\\\"\\n        Set the color mode (theme) for the application.\\n\\n        Args:\\n            theme: The new theme to apply\\n        \\\"\\\"\\\"\\n        self._style_manager.set_color_mode(theme)\\n\\n    def _map_tab_to_mindspace_view(self, tab: TabBase) -> MindspaceViewType:\\n        \\\"\\\"\\\"Map a tab to its corresponding mindspace view type.\\\"\\\"\\\"\\n        if isinstance(tab, ConversationTab):\\n            return MindspaceViewType.CONVERSATIONS\\n\\n        if isinstance(tab, WikiTab):\\n            return MindspaceViewType.WIKI\\n\\n        return MindspaceViewType.FILES\\n\\n    def _on_column_manager_tab_changed(self) -> None:\\n        \\\"\\\"\\\"Handle tab change events.\\\"\\\"\\\"\\n        current_tab = self._column_manager.get_current_tab()\\n        if current_tab is None:\\n            return\\n\\n        path = current_tab.path()\\n        if path is None:\\n            return\\n\\n        view_type = self._map_tab_to_mindspace_view(current_tab)\\n        self._mindspace_view.reveal_and_select_file(view_type, path)\\n\\n    def _on_column_manager_status_message(self, message: StatusMessage) -> None:\\n        \\\"\\\"\\\"Update status bar with new message.\\\"\\\"\\\"\\n        self._status_message_label.setText(message.text)\\n        if message.timeout:\\n            QTimer.singleShot(message.timeout, self._status_message_label.clear)\\n\\n    def _restore_last_mindspace(self) -> None:\\n        \\\"\\\"\\\"Restore last mindspace on startup if available.\\\"\\\"\\\"\\n        try:\\n            with open(os.path.expanduser(\\\"~/.humbug/mindspace.json\\\"), encoding='utf-8') as f:\\n                data = json.load(f)\\n                mindspace_path = data.get(\\\"lastMindspace\\\")\\n                if mindspace_path and os.path.exists(mindspace_path):\\n                    try:\\n                        self._mindspace_manager.open_mindspace(mindspace_path)\\n                        self._mindspace_view.set_mindspace(mindspace_path)\\n                        self._restore_mindspace_state()\\n\\n                    except MindspaceError as e:\\n                        self._logger.error(\\\"Failed to restore mindspace: %s\\\", str(e))\\n                        # Don't show error dialog on startup, just log it\\n\\n        except (FileNotFoundError, json.JSONDecodeError):\\n            pass\\n\\n    def _new_mindspace(self) -> None:\\n        \\\"\\\"\\\"Show folder selection dialog and create new mindspace.\\\"\\\"\\\"\\n        self._menu_timer.stop()\\n        strings = self._language_manager.strings()\\n        dir_path = QFileDialog.getExistingDirectory(\\n            self, strings.file_dialog_new_mindspace\\n        )\\n        self._menu_timer.start()\\n        if not dir_path:\\n            return\\n\\n        if self._mindspace_manager.is_already_mindspace(dir_path):\\n            MessageBox.show_message(\\n                self,\\n                MessageBoxType.CRITICAL,\\n                strings.mindspace_error_title,\\n                strings.mindspace_exists_error\\n            )\\n            return\\n\\n        # Show folder configuration dialog\\n        dialog = MindspaceFoldersDialog(dir_path, self)\\n        if dialog.exec() != QDialog.DialogCode.Accepted:\\n            return\\n\\n        try:\\n            # Create mindspace with selected folders\\n            self._mindspace_manager.create_mindspace(dir_path, dialog.get_selected_folders())\\n\\n        except MindspaceExistsError:\\n            MessageBox.show_message(\\n                self,\\n                MessageBoxType.CRITICAL,\\n                strings.mindspace_error_title,\\n                strings.mindspace_exists_error\\n            )\\n            return\\n\\n        except MindspaceError as e:\\n            MessageBox.show_message(\\n                self,\\n                MessageBoxType.CRITICAL,\\n                strings.mindspace_error_title,\\n                strings.error_creating_mindspace.format(str(e))\\n            )\\n            return\\n\\n        self._open_mindspace_path(dir_path)\\n\\n    def _open_mindspace(self) -> None:\\n        \\\"\\\"\\\"Open a new mindspace.\\\"\\\"\\\"\\n        self._menu_timer.stop()\\n        strings = self._language_manager.strings()\\n        dir_path = QFileDialog.getExistingDirectory(self, strings.file_dialog_open_mindspace)\\n        self._menu_timer.start()\\n        if not dir_path:\\n            return\\n\\n        self._open_mindspace_path(dir_path)\\n\\n    def _open_mindspace_path(self, path: str) -> None:\\n        # Before we do anything, check if the new location is a mindspace\\n        if not self._mindspace_manager.check_mindspace(path):\\n            strings = self._language_manager.strings()\\n            MessageBox.show_message(\\n                self,\\n                MessageBoxType.CRITICAL,\\n                strings.mindspace_error_title,\\n                strings.error_opening_mindspace.format(path)\\n            )\\n            return\\n\\n        # If we're switching mindspaces, save the current one first\\n        if self._mindspace_manager.has_mindspace():\\n            self._save_mindspace_state()\\n            if not self._close_all_tabs():\\n                return\\n\\n            self._mindspace_manager.close_mindspace()\\n\\n        # Open the new mindspace\\n        try:\\n            self._mindspace_manager.open_mindspace(path)\\n            self._mindspace_view.set_mindspace(path)\\n\\n        except MindspaceError as e:\\n            strings = self._language_manager.strings()\\n            MessageBox.show_message(\\n                self,\\n                MessageBoxType.CRITICAL,\\n                strings.mindspace_error_title,\\n                strings.error_opening_mindspace.format(str(e))\\n            )\\n            return\\n\\n        # Restore the state of the newly opened mindspace\\n        self._restore_mindspace_state()\\n\\n    def _close_mindspace(self) -> None:\\n        if not self._mindspace_manager.has_mindspace():\\n            self._logger.error(\\\"No mindspace active, cannot close\\\")\\n            return\\n\\n        self._save_mindspace_state()\\n        if not self._close_all_tabs():\\n            return\\n\\n        self._mindspace_view.set_mindspace(\\\"\\\")\\n        self._mindspace_manager.close_mindspace()\\n\\n    def _save_mindspace_state(self) -> None:\\n        \\\"\\\"\\\"Save current mindspace state.\\\"\\\"\\\"\\n        if not self._mindspace_manager.has_mindspace():\\n            self._logger.error(\\\"No mindspace active, cannot save\\\")\\n            return\\n\\n        try:\\n            mindspace_state = self._column_manager.save_state()\\n            self._mindspace_manager.save_mindspace_state(mindspace_state)\\n\\n        except MindspaceError as e:\\n            self._logger.error(\\\"Failed to save mindspace state: %s\\\", str(e))\\n            strings = self._language_manager.strings()\\n            MessageBox.show_message(\\n                self,\\n                MessageBoxType.CRITICAL,\\n                strings.mindspace_error_title,\\n                strings.error_saving_mindspace.format(str(e))\\n            )\\n\\n    def _restore_mindspace_state(self) -> None:\\n        \\\"\\\"\\\"Restore previously open tabs from mindspace state.\\\"\\\"\\\"\\n        saved_state = self._mindspace_manager.load_mindspace_state()\\n        if not saved_state:\\n            self._logger.debug(\\\"No saved states found\\\")\\n            return\\n\\n        try:\\n            self._column_manager.restore_state(saved_state)\\n\\n        except MindspaceError as e:\\n            self._logger.error(\\\"Failed to restore mindspace state: %s\\\", str(e))\\n            strings = self._language_manager.strings()\\n            MessageBox.show_message(\\n                self,\\n                MessageBoxType.CRITICAL,\\n                strings.mindspace_error_title,\\n                strings.error_restoring_mindspace.format(str(e))\\n            )\\n\\n    def _close_all_tabs(self) -> bool:\\n        return self._column_manager.close_all_tabs()\\n\\n    def _undo(self) -> None:\\n        self._column_manager.undo()\\n\\n    def _redo(self) -> None:\\n        self._column_manager.redo()\\n\\n    def _cut(self) -> None:\\n        self._column_manager.cut()\\n\\n    def _copy(self) -> None:\\n        self._column_manager.copy()\\n\\n    def _paste(self) -> None:\\n        self._column_manager.paste()\\n\\n    def _find(self) -> None:\\n        self._column_manager.show_find()\\n\\n    def _show_about_dialog(self) -> None:\\n        \\\"\\\"\\\"Show the About dialog.\\\"\\\"\\\"\\n        dialog = AboutDialog(self)\\n        dialog.exec()\\n\\n    def _new_terminal(self) -> None:\\n        \\\"\\\"\\\"Create a new terminal tab.\\\"\\\"\\\"\\n        if not self._mindspace_manager.has_mindspace():\\n            return\\n\\n        self._column_manager.new_terminal()\\n\\n    def _new_file(self) -> None:\\n        \\\"\\\"\\\"Create a new empty editor tab.\\\"\\\"\\\"\\n        if not self._mindspace_manager.has_mindspace():\\n            return\\n\\n        self._column_manager.new_file()\\n\\n    def _on_mindspace_view_file_opened_in_wiki(self, path: str, ephemeral: bool) -> None:\\n        \\\"\\\"\\\"Handle click of a wiki link from the mindspace view.\\\"\\\"\\\"\\n        wiki_tab = self._column_manager.open_wiki_page(path, ephemeral)\\n        if wiki_tab is None:\\n            return\\n\\n        self._mindspace_manager.add_interaction(\\n            MindspaceLogLevel.INFO,\\n            f\\\"User opened wiki: '{path}'\\\\ntab ID: {wiki_tab.tab_id()}\\\"\\n        )\\n\\n    def _on_mindspace_view_file_clicked(self, source: MindspaceViewType, path: str, ephemeral: bool) -> None:\\n        \\\"\\\"\\\"Handle click of a file from the mindspace view.\\\"\\\"\\\"\\n        self._column_manager.open_file_by_mindspace_view_type(source, path, ephemeral)\\n\\n    def _on_mindspace_view_file_deleted(self, path: str) -> None:\\n        \\\"\\\"\\\"Handle deletion of a file by closing any open tab.\\n\\n        Args:\\n            path: Path of file being deleted\\n        \\\"\\\"\\\"\\n        self._column_manager.close_deleted_file(path)\\n\\n    def _on_mindspace_view_file_renamed(self, old_path: str, new_path: str) -> None:\\n        \\\"\\\"\\\"Handle renaming of files.\\n\\n        Args:\\n            old_path: Original path of renamed file\\n            new_path: New path after renaming\\n        \\\"\\\"\\\"\\n        self._column_manager.handle_file_rename(old_path, new_path)\\n\\n    def _on_mindspace_view_file_edited(self, path: str, ephemeral: bool) -> None:\\n        \\\"\\\"\\\"Handle file edited event from the mindspace view.\\\"\\\"\\\"\\n        self._open_file_path(path, ephemeral)\\n\\n    def _open_file(self) -> None:\\n        \\\"\\\"\\\"Show open file dialog and create editor tab.\\\"\\\"\\\"\\n        self._menu_timer.stop()\\n        strings = self._language_manager.strings()\\n        file_path, _ = QFileDialog.getOpenFileName(\\n            self,\\n            strings.file_dialog_open_file,\\n            self._mindspace_manager.file_dialog_directory()\\n        )\\n        self._menu_timer.start()\\n\\n        if not file_path:\\n            return\\n\\n        self._mindspace_manager.update_file_dialog_directory(file_path)\\n        self._open_file_path(file_path, False)\\n\\n    def _open_file_path(self, path: str, ephemeral: bool) -> None:\\n        \\\"\\\"\\\"Open file in editor tab.\\\"\\\"\\\"\\n        try:\\n            editor_tab = self._column_manager.open_file(path, ephemeral)\\n\\n            self._mindspace_manager.add_interaction(\\n                MindspaceLogLevel.INFO,\\n                f\\\"User opened editor for file: '{path}'\\\\nTab ID: {editor_tab.tab_id()}\\\"\\n            )\\n\\n        except OSError as e:\\n            strings = self._language_manager.strings()\\n            MessageBox.show_message(\\n                self,\\n                MessageBoxType.CRITICAL,\\n                strings.error_opening_file_title,\\n                strings.could_not_open.format(path, str(e))\\n            )\\n\\n    def _save_file(self) -> None:\\n        \\\"\\\"\\\"Save the current file.\\\"\\\"\\\"\\n        path = self._column_manager.save_file()\\n        self._mindspace_view.reveal_and_select_file(MindspaceViewType.FILES, path)\\n\\n    def _save_file_as(self) -> None:\\n        \\\"\\\"\\\"Save the current file with a new name.\\\"\\\"\\\"\\n        path = self._column_manager.save_file_as()\\n        self._mindspace_view.reveal_and_select_file(MindspaceViewType.FILES, path)\\n\\n    def _open_wiki(self) -> None:\\n        \\\"\\\"\\\"Open the wiki page in a new tab.\\\"\\\"\\\"\\n        self._column_manager.open_wiki_page(self._mindspace_manager.get_absolute_path(\\\".\\\"), False)\\n\\n    def _show_system_log(self) -> None:\\n        \\\"\\\"\\\"Show the log tab.\\\"\\\"\\\"\\n        self._column_manager.show_system_log()\\n\\n    def _show_system_shell(self) -> None:\\n        \\\"\\\"\\\"Show the shell tab.\\\"\\\"\\\"\\n        self._column_manager.show_system_shell()\\n\\n    def _show_all_columns(self) -> None:\\n        \\\"\\\"\\\"Show all columns equally.\\\"\\\"\\\"\\n        self._column_manager.show_all_columns()\\n\\n    def _split_column(self, split_left: bool) -> None:\\n        \\\"\\\"\\\"Split the current column.\\\"\\\"\\\"\\n        self._column_manager.split_column(split_left)\\n\\n    def _merge_column(self, merge_left: bool) -> None:\\n        \\\"\\\"\\\"Merge the current column.\\\"\\\"\\\"\\n        self._column_manager.merge_column(merge_left)\\n\\n    def _swap_column(self, swap_left: bool) -> None:\\n        \\\"\\\"\\\"Swap the current column.\\\"\\\"\\\"\\n        self._column_manager.swap_column(swap_left)\\n\\n    def _on_style_changed(self) -> None:\\n        style_manager = self._style_manager\\n        zoom_factor = style_manager.zoom_factor()\\n        base_font_size = style_manager.base_font_size()\\n\\n        # Determine status bar background color based on canary state\\n        status_bg_color = (\\n            style_manager.get_color_str(ColorRole.CANARY_BACKGROUND)\\n            if self._canary_active\\n            else style_manager.get_color_str(ColorRole.STATUS_BAR_BACKGROUND)\\n        )\\n\\n        self.setStyleSheet(f\\\"\\\"\\\"\\n            QMainWindow {{\\n                background-color: {style_manager.get_color_str(ColorRole.BACKGROUND_PRIMARY)};\\n                color: {style_manager.get_color_str(ColorRole.TEXT_PRIMARY)};\\n            }}\\n\\n            QMenuBar {{\\n                background-color: {style_manager.get_color_str(ColorRole.MENU_BACKGROUND)};\\n                padding: 4px;\\n                font-size: {base_font_size}pt;\\n            }}\\n            QMenuBar::item {{\\n                background-color: transparent;\\n                color: {style_manager.get_color_str(ColorRole.TEXT_PRIMARY)};\\n                border-radius: 4px;\\n                padding: 4px 8px 4px 8px;\\n            }}\\n            QMenuBar::item:selected {{\\n                background-color: {style_manager.get_color_str(ColorRole.MENU_HOVER)};\\n            }}\\n\\n            QMenu {{\\n                background-color: {style_manager.get_color_str(ColorRole.MENU_BACKGROUND)};\\n                color: {style_manager.get_color_str(ColorRole.TEXT_PRIMARY)};\\n                border-color: {style_manager.get_color_str(ColorRole.MENU_BORDER)};\\n                border-width: 1px;\\n                border-style: solid;\\n                border-radius: 8px;\\n                margin: 0px;\\n            }}\\n            QMenu::item {{\\n                margin: 2px;\\n                padding: 4px 8px 4px 8px;\\n                border-radius: 4px;\\n            }}\\n            QMenu::item:disabled {{\\n                color: {style_manager.get_color_str(ColorRole.TEXT_DISABLED)};\\n            }}\\n            QMenu::item:selected {{\\n                background-color: {style_manager.get_color_str(ColorRole.MENU_HOVER)}\\n            }}\\n\\n            QStatusBar {{\\n                background-color: {status_bg_color};\\n                color: {self._style_manager.get_color_str(ColorRole.TEXT_PRIMARY)};\\n                padding: {2 * zoom_factor}px;\\n                border-top: 1px solid {self._style_manager.get_color_str(ColorRole.SPLITTER)};\\n            }}\\n            QStatusBar::item {{\\n                border: 0;\\n                padding: 0;\\n            }}\\n\\n            QStatusBar QLabel {{\\n                color: {self._style_manager.get_color_str(ColorRole.TEXT_PRIMARY)};\\n                padding: 0;\\n            }}\\n\\n            QSplitter::handle {{\\n                background-color: {style_manager.get_color_str(ColorRole.SPLITTER)};\\n                margin: 0;\\n                width: 1px;\\n            }}\\n        \\\"\\\"\\\")\\n\\n        # Update status bar font\\n        status_font = self.font()\\n        status_font.setPointSizeF(base_font_size * zoom_factor)\\n        self._status_bar.setFont(status_font)\\n        self._status_message_label.setFont(status_font)\\n\\n        # Apply styles to the mindspace view and column manager\\n        self._mindspace_view.apply_style()\\n        self._column_manager.apply_style()\\n\\n    def _new_conversation(self) -> ConversationTab | None:\\n        \\\"\\\"\\\"Create new conversation tab.\\\"\\\"\\\"\\n        if not self._mindspace_manager.has_mindspace():\\n            return None\\n\\n        try:\\n            self._mindspace_manager.ensure_mindspace_dir(\\\"conversations\\\")\\n            conversation_tab = self._column_manager.new_conversation()\\n\\n        except MindspaceError as e:\\n            strings = self._language_manager.strings()\\n            MessageBox.show_message(\\n                self,\\n                MessageBoxType.CRITICAL,\\n                strings.mindspace_error_title,\\n                strings.error_opening_conversation.format(str(e))\\n            )\\n            self._mindspace_manager.add_interaction(\\n                MindspaceLogLevel.ERROR,\\n                f\\\"User failed to create new conversation: {str(e)}\\\"\\n            )\\n            return None\\n\\n        self._mindspace_manager.add_interaction(\\n            MindspaceLogLevel.INFO,\\n            f\\\"User created new conversation\\\\ntab ID: {conversation_tab.tab_id()}\\\"\\n        )\\n        return conversation_tab\\n\\n    def _get_canonical_mindspace_path(self, path: str) -> str | None:\\n        \\\"\\\"\\\"Get the canonical path of the current mindspace.\\\"\\\"\\\"\\n        if not self._mindspace_manager.has_mindspace():\\n            return None\\n\\n        # Get the absolute path of the current mindspace\\n        return self._mindspace_manager.get_relative_path(path)\\n\\n    def _resolve_mindspace_path(self, path: str) -> Tuple[Path, str]:\\n        # Check if our path starts with a separator.  If it does we'll assume it's for the root of the mindspace.\\n        if path.startswith(os.sep):\\n            path = path[1:]\\n\\n        # Convert to absolute path via mindspace manager\\n        abs_path = self._mindspace_manager.get_absolute_path(path)\\n        resolved_path = Path(abs_path).resolve()\\n\\n        # Verify the resolved path is still within mindspace\\n        relative_path = self._mindspace_manager.get_mindspace_relative_path(str(resolved_path))\\n        if relative_path is None:\\n            raise ValueError(f\\\"Path is outside mindspace boundaries: {path}\\\")\\n\\n        return resolved_path, relative_path\\n\\n    def _new_metaphor_conversation(self) -> None:\\n        \\\"\\\"\\\"Create new conversation from Metaphor file.\\\"\\\"\\\"\\n        # Show file dialog\\n        self._menu_timer.stop()\\n        strings = self._language_manager.strings()\\n        file_path, _ = QFileDialog.getOpenFileName(\\n            self,\\n            strings.file_dialog_open_metaphor,\\n            self._mindspace_manager.file_dialog_directory(),\\n            f\\\"{strings.file_filter_metaphor};;{strings.file_filter_all}\\\"\\n        )\\n        self._menu_timer.start()\\n\\n        if not file_path:\\n            return\\n\\n        self._mindspace_manager.update_file_dialog_directory(file_path)\\n        search_path = self._mindspace_manager.mindspace_path()\\n\\n        metaphor_ast_builder = MetaphorASTBuilder(self._get_canonical_mindspace_path)\\n        try:\\n            syntax_tree = MetaphorASTRootNode()\\n            metaphor_ast_builder.build_ast_from_file(syntax_tree, file_path, [search_path], search_path, [file_path])\\n            formatter = MetaphorFormatVisitor()\\n            prompt = format_preamble() + formatter.format(syntax_tree)\\n\\n        except MetaphorASTBuilderError as e:\\n            self._column_manager.show_system_shell()\\n            error = f\\\"Metaphor compiler error prevented new Metaphor conversation:\\\\n\\\\n{format_errors(e.errors)}\\\"\\n            self._mindspace_manager.add_interaction(MindspaceLogLevel.WARN, error)\\n            self._column_manager.show_system_log()\\n            return\\n\\n        conversation_tab = self._new_conversation()\\n        if conversation_tab is None:\\n            return\\n\\n        # Set input text\\n        conversation_tab.set_input_text(prompt)\\n\\n    def _open_conversation(self) -> None:\\n        \\\"\\\"\\\"Show open conversation dialog and create conversation tab.\\\"\\\"\\\"\\n        self._menu_timer.stop()\\n        strings = self._language_manager.strings()\\n        file_path, _ = QFileDialog.getOpenFileName(\\n            self,\\n            strings.file_dialog_open_conversation,\\n            self._mindspace_manager.conversations_directory(),\\n            f\\\"{strings.file_filter_conversation};;{strings.file_filter_all}\\\"\\n        )\\n        self._menu_timer.start()\\n\\n        if not file_path:\\n            return\\n\\n        self._mindspace_manager.update_conversations_directory(file_path)\\n        self._open_conversation_path(file_path, False)\\n\\n    def _open_conversation_path(self, path: str, ephemeral: bool) -> ConversationTab | None:\\n        \\\"\\\"\\\"Open an existing conversation file.\\\"\\\"\\\"\\n        try:\\n            tab = self._column_manager.open_conversation(path, ephemeral)\\n            return tab\\n\\n        except ConversationError as e:\\n            self._logger.error(\\\"Error opening conversation: %s: %s\\\", path, str(e))\\n            strings = self._language_manager.strings()\\n            MessageBox.show_message(\\n                self,\\n                MessageBoxType.CRITICAL,\\n                strings.conversation_error_title,\\n                strings.error_opening_conversation.format(path, str(e))\\n            )\\n            return None\\n\\n    def _fork_conversation(self) -> None:\\n        \\\"\\\"\\\"Create a new conversation tab with the history of the current conversation.\\\"\\\"\\\"\\n        # Create task to fork conversation\\n        try:\\n            self._column_manager.fork_conversation_from_index(None)\\n\\n        except ConversationError as e:\\n            strings = self._language_manager.strings()\\n            MessageBox.show_message(\\n                self,\\n                MessageBoxType.CRITICAL,\\n                strings.conversation_error_title,\\n                strings.error_forking_conversation.format(str(e))\\n            )\\n\\n    def _on_column_manager_fork_requested(self) -> None:\\n        \\\"\\\"\\\"Handle fork conversation requests.\\\"\\\"\\\"\\n        self._fork_conversation()\\n\\n    def _on_column_manager_fork_from_index_requested(self, index: int) -> None:\\n        \\\"\\\"\\\"Handle fork conversation requests from a specific index.\\\"\\\"\\\"\\n        try:\\n            self._column_manager.fork_conversation_from_index(index)\\n\\n        except ConversationError as e:\\n            strings = self._language_manager.strings()\\n            MessageBox.show_message(\\n                self,\\n                MessageBoxType.CRITICAL,\\n                strings.conversation_error_title,\\n                strings.error_forking_conversation.format(str(e))\\n            )\\n\\n    def _on_column_manager_open_wiki_link_requested(self, path: str) -> None:\\n        \\\"\\\"\\\"Handle requests to open a wiki page.\\\"\\\"\\\"\\n        try:\\n            self._column_manager.open_wiki_page(path, True)\\n\\n        except WikiError as e:\\n            self._logger.info(\\\"Error opening wiki page: %s: %s\\\", path, str(e))\\n            strings = self._language_manager.strings()\\n            MessageBox.show_message(\\n                self,\\n                MessageBoxType.CRITICAL,\\n                strings.wiki_error_title,\\n                strings.could_not_open.format(path, str(e))\\n            )\\n\\n    def _on_column_manager_edit_file_requested(self, path: str) -> None:\\n        \\\"\\\"\\\"Handle requests to open a file in the editor.\\\"\\\"\\\"\\n        self._open_file_path(path, False)\\n\\n    def _close_tab(self) -> None:\\n        \\\"\\\"\\\"Close the current tab.\\\"\\\"\\\"\\n        tab = self._column_manager.get_current_tab()\\n        if tab is None:\\n            self._logger.error(\\\"No current tab to close\\\")\\n            return\\n\\n        self._column_manager.close_tab()\\n        self._mindspace_manager.add_interaction(\\n            MindspaceLogLevel.INFO,\\n            f\\\"User closed tab\\\\nTab ID: {tab.tab_id()}\\\"\\n        )\\n\\n    def _submit_message(self) -> None:\\n        \\\"\\\"\\\"Handle message submission.\\\"\\\"\\\"\\n        self._column_manager.submit_message()\\n\\n    def _navigate_next_message(self) -> None:\\n        \\\"\\\"\\\"Navigate to the next message in conversation.\\\"\\\"\\\"\\n        self._column_manager.navigate_next_message()\\n\\n    def _navigate_previous_message(self) -> None:\\n        \\\"\\\"\\\"Navigate to the previous message in conversation.\\\"\\\"\\\"\\n        self._column_manager.navigate_previous_message()\\n\\n    def _toggle_bookmark(self) -> None:\\n        \\\"\\\"\\\"Handle toggling a bookmark.\\\"\\\"\\\"\\n        self._column_manager.toggle_bookmark()\\n\\n    def _navigate_next_bookmark(self) -> None:\\n        \\\"\\\"\\\"Move to the next bookmark.\\\"\\\"\\\"\\n        self._column_manager.navigate_next_bookmark()\\n\\n    def _navigate_previous_bookmark(self) -> None:\\n        \\\"\\\"\\\"Move to the previous bookmark.\\\"\\\"\\\"\\n        self._column_manager.navigate_previous_bookmark()\\n\\n    def _show_user_settings_dialog(self) -> None:\\n        \\\"\\\"\\\"Show the user settings dialog.\\\"\\\"\\\"\\n        dialog = UserSettingsDialog(self)\\n        dialog.set_settings(self._user_manager.settings())\\n\\n        def _on_settings_changed(new_settings: UserSettings) -> None:\\n            try:\\n                self._user_manager.update_settings(new_settings)\\n                self._style_manager.set_user_font_size(new_settings.font_size)\\n                self._language_manager.set_language(new_settings.language)\\n\\n                # Update theme from settings if it changed\\n                new_theme = new_settings.theme\\n                if new_theme != self._style_manager.color_mode():\\n                    self._style_manager.set_color_mode(new_theme)\\n                    self._update_theme_menu()\\n\\n                self._logger.info(\\\"User settings saved successfully\\\")\\n\\n            except UserError as e:\\n                self._logger.error(\\\"Failed to save user settings: %s\\\", str(e))\\n                strings = self._language_manager.strings()\\n                MessageBox.show_message(\\n                    self,\\n                    MessageBoxType.CRITICAL,\\n                    strings.settings_error_title,\\n                    strings.error_saving_user_settings.format(str(e))\\n                )\\n\\n        dialog.settings_changed.connect(_on_settings_changed)\\n        dialog.exec()\\n\\n    def _show_mindspace_settings_dialog(self) -> None:\\n        \\\"\\\"\\\"Show the mindspace settings dialog.\\\"\\\"\\\"\\n        if not self._mindspace_manager.has_mindspace():\\n            return\\n\\n        settings = cast(MindspaceSettings, self._mindspace_manager.settings())\\n        dialog = MindspaceSettingsDialog(self)\\n        dialog.set_settings(settings)\\n\\n        def _on_settings_changed(new_settings: MindspaceSettings) -> None:\\n            try:\\n                self._mindspace_manager.update_settings(new_settings)\\n\\n            except OSError as e:\\n                self._logger.error(\\\"Failed to save mindspace settings: %s\\\", str(e))\\n                strings = self._language_manager.strings()\\n                MessageBox.show_message(\\n                    self,\\n                    MessageBoxType.CRITICAL,\\n                    strings.settings_error_title,\\n                    strings.error_saving_mindspace_settings.format(str(e))\\n                )\\n\\n        dialog.settings_changed.connect(_on_settings_changed)\\n        dialog.exec()\\n\\n    def _show_conversation_settings_dialog(self) -> None:\\n        \\\"\\\"\\\"Show the conversation settings dialog.\\\"\\\"\\\"\\n        self._column_manager.show_conversation_settings_dialog()\\n\\n    def keyPressEvent(self, event: QKeyEvent) -> None:\\n        \\\"\\\"\\\"Handle global key events.\\\"\\\"\\\"\\n        if event.key() == Qt.Key.Key_Escape:\\n            if self._column_manager.handle_esc_key():\\n                return\\n\\n        super().keyPressEvent(event)\\n\\n    def _handle_zoom(self, factor: float) -> None:\\n        \\\"\\\"\\\"Handle zoom in/out requests.\\\"\\\"\\\"\\n        new_zoom = self._style_manager.zoom_factor() * factor\\n        self._set_zoom(new_zoom)\\n\\n    def _set_zoom(self, zoom_level: float) -> None:\\n        \\\"\\\"\\\"Set zoom level for the application.\\\"\\\"\\\"\\n        self._style_manager.set_zoom(zoom_level)\\n\\n    def closeEvent(self, event: QEvent) -> None:\\n        \\\"\\\"\\\"Handle application close request.\\\"\\\"\\\"\\n        self._save_mindspace_state()\\n        if not self._close_all_tabs():\\n            event.ignore()\\n            return\\n\\n        event.accept()\"\n    }\n}\n```",
      "completed": true,
      "tool_calls": [
        {
          "id": "toolu_016RQWfX9P8iTgZZp6iQNEHs",
          "name": "filesystem",
          "arguments": {
            "operation": "write_file",
            "path": "src/humbug/main_window.py",
            "content": "\"\"\"Main window implementation for Humbug application.\"\"\"\n\nimport json\nimport logging\nimport os\nfrom pathlib import Path\nfrom typing import cast, Dict, Tuple\n\nfrom PySide6.QtWidgets import (\n    QMainWindow, QWidget, QVBoxLayout, QMenuBar, QFileDialog,\n    QSplitter, QLabel, QApplication, QDialog, QMenu, QStatusBar\n)\nfrom PySide6.QtCore import Qt, QTimer, QEvent\nfrom PySide6.QtGui import QKeyEvent, QAction, QKeySequence, QActionGroup\n\nfrom metaphor import (\n    MetaphorASTBuilder, MetaphorASTBuilderError, MetaphorFormatVisitor, MetaphorASTRootNode,\n    format_errors, format_preamble\n)\n\nfrom ai_tool import AIToolManager\nfrom ai_tool.tools.calculator_ai_tool import CalculatorAITool\nfrom ai_tool.tools.clock_ai_tool import ClockAITool\nfrom ai_tool.tools.filesystem_ai_tool import FileSystemAITool\n\nfrom humbug.about_dialog import AboutDialog\nfrom humbug.color_role import ColorRole\nfrom humbug.delegate_ai_tool import DelegateAITool\nfrom humbug.exception_notifier import get_exception_notifier\nfrom humbug.message_box import MessageBox, MessageBoxType\nfrom humbug.language.language_manager import LanguageManager\nfrom humbug.mindspace.mindspace_error import MindspaceError, MindspaceExistsError\nfrom humbug.mindspace.mindspace_folders_dialog import MindspaceFoldersDialog\nfrom humbug.mindspace.mindspace_log_level import MindspaceLogLevel\nfrom humbug.mindspace.mindspace_manager import MindspaceManager\nfrom humbug.mindspace.mindspace_settings import MindspaceSettings\nfrom humbug.mindspace.mindspace_settings_dialog import MindspaceSettingsDialog\nfrom humbug.mindspace.mindspace_view import MindspaceView\nfrom humbug.mindspace.mindspace_view_type import MindspaceViewType\nfrom humbug.style_manager import StyleManager, ColorMode\nfrom humbug.status_message import StatusMessage\nfrom humbug.system_ai_tool import SystemAITool\nfrom humbug.tabs.column_manager import ColumnManager\nfrom humbug.tabs.conversation.conversation_error import ConversationError\nfrom humbug.tabs.conversation.conversation_tab import ConversationTab\nfrom humbug.tabs.shell.commands.shell_command_clear import ShellCommandClear\nfrom humbug.tabs.shell.commands.shell_command_conversation import ShellCommandConversation\nfrom humbug.tabs.shell.commands.shell_command_edit import ShellCommandEdit\nfrom humbug.tabs.shell.commands.shell_command_help import ShellCommandHelp\nfrom humbug.tabs.shell.commands.shell_command_log import ShellCommandLog\nfrom humbug.tabs.shell.commands.shell_command_m6rc import ShellCommandM6rc\nfrom humbug.tabs.shell.commands.shell_command_terminal import ShellCommandTerminal\nfrom humbug.tabs.shell.commands.shell_command_wiki import ShellCommandWiki\nfrom humbug.tabs.shell.shell_command_registry import ShellCommandRegistry\nfrom humbug.tabs.tab_base import TabBase\nfrom humbug.tabs.wiki.wiki_error import WikiError\nfrom humbug.tabs.wiki.wiki_tab import WikiTab\nfrom humbug.user.user_manager import UserManager, UserError\nfrom humbug.user.user_settings import UserSettings\nfrom humbug.user.user_settings_dialog import UserSettingsDialog\n\n\nclass MainWindow(QMainWindow):\n    \"\"\"Main window for the Humbug application.\"\"\"\n\n    def __init__(self) -> None:\n        \"\"\"Initialize the main window.\"\"\"\n        super().__init__()\n\n        self._logger = logging.getLogger(\"MainWindow\")\n\n        self._language_manager = LanguageManager()\n        self._language_manager.language_changed.connect(self._on_language_changed)\n        strings = self._language_manager.strings()\n\n        # Humbug menu actions\n        self._about_action = QAction(strings.about_humbug, self)\n        self._about_action.setMenuRole(QAction.MenuRole.AboutRole)\n        self._about_action.triggered.connect(self._show_about_dialog)\n\n        self._user_settings_action = QAction(strings.user_settings, self)\n        self._user_settings_action.setMenuRole(QAction.MenuRole.PreferencesRole)\n        self._user_settings_action.setShortcut(QKeySequence(\"Ctrl+,\"))\n        self._user_settings_action.triggered.connect(self._show_user_settings_dialog)\n\n        self._quit_action = QAction(strings.quit_humbug, self)\n        self._quit_action.setMenuRole(QAction.MenuRole.QuitRole)\n        self._quit_action.setShortcut(QKeySequence(\"Ctrl+Q\"))\n        self._quit_action.triggered.connect(self.close)\n\n        # File menu actions\n        self._new_mindspace_action = QAction(strings.new_mindspace, self)\n        self._new_mindspace_action.setShortcut(QKeySequence(\"Ctrl+Alt+N\"))\n        self._new_mindspace_action.triggered.connect(self._new_mindspace)\n\n        self._new_conv_action = QAction(strings.new_conversation, self)\n        self._new_conv_action.setShortcut(QKeySequence(\"Ctrl+Shift+N\"))\n        self._new_conv_action.triggered.connect(self._new_conversation)\n\n        self._new_metaphor_conv_action = QAction(strings.new_metaphor_conversation, self)\n        self._new_metaphor_conv_action.setShortcut(QKeySequence(\"Ctrl+Shift+M\"))\n        self._new_metaphor_conv_action.triggered.connect(self._new_metaphor_conversation)\n\n        self._new_file_action = QAction(strings.new_file, self)\n        self._new_file_action.setShortcut(QKeySequence.StandardKey.New)\n        self._new_file_action.triggered.connect(self._new_file)\n\n        self._new_terminal_action = QAction(strings.new_terminal, self)\n        self._new_terminal_action.setShortcut(QKeySequence(\"Ctrl+Alt+T\"))\n        self._new_terminal_action.triggered.connect(self._new_terminal)\n\n        self._open_mindspace_action = QAction(strings.open_mindspace, self)\n        self._open_mindspace_action.setShortcut(QKeySequence(\"Ctrl+Alt+O\"))\n        self._open_mindspace_action.triggered.connect(self._open_mindspace)\n\n        self._open_wiki_action = QAction(strings.open_wiki, self)\n        self._open_wiki_action.setShortcut(QKeySequence(\"Ctrl+Shift+W\"))\n        self._open_wiki_action.triggered.connect(self._open_wiki)\n\n        self._open_conv_action = QAction(strings.open_conversation, self)\n        self._open_conv_action.setShortcut(QKeySequence(\"Ctrl+Shift+O\"))\n        self._open_conv_action.triggered.connect(self._open_conversation)\n\n        self._open_file_action = QAction(strings.open_file, self)\n        self._open_file_action.setShortcut(QKeySequence.StandardKey.Open)\n        self._open_file_action.triggered.connect(self._open_file)\n\n        self._fork_conv_action = QAction(strings.fork_conversation, self)\n        self._fork_conv_action.setShortcut(QKeySequence(\"Ctrl+Shift+F\"))\n        self._fork_conv_action.triggered.connect(self._fork_conversation)\n\n        self._save_action = QAction(strings.save, self)\n        self._save_action.setShortcut(QKeySequence.StandardKey.Save)\n        self._save_action.triggered.connect(self._save_file)\n\n        self._save_as_action = QAction(strings.save_as, self)\n        self._save_as_action.setShortcut(QKeySequence.StandardKey.SaveAs)\n        self._save_as_action.triggered.connect(self._save_file_as)\n\n        self._close_tab_action = QAction(strings.close_tab, self)\n        self._close_tab_action.setShortcut(QKeySequence(\"Ctrl+W\"))\n        self._close_tab_action.triggered.connect(self._close_tab)\n\n        self._close_mindspace_action = QAction(strings.close_mindspace, self)\n        self._close_mindspace_action.setShortcut(QKeySequence(\"Ctrl+Alt+W\"))\n        self._close_mindspace_action.triggered.connect(self._close_mindspace)\n\n        # Edit menu actions\n        self._submit_message_action = QAction(strings.submit_message, self)\n        self._submit_message_action.setShortcut(QKeySequence(\"Ctrl+J\"))\n        self._submit_message_action.triggered.connect(self._submit_message)\n\n        self._undo_action = QAction(strings.undo, self)\n        self._undo_action.setShortcut(QKeySequence(\"Ctrl+Z\"))\n        self._undo_action.triggered.connect(self._undo)\n\n        self._redo_action = QAction(strings.redo, self)\n        self._redo_action.setShortcut(QKeySequence(\"Ctrl+Shift+Z\"))\n        self._redo_action.triggered.connect(self._redo)\n\n        self._cut_action = QAction(strings.cut, self)\n        self._cut_action.setShortcut(QKeySequence(\"Ctrl+X\"))\n        self._cut_action.triggered.connect(self._cut)\n\n        self._copy_action = QAction(strings.copy, self)\n        self._copy_action.setShortcut(QKeySequence(\"Ctrl+C\"))\n        self._copy_action.triggered.connect(self._copy)\n\n        self._paste_action = QAction(strings.paste, self)\n        self._paste_action.setShortcut(QKeySequence(\"Ctrl+V\"))\n        self._paste_action.triggered.connect(self._paste)\n\n        self._find_action = QAction(strings.find, self)\n        self._find_action.setShortcut(QKeySequence.StandardKey.Find)\n        self._find_action.triggered.connect(self._find)\n\n        self._mindspace_settings_action = QAction(strings.mindspace_settings, self)\n        self._mindspace_settings_action.setShortcut(QKeySequence(\"Ctrl+Alt+,\"))\n        self._mindspace_settings_action.triggered.connect(self._show_mindspace_settings_dialog)\n\n        self._conv_settings_action = QAction(strings.conversation_settings, self)\n        self._conv_settings_action.setShortcut(QKeySequence(\"Ctrl+Shift+,\"))\n        self._conv_settings_action.triggered.connect(self._show_conversation_settings_dialog)\n\n        # View menu actions - Theme menu will be created in _on_language_changed\n        self._theme_menu: QMenu | None = None\n        self._theme_actions: Dict[ColorMode, QAction] = {}\n\n        self._zoom_in_action = QAction(strings.zoom_in, self)\n        self._zoom_in_action.setShortcut(QKeySequence(\"Ctrl+=\"))\n        self._zoom_in_action.triggered.connect(lambda: self._handle_zoom(1.0800597))\n\n        self._zoom_out_action = QAction(strings.zoom_out, self)\n        self._zoom_out_action.setShortcut(QKeySequence(\"Ctrl+-\"))\n        self._zoom_out_action.triggered.connect(lambda: self._handle_zoom(1/1.0800597))\n\n        self._reset_zoom_action = QAction(strings.reset_zoom, self)\n        self._reset_zoom_action.setShortcut(QKeySequence(\"Ctrl+0\"))\n        self._reset_zoom_action.triggered.connect(lambda: self._set_zoom(1.0))\n\n        self._show_system_log_action = QAction(strings.show_system_log, self)\n        self._show_system_log_action.setShortcut(QKeySequence(\"Ctrl+Shift+L\"))\n        self._show_system_log_action.triggered.connect(self._show_system_log)\n\n        self._show_system_shell_action = QAction(strings.show_system_shell, self)\n        self._show_system_shell_action.setShortcut(QKeySequence(\"Ctrl+Shift+Y\"))\n        self._show_system_shell_action.triggered.connect(self._show_system_shell)\n\n        self._show_all_columns_action = QAction(strings.show_all_columns, self)\n        self._show_all_columns_action.setShortcut(QKeySequence(\"Ctrl+\\\\\"))\n        self._show_all_columns_action.triggered.connect(self._show_all_columns)\n\n        self._split_column_left_action = QAction(strings.split_column_left, self)\n        self._split_column_left_action.setShortcut(QKeySequence(\"Ctrl+Shift+[\"))\n\n        self._split_column_right_action = QAction(strings.split_column_right, self)\n        self._split_column_right_action.setShortcut(QKeySequence(\"Ctrl+Shift+]\"))\n\n        self._merge_column_left_action = QAction(strings.merge_column_left, self)\n        self._merge_column_left_action.setShortcut(QKeySequence(\"Ctrl+[\"))\n\n        self._merge_column_right_action = QAction(strings.merge_column_right, self)\n        self._merge_column_right_action.setShortcut(QKeySequence(\"Ctrl+]\"))\n\n        self._swap_column_left_action = QAction(strings.swap_column_left, self)\n        self._swap_column_left_action.setShortcut(QKeySequence(\"Ctrl+Alt+[\"))\n\n        self._swap_column_right_action = QAction(strings.swap_column_right, self)\n        self._swap_column_right_action.setShortcut(QKeySequence(\"Ctrl+Alt+]\"))\n\n        self._next_message_action = QAction(strings.next_message, self)\n        self._next_message_action.setShortcut(QKeySequence(\"Alt+Down\"))\n        self._next_message_action.triggered.connect(self._navigate_next_message)\n\n        self._previous_message_action = QAction(strings.previous_message, self)\n        self._previous_message_action.setShortcut(QKeySequence(\"Alt+Up\"))\n        self._previous_message_action.triggered.connect(self._navigate_previous_message)\n\n        self._toggle_bookmark_action = QAction(strings.bookmark_section, self)\n        self._toggle_bookmark_action.setCheckable(True)\n        self._toggle_bookmark_action.setShortcut(QKeySequence(\"Ctrl+B\"))\n        self._toggle_bookmark_action.triggered.connect(self._toggle_bookmark)\n\n        self._next_bookmark_action = QAction(strings.next_bookmark, self)\n        self._next_bookmark_action.setShortcut(QKeySequence(\"Ctrl+Shift+N\"))\n        self._next_bookmark_action.triggered.connect(self._navigate_next_bookmark)\n\n        self._previous_bookmark_action = QAction(strings.previous_bookmark, self)\n        self._previous_bookmark_action.setShortcut(QKeySequence(\"Ctrl+Shift+P\"))\n        self._previous_bookmark_action.triggered.connect(self._navigate_previous_bookmark)\n\n        self._menu_bar = QMenuBar(self)\n        self.setMenuBar(self._menu_bar)\n\n        # Humbug menu\n        self._humbug_menu = self._menu_bar.addMenu(strings.humbug_menu)\n        self._humbug_menu.addAction(self._about_action)\n        self._humbug_menu.addSeparator()\n        self._humbug_menu.addAction(self._user_settings_action)\n        self._humbug_menu.addSeparator()\n        self._humbug_menu.addAction(self._quit_action)\n\n        # File menu\n        self._file_menu = self._menu_bar.addMenu(strings.file_menu)\n        self._file_menu.addAction(self._new_mindspace_action)\n        self._file_menu.addAction(self._new_conv_action)\n        self._file_menu.addAction(self._new_metaphor_conv_action)\n        self._file_menu.addAction(self._new_file_action)\n        self._file_menu.addAction(self._new_terminal_action)\n        self._file_menu.addSeparator()\n        self._file_menu.addAction(self._open_mindspace_action)\n        self._file_menu.addAction(self._open_wiki_action)\n        self._file_menu.addAction(self._open_conv_action)\n        self._file_menu.addAction(self._open_file_action)\n        self._file_menu.addSeparator()\n        self._file_menu.addAction(self._fork_conv_action)\n        self._file_menu.addSeparator()\n        self._file_menu.addAction(self._save_action)\n        self._file_menu.addAction(self._save_as_action)\n        self._file_menu.addSeparator()\n        self._file_menu.addAction(self._close_mindspace_action)\n        self._file_menu.addAction(self._close_tab_action)\n\n        # Edit menu\n        self._edit_menu = self._menu_bar.addMenu(strings.edit_menu)\n        self._edit_menu.addAction(self._submit_message_action)\n        self._edit_menu.addSeparator()\n        self._edit_menu.addAction(self._undo_action)\n        self._edit_menu.addAction(self._redo_action)\n        self._edit_menu.addSeparator()\n        self._edit_menu.addAction(self._cut_action)\n        self._edit_menu.addAction(self._copy_action)\n        self._edit_menu.addAction(self._paste_action)\n        self._edit_menu.addSeparator()\n        self._edit_menu.addAction(self._find_action)\n        self._edit_menu.addSeparator()\n        self._edit_menu.addAction(self._mindspace_settings_action)\n        self._edit_menu.addAction(self._conv_settings_action)\n\n        # View menu\n        self._view_menu = self._menu_bar.addMenu(strings.view_menu)\n\n        # Theme menu will be added when language changes\n        self._view_menu.addSeparator()\n        self._view_menu.addAction(self._zoom_in_action)\n        self._view_menu.addAction(self._zoom_out_action)\n        self._view_menu.addAction(self._reset_zoom_action)\n        self._view_menu.addSeparator()\n        self._view_menu.addAction(self._show_system_log_action)\n        self._view_menu.addAction(self._show_system_shell_action)\n        self._view_menu.addSeparator()\n        self._view_menu.addAction(self._show_all_columns_action)\n        self._view_menu.addAction(self._split_column_left_action)\n        self._view_menu.addAction(self._split_column_right_action)\n        self._view_menu.addAction(self._merge_column_left_action)\n        self._view_menu.addAction(self._merge_column_right_action)\n        self._view_menu.addAction(self._swap_column_left_action)\n        self._view_menu.addAction(self._swap_column_right_action)\n        self._view_menu.addSeparator()\n        self._view_menu.addAction(self._next_message_action)\n        self._view_menu.addAction(self._previous_message_action)\n        self._view_menu.addSeparator()\n        self._view_menu.addAction(self._toggle_bookmark_action)\n        self._view_menu.addAction(self._next_bookmark_action)\n        self._view_menu.addAction(self._previous_bookmark_action)\n\n        self.setWindowTitle(\"Humbug\")\n        self.setMinimumSize(1280, 800)\n\n        # Main widget and layout\n        main_widget = QWidget()\n        self.setCentralWidget(main_widget)\n        layout = QVBoxLayout(main_widget)\n        layout.setSpacing(0)\n        layout.setContentsMargins(0, 0, 0, 0)\n\n        # Create splitter\n        self._splitter = QSplitter(Qt.Orientation.Horizontal)\n        layout.addWidget(self._splitter)\n\n        # Create and add mindspace view\n        self._mindspace_view = MindspaceView(self)\n        self._mindspace_view.file_clicked.connect(self._on_mindspace_view_file_clicked)\n        self._mindspace_view.file_deleted.connect(self._on_mindspace_view_file_deleted)\n        self._mindspace_view.file_renamed.connect(self._on_mindspace_view_file_renamed)\n        self._mindspace_view.file_edited.connect(self._on_mindspace_view_file_edited)\n        self._mindspace_view.file_opened_in_wiki.connect(self._on_mindspace_view_file_opened_in_wiki)\n        self._splitter.addWidget(self._mindspace_view)\n\n        # Create tab manager in splitter\n        self._column_manager = ColumnManager(self)\n        self._column_manager.tab_changed.connect(self._on_column_manager_tab_changed)\n        self._column_manager.fork_requested.connect(self._on_column_manager_fork_requested)\n        self._column_manager.fork_from_index_requested.connect(self._on_column_manager_fork_from_index_requested)\n        self._column_manager.open_wiki_link_requested.connect(self._on_column_manager_open_wiki_link_requested)\n        self._column_manager.edit_file_requested.connect(self._on_column_manager_edit_file_requested)\n        self._splitter.addWidget(self._column_manager)\n\n        # Set initial mindspace view width\n        self._splitter.setSizes([300, self.width() - 300])\n\n        # Set the stretch factors: 0 for mindspace view (no stretch) and 1 for column manager (stretch to fill)\n        self._splitter.setStretchFactor(0, 0)\n        self._splitter.setStretchFactor(1, 1)\n\n        self._style_manager = StyleManager()\n        self._style_manager.style_changed.connect(self._on_style_changed)\n\n        # Create a timer that fires every 50ms to keep our menu states correct\n        self._menu_timer = QTimer()\n        self._menu_timer.setInterval(50)\n        self._menu_timer.timeout.connect(self._update_menu_state)\n        self._menu_timer.start()\n\n        # Create status bar\n        self._status_bar = QStatusBar()\n        self._status_message_label = QLabel()\n        self._status_bar.addPermanentWidget(self._status_message_label)\n\n        self.setStatusBar(self._status_bar)\n        self._column_manager.status_message.connect(self._on_column_manager_status_message)\n\n        # Connect to exception notifier for canary functionality\n        self._canary_active = False\n        exception_notifier = get_exception_notifier()\n        exception_notifier.exception_occurred.connect(self._on_exception_occurred)\n\n        self._on_language_changed()\n\n        self._user_manager = UserManager()\n        user_settings = self._user_manager.settings()\n        self._style_manager.set_user_font_size(user_settings.font_size)\n        self._language_manager.set_language(user_settings.language)\n\n        # Set theme from user settings\n        self._style_manager.set_color_mode(user_settings.theme)\n        self._update_theme_menu()\n\n        self._mindspace_manager = MindspaceManager()\n\n        # Initialize command registry and register commands\n        self._command_registry = ShellCommandRegistry()\n        self._command_registry.register_command(ShellCommandClear(self._column_manager))\n        self._command_registry.register_command(ShellCommandConversation(self._column_manager))\n        self._command_registry.register_command(ShellCommandEdit(self._column_manager))\n        self._command_registry.register_command(ShellCommandLog(self._column_manager))\n        self._command_registry.register_command(ShellCommandM6rc(self._column_manager))\n        self._command_registry.register_command(ShellCommandTerminal(self._column_manager))\n        self._command_registry.register_command(ShellCommandWiki(self._column_manager))\n\n        # Register help command last so it can see all other commands\n        self._command_registry.register_command(ShellCommandHelp(self._command_registry))\n\n        self._ai_tool_manager = AIToolManager()\n        self._ai_tool_manager.register_tool(\n            CalculatorAITool(), \"Calculator: performs arithmetic, trigonometry, logarithms, and other calculations\"\n        )\n        self._ai_tool_manager.register_tool(ClockAITool(), \"Clock: gets the current time and date\")\n        self._ai_tool_manager.register_tool(\n            DelegateAITool(self._column_manager), \"Delegate: delegates tasks to specialized AI instances\"\n        )\n        self._ai_tool_manager.register_tool(\n            FileSystemAITool(self._resolve_mindspace_path), \"FileSystem: handles file operations in the current mindspace\"\n        )\n        self._ai_tool_manager.register_tool(SystemAITool(self._column_manager), \"System: implements UI automations within Humbug\")\n\n        QTimer.singleShot(0, self._restore_last_mindspace)\n\n    def changeEvent(self, event: QEvent) -> None:\n        \"\"\"Handle change events.\"\"\"\n        # If our window state changes then update the column manager's style\n        if event.type() == QEvent.Type.WindowStateChange:\n            self._column_manager.apply_style()\n\n        return super().changeEvent(event)\n\n    def _on_exception_occurred(self) -> None:\n        \"\"\"Handle uncaught exception notification by activating canary.\"\"\"\n        self._logger.debug(\"Uncaught exception detected, activating canary\")\n        self._canary_active = True\n        self._on_style_changed()  # Refresh styles to apply canary background\n\n    def _update_menu_state(self) -> None:\n        \"\"\"Update enabled/disabled state of menu items.\"\"\"\n        # Update mindspace-specific actions\n        has_mindspace = self._mindspace_manager.has_mindspace()\n        self._close_mindspace_action.setEnabled(has_mindspace)\n        self._new_conv_action.setEnabled(has_mindspace)\n        self._new_metaphor_conv_action.setEnabled(has_mindspace)\n        self._new_file_action.setEnabled(has_mindspace)\n        self._open_wiki_action.setEnabled(has_mindspace)\n        self._open_conv_action.setEnabled(has_mindspace)\n        self._open_file_action.setEnabled(has_mindspace)\n        self._new_terminal_action.setEnabled(has_mindspace)\n        self._mindspace_settings_action.setEnabled(has_mindspace)\n\n        # Update tab-specific actions\n        column_manager = self._column_manager\n        self._fork_conv_action.setEnabled(column_manager.can_fork_conversation())\n        self._save_action.setEnabled(column_manager.can_save_file())\n        self._save_as_action.setEnabled(column_manager.can_save_file_as())\n        self._close_tab_action.setEnabled(column_manager.can_close_tab())\n        self._undo_action.setEnabled(column_manager.can_undo())\n        self._redo_action.setEnabled(column_manager.can_redo())\n        self._cut_action.setEnabled(column_manager.can_cut())\n        self._copy_action.setEnabled(column_manager.can_copy())\n        self._paste_action.setEnabled(column_manager.can_paste())\n        self._find_action.setEnabled(column_manager.can_show_find())\n        self._submit_message_action.setEnabled(column_manager.can_submit_message())\n        self._conv_settings_action.setEnabled(column_manager.can_show_conversation_settings_dialog())\n\n        # Update view actions\n        current_zoom = self._style_manager.zoom_factor()\n        left_to_right = self._language_manager.left_to_right()\n        self._zoom_in_action.setEnabled(current_zoom < 2.0)\n        self._zoom_out_action.setEnabled(current_zoom > 0.5)\n        self._show_system_log_action.setEnabled(has_mindspace)\n        self._show_system_shell_action.setEnabled(has_mindspace)\n        self._show_all_columns_action.setEnabled(column_manager.can_show_all_columns())\n        self._split_column_left_action.setEnabled(column_manager.can_split_column())\n        self._split_column_right_action.setEnabled(column_manager.can_split_column())\n        self._merge_column_left_action.setEnabled(column_manager.can_merge_column(left_to_right))\n        self._merge_column_right_action.setEnabled(column_manager.can_merge_column(not left_to_right))\n        self._swap_column_left_action.setEnabled(column_manager.can_swap_column(left_to_right))\n        self._swap_column_right_action.setEnabled(column_manager.can_swap_column(not left_to_right))\n        self._next_message_action.setEnabled(column_manager.can_navigate_next_message())\n        self._previous_message_action.setEnabled(column_manager.can_navigate_previous_message())\n        self._toggle_bookmark_action.setEnabled(column_manager.can_toggle_bookmark())\n        self._next_bookmark_action.setEnabled(column_manager.can_navigate_next_bookmark())\n        self._previous_bookmark_action.setEnabled(column_manager.can_navigate_previous_bookmark())\n\n    def _on_language_changed(self) -> None:\n        \"\"\"Update UI text when language changes.\"\"\"\n        app = cast(QApplication, QApplication.instance())\n        left_to_right = self._language_manager.left_to_right()\n        if left_to_right:\n            app.setLayoutDirection(Qt.LayoutDirection.LeftToRight)\n\n        else:\n            app.setLayoutDirection(Qt.LayoutDirection.RightToLeft)\n\n        strings = self._language_manager.strings()\n\n        # Update menu titles\n        self._humbug_menu.setTitle(strings.humbug_menu)\n        self._edit_menu.setTitle(strings.edit_menu)\n        self._file_menu.setTitle(strings.file_menu)\n        self._view_menu.setTitle(strings.view_menu)\n\n        # Update action texts\n        self._about_action.setText(strings.about_humbug)\n        self._user_settings_action.setText(strings.user_settings)\n        self._quit_action.setText(strings.quit_humbug)\n        self._new_mindspace_action.setText(strings.new_mindspace)\n        self._new_conv_action.setText(strings.new_conversation)\n        self._new_metaphor_conv_action.setText(strings.new_metaphor_conversation)\n        self._new_file_action.setText(strings.new_file)\n        self._open_mindspace_action.setText(strings.open_mindspace)\n        self._open_wiki_action.setText(strings.open_wiki)\n        self._open_conv_action.setText(strings.open_conversation)\n        self._open_file_action.setText(strings.open_file)\n        self._fork_conv_action.setText(strings.fork_conversation)\n        self._save_action.setText(strings.save)\n        self._save_as_action.setText(strings.save_as)\n        self._close_tab_action.setText(strings.close_tab)\n        self._close_mindspace_action.setText(strings.close_mindspace)\n        self._submit_message_action.setText(strings.submit_message)\n        self._undo_action.setText(strings.undo)\n        self._redo_action.setText(strings.redo)\n        self._cut_action.setText(strings.cut)\n        self._copy_action.setText(strings.copy)\n        self._paste_action.setText(strings.paste)\n        self._find_action.setText(strings.find)\n        self._mindspace_settings_action.setText(strings.mindspace_settings)\n        self._conv_settings_action.setText(strings.conversation_settings)\n\n        # Recreate the theme menu with updated language strings\n        if self._theme_menu is not None:\n            self._view_menu.removeAction(self._theme_menu.menuAction())\n\n        self._theme_menu = self._create_theme_menu()\n        self._view_menu.insertMenu(self._zoom_in_action, self._theme_menu)\n\n        self._zoom_in_action.setText(strings.zoom_in)\n        self._zoom_out_action.setText(strings.zoom_out)\n        self._reset_zoom_action.setText(strings.reset_zoom)\n        self._show_system_shell_action.setText(strings.show_system_shell)\n        self._show_all_columns_action.setText(strings.show_all_columns)\n        self._split_column_left_action.setText(strings.split_column_left)\n        self._split_column_right_action.setText(strings.split_column_right)\n        self._merge_column_left_action.setText(strings.merge_column_left)\n        self._merge_column_right_action.setText(strings.merge_column_right)\n        self._swap_column_left_action.setText(strings.swap_column_left)\n        self._swap_column_right_action.setText(strings.swap_column_right)\n        self._next_message_action.setText(strings.next_message)\n        self._previous_message_action.setText(strings.previous_message)\n        self._toggle_bookmark_action.setText(strings.bookmark_section)\n        self._next_bookmark_action.setText(strings.next_bookmark)\n        self._previous_bookmark_action.setText(strings.previous_bookmark)\n\n        # Our logic for left and right reverses for right-to-left languages\n        left_to_right = self._language_manager.left_to_right()\n        self._split_column_left_action.triggered.disconnect()\n        self._split_column_left_action.triggered.connect(lambda: self._split_column(left_to_right))\n        self._split_column_right_action.triggered.disconnect()\n        self._split_column_right_action.triggered.connect(lambda: self._split_column(not left_to_right))\n        self._merge_column_left_action.triggered.disconnect()\n        self._merge_column_left_action.triggered.connect(lambda: self._merge_column(left_to_right))\n        self._merge_column_right_action.triggered.disconnect()\n        self._merge_column_right_action.triggered.connect(lambda: self._merge_column(not left_to_right))\n        self._swap_column_left_action.triggered.disconnect()\n        self._swap_column_left_action.triggered.connect(lambda: self._swap_column(left_to_right))\n        self._swap_column_right_action.triggered.disconnect()\n        self._swap_column_right_action.triggered.connect(lambda: self._swap_column(not left_to_right))\n\n        self._on_style_changed()\n\n    def _create_theme_menu(self) -> QMenu:\n        \"\"\"\n        Create a display theme submenu with available themes.\n\n        Returns:\n            QMenu: The theme submenu\n        \"\"\"\n        strings = self._language_manager.strings()\n\n        # Create the theme menu\n        theme_menu = QMenu(strings.display_theme, self)\n\n        # Create an action group so only one theme can be selected at a time\n        theme_action_group = QActionGroup(self)\n        theme_action_group.setExclusive(True)\n\n        # Create the theme actions dictionary to store references\n        self._theme_actions = {}\n\n        # Add Light theme action\n        light_action = QAction(strings.theme_light, self)\n        light_action.setCheckable(True)\n        light_action.setChecked(self._style_manager.color_mode() == ColorMode.LIGHT)\n        light_action.triggered.connect(lambda: self._set_color_mode(ColorMode.LIGHT))\n        theme_action_group.addAction(light_action)\n        theme_menu.addAction(light_action)\n        self._theme_actions[ColorMode.LIGHT] = light_action\n\n        # Add Dark theme action\n        dark_action = QAction(strings.theme_dark, self)\n        dark_action.setCheckable(True)\n        dark_action.setChecked(self._style_manager.color_mode() == ColorMode.DARK)\n        dark_action.triggered.connect(lambda: self._set_color_mode(ColorMode.DARK))\n        theme_action_group.addAction(dark_action)\n        theme_menu.addAction(dark_action)\n        self._theme_actions[ColorMode.DARK] = dark_action\n\n        return theme_menu\n\n    def _update_theme_menu(self) -> None:\n        \"\"\"Update the theme menu to reflect the current selected theme.\"\"\"\n        # Set the checked state for the appropriate theme action\n        for theme, action in self._theme_actions.items():\n            action.setChecked(theme == self._style_manager.color_mode())\n\n    def _set_color_mode(self, theme: ColorMode) -> None:\n        \"\"\"\n        Set the color mode (theme) for the application.\n\n        Args:\n            theme: The new theme to apply\n        \"\"\"\n        self._style_manager.set_color_mode(theme)\n\n    def _map_tab_to_mindspace_view(self, tab: TabBase) -> MindspaceViewType:\n        \"\"\"Map a tab to its corresponding mindspace view type.\"\"\"\n        if isinstance(tab, ConversationTab):\n            return MindspaceViewType.CONVERSATIONS\n\n        if isinstance(tab, WikiTab):\n            return MindspaceViewType.WIKI\n\n        return MindspaceViewType.FILES\n\n    def _on_column_manager_tab_changed(self) -> None:\n        \"\"\"Handle tab change events.\"\"\"\n        current_tab = self._column_manager.get_current_tab()\n        if current_tab is None:\n            return\n\n        path = current_tab.path()\n        if path is None:\n            return\n\n        view_type = self._map_tab_to_mindspace_view(current_tab)\n        self._mindspace_view.reveal_and_select_file(view_type, path)\n\n    def _on_column_manager_status_message(self, message: StatusMessage) -> None:\n        \"\"\"Update status bar with new message.\"\"\"\n        self._status_message_label.setText(message.text)\n        if message.timeout:\n            QTimer.singleShot(message.timeout, self._status_message_label.clear)\n\n    def _restore_last_mindspace(self) -> None:\n        \"\"\"Restore last mindspace on startup if available.\"\"\"\n        try:\n            with open(os.path.expanduser(\"~/.humbug/mindspace.json\"), encoding='utf-8') as f:\n                data = json.load(f)\n                mindspace_path = data.get(\"lastMindspace\")\n                if mindspace_path and os.path.exists(mindspace_path):\n                    try:\n                        self._mindspace_manager.open_mindspace(mindspace_path)\n                        self._mindspace_view.set_mindspace(mindspace_path)\n                        self._restore_mindspace_state()\n\n                    except MindspaceError as e:\n                        self._logger.error(\"Failed to restore mindspace: %s\", str(e))\n                        # Don't show error dialog on startup, just log it\n\n        except (FileNotFoundError, json.JSONDecodeError):\n            pass\n\n    def _new_mindspace(self) -> None:\n        \"\"\"Show folder selection dialog and create new mindspace.\"\"\"\n        self._menu_timer.stop()\n        strings = self._language_manager.strings()\n        dir_path = QFileDialog.getExistingDirectory(\n            self, strings.file_dialog_new_mindspace\n        )\n        self._menu_timer.start()\n        if not dir_path:\n            return\n\n        if self._mindspace_manager.is_already_mindspace(dir_path):\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.mindspace_exists_error\n            )\n            return\n\n        # Show folder configuration dialog\n        dialog = MindspaceFoldersDialog(dir_path, self)\n        if dialog.exec() != QDialog.DialogCode.Accepted:\n            return\n\n        try:\n            # Create mindspace with selected folders\n            self._mindspace_manager.create_mindspace(dir_path, dialog.get_selected_folders())\n\n        except MindspaceExistsError:\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.mindspace_exists_error\n            )\n            return\n\n        except MindspaceError as e:\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.error_creating_mindspace.format(str(e))\n            )\n            return\n\n        self._open_mindspace_path(dir_path)\n\n    def _open_mindspace(self) -> None:\n        \"\"\"Open a new mindspace.\"\"\"\n        self._menu_timer.stop()\n        strings = self._language_manager.strings()\n        dir_path = QFileDialog.getExistingDirectory(self, strings.file_dialog_open_mindspace)\n        self._menu_timer.start()\n        if not dir_path:\n            return\n\n        self._open_mindspace_path(dir_path)\n\n    def _open_mindspace_path(self, path: str) -> None:\n        # Before we do anything, check if the new location is a mindspace\n        if not self._mindspace_manager.check_mindspace(path):\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.error_opening_mindspace.format(path)\n            )\n            return\n\n        # If we're switching mindspaces, save the current one first\n        if self._mindspace_manager.has_mindspace():\n            self._save_mindspace_state()\n            if not self._close_all_tabs():\n                return\n\n            self._mindspace_manager.close_mindspace()\n\n        # Open the new mindspace\n        try:\n            self._mindspace_manager.open_mindspace(path)\n            self._mindspace_view.set_mindspace(path)\n\n        except MindspaceError as e:\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.error_opening_mindspace.format(str(e))\n            )\n            return\n\n        # Restore the state of the newly opened mindspace\n        self._restore_mindspace_state()\n\n    def _close_mindspace(self) -> None:\n        if not self._mindspace_manager.has_mindspace():\n            self._logger.error(\"No mindspace active, cannot close\")\n            return\n\n        self._save_mindspace_state()\n        if not self._close_all_tabs():\n            return\n\n        self._mindspace_view.set_mindspace(\"\")\n        self._mindspace_manager.close_mindspace()\n\n    def _save_mindspace_state(self) -> None:\n        \"\"\"Save current mindspace state.\"\"\"\n        if not self._mindspace_manager.has_mindspace():\n            self._logger.error(\"No mindspace active, cannot save\")\n            return\n\n        try:\n            mindspace_state = self._column_manager.save_state()\n            self._mindspace_manager.save_mindspace_state(mindspace_state)\n\n        except MindspaceError as e:\n            self._logger.error(\"Failed to save mindspace state: %s\", str(e))\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.error_saving_mindspace.format(str(e))\n            )\n\n    def _restore_mindspace_state(self) -> None:\n        \"\"\"Restore previously open tabs from mindspace state.\"\"\"\n        saved_state = self._mindspace_manager.load_mindspace_state()\n        if not saved_state:\n            self._logger.debug(\"No saved states found\")\n            return\n\n        try:\n            self._column_manager.restore_state(saved_state)\n\n        except MindspaceError as e:\n            self._logger.error(\"Failed to restore mindspace state: %s\", str(e))\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.error_restoring_mindspace.format(str(e))\n            )\n\n    def _close_all_tabs(self) -> bool:\n        return self._column_manager.close_all_tabs()\n\n    def _undo(self) -> None:\n        self._column_manager.undo()\n\n    def _redo(self) -> None:\n        self._column_manager.redo()\n\n    def _cut(self) -> None:\n        self._column_manager.cut()\n\n    def _copy(self) -> None:\n        self._column_manager.copy()\n\n    def _paste(self) -> None:\n        self._column_manager.paste()\n\n    def _find(self) -> None:\n        self._column_manager.show_find()\n\n    def _show_about_dialog(self) -> None:\n        \"\"\"Show the About dialog.\"\"\"\n        dialog = AboutDialog(self)\n        dialog.exec()\n\n    def _new_terminal(self) -> None:\n        \"\"\"Create a new terminal tab.\"\"\"\n        if not self._mindspace_manager.has_mindspace():\n            return\n\n        self._column_manager.new_terminal()\n\n    def _new_file(self) -> None:\n        \"\"\"Create a new empty editor tab.\"\"\"\n        if not self._mindspace_manager.has_mindspace():\n            return\n\n        self._column_manager.new_file()\n\n    def _on_mindspace_view_file_opened_in_wiki(self, path: str, ephemeral: bool) -> None:\n        \"\"\"Handle click of a wiki link from the mindspace view.\"\"\"\n        wiki_tab = self._column_manager.open_wiki_page(path, ephemeral)\n        if wiki_tab is None:\n            return\n\n        self._mindspace_manager.add_interaction(\n            MindspaceLogLevel.INFO,\n            f\"User opened wiki: '{path}'\\ntab ID: {wiki_tab.tab_id()}\"\n        )\n\n    def _on_mindspace_view_file_clicked(self, source: MindspaceViewType, path: str, ephemeral: bool) -> None:\n        \"\"\"Handle click of a file from the mindspace view.\"\"\"\n        self._column_manager.open_file_by_mindspace_view_type(source, path, ephemeral)\n\n    def _on_mindspace_view_file_deleted(self, path: str) -> None:\n        \"\"\"Handle deletion of a file by closing any open tab.\n\n        Args:\n            path: Path of file being deleted\n        \"\"\"\n        self._column_manager.close_deleted_file(path)\n\n    def _on_mindspace_view_file_renamed(self, old_path: str, new_path: str) -> None:\n        \"\"\"Handle renaming of files.\n\n        Args:\n            old_path: Original path of renamed file\n            new_path: New path after renaming\n        \"\"\"\n        self._column_manager.handle_file_rename(old_path, new_path)\n\n    def _on_mindspace_view_file_edited(self, path: str, ephemeral: bool) -> None:\n        \"\"\"Handle file edited event from the mindspace view.\"\"\"\n        self._open_file_path(path, ephemeral)\n\n    def _open_file(self) -> None:\n        \"\"\"Show open file dialog and create editor tab.\"\"\"\n        self._menu_timer.stop()\n        strings = self._language_manager.strings()\n        file_path, _ = QFileDialog.getOpenFileName(\n            self,\n            strings.file_dialog_open_file,\n            self._mindspace_manager.file_dialog_directory()\n        )\n        self._menu_timer.start()\n\n        if not file_path:\n            return\n\n        self._mindspace_manager.update_file_dialog_directory(file_path)\n        self._open_file_path(file_path, False)\n\n    def _open_file_path(self, path: str, ephemeral: bool) -> None:\n        \"\"\"Open file in editor tab.\"\"\"\n        try:\n            editor_tab = self._column_manager.open_file(path, ephemeral)\n\n            self._mindspace_manager.add_interaction(\n                MindspaceLogLevel.INFO,\n                f\"User opened editor for file: '{path}'\\nTab ID: {editor_tab.tab_id()}\"\n            )\n\n        except OSError as e:\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.error_opening_file_title,\n                strings.could_not_open.format(path, str(e))\n            )\n\n    def _save_file(self) -> None:\n        \"\"\"Save the current file.\"\"\"\n        path = self._column_manager.save_file()\n        self._mindspace_view.reveal_and_select_file(MindspaceViewType.FILES, path)\n\n    def _save_file_as(self) -> None:\n        \"\"\"Save the current file with a new name.\"\"\"\n        path = self._column_manager.save_file_as()\n        self._mindspace_view.reveal_and_select_file(MindspaceViewType.FILES, path)\n\n    def _open_wiki(self) -> None:\n        \"\"\"Open the wiki page in a new tab.\"\"\"\n        self._column_manager.open_wiki_page(self._mindspace_manager.get_absolute_path(\".\"), False)\n\n    def _show_system_log(self) -> None:\n        \"\"\"Show the log tab.\"\"\"\n        self._column_manager.show_system_log()\n\n    def _show_system_shell(self) -> None:\n        \"\"\"Show the shell tab.\"\"\"\n        self._column_manager.show_system_shell()\n\n    def _show_all_columns(self) -> None:\n        \"\"\"Show all columns equally.\"\"\"\n        self._column_manager.show_all_columns()\n\n    def _split_column(self, split_left: bool) -> None:\n        \"\"\"Split the current column.\"\"\"\n        self._column_manager.split_column(split_left)\n\n    def _merge_column(self, merge_left: bool) -> None:\n        \"\"\"Merge the current column.\"\"\"\n        self._column_manager.merge_column(merge_left)\n\n    def _swap_column(self, swap_left: bool) -> None:\n        \"\"\"Swap the current column.\"\"\"\n        self._column_manager.swap_column(swap_left)\n\n    def _on_style_changed(self) -> None:\n        style_manager = self._style_manager\n        zoom_factor = style_manager.zoom_factor()\n        base_font_size = style_manager.base_font_size()\n\n        # Determine status bar background color based on canary state\n        status_bg_color = (\n            style_manager.get_color_str(ColorRole.CANARY_BACKGROUND)\n            if self._canary_active\n            else style_manager.get_color_str(ColorRole.STATUS_BAR_BACKGROUND)\n        )\n\n        self.setStyleSheet(f\"\"\"\n            QMainWindow {{\n                background-color: {style_manager.get_color_str(ColorRole.BACKGROUND_PRIMARY)};\n                color: {style_manager.get_color_str(ColorRole.TEXT_PRIMARY)};\n            }}\n\n            QMenuBar {{\n                background-color: {style_manager.get_color_str(ColorRole.MENU_BACKGROUND)};\n                padding: 4px;\n                font-size: {base_font_size}pt;\n            }}\n            QMenuBar::item {{\n                background-color: transparent;\n                color: {style_manager.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border-radius: 4px;\n                padding: 4px 8px 4px 8px;\n            }}\n            QMenuBar::item:selected {{\n                background-color: {style_manager.get_color_str(ColorRole.MENU_HOVER)};\n            }}\n\n            QMenu {{\n                background-color: {style_manager.get_color_str(ColorRole.MENU_BACKGROUND)};\n                color: {style_manager.get_color_str(ColorRole.TEXT_PRIMARY)};\n                border-color: {style_manager.get_color_str(ColorRole.MENU_BORDER)};\n                border-width: 1px;\n                border-style: solid;\n                border-radius: 8px;\n                margin: 0px;\n            }}\n            QMenu::item {{\n                margin: 2px;\n                padding: 4px 8px 4px 8px;\n                border-radius: 4px;\n            }}\n            QMenu::item:disabled {{\n                color: {style_manager.get_color_str(ColorRole.TEXT_DISABLED)};\n            }}\n            QMenu::item:selected {{\n                background-color: {style_manager.get_color_str(ColorRole.MENU_HOVER)}\n            }}\n\n            QStatusBar {{\n                background-color: {status_bg_color};\n                color: {self._style_manager.get_color_str(ColorRole.TEXT_PRIMARY)};\n                padding: {2 * zoom_factor}px;\n                border-top: 1px solid {self._style_manager.get_color_str(ColorRole.SPLITTER)};\n            }}\n            QStatusBar::item {{\n                border: 0;\n                padding: 0;\n            }}\n\n            QStatusBar QLabel {{\n                color: {self._style_manager.get_color_str(ColorRole.TEXT_PRIMARY)};\n                padding: 0;\n            }}\n\n            QSplitter::handle {{\n                background-color: {style_manager.get_color_str(ColorRole.SPLITTER)};\n                margin: 0;\n                width: 1px;\n            }}\n        \"\"\")\n\n        # Update status bar font\n        status_font = self.font()\n        status_font.setPointSizeF(base_font_size * zoom_factor)\n        self._status_bar.setFont(status_font)\n        self._status_message_label.setFont(status_font)\n\n        # Apply styles to the mindspace view and column manager\n        self._mindspace_view.apply_style()\n        self._column_manager.apply_style()\n\n    def _new_conversation(self) -> ConversationTab | None:\n        \"\"\"Create new conversation tab.\"\"\"\n        if not self._mindspace_manager.has_mindspace():\n            return None\n\n        try:\n            self._mindspace_manager.ensure_mindspace_dir(\"conversations\")\n            conversation_tab = self._column_manager.new_conversation()\n\n        except MindspaceError as e:\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.mindspace_error_title,\n                strings.error_opening_conversation.format(str(e))\n            )\n            self._mindspace_manager.add_interaction(\n                MindspaceLogLevel.ERROR,\n                f\"User failed to create new conversation: {str(e)}\"\n            )\n            return None\n\n        self._mindspace_manager.add_interaction(\n            MindspaceLogLevel.INFO,\n            f\"User created new conversation\\ntab ID: {conversation_tab.tab_id()}\"\n        )\n        return conversation_tab\n\n    def _get_canonical_mindspace_path(self, path: str) -> str | None:\n        \"\"\"Get the canonical path of the current mindspace.\"\"\"\n        if not self._mindspace_manager.has_mindspace():\n            return None\n\n        # Get the absolute path of the current mindspace\n        return self._mindspace_manager.get_relative_path(path)\n\n    def _resolve_mindspace_path(self, path: str) -> Tuple[Path, str]:\n        # Check if our path starts with a separator.  If it does we'll assume it's for the root of the mindspace.\n        if path.startswith(os.sep):\n            path = path[1:]\n\n        # Convert to absolute path via mindspace manager\n        abs_path = self._mindspace_manager.get_absolute_path(path)\n        resolved_path = Path(abs_path).resolve()\n\n        # Verify the resolved path is still within mindspace\n        relative_path = self._mindspace_manager.get_mindspace_relative_path(str(resolved_path))\n        if relative_path is None:\n            raise ValueError(f\"Path is outside mindspace boundaries: {path}\")\n\n        return resolved_path, relative_path\n\n    def _new_metaphor_conversation(self) -> None:\n        \"\"\"Create new conversation from Metaphor file.\"\"\"\n        # Show file dialog\n        self._menu_timer.stop()\n        strings = self._language_manager.strings()\n        file_path, _ = QFileDialog.getOpenFileName(\n            self,\n            strings.file_dialog_open_metaphor,\n            self._mindspace_manager.file_dialog_directory(),\n            f\"{strings.file_filter_metaphor};;{strings.file_filter_all}\"\n        )\n        self._menu_timer.start()\n\n        if not file_path:\n            return\n\n        self._mindspace_manager.update_file_dialog_directory(file_path)\n        search_path = self._mindspace_manager.mindspace_path()\n\n        metaphor_ast_builder = MetaphorASTBuilder(self._get_canonical_mindspace_path)\n        try:\n            syntax_tree = MetaphorASTRootNode()\n            metaphor_ast_builder.build_ast_from_file(syntax_tree, file_path, [search_path], search_path, [file_path])\n            formatter = MetaphorFormatVisitor()\n            prompt = format_preamble() + formatter.format(syntax_tree)\n\n        except MetaphorASTBuilderError as e:\n            self._column_manager.show_system_shell()\n            error = f\"Metaphor compiler error prevented new Metaphor conversation:\\n\\n{format_errors(e.errors)}\"\n            self._mindspace_manager.add_interaction(MindspaceLogLevel.WARN, error)\n            self._column_manager.show_system_log()\n            return\n\n        conversation_tab = self._new_conversation()\n        if conversation_tab is None:\n            return\n\n        # Set input text\n        conversation_tab.set_input_text(prompt)\n\n    def _open_conversation(self) -> None:\n        \"\"\"Show open conversation dialog and create conversation tab.\"\"\"\n        self._menu_timer.stop()\n        strings = self._language_manager.strings()\n        file_path, _ = QFileDialog.getOpenFileName(\n            self,\n            strings.file_dialog_open_conversation,\n            self._mindspace_manager.conversations_directory(),\n            f\"{strings.file_filter_conversation};;{strings.file_filter_all}\"\n        )\n        self._menu_timer.start()\n\n        if not file_path:\n            return\n\n        self._mindspace_manager.update_conversations_directory(file_path)\n        self._open_conversation_path(file_path, False)\n\n    def _open_conversation_path(self, path: str, ephemeral: bool) -> ConversationTab | None:\n        \"\"\"Open an existing conversation file.\"\"\"\n        try:\n            tab = self._column_manager.open_conversation(path, ephemeral)\n            return tab\n\n        except ConversationError as e:\n            self._logger.error(\"Error opening conversation: %s: %s\", path, str(e))\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.conversation_error_title,\n                strings.error_opening_conversation.format(path, str(e))\n            )\n            return None\n\n    def _fork_conversation(self) -> None:\n        \"\"\"Create a new conversation tab with the history of the current conversation.\"\"\"\n        # Create task to fork conversation\n        try:\n            self._column_manager.fork_conversation_from_index(None)\n\n        except ConversationError as e:\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.conversation_error_title,\n                strings.error_forking_conversation.format(str(e))\n            )\n\n    def _on_column_manager_fork_requested(self) -> None:\n        \"\"\"Handle fork conversation requests.\"\"\"\n        self._fork_conversation()\n\n    def _on_column_manager_fork_from_index_requested(self, index: int) -> None:\n        \"\"\"Handle fork conversation requests from a specific index.\"\"\"\n        try:\n            self._column_manager.fork_conversation_from_index(index)\n\n        except ConversationError as e:\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.conversation_error_title,\n                strings.error_forking_conversation.format(str(e))\n            )\n\n    def _on_column_manager_open_wiki_link_requested(self, path: str) -> None:\n        \"\"\"Handle requests to open a wiki page.\"\"\"\n        try:\n            self._column_manager.open_wiki_page(path, True)\n\n        except WikiError as e:\n            self._logger.info(\"Error opening wiki page: %s: %s\", path, str(e))\n            strings = self._language_manager.strings()\n            MessageBox.show_message(\n                self,\n                MessageBoxType.CRITICAL,\n                strings.wiki_error_title,\n                strings.could_not_open.format(path, str(e))\n            )\n\n    def _on_column_manager_edit_file_requested(self, path: str) -> None:\n        \"\"\"Handle requests to open a file in the editor.\"\"\"\n        self._open_file_path(path, False)\n\n    def _close_tab(self) -> None:\n        \"\"\"Close the current tab.\"\"\"\n        tab = self._column_manager.get_current_tab()\n        if tab is None:\n            self._logger.error(\"No current tab to close\")\n            return\n\n        self._column_manager.close_tab()\n        self._mindspace_manager.add_interaction(\n            MindspaceLogLevel.INFO,\n            f\"User closed tab\\nTab ID: {tab.tab_id()}\"\n        )\n\n    def _submit_message(self) -> None:\n        \"\"\"Handle message submission.\"\"\"\n        self._column_manager.submit_message()\n\n    def _navigate_next_message(self) -> None:\n        \"\"\"Navigate to the next message in conversation.\"\"\"\n        self._column_manager.navigate_next_message()\n\n    def _navigate_previous_message(self) -> None:\n        \"\"\"Navigate to the previous message in conversation.\"\"\"\n        self._column_manager.navigate_previous_message()\n\n    def _toggle_bookmark(self) -> None:\n        \"\"\"Handle toggling a bookmark.\"\"\"\n        self._column_manager.toggle_bookmark()\n\n    def _navigate_next_bookmark(self) -> None:\n        \"\"\"Move to the next bookmark.\"\"\"\n        self._column_manager.navigate_next_bookmark()\n\n    def _navigate_previous_bookmark(self) -> None:\n        \"\"\"Move to the previous bookmark.\"\"\"\n        self._column_manager.navigate_previous_bookmark()\n\n    def _show_user_settings_dialog(self) -> None:\n        \"\"\"Show the user settings dialog.\"\"\"\n        dialog = UserSettingsDialog(self)\n        dialog.set_settings(self._user_manager.settings())\n\n        def _on_settings_changed(new_settings: UserSettings) -> None:\n            try:\n                self._user_manager.update_settings(new_settings)\n                self._style_manager.set_user_font_size(new_settings.font_size)\n                self._language_manager.set_language(new_settings.language)\n\n                # Update theme from settings if it changed\n                new_theme = new_settings.theme\n                if new_theme != self._style_manager.color_mode():\n                    self._style_manager.set_color_mode(new_theme)\n                    self._update_theme_menu()\n\n                self._logger.info(\"User settings saved successfully\")\n\n            except UserError as e:\n                self._logger.error(\"Failed to save user settings: %s\", str(e))\n                strings = self._language_manager.strings()\n                MessageBox.show_message(\n                    self,\n                    MessageBoxType.CRITICAL,\n                    strings.settings_error_title,\n                    strings.error_saving_user_settings.format(str(e))\n                )\n\n        dialog.settings_changed.connect(_on_settings_changed)\n        dialog.exec()\n\n    def _show_mindspace_settings_dialog(self) -> None:\n        \"\"\"Show the mindspace settings dialog.\"\"\"\n        if not self._mindspace_manager.has_mindspace():\n            return\n\n        settings = cast(MindspaceSettings, self._mindspace_manager.settings())\n        dialog = MindspaceSettingsDialog(self)\n        dialog.set_settings(settings)\n\n        def _on_settings_changed(new_settings: MindspaceSettings) -> None:\n            try:\n                self._mindspace_manager.update_settings(new_settings)\n\n            except OSError as e:\n                self._logger.error(\"Failed to save mindspace settings: %s\", str(e))\n                strings = self._language_manager.strings()\n                MessageBox.show_message(\n                    self,\n                    MessageBoxType.CRITICAL,\n                    strings.settings_error_title,\n                    strings.error_saving_mindspace_settings.format(str(e))\n                )\n\n        dialog.settings_changed.connect(_on_settings_changed)\n        dialog.exec()\n\n    def _show_conversation_settings_dialog(self) -> None:\n        \"\"\"Show the conversation settings dialog.\"\"\"\n        self._column_manager.show_conversation_settings_dialog()\n\n    def keyPressEvent(self, event: QKeyEvent) -> None:\n        \"\"\"Handle global key events.\"\"\"\n        if event.key() == Qt.Key.Key_Escape:\n            if self._column_manager.handle_esc_key():\n                return\n\n        super().keyPressEvent(event)\n\n    def _handle_zoom(self, factor: float) -> None:\n        \"\"\"Handle zoom in/out requests.\"\"\"\n        new_zoom = self._style_manager.zoom_factor() * factor\n        self._set_zoom(new_zoom)\n\n    def _set_zoom(self, zoom_level: float) -> None:\n        \"\"\"Set zoom level for the application.\"\"\"\n        self._style_manager.set_zoom(zoom_level)\n\n    def closeEvent(self, event: QEvent) -> None:\n        \"\"\"Handle application close request.\"\"\"\n        self._save_mindspace_state()\n        if not self._close_all_tabs():\n            event.ignore()\n            return\n\n        event.accept()"
          }
        }
      ]
    },
    {
      "id": "5397458f-bc75-4a59-bca2-347aa8a40544",
      "timestamp": "2025-08-29T20:21:55.902491+00:00",
      "type": "tool_result",
      "content": "```json\n{\n    \"id\": \"toolu_016RQWfX9P8iTgZZp6iQNEHs\",\n    \"name\": \"filesystem\",\n    \"content\": \"File written successfully: src/humbug/main_window.py (60,154 bytes)\",\n    \"error\": null\n}\n```",
      "completed": true,
      "tool_results": [
        {
          "id": "toolu_016RQWfX9P8iTgZZp6iQNEHs",
          "name": "filesystem",
          "content": "File written successfully: src/humbug/main_window.py (60,154 bytes)",
          "error": null
        }
      ]
    },
    {
      "id": "540a6e9a-8dbe-4d3a-82ee-65bf7812a12d",
      "timestamp": "2025-08-29T20:21:55.913050+00:00",
      "type": "user_message",
      "content": "",
      "completed": true,
      "tool_results": [
        {
          "id": "toolu_016RQWfX9P8iTgZZp6iQNEHs",
          "name": "filesystem",
          "content": "File written successfully: src/humbug/main_window.py (60,154 bytes)",
          "error": null
        }
      ]
    },
    {
      "id": "bc1cb6de-2c21-46ce-aba8-416461b41b65",
      "timestamp": "2025-08-29T20:21:59.392015+00:00",
      "type": "ai_response",
      "content": "Finally, I need to update the global exception handler in `__main__.py` to use the exception notifier:",
      "completed": true,
      "usage": {
        "prompt_tokens": 87461,
        "completion_tokens": 1410,
        "total_tokens": 88871
      },
      "model": "claude-sonnet-4-20250514",
      "reasoning_capability": 1,
      "temperature": 0.7,
      "tool_calls": [
        {
          "id": "toolu_01VbuspYsoEm43agkfo79twM",
          "name": "filesystem",
          "arguments": {
            "operation": "write_file",
            "path": "src/humbug/__main__.py",
            "content": "\"\"\"Main entry point for the Humbug application.\"\"\"\n\nimport asyncio\nfrom datetime import datetime, timezone\nimport glob\nimport logging\nfrom logging.handlers import RotatingFileHandler\nimport os\nimport sys\nimport time\nfrom types import TracebackType\nfrom typing import List\n\nfrom PySide6.QtCore import QObject, QEvent\nfrom qasync import QEventLoop, QApplication  # type: ignore[import-untyped]\n\n# pylint: disable=unused-import\nimport syntax.parser_imports\n# pylint: enable=unused-import\n\nfrom humbug.exception_notifier import get_exception_notifier\nfrom humbug.main_window import MainWindow\n\n\ndef setup_logging() -> None:\n    \"\"\"Configure application logging with timestamped files and rotation.\"\"\"\n    # Create logs directory in user's home .humbug directory\n    log_dir = os.path.expanduser(\"~/.humbug/logs\")\n    os.makedirs(log_dir, exist_ok=True)\n\n    # Generate timestamp for log filename\n    timestamp = datetime.now(timezone.utc).strftime(\"%Y-%m-%d-%H-%M-%S-%f\")[:23]\n    log_file = os.path.join(log_dir, f\"{timestamp}.log\")\n\n    # Configure rotating file handler\n    # Keep up to 50 log files, max 1MB each\n    handler = RotatingFileHandler(\n        log_file,\n        maxBytes=1024*1024,  # 1MB\n        backupCount=49,  # Keep 50 files total (current + 49 backups)\n        encoding='utf-8'\n    )\n\n    # Configure logging\n    logging.basicConfig(\n        level=logging.DEBUG,\n        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',\n        handlers=[handler]\n    )\n\n    # Clean up old logs if we have too many\n    cleanup_old_logs(log_dir, max_logs=50)\n\n\ndef cleanup_old_logs(log_dir: str, max_logs: int) -> None:\n    \"\"\"Remove oldest log files if we exceed maximum count.\"\"\"\n    log_files = glob.glob(os.path.join(log_dir, \"*.log*\"))\n    log_files.sort(key=os.path.getctime)  # Sort by creation time\n\n    # Remove oldest files if we have too many\n    while len(log_files) > max_logs:\n        try:\n            os.remove(log_files.pop(0))  # Remove oldest file\n\n        except OSError:\n            pass  # Ignore errors removing old logs\n\n\ndef install_global_exception_handler() -> None:\n    \"\"\"Install a global exception handler for uncaught exceptions.\"\"\"\n    logger = logging.getLogger('GlobalExceptionHandler')\n\n    def handle_exception(exc_type: type[BaseException], exc_value: BaseException, exc_traceback: TracebackType | None) -> None:\n        \"\"\"Handle uncaught exceptions and log them.\"\"\"\n        if issubclass(exc_type, KeyboardInterrupt):\n            # Don't log keyboard interrupt\n            sys.__excepthook__(exc_type, exc_value, exc_traceback)\n            return\n\n        logger.critical(\n            \"Uncaught exception\",\n            exc_info=(exc_type, exc_value, exc_traceback),\n            stack_info=True\n        )\n\n        # Notify the UI about the uncaught exception\n        try:\n            exception_notifier = get_exception_notifier()\n            exception_notifier.notify_exception()\n\n        except Exception:\n            # If notifying the UI fails, don't let that crash the exception handler\n            logger.error(\"Failed to notify UI of uncaught exception\", exc_info=True)\n\n    sys.excepthook = handle_exception\n\n\nclass HumbugApplication(QApplication):\n    \"\"\"Class for the application. Specialized to do event time reporting.\"\"\"\n    def __init__(self, argv: List[str]) -> None:\n        super().__init__(argv)\n        self._start_time = time.monotonic()\n\n    def notify(self, arg__1: QObject, arg__2: QEvent) -> bool:\n        event_type = arg__2.type()\n        receiver_name = arg__1.objectName()\n        start = time.monotonic()\n        ret = super().notify(arg__1, arg__2)\n        end = time.monotonic()\n        elapsed_time = (end - start) * 1000\n        if elapsed_time > 20:\n            rel_end = end - self._start_time\n            print(f\"{rel_end:.3f}: event {arg__2}, type {event_type}, object {receiver_name}, took {elapsed_time:.3f} msec\")\n\n        return ret\n\n\ndef main() -> int:\n    \"\"\"Main function to run the application.\"\"\"\n    setup_logging()\n    install_global_exception_handler()\n\n    # Create application\n    app = HumbugApplication(sys.argv)\n\n    # Create and set event loop\n    loop = QEventLoop(app)\n    asyncio.set_event_loop(loop)\n\n    window = MainWindow()\n    window.show()\n\n    # Run the main function\n    try:\n        with loop:\n            loop.run_forever()\n\n    except KeyboardInterrupt:\n        return 0\n\n    return 0\n\nif __name__ == \"__main__\":\n    sys.exit(main())"
          }
        }
      ]
    },
    {
      "id": "f6ed5164-491c-4ec1-b72b-8056b68fa13b",
      "timestamp": "2025-08-29T20:22:20.572818+00:00",
      "type": "tool_call",
      "content": "```json\n{\n    \"id\": \"toolu_01VbuspYsoEm43agkfo79twM\",\n    \"name\": \"filesystem\",\n    \"arguments\": {\n        \"operation\": \"write_file\",\n        \"path\": \"src/humbug/__main__.py\",\n        \"content\": \"\\\"\\\"\\\"Main entry point for the Humbug application.\\\"\\\"\\\"\\n\\nimport asyncio\\nfrom datetime import datetime, timezone\\nimport glob\\nimport logging\\nfrom logging.handlers import RotatingFileHandler\\nimport os\\nimport sys\\nimport time\\nfrom types import TracebackType\\nfrom typing import List\\n\\nfrom PySide6.QtCore import QObject, QEvent\\nfrom qasync import QEventLoop, QApplication  # type: ignore[import-untyped]\\n\\n# pylint: disable=unused-import\\nimport syntax.parser_imports\\n# pylint: enable=unused-import\\n\\nfrom humbug.exception_notifier import get_exception_notifier\\nfrom humbug.main_window import MainWindow\\n\\n\\ndef setup_logging() -> None:\\n    \\\"\\\"\\\"Configure application logging with timestamped files and rotation.\\\"\\\"\\\"\\n    # Create logs directory in user's home .humbug directory\\n    log_dir = os.path.expanduser(\\\"~/.humbug/logs\\\")\\n    os.makedirs(log_dir, exist_ok=True)\\n\\n    # Generate timestamp for log filename\\n    timestamp = datetime.now(timezone.utc).strftime(\\\"%Y-%m-%d-%H-%M-%S-%f\\\")[:23]\\n    log_file = os.path.join(log_dir, f\\\"{timestamp}.log\\\")\\n\\n    # Configure rotating file handler\\n    # Keep up to 50 log files, max 1MB each\\n    handler = RotatingFileHandler(\\n        log_file,\\n        maxBytes=1024*1024,  # 1MB\\n        backupCount=49,  # Keep 50 files total (current + 49 backups)\\n        encoding='utf-8'\\n    )\\n\\n    # Configure logging\\n    logging.basicConfig(\\n        level=logging.DEBUG,\\n        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',\\n        handlers=[handler]\\n    )\\n\\n    # Clean up old logs if we have too many\\n    cleanup_old_logs(log_dir, max_logs=50)\\n\\n\\ndef cleanup_old_logs(log_dir: str, max_logs: int) -> None:\\n    \\\"\\\"\\\"Remove oldest log files if we exceed maximum count.\\\"\\\"\\\"\\n    log_files = glob.glob(os.path.join(log_dir, \\\"*.log*\\\"))\\n    log_files.sort(key=os.path.getctime)  # Sort by creation time\\n\\n    # Remove oldest files if we have too many\\n    while len(log_files) > max_logs:\\n        try:\\n            os.remove(log_files.pop(0))  # Remove oldest file\\n\\n        except OSError:\\n            pass  # Ignore errors removing old logs\\n\\n\\ndef install_global_exception_handler() -> None:\\n    \\\"\\\"\\\"Install a global exception handler for uncaught exceptions.\\\"\\\"\\\"\\n    logger = logging.getLogger('GlobalExceptionHandler')\\n\\n    def handle_exception(exc_type: type[BaseException], exc_value: BaseException, exc_traceback: TracebackType | None) -> None:\\n        \\\"\\\"\\\"Handle uncaught exceptions and log them.\\\"\\\"\\\"\\n        if issubclass(exc_type, KeyboardInterrupt):\\n            # Don't log keyboard interrupt\\n            sys.__excepthook__(exc_type, exc_value, exc_traceback)\\n            return\\n\\n        logger.critical(\\n            \\\"Uncaught exception\\\",\\n            exc_info=(exc_type, exc_value, exc_traceback),\\n            stack_info=True\\n        )\\n\\n        # Notify the UI about the uncaught exception\\n        try:\\n            exception_notifier = get_exception_notifier()\\n            exception_notifier.notify_exception()\\n\\n        except Exception:\\n            # If notifying the UI fails, don't let that crash the exception handler\\n            logger.error(\\\"Failed to notify UI of uncaught exception\\\", exc_info=True)\\n\\n    sys.excepthook = handle_exception\\n\\n\\nclass HumbugApplication(QApplication):\\n    \\\"\\\"\\\"Class for the application. Specialized to do event time reporting.\\\"\\\"\\\"\\n    def __init__(self, argv: List[str]) -> None:\\n        super().__init__(argv)\\n        self._start_time = time.monotonic()\\n\\n    def notify(self, arg__1: QObject, arg__2: QEvent) -> bool:\\n        event_type = arg__2.type()\\n        receiver_name = arg__1.objectName()\\n        start = time.monotonic()\\n        ret = super().notify(arg__1, arg__2)\\n        end = time.monotonic()\\n        elapsed_time = (end - start) * 1000\\n        if elapsed_time > 20:\\n            rel_end = end - self._start_time\\n            print(f\\\"{rel_end:.3f}: event {arg__2}, type {event_type}, object {receiver_name}, took {elapsed_time:.3f} msec\\\")\\n\\n        return ret\\n\\n\\ndef main() -> int:\\n    \\\"\\\"\\\"Main function to run the application.\\\"\\\"\\\"\\n    setup_logging()\\n    install_global_exception_handler()\\n\\n    # Create application\\n    app = HumbugApplication(sys.argv)\\n\\n    # Create and set event loop\\n    loop = QEventLoop(app)\\n    asyncio.set_event_loop(loop)\\n\\n    window = MainWindow()\\n    window.show()\\n\\n    # Run the main function\\n    try:\\n        with loop:\\n            loop.run_forever()\\n\\n    except KeyboardInterrupt:\\n        return 0\\n\\n    return 0\\n\\nif __name__ == \\\"__main__\\\":\\n    sys.exit(main())\"\n    }\n}\n```",
      "completed": true,
      "tool_calls": [
        {
          "id": "toolu_01VbuspYsoEm43agkfo79twM",
          "name": "filesystem",
          "arguments": {
            "operation": "write_file",
            "path": "src/humbug/__main__.py",
            "content": "\"\"\"Main entry point for the Humbug application.\"\"\"\n\nimport asyncio\nfrom datetime import datetime, timezone\nimport glob\nimport logging\nfrom logging.handlers import RotatingFileHandler\nimport os\nimport sys\nimport time\nfrom types import TracebackType\nfrom typing import List\n\nfrom PySide6.QtCore import QObject, QEvent\nfrom qasync import QEventLoop, QApplication  # type: ignore[import-untyped]\n\n# pylint: disable=unused-import\nimport syntax.parser_imports\n# pylint: enable=unused-import\n\nfrom humbug.exception_notifier import get_exception_notifier\nfrom humbug.main_window import MainWindow\n\n\ndef setup_logging() -> None:\n    \"\"\"Configure application logging with timestamped files and rotation.\"\"\"\n    # Create logs directory in user's home .humbug directory\n    log_dir = os.path.expanduser(\"~/.humbug/logs\")\n    os.makedirs(log_dir, exist_ok=True)\n\n    # Generate timestamp for log filename\n    timestamp = datetime.now(timezone.utc).strftime(\"%Y-%m-%d-%H-%M-%S-%f\")[:23]\n    log_file = os.path.join(log_dir, f\"{timestamp}.log\")\n\n    # Configure rotating file handler\n    # Keep up to 50 log files, max 1MB each\n    handler = RotatingFileHandler(\n        log_file,\n        maxBytes=1024*1024,  # 1MB\n        backupCount=49,  # Keep 50 files total (current + 49 backups)\n        encoding='utf-8'\n    )\n\n    # Configure logging\n    logging.basicConfig(\n        level=logging.DEBUG,\n        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',\n        handlers=[handler]\n    )\n\n    # Clean up old logs if we have too many\n    cleanup_old_logs(log_dir, max_logs=50)\n\n\ndef cleanup_old_logs(log_dir: str, max_logs: int) -> None:\n    \"\"\"Remove oldest log files if we exceed maximum count.\"\"\"\n    log_files = glob.glob(os.path.join(log_dir, \"*.log*\"))\n    log_files.sort(key=os.path.getctime)  # Sort by creation time\n\n    # Remove oldest files if we have too many\n    while len(log_files) > max_logs:\n        try:\n            os.remove(log_files.pop(0))  # Remove oldest file\n\n        except OSError:\n            pass  # Ignore errors removing old logs\n\n\ndef install_global_exception_handler() -> None:\n    \"\"\"Install a global exception handler for uncaught exceptions.\"\"\"\n    logger = logging.getLogger('GlobalExceptionHandler')\n\n    def handle_exception(exc_type: type[BaseException], exc_value: BaseException, exc_traceback: TracebackType | None) -> None:\n        \"\"\"Handle uncaught exceptions and log them.\"\"\"\n        if issubclass(exc_type, KeyboardInterrupt):\n            # Don't log keyboard interrupt\n            sys.__excepthook__(exc_type, exc_value, exc_traceback)\n            return\n\n        logger.critical(\n            \"Uncaught exception\",\n            exc_info=(exc_type, exc_value, exc_traceback),\n            stack_info=True\n        )\n\n        # Notify the UI about the uncaught exception\n        try:\n            exception_notifier = get_exception_notifier()\n            exception_notifier.notify_exception()\n\n        except Exception:\n            # If notifying the UI fails, don't let that crash the exception handler\n            logger.error(\"Failed to notify UI of uncaught exception\", exc_info=True)\n\n    sys.excepthook = handle_exception\n\n\nclass HumbugApplication(QApplication):\n    \"\"\"Class for the application. Specialized to do event time reporting.\"\"\"\n    def __init__(self, argv: List[str]) -> None:\n        super().__init__(argv)\n        self._start_time = time.monotonic()\n\n    def notify(self, arg__1: QObject, arg__2: QEvent) -> bool:\n        event_type = arg__2.type()\n        receiver_name = arg__1.objectName()\n        start = time.monotonic()\n        ret = super().notify(arg__1, arg__2)\n        end = time.monotonic()\n        elapsed_time = (end - start) * 1000\n        if elapsed_time > 20:\n            rel_end = end - self._start_time\n            print(f\"{rel_end:.3f}: event {arg__2}, type {event_type}, object {receiver_name}, took {elapsed_time:.3f} msec\")\n\n        return ret\n\n\ndef main() -> int:\n    \"\"\"Main function to run the application.\"\"\"\n    setup_logging()\n    install_global_exception_handler()\n\n    # Create application\n    app = HumbugApplication(sys.argv)\n\n    # Create and set event loop\n    loop = QEventLoop(app)\n    asyncio.set_event_loop(loop)\n\n    window = MainWindow()\n    window.show()\n\n    # Run the main function\n    try:\n        with loop:\n            loop.run_forever()\n\n    except KeyboardInterrupt:\n        return 0\n\n    return 0\n\nif __name__ == \"__main__\":\n    sys.exit(main())"
          }
        }
      ]
    },
    {
      "id": "54453f6c-f64d-4b0b-bd92-eb310a21e72a",
      "timestamp": "2025-08-29T20:25:08.239111+00:00",
      "type": "tool_result",
      "content": "```json\n{\n    \"id\": \"toolu_01VbuspYsoEm43agkfo79twM\",\n    \"name\": \"filesystem\",\n    \"content\": \"File written successfully: src/humbug/__main__.py (4,452 bytes)\",\n    \"error\": null\n}\n```",
      "completed": true,
      "tool_results": [
        {
          "id": "toolu_01VbuspYsoEm43agkfo79twM",
          "name": "filesystem",
          "content": "File written successfully: src/humbug/__main__.py (4,452 bytes)",
          "error": null
        }
      ]
    },
    {
      "id": "88c9acb0-1f09-4b57-a2de-dac21d2c7b66",
      "timestamp": "2025-08-29T20:25:08.253170+00:00",
      "type": "user_message",
      "content": "",
      "completed": true,
      "tool_results": [
        {
          "id": "toolu_01VbuspYsoEm43agkfo79twM",
          "name": "filesystem",
          "content": "File written successfully: src/humbug/__main__.py (4,452 bytes)",
          "error": null
        }
      ]
    },
    {
      "id": "30377770-371f-40e8-a68d-1b625b9fce6b",
      "timestamp": "2025-08-29T20:25:11.395916+00:00",
      "type": "ai_response",
      "content": "Perfect! I've implemented the canary functionality as requested. Here's a summary of what I've created:\n\n## Implementation Summary\n\n### 1. **ExceptionNotifier Singleton** (`src/humbug/exception_notifier.py`)\n- Thread-safe singleton class using Qt signals/slots\n- `notify_exception()` method that can be called from any thread\n- Uses `QMetaObject.invokeMethod` with `Qt.QueuedConnection` for thread safety\n- Emits `exception_occurred` signal on the main thread\n\n### 2. **New Color Role** (`src/humbug/color_role.py`)\n- Added `CANARY_BACKGROUND` color role for the exception indicator\n\n### 3. **StyleManager Colors** (`src/humbug/style_manager.py`)\n- Added appropriate red colors for both light and dark themes:\n  - **Dark theme**: `#802020` (dark red that maintains contrast with white text)\n  - **Light theme**: `#c04040` (medium red that maintains contrast with black text)\n\n### 4. **MainWindow Integration** (`src/humbug/main_window.py`)\n- Added `_canary_active` boolean flag to track exception state\n- Connected to the exception notifier's signal in `__init__`\n- `_on_exception_occurred()` method sets the canary flag and refreshes styles\n- Modified `_on_style_changed()` to use canary background color when active\n- Status bar background changes to red when `_canary_active` is `True`\n\n### 5. **Global Exception Handler** (`src/humbug/__main__.py`)\n- Updated to import and use the exception notifier\n- Calls `exception_notifier.notify_exception()` when uncaught exceptions occur\n- Includes error handling to prevent notification failures from crashing the handler\n\n## Key Features\n\n\u2705 **Persistent Canary**: Once an uncaught exception occurs, the status bar stays red for the entire session\n\u2705 **Thread-Safe**: Works correctly even if exceptions occur on background threads  \n\u2705 **Non-Intrusive**: Normal status messages continue to work over the red background\n\u2705 **Theme-Aware**: Uses appropriate red colors for both light and dark themes\n\u2705 **Signal/Slot Architecture**: Clean Qt-native communication between components\n\u2705 **Robust Error Handling**: Exception notification failures don't crash the app\n\nThe status bar will now turn red whenever an uncaught exception occurs, providing a clear visual indicator that something went wrong during the session, even if the application continues to function normally.",
      "completed": true,
      "usage": {
        "prompt_tokens": 88902,
        "completion_tokens": 596,
        "total_tokens": 89498
      },
      "model": "claude-sonnet-4-20250514",
      "reasoning_capability": 1,
      "temperature": 0.7
    }
  ]
}